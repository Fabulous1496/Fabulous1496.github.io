---
title: BombLab
date: 2024-07-07 11:11:49
categories:
- CMU15-213
index_img: /Pictures/CMU15-213/bomblab.jpg
banner_img: /Pictures/CMU15-213/bomblab.jpg
---

# BombLab

**Labæ¦‚è¿°**ï¼šâ€œäºŒè¿›åˆ¶ç‚¸å¼¹â€æ˜¯ä¸€ä¸ª Linux å¯æ‰§è¡Œçš„ C ç¨‹åºï¼ŒåŒ…å«å…­ä¸ªâ€œé˜¶æ®µâ€ã€‚æ¯ä¸ªé˜¶æ®µæœŸæœ›å­¦ç”Ÿåœ¨æ ‡å‡†è¾“å…¥ä¸Šè¾“å…¥ç‰¹å®šå­—ç¬¦ä¸²ã€‚å¦‚æœå­¦ç”Ÿè¾“å…¥äº†é¢„æœŸçš„å­—ç¬¦ä¸²ï¼Œåˆ™è¯¥é˜¶æ®µè¢«â€œæ‹†é™¤â€ã€‚å¦åˆ™ç‚¸å¼¹ä¼šé€šè¿‡æ‰“å°â€œBOOM!!!â€æ¥â€œçˆ†ç‚¸â€ã€‚å­¦ç”Ÿçš„ç›®æ ‡æ˜¯å°½å¯èƒ½å¤šåœ°â€œæ‹†é™¤â€è¯¥ç‚¸å¼¹ã€‚

å› æ­¤ï¼Œæœ¬Labèšç„¦äºåˆ©ç”¨gdbç­‰è°ƒè¯•å™¨æ¥åç¼–è¯‘äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œå¹¶é€æ­¥æ‰§è¡Œæ¯ä¸ªé˜¶æ®µçš„æœºå™¨ä»£ç ï¼Œåˆ©ç”¨å­¦ä¹ çš„æ±‡ç¼–çŸ¥è¯†æ¥æ‹†è§£éšè—åœ¨ä»£ç ä¸­çš„å­—ç¬¦ä¸²å¯†ç ã€‚

## é¢„å¤‡çŸ¥è¯†ï¼šGDBè°ƒè¯•å™¨çš„ä½¿ç”¨

GNUçš„è°ƒè¯•å™¨GDBæä¾›äº†è®¸å¤šæœ‰ç”¨çš„ç‰¹æ€§ï¼Œæ”¯æŒæœºå™¨åŠç¨‹åºçš„è¿è¡Œæ—¶è¯„ä¼°å’Œåˆ†æã€‚æˆ‘ä»¬ä½¿ç”¨ä¸‹é¢æŒ‡ä»¤è¡¨ä¸­çš„å‘½ä»¤æ¥ä½¿ç”¨GDBï¼š

| å‘½ä»¤                    | æ•ˆæœ                                    |
| ----------------------- | --------------------------------------- |
| gdb fileName            | å¼€å§‹è°ƒè¯•fileNameæ–‡ä»¶                    |
| run 1 2 3               | è¿è¡Œç¨‹åºï¼ˆåœ¨æ­¤ç»™å‡ºå‘½ä»¤è¡Œå‚æ•°ï¼‰          |
| kill                    | ç»ˆæ­¢ç¨‹åº                                |
| quit                    | é€€å‡ºGDB                                 |
| break func              | åœ¨å‡½æ•°funcå…¥å£å¤„è®¾ç½®æ–­ç‚¹                |
| break * 0x10000         | åœ¨åœ°å€ 0x10000 å¤„è®¾ç½®æ–­ç‚¹               |
| delete 1                | åˆ é™¤æ–­ç‚¹1ï¼Œæ— indexé»˜è®¤åˆ é™¤æ‰€æœ‰          |
| stepi                   | æ‰§è¡Œ1æ¡æŒ‡ä»¤ï¼ˆåè·Ÿæ•°å­—è¡¨ç¤ºè¿è¡Œå‡ æ¡æŒ‡ä»¤ï¼‰ |
| nexti                   | ç±»ä¼¼äºstepiï¼Œä»¥å‡½æ•°ä¸ºè°ƒç”¨å•ä½           |
| continue                | ç»§ç»­æ‰§è¡Œ                                |
| disas                   | åæ±‡ç¼–å½“å‰å‡½æ•°                          |
| disas func              | åæ±‡ç¼–å‡½æ•°func                          |
| disas 0x10000           | åæ±‡ç¼–åœ°å€0x10000é™„è¿‘çš„å‡½æ•°             |
| disas 0x10000 0x100FF   | åæ±‡ç¼–åœ°å€èŒƒå›´å†…çš„ä»£ç                   |
| print /x $rip           | ä»¥åå…­è¿›åˆ¶è¾“å‡ºç¨‹åºè®¡æ•°å™¨çš„å€¼            |
| print $rax              | ä»¥åè¿›åˆ¶è¾“å‡º%raxçš„å†…å®¹                  |
| print /x $rip           | ä»¥åå…­è¿›åˆ¶è¾“å‡º%raxçš„å†…å®¹                |
| print /t $rax           | ä»¥äºŒè¿›åˆ¶è¾“å‡º%raxçš„å†…å®¹                  |
| print /x 555            | è¾“å‡º555çš„åå…­è¿›åˆ¶è¡¨ç¤º                   |
| print /x ($rsp+8)       | ä»¥åå…­è¿›åˆ¶è¾“å‡º%rspçš„å†…å®¹åŠ 8             |
| print *(int \*) 0x10000 | å°†0x10000åœ°å€æ‰€å­˜å‚¨çš„å†…å®¹ä»¥æ•°å­—å½¢å¼è¾“å‡º |
| print (char *) 0x10000  | è¾“å‡ºå­˜å‚¨åœ¨0x10000çš„å­—ç¬¦ä¸²               |
| x/ $rsp                 | è§£æ%rspä¸­çš„å†…å®¹                        |
| x/w $rsp                | è§£æåœ¨%rspæ‰€æŒ‡ä½ç½®çš„wordï¼ˆ8å­—èŠ‚ï¼‰       |
| info registers          | å¯„å­˜å™¨ä¿¡æ¯                              |
| info stack              | æ ˆä¿¡æ¯                                  |
| info functions          | å‡½æ•°ä¿¡æ¯                                |

æ›´å¤šæŒ‡ä»¤å¯ä»¥æŸ¥è¯¢æ–‡æ¡£æˆ–ä½¿ç”¨/helpæŒ‡ä»¤ã€‚

## æ­£å¼é˜¶æ®µï¼šå¼€å§‹æ‹†å¼¹

### åŸç æ€»è§ˆ

æŠ›å»è¥é€ æ°›å›´æ„Ÿå’ŒèƒŒæ™¯æ•…äº‹çš„â€œDoctor Evilâ€çš„æ³¨é‡Šï¼Œæ•´ä¸ªbomb.cæ–‡ä»¶çš„ç»“æ„å¦‚ä¸‹æ‰€ç¤ºï¼š

```c
#include <stdio.h>
#include <stdlib.h>
#include "support.h"
#include "phases.h"

FILE *infile;

int main(int argc, char *argv[])
{
    char *input;

    if (argc == 1) {  
	infile = stdin;
    } 

    else if (argc == 2) {
	if (!(infile = fopen(argv[1], "r"))) {
	    printf("%s: Error: Couldn't open %s\n", argv[0], argv[1]);
	    exit(8);
	}
    }

    /* You can't call the bomb with more than 1 command line argument. */
    else {
	printf("Usage: %s [<input_file>]\n", argv[0]);
	exit(8);
    }

    initialize_bomb();

    printf("Welcome to my fiendish little bomb. You have 6 phases with\n");
    printf("which to blow yourself up. Have a nice day!\n");

    input = read_line();             
    phase_1(input);                  
    phase_defused();                 
    printf("Phase 1 defused. How about the next one?\n");

    input = read_line();
    phase_2(input);
    phase_defused();
    printf("That's number 2.  Keep going!\n");


    input = read_line();
    phase_3(input);
    phase_defused();
    printf("Halfway there!\n");

    input = read_line();
    phase_4(input);
    phase_defused();
    printf("So you got that one.  Try this one.\n");

    input = read_line();
    phase_5(input);
    phase_defused();
    printf("Good work!  On to the next...\n");

    input = read_line();
    phase_6(input);
    phase_defused();
    
    return 0;
}

```

æ•´æ®µä»£ç çš„é€»è¾‘å¾ˆç®€å•ï¼Œé¦–å…ˆå®šä¹‰äº†ä¸€ä¸ªFileæ–‡ä»¶infileä½œä¸ºæˆ‘ä»¬è¾“å…¥å¯†ç çš„æ–‡ä»¶ï¼Œç„¶åä»£ç ä¼šä»infileä¸­è¯»å–æˆ‘ä»¬çš„å¯†ç å®Œæˆå„ä¸ªé˜¶æ®µçš„è§£å¯†ã€‚è€Œè§£å¯†æ‰€éœ€è¦çš„å­—ç¬¦å°±å‚¨å­˜åœ¨äºŒè¿›åˆ¶æ–‡ä»¶bombä¸­ã€‚

ä½¿ç”¨æŒ‡ä»¤`objdump -d bomb > bomb.asm`ï¼Œæˆ‘ä»¬ä¾¿å¾—åˆ°äº†åç¼–è¯‘åçš„æ–‡ä»¶ã€‚

### Phase_1

é˜…è¯»æ–‡ä»¶ï¼Œæˆ‘ä»¬æ‰¾åˆ°phase_1å¯¹åº”çš„ä»£ç ï¼š

```assembly
0000000000400ee0 <phase_1>:
  400ee0:	48 83 ec 08          	sub    $0x8,%rsp
  400ee4:	be 00 24 40 00       	mov    $0x402400,%esi
  400ee9:	e8 4a 04 00 00       	call   401338 <strings_not_equal>
  400eee:	85 c0                	test   %eax,%eax
  400ef0:	74 05                	je     400ef7 <phase_1+0x17>
  400ef2:	e8 43 05 00 00       	call   40143a <explode_bomb>
  400ef7:	48 83 c4 08          	add    $0x8,%rsp
  400efb:	c3                   	ret    
```

æˆ‘ä»¬å‘ç°ï¼Œå…¶ä¸­åŒ…å«ä¸€ä¸ªæ£€æŸ¥å­—ç¬¦ä¸²æ˜¯å¦ç›¸ç­‰çš„çš„å‡½æ•°`strings_not_equal`ï¼Œå¦‚æœç›¸ç­‰ï¼Œåˆ™è·³è½¬åˆ°åœ°å€0x400ef7å¤„ï¼ˆaddè¡Œï¼‰ï¼Œå¦‚æœä¸ç›¸ç­‰ï¼Œåˆ™è°ƒç”¨`explode_bomb`ï¼Œä¸éš¾æƒ³è±¡ä¼šå‘ç”Ÿä»€ä¹ˆã€‚äºæ˜¯æˆ‘ä»¬é¦–å…ˆå°±æ˜¯è¦åœ¨`explode_bomb`å‡½æ•°å¤„æ‰“ä¸€ä¸ªæ–­ç‚¹ï¼Œç¡®ä¿æˆ‘ä»¬æ¥ä¸‹æ¥çš„æ“ä½œä¸ä¼šå¼•èµ·ç‚¸å¼¹çˆ†ç‚¸ã€‚

åˆ†æå„ä¸ªå¯„å­˜å™¨ï¼Œæˆ‘ä»¬å‘ç°å‡ºç°äº†%rspï¼Œ%esiï¼Œ%eaxä¸‰ä¸ªå¯„å­˜å™¨ã€‚å…¶ä¸­%rspä¸ºæ ˆæŒ‡é’ˆï¼ŒæŒ‡æ˜è¿è¡Œæ—¶æ ˆçš„æ ˆé¡¶ä½ç½®ï¼Œè€Œ%esiä¸º%rsiçš„ä½8å­—èŠ‚ï¼Œä¿å­˜å‡½æ•°è°ƒç”¨çš„ç¬¬äºŒä¸ªå‚æ•°ï¼Œ%eaxä½œä¸º%raxçš„ä½8å­—èŠ‚ï¼Œä¿å­˜å‡½æ•°çš„è¿”å›å€¼ã€‚æ‰€ä»¥æˆ‘ä»¬å°±åˆ»ç”»å‡ºäº†å‡½æ•°`strings_not_equal`çš„åŸºæœ¬å½¢å¼ï¼šæ¥å—è‡³å°‘ä¸¤ä¸ªå‚æ•°å¹¶è¿”å›ä¸€ä¸ªå€¼ã€‚ä¸éš¾æƒ³åˆ°ç¬¬ä¸€ä¸ªå‚æ•°å°±æ˜¯æˆ‘ä»¬è¾“å…¥çš„å­—ç¬¦ä¸²ï¼Œç¬¬äºŒä¸ªå‚æ•°å­˜æ”¾åœ¨åœ°å€**0x402400**çš„å­—ç¬¦ä¸²å°±æ˜¯æˆ‘ä»¬çš„å¯†ç ã€‚

æ¥ä¸‹æ¥æˆ‘ä»¬æ¥æ“ä½œä¸€ä¸‹ï¼Œé¦–å…ˆæ‰“æ–­ç‚¹å¹¶è¿è¡Œï¼š

```bash
gdb bomb
(gdb) break explode_bomb
(gdb) break phase_1
(gdb) run
```

è¿™é‡Œä¼šè®©ä½ è¾“å…¥å¯†ç ï¼Œå¯ä»¥å…ˆéšä¾¿è¾“å…¥ä¸€ä¸ªåˆ°è¾¾æ–­ç‚¹ã€‚

ä¹‹åæˆ‘ä»¬ä¾¿åˆ°è¾¾äº†æ–­ç‚¹phase_1ï¼Œç”¨`disas`æŒ‡ä»¤çœ‹çœ‹å®ƒçš„~~æº~~ç ï¼š

```bash
Breakpoint 2, 0x0000000000400ee0 in phase_1 ()
(gdb) disas
Dump of assembler code for function phase_1:
=> 0x0000000000400ee0 <+0>:     sub    $0x8,%rsp
   0x0000000000400ee4 <+4>:     mov    $0x402400,%esi
   0x0000000000400ee9 <+9>:     call   0x401338 <strings_not_equal>
   0x0000000000400eee <+14>:    test   %eax,%eax
   0x0000000000400ef0 <+16>:    je     0x400ef7 <phase_1+23>
   0x0000000000400ef2 <+18>:    call   0x40143a <explode_bomb>
   0x0000000000400ef7 <+23>:    add    $0x8,%rsp
   0x0000000000400efb <+27>:    ret
```

å¯ä»¥çœ‹åˆ°å’Œæˆ‘ä»¬ä¸Šé¢è§£æå‡ºæ¥çš„ä»£ç ä¸€è‡´ã€‚

ç»§ç»­ä½¿ç”¨`stepi`æŒ‡ä»¤å‘ä¸‹æ‰§è¡Œåˆ°movæŒ‡ä»¤ç»“æŸï¼š

```
(gdb) stepi 2
(gdb) disas
Dump of assembler code for function phase_1:
   0x0000000000400ee0 <+0>:     sub    $0x8,%rsp
   0x0000000000400ee4 <+4>:     mov    $0x402400,%esi
=> 0x0000000000400ee9 <+9>:     call   0x401338 <strings_not_equal>
   0x0000000000400eee <+14>:    test   %eax,%eax
   0x0000000000400ef0 <+16>:    je     0x400ef7 <phase_1+23>
   0x0000000000400ef2 <+18>:    call   0x40143a <explode_bomb>
   0x0000000000400ef7 <+23>:    add    $0x8,%rsp
   0x0000000000400efb <+27>:    ret
End of assembler dump.
```

å¥½çš„ï¼Œæ­¤æ—¶åœ°å€**0x402400**å¤„çš„å­—ç¬¦ä¸²å·²ç»æˆåŠŸç§»åˆ°%esiå¯„å­˜å™¨ä¸­äº†ã€‚æˆ‘ä»¬ä½¿ç”¨`x/s $esi`å¯ä»¥å¾—åˆ°å†…å®¹å­—ç¬¦ä¸²ï¼š

```
(gdb) x/s $esi
0x402400:       "Border relations with Canada have never been better."
```

è¿™ä¾¿æ˜¯æˆ‘ä»¬ç¬¬ä¸€é˜¶æ®µçš„å¯†é’¥ã€‚

ç”±äºè¿™é‡Œæˆ‘ä»¬å·²ç»å¾—åˆ°äº†å­—ç¬¦ä¸²å­˜æ”¾çš„æºåœ°å€ï¼Œæ›´ç®€å•çš„æ–¹æ³•æ˜¯ç›´æ¥è§£æå¯¹åº”åœ°å€ï¼Œä¸éœ€è¦åˆ©ç”¨å¯„å­˜å™¨ã€‚ä½†ç”±äºå®é™…ä¸Šæ¯æ¬¡è¿è¡Œä»£ç çš„åœ°å€æ˜¯ä¸ç¡®å®šçš„ï¼Œä¸€èˆ¬ä¹Ÿä¸ä¼šç›´æ¥å‘ŠçŸ¥åœ°å€ï¼Œæ‰€ä»¥æˆ‘é‡‡å–äº†ä¸€ç§è¿‚å›çš„æ–¹æ³•ã€‚

```bash
(gdb) print (char*) 0x402400
$1 = 0x402400 "Border relations with Canada have never been better."
```

è¿™æ ·ä¹Ÿè¡Œã€‚

### Phase_2

æˆ‘ä»¬é¦–å…ˆæ£€éªŒphase_1çš„å¯†ç æ˜¯å¦æ­£ç¡®ã€‚

```bash
(gdb) break phase_2
Breakpoint 1 at 0x400efc
(gdb) break explode_bomb
Breakpoint 2 at 0x40143a
(gdb) run
Welcome to my fiendish little bomb. You have 6 phases with
which to blow yourself up. Have a nice day!
Border relations with Canada have never been better.
Phase 1 defused. How about the next one?
aaa

Breakpoint 1, 0x0000000000400efc in phase_2 ()
```

å¯ä»¥çœ‹åˆ°ï¼Œæ–­ç‚¹æˆåŠŸåœåœ¨äº†phase_2å¤„ï¼Œè¯´æ˜æˆ‘ä»¬æˆåŠŸé€šè¿‡é˜¶æ®µ1.æ¥ä¸‹æ¥æŠŠphase_2çš„ä»£ç åæ±‡ç¼–å‡ºæ¥ï¼š

```bash
(gdb) disas
Dump of assembler code for function phase_2:
=> 0x0000000000400efc <+0>:     push   %rbp
   0x0000000000400efd <+1>:     push   %rbx
   0x0000000000400efe <+2>:     sub    $0x28,%rsp
   0x0000000000400f02 <+6>:     mov    %rsp,%rsi
   0x0000000000400f05 <+9>:     call   0x40145c <read_six_numbers>
   0x0000000000400f0a <+14>:    cmpl   $0x1,(%rsp)
   0x0000000000400f0e <+18>:    je     0x400f30 <phase_2+52>
   0x0000000000400f10 <+20>:    call   0x40143a <explode_bomb>
   0x0000000000400f15 <+25>:    jmp    0x400f30 <phase_2+52>
   0x0000000000400f17 <+27>:    mov    -0x4(%rbx),%eax
   0x0000000000400f1a <+30>:    add    %eax,%eax
   0x0000000000400f1c <+32>:    cmp    %eax,(%rbx)
   0x0000000000400f1e <+34>:    je     0x400f25 <phase_2+41>
   0x0000000000400f20 <+36>:    call   0x40143a <explode_bomb>
   0x0000000000400f25 <+41>:    add    $0x4,%rbx
   0x0000000000400f29 <+45>:    cmp    %rbp,%rbx
   0x0000000000400f2c <+48>:    jne    0x400f17 <phase_2+27>
   0x0000000000400f2e <+50>:    jmp    0x400f3c <phase_2+64>
   0x0000000000400f30 <+52>:    lea    0x4(%rsp),%rbx
   0x0000000000400f35 <+57>:    lea    0x18(%rsp),%rbp
   0x0000000000400f3a <+62>:    jmp    0x400f17 <phase_2+27>
   0x0000000000400f3c <+64>:    add    $0x28,%rsp
   0x0000000000400f40 <+68>:    pop    %rbx
   0x0000000000400f41 <+69>:    pop    %rbp
   0x0000000000400f42 <+70>:    ret
End of assembler dump.
```

å¯ä»¥å‘ç°å†…éƒ¨çš„ä¸»ä½“å­˜åœ¨å‡½æ•°`read_six_numbers`ä»¥åŠå¼•çˆ†ç¨‹åº`explode_bomb`ã€‚ä¸éš¾çŒœå‡ºå‡½æ•°`read_six_numbers`ä¾¿æ˜¯æ£€éªŒæˆ‘ä»¬ç­”æ¡ˆçš„å‡½æ•°ï¼Œç­”æ¡ˆåŒ…æ‹¬6ä¸ªæ•°å­—ã€‚

æ¥é€æ­¥åˆ†æè¿™æ®µä»£ç çš„é€»è¾‘ï¼š

1. å°†%rbpå’Œ%rbxå‹å…¥æ ˆä¸­ï¼Œå†ç”³è¯·ä¸€ä¸ª0x28ï¼ˆ40å­—èŠ‚ï¼‰çš„ç©ºé—´
2. å°†æ ˆé¡¶%rspå­˜æ”¾çš„æ•°æ®è½¬ç§»åˆ°%rsiä¸­ä½œä¸ºå‡½æ•°`read_six_numbers`çš„ç¬¬äºŒä¸ªå‚æ•°ï¼Œè°ƒç”¨å‡½æ•°ã€‚
3. æ¯”è¾ƒï¼ˆ%rspï¼‰å’Œ1ï¼Œå¦‚æœä¸ç›¸ç­‰ï¼Œç‚¸å¼¹çˆ†ç‚¸ã€‚
4. å¦‚æœç›¸ç­‰ï¼Œè·³è½¬åˆ°0x400f30è¡Œï¼ˆ+52  leaè¡Œï¼‰ï¼Œè¿™è¡Œå°†%rsp+0x4çš„å€¼å­˜å…¥%rbxä¸­ï¼Œä¹‹åå°†%rsp+0x18çš„å€¼å­˜å…¥%rbpã€‚
5. å†è·³è½¬åˆ°0x400f17ï¼ˆ+27  movè¡Œï¼‰ï¼Œå°†%rbx-0x4çš„å€¼å­˜å…¥%eaxï¼Œå†å°†%eaxä¸­çš„å€¼ç¿»å€ã€‚ä¹‹åæ¯”è¾ƒï¼ˆ%rbxï¼‰ï¼ˆè¿™æ˜¯ä¸ªé—´æ¥å–å€ï¼‰å’Œ%eaxçš„å€¼ï¼Œå¦‚æœä¸ç­‰ï¼Œç‚¸å¼¹çˆ†ç‚¸ã€‚
6. å¦‚æœç›¸ç­‰ï¼Œè·³è½¬åˆ°0x400f25è¡Œï¼ˆ+41  addè¡Œï¼‰ï¼Œå°†%rbxçš„å€¼è½¬å˜ä¸º%rbx+0x4ï¼Œå†æ¯”è¾ƒ%rbxå’Œ%rbpçš„å€¼ã€‚
7. å¦‚æœä¸ç›¸ç­‰ï¼Œè·³è½¬åˆ°0x400f17ï¼ˆ+27  movè¡Œï¼‰ï¼Œå½¢æˆå¾ªç¯
8. å¦‚æœç›¸ç­‰ï¼Œè·³è½¬åˆ°0x400f3cï¼ˆ+64  addè¡Œï¼‰ï¼Œå°†%rsp+0x28ï¼ˆå‡å°40å­—èŠ‚ï¼‰ï¼Œ%rbxï¼Œ%rbpå‡ºæ ˆï¼Œé€€å‡ºç¨‹åºã€‚

æˆ‘ä»¬å°è¯•ç¿»è¯‘ä¸ºCè¯­è¨€ä»£ç ï¼šè¿™é‡Œç”±äºæ•°æ®ç±»å‹ä¸ºintï¼Œæ•…åœ°å€æ“ä½œ%rsp+4è½¬æ¢ä¸ºæŒ‡é’ˆä¾¿ä¸ºrsp+1.å…¶å®ƒåœ°æ–¹ä¹Ÿè¿›è¡Œäº†ç›¸åŒçš„å¤„ç†ã€‚

```c
int phase2(int *rsp) 
{
    int *rbx, *rbp, eaxï¼›
    if(*rsp == 1)
    {
        goto L2;
    }
    else
    {
        explode_bomb();
    }
L2:
    rbx = rsp+1;
    rbp = rsp+6;
    goto L3;
L3:
    eax = *(rbx-1);
    eax *= 2;
    if(eax == *rbx)
    {
        goto L4;
    }
    else
    {
        explode_bomb();
    }
L4:
    rbx = rbx+1;
    if(rbx != rbp)
    {
        goto L3;
    }
    else
    {
        return ;
    }
        	
}
```

æˆ‘ä»¬å¯ä»¥ç»§ç»­æŸ¥çœ‹å…³é”®å‡½æ•°`read_six_numbers`çš„ä»£ç ï¼š

```assembly
=> 0x0000000000400efc <+0>:     push   %rbp
   0x0000000000400efd <+1>:     push   %rbx
   0x0000000000400efe <+2>:     sub    $0x28,%rsp
   0x0000000000400f02 <+6>:     mov    %rsp,%rsi
   0x0000000000400f05 <+9>:     call   0x40145c <read_six_numbers>
   # ä¸‹é¢æ³¨æ„%rsi=%rsp
Dump of assembler code for function read_six_numbers:
=> 0x000000000040145c <+0>:     sub    $0x18,%rsp  	#ç”³è¯·ç©ºé—´
   0x0000000000401460 <+4>:     mov    %rsi,%rdx	#å°†%rsièµ‹å€¼ç»™%rdx
   0x0000000000401463 <+7>:     lea    0x4(%rsi),%rcx	#å°†%rsi+4çš„åœ°å€å­˜å…¥%rcx
   0x0000000000401467 <+11>:    lea    0x14(%rsi),%rax	#å°†%rsi+20çš„åœ°å€å­˜å…¥%rax
   0x000000000040146b <+15>:    mov    %rax,0x8(%rsp)	#å°†%raxèµ‹å€¼ç»™%rsp+8
   0x0000000000401470 <+20>:    lea    0x10(%rsi),%rax	#å°†%rsi+16çš„åœ°å€å­˜å…¥%rax
   0x0000000000401474 <+24>:    mov    %rax,(%rsp)	#å°†raxçš„å€¼èµ‹ç»™%rspæŒ‡å‘çš„åœ°å€
   0x0000000000401478 <+28>:    lea    0xc(%rsi),%r9#å°†%rsi+12å­˜å…¥%r9
   0x000000000040147c <+32>:    lea    0x8(%rsi),%r8#å°†%rsi+8å­˜å…¥%r8
   0x0000000000401480 <+36>:    mov    $0x4025c3,%esi	#å°†$0x4025c3èµ‹ç»™%esi
   0x0000000000401485 <+41>:    mov    $0x0,%eax	#å°†0èµ‹ç»™%eax
   0x000000000040148a <+46>:    call   0x400bf0 <__isoc99_sscanf@plt>
   0x000000000040148f <+51>:    cmp    $0x5,%eax	#æ¯”è¾ƒ%eaxçš„å€¼å’Œ0x5
   0x0000000000401492 <+54>:    jg     0x401499 <read_six_numbers+61>
   0x0000000000401494 <+56>:    call   0x40143a <explode_bomb>
   0x0000000000401499 <+61>:    add    $0x18,%rsp	#å›æ”¶ç©ºé—´
   0x000000000040149d <+65>:    ret
End of assembler dump.
```

**__isoc99_sscanf å‡½æ•°**ï¼š

- `__isoc99_sscanf` æ˜¯ `sscanf` å‡½æ•°çš„å®ç°ï¼Œå®ƒç”¨äºä»å­—ç¬¦ä¸²ä¸­è§£ææ ¼å¼åŒ–è¾“å…¥ã€‚
- `sscanf` å‡½æ•°çš„åŸå‹ä¸ºï¼š`int sscanf(const char *str, const char *format, ...);`ï¼Œå®ƒä» `str` ä¸­è¯»å–æ•°æ®å¹¶æ ¹æ® `format` å­—ç¬¦ä¸²è¿›è¡Œè§£æï¼Œå°†ç»“æœå­˜å‚¨åœ¨åé¢çš„å‚æ•°ä¸­ã€‚
- è¿”å›å€¼æ˜¯è§£ææˆåŠŸçš„é¡¹æ•°ï¼Œå‚¨å­˜åœ¨`%rax`ä¸­ï¼Œæ­¤å¤„å…±6é¡¹ï¼Œæ‰€ä»¥æœ‰ä¸€ä¸ªè§£æé¡¹æ•°ä¸æ»¡è¶³å¤§äº5åˆ™çˆ†ç‚¸çš„æŒ‡ä»¤ã€‚

ç»è¿‡è®¡ç®—ï¼Œæˆ‘ä»¬å‘ç°`sscanf`å°†è§£æç»“æœ**æŒ‰ç…§é¡ºåºä¾æ¬¡æŒ‡å‘äº†å†…å­˜ä¸­ä¸€æ®µè¿ç»­çš„åœ°å€ï¼Œä¹Ÿå°±æ˜¯ä»`%rsi`å¼€å§‹å¢é•¿çš„æ•°ç»„ï¼š `%rdx`ï¼ˆ`%rsi` æŒ‡å‘çš„åœ°å€ï¼‰ã€`%rcx`ï¼ˆ`%rsi + 4`ï¼‰ã€`%r8`ï¼ˆ`%rsi + 8`ï¼‰ã€`%r9`ï¼ˆ`%rsi + 12`ï¼‰ã€`%rsp`ï¼ˆ`%rsi + 16`ï¼‰ã€`%rsp + 8`ï¼ˆ`%rsi + 20`ï¼‰æŒ‡å‘çš„å†…å­˜ä½ç½®ã€‚**è€Œå®é™…ä¸Šï¼Œ`read_six_numbers`å‡½æ•°æ‰§è¡Œå®Œæˆå›æ”¶å†…å­˜ç©ºé—´åï¼Œå—åˆ°`%rsi=%rsp`çš„é™åˆ¶ï¼Œæ•°ç»„å®é™…ä¸Šæ˜¯ä»`%rsp`å¼€å§‹ã€‚

çŸ¥é“è¿™ä¸€ç‚¹åï¼Œæˆ‘ä»¬å›è¿‡å¤´çœ‹phase_2å‡½æ•°ï¼šç¬¬ä¸€ä¸ªåˆ¤æ–­é™åˆ¶äº†ç¬¬ä¸€ä¸ªå‚æ•°ä¹Ÿå°±æ˜¯%rspå¿…é¡»ä¸º1.

ç”»å›¾åˆ†æï¼Œå®é™…ä¸ŠåŸå§‹ä»£ç å¯ä»¥ç®€åŒ–ä¸ºä¸€ä¸ªforå¾ªç¯ï¼š

![](/Pictures/CMU15-213/Bomb.jpg)

```c
int phase2(int *rsp)
{
    rsp[0] = 1;
    int rbp=7;
    for(int rbx=1;rbx < rbp; rbx++)
    {
        if(rsp[rbx] != 2*rsp[rbx-1])
        {
            explode_bomb();
        }
    }
}
```

äºæ˜¯æˆ‘ä»¬å¾—åˆ°äº†phase_2çš„å¯†ç ï¼š1 2 4 8 16 32.

### Phase_3

ä¾ç„¶æ˜¯å…ˆæ‰“æ–­ç‚¹å’Œæ£€éªŒç­”æ¡ˆï¼Œå‘ç°æ— è¯¯ã€‚æå–phase_3çš„ä»£ç ï¼š

```assembly
Dump of assembler code for function phase_3:
=> 0x0000000000400f43 <+0>:     sub    $0x18,%rsp	#ç”³è¯·ç©ºé—´
   0x0000000000400f47 <+4>:     lea    0xc(%rsp),%rcx	#%rcx=%rsp+0xc
   0x0000000000400f4c <+9>:     lea    0x8(%rsp),%rdx	#%rdx=%rsp+0x8
   0x0000000000400f51 <+14>:    mov    $0x4025cf,%esi	#%esi=$ox4025cf
   0x0000000000400f56 <+19>:    mov    $0x0,%eax	#%eax=0x0
   0x0000000000400f5b <+24>:    call   0x400bf0 <__isoc99_sscanf@plt>
   0x0000000000400f60 <+29>:    cmp    $0x1,%eax#æ¯”è¾ƒ%eaxå’Œ0x1,%eaxä¸ºè§£æç»“æœ
   0x0000000000400f63 <+32>:    jg     0x400f6a <phase_3+39>	#%eaxå¤§äº1è·³è½¬
   0x0000000000400f65 <+34>:    call   0x40143a <explode_bomb>	#%eaxå°äº1å¼•çˆ†
   0x0000000000400f6a <+39>:    cmpl   $0x7,0x8(%rsp)	#æ¯”è¾ƒ*(%rsp+8)ä¸7
   0x0000000000400f6f <+44>:    ja     0x400fad <phase_3+106>	#å¤§äº7è·³è½¬ï¼Œå¼•çˆ†
   0x0000000000400f71 <+46>:    mov    0x8(%rsp),%eax	#å°äº7%eax=*(%rsp+8)
   0x0000000000400f75 <+50>:    jmp    *0x402470(,%rax,8)#è·³*(0x402470+8%rax)
   0x0000000000400f7c <+57>:    mov    $0xcf,%eax	#%eax=0xcf
   0x0000000000400f81 <+62>:    jmp    0x400fbe <phase_3+123>
   0x0000000000400f83 <+64>:    mov    $0x2c3,%eax	#%eax=0x2c3
   0x0000000000400f88 <+69>:    jmp    0x400fbe <phase_3+123>
   0x0000000000400f8a <+71>:    mov    $0x100,%eax	#%eax=0x100
   0x0000000000400f8f <+76>:    jmp    0x400fbe <phase_3+123>
   0x0000000000400f91 <+78>:    mov    $0x185,%eax	#%eax=0x185
   0x0000000000400f96 <+83>:    jmp    0x400fbe <phase_3+123>
   0x0000000000400f98 <+85>:    mov    $0xce,%eax	#%eax=0xce
   0x0000000000400f9d <+90>:    jmp    0x400fbe <phase_3+123>
   0x0000000000400f9f <+92>:    mov    $0x2aa,%eax	#%eax=0x2aa
   0x0000000000400fa4 <+97>:    jmp    0x400fbe <phase_3+123>
   0x0000000000400fa6 <+99>:    mov    $0x147,%eax	#%eax=0x147
   0x0000000000400fab <+104>:   jmp    0x400fbe <phase_3+123>
   0x0000000000400fad <+106>:   call   0x40143a <explode_bomb>
   0x0000000000400fb2 <+111>:   mov    $0x0,%eax	#%eax=0x0
   0x0000000000400fb7 <+116>:   jmp    0x400fbe <phase_3+123>
   0x0000000000400fb9 <+118>:   mov    $0x137,%eax	#%eax=0x137
   0x0000000000400fbe <+123>:   cmp    0xc(%rsp),%eax	#æ¯”è¾ƒ%eaxå’Œ*(rsp+0xc)
   0x0000000000400fc2 <+127>:   je     0x400fc9 <phase_3+134>	#ç›¸ç­‰è·³è½¬ç»“æŸ
   0x0000000000400fc4 <+129>:   call   0x40143a <explode_bomb>	#ä¸ç­‰çˆ†ç‚¸
   0x0000000000400fc9 <+134>:   add    $0x18,%rsp
   0x0000000000400fcd <+138>:   ret
End of assembler dump.
```

è¿™é‡Œè¦æ³¨æ„ï¼Œä¸€æ¬¡æ˜¯æ— æ³•æ˜¾ç¤ºå…¨éƒ¨ä»£ç çš„ã€‚æˆ‘ä»¬éœ€è¦æ‰§è¡Œä¸€æ¬¡RETç›´åˆ°æ˜¾ç¤º`End of assembler dump.`æ‰ç®—å®Œæˆã€‚

è¿˜æ˜¯ç»§ç»­åˆ†æè¿™æ®µä»£ç çš„é€»è¾‘ï¼Œå‰æ®µè°ƒç”¨`sscanf`ï¼Œè€Œåˆ¤æ–­eaxæ˜¯å¦å¤§äº1è¯´æ˜`sccanf`è§£æå‡ºä¸¤ä¸ªç»“æœï¼Œå­˜æ”¾åœ¨`%rdx(%rsp+8)`å’Œ`%rcx(%rsp+12)`ä¸­ã€‚è€Œformatå­˜æ”¾åœ¨åœ°å€$0x4025cfå¤„ï¼Œæˆ‘ä»¬è§£è¯»ä¸€ä¸‹ï¼š

```
(gdb) print (char*) 0x4025cf
$1 = 0x4025cf "%d %d"
```

å‘ç°æ˜¯ä¸¤ä¸ªæ•´æ•°ï¼Œä¹Ÿå°±æ˜¯è¯´ç¬¬ä¸‰å…³çš„å¯†ç æ˜¯ä¸¤ä¸ªæ•´æ•°ï¼Œè§£æå®Œæˆå`%eax=2`ã€‚

ç„¶åæˆ‘ä»¬è§‚å¯Ÿ+39è¡Œï¼Œæ¯”è¾ƒå¤§äº7ä¼šå¼•çˆ†ï¼Œæ‰€ä»¥æˆ‘ä»¬çš„ç¬¬ä¸€ä¸ªæ•°ä¸€å®šä¸å¤§äº7.ä¹‹åå°†ç¬¬ä¸€ä¸ªæ•°èµ‹å€¼ç»™`%eax`ï¼Œå¹¶è·³è½¬åˆ°`*(0x402470+8%rax)`å¤„ï¼Œè¿™é‡Œç”±äºç½®é›¶ï¼Œ`%rax=%eax`ã€‚

è·³è½¬ä¹‹åä¸‹é¢çš„ä»£ç éƒ½æ˜¯ä¸€è¡Œèµ‹å€¼ä¸€è¡Œè·³è½¬ã€‚æˆ‘ä»¬èšç„¦äºæœ€åç»“æŸçš„æ¡ä»¶ï¼š`æ¯”è¾ƒ%eaxå’Œ*(rsp+0xc)`ï¼Œä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬è·³è½¬çš„`*(0x402470+8%rax)`ä¼šå‘Šè¯‰æˆ‘ä»¬è·³è½¬åˆ°å…¶ä¸­ä¸€è¡Œï¼Œç»™`%eax`èµ‹å€¼åä½¿å…¶äºç¬¬äºŒä¸ªæ•°ç›¸ç­‰ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œç¬¬äºŒä¸ªæ•°å°±æ˜¯ä¸Šé¢`%eax`èµ‹å€¼çš„æ•°çš„å…¶ä¸­ä¹‹ä¸€ã€‚

å…¶å®åšåˆ°è¿™ä¸€æ­¥ï¼Œç”±äºæˆ‘ä»¬çŸ¥é“ç¬¬ä¸€ä¸ªæ•°ä¸å¤§äº7ï¼Œç¬¬äºŒä¸ªæ•°åœ¨ä¸Šé¢çš„èµ‹å€¼ä¸­ï¼Œå·²ç»å¯ä»¥ç©·ä¸¾äº†ğŸ¤£ã€‚ä½†æ˜¯æˆ‘ä»¬è¿˜æ˜¯å…ˆå»æ‰¾åˆ°`*(0x402470+8%rax)`çš„åœ°å€ã€‚

æˆ‘ä»¬æŠŠç¬¬ä¸€ä¸ªæ•°ä»0åˆ°7ä¾æ¬¡èµ‹å€¼ï¼Œå¥½å§ï¼Œå…¶å®è¿™é“é¢˜å¤šè§£ã€‚è§£æå‡ºæ¥å‘ç°å…¶å®æ¯ä¸€ä¸ªå€¼æ­£å¥½å¯¹åº”äº†ä¸€ä¸ªèµ‹å€¼è¯­å¥ã€‚

```assembly
(gdb) print /x *0x402470
$1 = 0x400f7c
```

è€Œ`0x400f7c`å¯¹åº”çš„è¯­å¥ï¼š

```assembly
0x0000000000400f7c <+57>:    mov    $0xcf,%eax	#%eax=0xcf
0x0000000000400f81 <+62>:    jmp    0x400fbe <phase_3+123>
```

æ•…è¿™ä¸€ç»„ç­”æ¡ˆä¸º`0 207`

ç»™å‡ºæ‰€æœ‰å…«ç»„ç­”æ¡ˆï¼š

0 207ï¼›1 311ï¼›2 707ï¼›3 256ï¼›4 389ï¼›5 206ï¼›6 682ï¼›7 327ã€‚

### Phase_4

æ‰“æ–­ç‚¹è§£æï¼š

```assembly
Dump of assembler code for function phase_4:
=> 0x000000000040100c <+0>:     sub    $0x18,%rsp
   0x0000000000401010 <+4>:     lea    0xc(%rsp),%rcx
   0x0000000000401015 <+9>:     lea    0x8(%rsp),%rdx
   0x000000000040101a <+14>:    mov    $0x4025cf,%esi
   0x000000000040101f <+19>:    mov    $0x0,%eax
   0x0000000000401024 <+24>:    call   0x400bf0 <__isoc99_sscanf@plt>
   0x0000000000401029 <+29>:    cmp    $0x2,%eax	#æ¯”è¾ƒ%eaxå’Œ2
   0x000000000040102c <+32>:    jne    0x401035 <phase_4+41>	#ä¸ç›¸ç­‰è·³è½¬ï¼Œçˆ†
   0x000000000040102e <+34>:    cmpl   $0xe,0x8(%rsp)	#æ¯”è¾ƒç¬¬ä¸€ä¸ªæ•°å’Œ14
   0x0000000000401033 <+39>:    jbe    0x40103a <phase_4+46>#å°äºç­‰äºè·³è½¬
   0x0000000000401035 <+41>:    call   0x40143a <explode_bomb>
   0x000000000040103a <+46>:    mov    $0xe,%edx	#%edx=14
   0x000000000040103f <+51>:    mov    $0x0,%esi	#%esi=0
   0x0000000000401044 <+56>:    mov    0x8(%rsp),%edi	#%edi=ç¬¬ä¸€ä¸ªæ•°
   0x0000000000401048 <+60>:    call   0x400fce <func4>
   0x000000000040104d <+65>:    test   %eax,%eax	#æ£€æµ‹æ­£è´Ÿ
   0x000000000040104f <+67>:    jne    0x401058 <phase_4+76>	#éé›¶çˆ†ç‚¸
   0x0000000000401051 <+69>:    cmpl   $0x0,0xc(%rsp)	#æ¯”è¾ƒç¬¬äºŒä¸ªæ•°å’Œ0
   0x0000000000401056 <+74>:    je     0x40105d <phase_4+81>	#ç›¸ç­‰ç»“æŸ
   0x0000000000401058 <+76>:    call   0x40143a <explode_bomb>
   0x000000000040105d <+81>:    add    $0x18,%rsp
   0x0000000000401061 <+85>:    ret
End of assembler dump.
```

å¾ˆåƒå•Šï¼Œå’Œphase_3ï¼Œè¿formatéƒ½æ˜¯ç”¨çš„åŒä¸€ä¸ªã€‚æ‰€ä»¥è¿™æ¬¡çš„å¯†ç ä¹Ÿæ˜¯ä¸¤ä¸ªæ•´æ•°ã€‚ç”±å·²çŸ¥ä¿¡æ¯ï¼Œç¬¬ä¸€ä¸ªæ•°å°äºç­‰äº14ï¼Œè€Œç¬¬ä¸€ã€äºŒä¸ªæ•°è¦ä¸º0ï¼ˆç»è¿‡func4åï¼‰.

è¿™é‡Œæ¶‰åŠåˆ°ä¸€ä¸ªå…³é”®ä¸­é—´å‡½æ•°`func4`ï¼Œæˆ‘ä»¬è°ƒå‡ºæ¥çœ‹ä¸€ä¸‹ï¼š

```assembly
Dump of assembler code for function func4:
=> 0x0000000000400fce <+0>:     sub    $0x8,%rsp
   0x0000000000400fd2 <+4>:     mov    %edx,%eax	#%eax=%edx=14
   0x0000000000400fd4 <+6>:     sub    %esi,%eax	#%eax -= %esiï¼Œè€Œ%esi=0
   0x0000000000400fd6 <+8>:     mov    %eax,%ecx	#%ecx=%eax=14
   0x0000000000400fd8 <+10>:    shr    $0x1f,%ecx	#é€»è¾‘å³ç§»%ecxä¸­31ä½
   0x0000000000400fdb <+13>:    add    %ecx,%eax	#%eax += %ecx
   0x0000000000400fdd <+15>:    sar    %eax			#%eax=%eax/2
   0x0000000000400fdf <+17>:    lea    (%rax,%rsi,1),%ecx	#%ecx=%rax+%rsi
   0x0000000000400fe2 <+20>:    cmp    %edi,%ecx	#æ¯”è¾ƒ%ecxå’Œ%edi
   0x0000000000400fe4 <+22>:    jle    0x400ff2 <func4+36>#å°äºç­‰äºè·³è½¬
   0x0000000000400fe6 <+24>:    lea    -0x1(%rcx),%edx#å¤§äº%edx=%rcx-1
   0x0000000000400fe9 <+27>:    call   0x400fce <func4>#é€’å½’è°ƒç”¨
   0x0000000000400fee <+32>:    add    %eax,%eax	#%eax*=2
   0x0000000000400ff0 <+34>:    jmp    0x401007 <func4+57>	#è·³è½¬ï¼Œç»“æŸ
   0x0000000000400ff2 <+36>:    mov    $0x0,%eax	#%eax=0
   0x0000000000400ff7 <+41>:    cmp    %edi,%ecx	#æ¯”è¾ƒ%ecxä¸%edi
   0x0000000000400ff9 <+43>:    jge    0x401007 <func4+57>	#å¤§äºç­‰äºï¼Œç»“æŸ
   0x0000000000400ffb <+45>:    lea    0x1(%rcx),%esi	#å¦åˆ™%esi=%rcx+1
   0x0000000000400ffe <+48>:    call   0x400fce <func4>	#é€’å½’è°ƒç”¨
   0x0000000000401003 <+53>:    lea    0x1(%rax,%rax,1),%eax#%eax=2%rax+1
   0x0000000000401007 <+57>:    add    $0x8,%rsp
   0x000000000040100b <+61>:    ret
End of assembler dump.
```

è¿™é‡Œ`func4`ä¸­æ²¡æœ‰æ¶‰åŠåˆ°`%rsp+0xc`ä¹Ÿå°±æ˜¯ç¬¬äºŒä¸ªæ•°çš„ä½ç½®ï¼Œé‚£ä¹ˆæˆ‘ä»¬ä¾¿èƒ½ç¡®å®šç¬¬äºŒä¸ªæ•°å°±æ˜¯0.å¯¹äºç¬¬ä¸€ä¸ªæ•°ï¼Œéœ€è¦ç¡®å®šä»€ä¹ˆæ ·çš„è¾“å…¥æ‰èƒ½ä½¿`func4`è¿”å›0.è¿™æ®µå‡½æ•°ç”±äºæ¶‰åŠä¸¤éƒ¨åˆ†çš„é€’å½’è°ƒç”¨ï¼Œè¾ƒä¸ºå¤æ‚ã€‚ç¬”è€…åˆå§‹å‡è®¾ç¬¬ä¸€ä¸ªæ•°ä¸º0å‘ç°èƒ½å¤Ÿå¾—åˆ°è¿”å›å€¼ä¸º0.ä¹Ÿå°±æ˜¯è¯´0 0ä¸ºä¸€ç»„è¾ƒæ˜æ˜¾çš„ç­”æ¡ˆã€‚å®é™…ä¸Šæœ‰ä¸å¤§äº14çš„é™åˆ¶ï¼Œé€ä¸ªä»£å…¥ä¹Ÿèƒ½è§£å‡ºå…¨è§£ã€‚ä½†è¿™é‡Œå°è¯•è½¬æ¢ä¸ºCä»£ç ã€‚

```c
int func4()
{
    static int edx=14, esi=0, edi=x, eax, ecx;  //è¿™é‡Œæ²¡æ¶‰åŠæŒ‡é’ˆæ“ä½œï¼Œå› æ­¤è®¾ä¸ºæ•´å‹è€Œä¸æ˜¯æŒ‡é’ˆã€‚
    eax = edx;
    eax = eax-esi;
    ecx = eax;
    ecx = sign(eax);  //ecxå‚¨å­˜eaxçš„æ­£è´Ÿå·ï¼Œ1ä¸ºè´Ÿ0ä¸ºæ­£
    eax += ecx;
    eax /= 2;
    ecx = eax+esi;
    if(ecx <= edi)
    {
        eax = 0;
        if(ecx >= edi)
        {
            return eax;
        }
        else
        {
            esi = ecx+1;
            eax = func4();
            eax = 2*eax + 1;
            return eax;
        }
    }
    else 
    {
        edx = ecx-1;
        eax = func4();
        eax = eax*2;
        return eax;
    }
}
```

ç»§ç»­ç®€åŒ–,è¿™é‡Œç”±äº`eax`çš„åˆå€¼æ˜¯2ï¼Œç”±æˆ‘ä»¬è¾“å…¥å†³å®šçš„å˜é‡æ˜¯`edi`ï¼Œç”±è§‚å¯Ÿè¿”å›å€¼å¯çŸ¥ï¼Œä¸`eax`çš„åˆå€¼æ— å…³ä¸”`eax`æ’éè´Ÿã€‚å› æ­¤æ‰€æœ‰ç”±ç§»ä½äº§ç”Ÿå‡ºæ¥çš„åˆ¤æ–­ç¬¦å·çš„`ecx`éƒ½ä¸º0ã€‚

```c
// mä»£edxï¼Œnä»£esi
int func4(int x,int m=14,int n=0)
{
    int val; //ä»£ecx
    val = (m+n)/2;
    if(val == x) 
        return 0;
    if(val < x)
    {
        return 2*func4(x,m,val+1)+1;
    }
    if(val > x)
    {
        return 2*func4(x,val-1,n);
    }
}
```

è¿™æ ·æˆ‘ä»¬å°±èƒ½å¿«ä¹çš„åœ¨å¤–é¢å¥—ä¸€ä¸ªforå¾ªç¯å’Œä¸€ä¸ªif==0æ¥åˆ¤æ–­ç­”æ¡ˆå•¦ğŸ˜ã€‚

æœ€ç»ˆç»“æœï¼š

0 0ï¼›1 0ï¼›3 0ï¼›7 0

### Phase_5

è§£æä»£ç ï¼š

```assembly
Dump of assembler code for function phase_5:
=> 0x0000000000401062 <+0>:     push   %rbx
   0x0000000000401063 <+1>:     sub    $0x20,%rsp
   0x0000000000401067 <+5>:     mov    %rdi,%rbx	#%rbx=%rdi
   0x000000000040106a <+8>:     mov    %fs:0x28,%rax#è¿™é‡Œå®é™…ä¸Šæ˜¯è®¾ç½®äº†ä¸€ä¸ªCanary
   0x0000000000401073 <+17>:    mov    %rax,0x18(%rsp)	#*(%rsp+0x18)=%rax
   0x0000000000401078 <+22>:    xor    %eax,%eax	#%eax=0
   0x000000000040107a <+24>:    call   0x40131b <string_length>
   0x000000000040107f <+29>:    cmp    $0x6,%eax	#è¦æ±‚ä¸€ä¸ªé•¿åº¦ä¸º6çš„å­—ç¬¦ä¸²
   0x0000000000401082 <+32>:    je     0x4010d2 <phase_5+112>
   0x0000000000401084 <+34>:    call   0x40143a <explode_bomb>
   0x0000000000401089 <+39>:    jmp    0x4010d2 <phase_5+112>
   0x000000000040108b <+41>:    movzbl (%rbx,%rax,1),%ecx	#%ecx=%rbx+%raxï¼Œä¿ç•™ä½8ä½
   0x000000000040108f <+45>:    mov    %cl,(%rsp)	#*ï¼ˆ%rspï¼‰=%cl
   0x0000000000401092 <+48>:    mov    (%rsp),%rdx	#%rdx=*ï¼ˆ%rspï¼‰
   0x0000000000401096 <+52>:    and    $0xf,%edx	#è·å–å½“å‰å­—ç¬¦åå››ä½ï¼Œè®¾ä¸º0xk
   0x0000000000401099 <+55>:    movzbl 0x4024b0(%rdx),%edx#%edx=*(%rdx+..)ä¿ç•™ä½8ä½ï¼Œä¿ç•™å%edx=0x4024bk
   0x00000000004010a0 <+62>:    mov    %dl,0x10(%rsp,%rax,1)#*(%rsp+%rax+0x10)=%dlï¼Œ%dlä¹Ÿå°±æ˜¯%rdxä½8ä½0xk
   0x00000000004010a4 <+66>:    add    $0x1,%rax	#%rax+=1
   0x00000000004010a8 <+70>:    cmp    $0x6,%rax	#æ¯”è¾ƒ%raxä¸6
   0x00000000004010ac <+74>:    jne    0x40108b <phase_5+41>	#ä¸ç­‰ï¼Œè·³å›+41
   0x00000000004010ae <+76>:    movb   $0x0,0x16(%rsp)	#ç›¸ç­‰ï¼Œ*(%rsp+0x16)=0
   0x00000000004010b3 <+81>:    mov    $0x40245e,%esi	#%esi=0x40245e
   0x00000000004010b8 <+86>:    lea    0x10(%rsp),%rdi	#%rdi=%rsp+0x10
   0x00000000004010bd <+91>:    call   0x401338 <strings_not_equal>
   0x00000000004010c2 <+96>:    test   %eax,%eax	#åˆ¤æ–­å­—ç¬¦æ˜¯å¦ç›¸ç­‰ï¼Œç›¸ç­‰å³ç»“æŸã€‚
   0x00000000004010c4 <+98>:    je     0x4010d9 <phase_5+119>
   0x00000000004010c6 <+100>:   call   0x40143a <explode_bomb>
   0x00000000004010cb <+105>:   nopl   0x0(%rax,%rax,1)
   0x00000000004010d0 <+110>:   jmp    0x4010d9 <phase_5+119>
   0x00000000004010d2 <+112>:   mov    $0x0,%eax	#%eax=0
   0x00000000004010d7 <+117>:   jmp    0x40108b <phase_5+41>
   0x00000000004010d9 <+119>:   mov    0x18(%rsp),%rax
   0x00000000004010de <+124>:   xor    %fs:0x28,%rax
   0x00000000004010e7 <+133>:   je     0x4010ee <phase_5+140>
   0x00000000004010e9 <+135>:   call   0x400b30 <__stack_chk_fail@plt>
   0x00000000004010ee <+140>:   add    $0x20,%rsp
   0x00000000004010f2 <+144>:   pop    %rbx
   0x00000000004010f3 <+145>:   ret
End of assembler dump.
```

åŒæ—¶è§£æç›¸å…³çš„å‡½æ•°`string_length`ï¼š

```assembly
Dump of assembler code for function string_length:
=> 0x000000000040131b <+0>:     cmpb   $0x0,(%rdi)	#æ¯”è¾ƒ*(%rdi)ä¸0
   0x000000000040131e <+3>:     je     0x401332 <string_length+23>	#ç›¸ç­‰ï¼Œç»“æŸ
   0x0000000000401320 <+5>:     mov    %rdi,%rdx	#ä¸ç­‰ï¼Œ%rdx=%rdi
   0x0000000000401323 <+8>:     add    $0x1,%rdx	#%rdx += 1
   0x0000000000401327 <+12>:    mov    %edx,%eax	#%eax=%edx
   0x0000000000401329 <+14>:    sub    %edi,%eax	#%eax -= %edi
   0x000000000040132b <+16>:    cmpb   $0x0,(%rdx)	#æ¯”è¾ƒ*ï¼ˆ%rdxï¼‰å’Œ0
   0x000000000040132e <+19>:    jne    0x401323 <string_length+8>	#ä¸ç­‰ï¼Œè·³å›
   0x0000000000401330 <+21>:    repz ret	#ç›¸ç­‰ï¼Œè¿”å›
   0x0000000000401332 <+23>:    mov    $0x0,%eax
   0x0000000000401337 <+28>:    ret
End of assembler dump.
```

ç»“åˆä¸¤æ®µä»£ç ï¼Œæˆ‘ä»¬å¾—åˆ°`string_length`å‡½æ•°çš„é€»è¾‘ï¼šä»æˆ‘ä»¬çš„è¾“å…¥`%rdi`ä¸­è¯»å–æ•°æ®ï¼Œè¿”å›å­—ç¬¦ä¸²çš„é•¿åº¦ï¼ˆè¿™é‡Œé€šè¿‡è¿ç»­+1åˆ¤æ–­æ˜¯å¦ä¸ºé›¶ä¹Ÿå°±æ˜¯ä¸ºç©ºæ¥åˆ¤æ–­æ˜¯å¦å‚¨å­˜å­—ç¬¦ï¼Œå…¶ä¸­çš„`%eax=%edx-%edi`å°±æ˜¯å­—ç¬¦ä¸²é•¿åº¦ï¼‰ã€‚åˆ¤æ–­`%eax`æ˜¯å¦ä¸º6è¯´æ˜ç­”æ¡ˆæ˜¯ä¸€ä¸ªé•¿åº¦ä¸º6çš„å­—ç¬¦ä¸²ã€‚

ä¸‹é¢å°†`%eax`ç½®é›¶åè·³è½¬åˆ°+41ç»§ç»­ã€‚ä¹‹åç»è¿‡å‡ æ­¥å°†æˆ‘ä»¬è¾“å…¥çš„å­—ç¬¦ä¸²å­˜åˆ°`%rdx`ä¸­ï¼Œå¹¶åªæ”¹å˜äº†ä½4ä½ã€‚æ¯æ¬¡åˆ©ç”¨`%rax+1`å°†å‚¨å­˜åœ¨`0x4024bk`çš„å­—ç¬¦æˆªå–å¾—åˆ°æ¯”å¯¹å­—ç¬¦ä¸²ï¼Œè½¬åˆ°`%rsp+0x10-%rsp+0x15`å¤„ã€‚é‡æ–°å°†å­—ç¬¦ä¸²çš„é¦–åœ°å€`%rsp+0x10`èµ‹ç»™`%rdi`ä½œä¸º`strings_not_equal`å‡½æ•°çš„ç¬¬ä¸€ä¸ªå‚æ•°ï¼Œè°ƒç”¨è¯¥å‡½æ•°ã€‚

```assembly
Dump of assembler code for function strings_not_equal:
=> 0x0000000000401338 <+0>:     push   %r12
   0x000000000040133a <+2>:     push   %rbp
   0x000000000040133b <+3>:     push   %rbx
   0x000000000040133c <+4>:     mov    %rdi,%rbx	#%rbxå‚¨å­˜ç¬¬ä¸€ä¸ªå‚æ•°
   0x000000000040133f <+7>:     mov    %rsi,%rbp
   0x0000000000401342 <+10>:    call   0x40131b <string_length>
   0x0000000000401347 <+15>:    mov    %eax,%r12d	#%r12d=%eax=6
   0x000000000040134a <+18>:    mov    %rbp,%rdi	#%rbpä¸ºç¬¬äºŒä¸ªå‚æ•°èµ‹ç»™%rdi
   0x000000000040134d <+21>:    call   0x40131b <string_length>
   0x0000000000401352 <+26>:    mov    $0x1,%edx	#%edx=1
   0x0000000000401357 <+31>:    cmp    %eax,%r12d	#æ­¤å¤„%eaxä¸ºç¬¬äºŒä¸ªå‚æ•°çš„é•¿åº¦ï¼Œè¿™å‡ æ­¥æ˜¯åˆ¤æ–­ä¸¤è€…æ˜¯å¦ç­‰é•¿ã€‚ä¸ç­‰é•¿è·³è½¬è¿”å›1.
   0x000000000040135a <+34>:    jne    0x40139b <strings_not_equal+99>
   0x000000000040135c <+36>:    movzbl (%rbx),%eax
   0x000000000040135f <+39>:    test   %al,%al
   0x0000000000401361 <+41>:    je     0x401388 <strings_not_equal+80>
   0x0000000000401363 <+43>:    cmp    0x0(%rbp),%al
   0x0000000000401366 <+46>:    je     0x401372 <strings_not_equal+58>
   0x0000000000401368 <+48>:    jmp    0x40138f <strings_not_equal+87>
   0x000000000040136a <+50>:    cmp    0x0(%rbp),%al
   0x000000000040136d <+53>:    nopl   (%rax)
   0x0000000000401370 <+56>:    jne    0x401396 <strings_not_equal+94>
   0x0000000000401372 <+58>:    add    $0x1,%rbx
   0x0000000000401376 <+62>:    add    $0x1,%rbp
   0x000000000040137a <+66>:    movzbl (%rbx),%eax
   0x000000000040137d <+69>:    test   %al,%al
   0x000000000040137f <+71>:    jne    0x40136a <strings_not_equal+50>
   0x0000000000401381 <+73>:    mov    $0x0,%edx
   0x0000000000401386 <+78>:    jmp    0x40139b <strings_not_equal+99>
   0x0000000000401388 <+80>:    mov    $0x0,%edx
   0x000000000040138d <+85>:    jmp    0x40139b <strings_not_equal+99>
   0x000000000040138f <+87>:    mov    $0x1,%edx
   0x0000000000401394 <+92>:    jmp    0x40139b <strings_not_equal+99>
   0x0000000000401396 <+94>:    mov    $0x1,%edx
   0x000000000040139b <+99>:    mov    %edx,%eax
   0x000000000040139d <+101>:   pop    %rbx
   0x000000000040139e <+102>:   pop    %rbp
   0x000000000040139f <+103>:   pop    %r12
   0x00000000004013a1 <+105>:   ret
End of assembler dump.
```

æ•´ä¸ªå‡½æ•°å…ˆæ¯”è¾ƒé•¿åº¦ï¼Œåé€šè¿‡å­—ç¬¦ä¸€ä¸€ä½¿ç”¨`test`æ¯”è¾ƒæ˜¯å¦ç›¸ç­‰ã€‚æ€»ä½“è€Œè¨€ä¸ç­‰è¿”å›1ï¼Œç›¸ç­‰è¿”å›0.

æ¯”è¾ƒæ‰€ç”¨çš„å‡½æ•°å‚¨å­˜åœ¨`%esi`ä¸­ï¼Œè€Œåˆ©ç”¨åœ°å€0x40245eï¼Œæˆ‘ä»¬è§£æå‡ºç”¨äºæ¯”è¾ƒçš„å­—ç¬¦ï¼š

```assembly
(gdb) print (char*) 0x40245e
$1 = 0x40245e "flyers"
```

åŒæ—¶æˆ‘ä»¬è§£æä½äº`0x4024b0`å¤„çš„å­—ç¬¦ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬éœ€è¦æˆªå–å‡ºflyersçš„æºå­—ç¬¦ï¼š

```assembly
(gdb) print (char*) 0x4024b0
$2 = 0x4024b0 <array> "maduiersnfotvbylSo you think you can stop the bomb with ctrl-c, do you?"
```

è§‚å¯Ÿå¯å¾—ï¼Œè¦å‡‘é½flyersï¼Œéœ€è¦æºå­—ç¬¦ä¸²çš„indexä¸º9ã€15ã€14ã€5ã€6ã€7ã€‚è€Œæˆ‘ä»¬è¾“å…¥çš„å…­ä¸ªå­—ç¬¦éœ€è¦æ»¡è¶³ASCIIç çš„ä½4ä½è¦è¯‘å‡ºå¯¹åº”æ•°å­—ä½œä¸ºåç§»é‡ã€‚æŸ¥è¡¨å¯å¾—ç­”æ¡ˆä¸ºï¼š

**ionefg.**

### Phase_6

æœ€åä¸€å…³æ— ç–‘æ˜¯æœ€å¤æ‚çš„ä¸€å…³ï¼Œæºç çš„é‡éƒ½æ˜¯å·¨å¤§çš„ï¼š

å¾ˆé•¿ï¼Œä½†å…¶ä¸­çš„é€»è¾‘å¹¶ä¸å›°éš¾ï¼Œæˆ‘ä»¬åªéœ€è¦~~äº¿ç‚¹~~è€å¿ƒæ…¢æ…¢çœ‹å°±è¡Œï¼ˆï¼‰ã€‚

```assembly
Dump of assembler code for function phase_6:
=> 0x00000000004010f4 <+0>:     push   %r14
   0x00000000004010f6 <+2>:     push   %r13
   0x00000000004010f8 <+4>:     push   %r12
   0x00000000004010fa <+6>:     push   %rbp
   0x00000000004010fb <+7>:     push   %rbx
   0x00000000004010fc <+8>:     sub    $0x50,%rsp
   0x0000000000401100 <+12>:    mov    %rsp,%r13
   0x0000000000401103 <+15>:    mov    %rsp,%rsi
   0x0000000000401106 <+18>:    call   0x40145c <read_six_numbers>
   0x000000000040110b <+23>:    mov    %rsp,%r14	#%r14=%rsp
   0x000000000040110e <+26>:    mov    $0x0,%r12d	#r12d=0
   0x0000000000401114 <+32>:    mov    %r13,%rbp	#%rbp=%r13
   0x0000000000401117 <+35>:    mov    0x0(%r13),%eax	#%eax=*(%r13)ï¼Œç¬¬ä¸€ä¸ªæ•°
   0x000000000040111b <+39>:    sub    $0x1,%eax	#%eax -= 1
   0x000000000040111e <+42>:    cmp    $0x5,%eax	#æ¯”è¾ƒ%eaxå’Œ5
   0x0000000000401121 <+45>:    jbe    0x401128 <phase_6+52>	#å°äºç­‰äºï¼Œç»§ç»­
   0x0000000000401123 <+47>:    call   0x40143a <explode_bomb>
   0x0000000000401128 <+52>:    add    $0x1,%r12d	#%r12d += 1
   0x000000000040112c <+56>:    cmp    $0x6,%r12d	#æ¯”è¾ƒ%r12dä¸6
   0x0000000000401130 <+60>:    je     0x401153 <phase_6+95>	#ç›¸ç­‰è·³è½¬
   0x0000000000401132 <+62>:    mov    %r12d,%ebx	#ä¸ç­‰ï¼Œ%ebx=%r12d=1
   0x0000000000401135 <+65>:    movslq %ebx,%rax	#%rax=%ebx=%r12d
   0x0000000000401138 <+68>:    mov    (%rsp,%rax,4),%eax#%eax=%rsp+4%raxï¼Œç›¸å½“äºç§»åŠ¨åˆ°ä¸‹ä¸€ä¸ªæ•°
   0x000000000040113b <+71>:    cmp    %eax,0x0(%rbp)#æ¯”è¾ƒ*(%rbp)ä¸%eax
   0x000000000040113e <+74>:    jne    0x401145 <phase_6+81>#ä¸ç­‰ï¼Œç»§ç»­è¿è¡Œ
   0x0000000000401140 <+76>:    call   0x40143a <explode_bomb>
   0x0000000000401145 <+81>:    add    $0x1,%ebx	#%ebx +=1
   0x0000000000401148 <+84>:    cmp    $0x5,%ebx	#æ¯”è¾ƒ%ebxå’Œ5
   0x000000000040114b <+87>:    jle    0x401135 <phase_6+65>#å°äºç­‰äºï¼Œè·³å›
   0x000000000040114d <+89>:    add    $0x4,%r13	#å¤§äº5ï¼Œ%r13=4
   0x0000000000401151 <+93>:    jmp    0x401114 <phase_6+32>
   0x0000000000401153 <+95>:    lea    0x18(%rsp),%rsi
   0x0000000000401158 <+100>:   mov    %r14,%rax
   0x000000000040115b <+103>:   mov    $0x7,%ecx
   0x0000000000401160 <+108>:   mov    %ecx,%edx
   0x0000000000401162 <+110>:   sub    (%rax),%edx	#7-%raxï¼Œå°†ç»“æœæ”¾å›
   0x0000000000401164 <+112>:   mov    %edx,(%rax)
   0x0000000000401166 <+114>:   add    $0x4,%rax	#ç§»åŠ¨åˆ°ä¸‹ä¸€ä¸ªæ•°
   0x000000000040116a <+118>:   cmp    %rsi,%rax
   0x000000000040116d <+121>:   jne    0x401160 <phase_6+108>
   0x000000000040116f <+123>:   mov    $0x0,%esi
   0x0000000000401174 <+128>:   jmp    0x401197 <phase_6+163>
   0x0000000000401176 <+130>:   mov    0x8(%rdx),%rdx	#ç§»åŠ¨åˆ°ä¸‹ä¸€ä¸ªèŠ‚ç‚¹
   0x000000000040117a <+134>:   add    $0x1,%eax
   0x000000000040117d <+137>:   cmp    %ecx,%eax
   0x000000000040117f <+139>:   jne    0x401176 <phase_6+130>
   0x0000000000401181 <+141>:   jmp    0x401188 <phase_6+148>
   0x0000000000401183 <+143>:   mov    $0x6032d0,%edx
   0x0000000000401188 <+148>:   mov    %rdx,0x20(%rsp,%rsi,2)#èµ‹å€¼ä¸ºè¾“å…¥åºå·
   0x000000000040118d <+153>:   add    $0x4,%rsi
   0x0000000000401191 <+157>:   cmp    $0x18,%rsi
   0x0000000000401195 <+161>:   je     0x4011ab <phase_6+183>
   0x0000000000401197 <+163>:   mov    (%rsp,%rsi,1),%ecx
   0x000000000040119a <+166>:   cmp    $0x1,%ecx
   0x000000000040119d <+169>:   jle    0x401183 <phase_6+143>
   0x000000000040119f <+171>:   mov    $0x1,%eax
   0x00000000004011a4 <+176>:   mov    $0x6032d0,%edx
   0x00000000004011a9 <+181>:   jmp    0x401176 <phase_6+130>
   0x00000000004011ab <+183>:   mov    0x20(%rsp),%rbx#ä¾æ¬¡åˆ¤åˆ«å°äº
   0x00000000004011b0 <+188>:   lea    0x28(%rsp),%rax
   0x00000000004011b5 <+193>:   lea    0x50(%rsp),%rsi
   0x00000000004011ba <+198>:   mov    %rbx,%rcx
   0x00000000004011bd <+201>:   mov    (%rax),%rdx
   0x00000000004011c0 <+204>:   mov    %rdx,0x8(%rcx)
   0x00000000004011c4 <+208>:   add    $0x8,%rax
   0x00000000004011c8 <+212>:   cmp    %rsi,%rax
   0x00000000004011cb <+215>:   je     0x4011d2 <phase_6+222>
   0x00000000004011cd <+217>:   mov    %rdx,%rcx
   0x00000000004011d0 <+220>:   jmp    0x4011bd <phase_6+201>
   0x00000000004011d2 <+222>:   movq   $0x0,0x8(%rdx)
   0x00000000004011da <+230>:   mov    $0x5,%ebp
   0x00000000004011df <+235>:   mov    0x8(%rbx),%rax
   0x00000000004011e3 <+239>:   mov    (%rax),%eax
   0x00000000004011e5 <+241>:   cmp    %eax,(%rbx)
   0x00000000004011e7 <+243>:   jge    0x4011ee <phase_6+250>
   0x00000000004011e9 <+245>:   call   0x40143a <explode_bomb>
   0x00000000004011ee <+250>:   mov    0x8(%rbx),%rbx
   0x00000000004011f2 <+254>:   sub    $0x1,%ebp
   0x00000000004011f5 <+257>:   jne    0x4011df <phase_6+235>
   0x00000000004011f7 <+259>:   add    $0x50,%rsp
   0x00000000004011fb <+263>:   pop    %rbx
   0x00000000004011fc <+264>:   pop    %rbp
   0x00000000004011fd <+265>:   pop    %r12
   0x00000000004011ff <+267>:   pop    %r13
   0x0000000000401201 <+269>:   pop    %r14
   0x0000000000401203 <+271>:   ret
End of assembler dump.
```

åˆ†é˜¶æ®µåˆ†æï¼š

- ä»å¼€å¤´åˆ°+18ï¼Œå‡ºç°å‡½æ•°`read_six_numbers`ï¼Œè¯´æ˜æˆ‘ä»¬çš„è¾“å…¥ä¾æ—§æ˜¯6ä¸ªæ•°å­—ï¼Œè€Œ6ä¸ªæ•°å­—å‚¨å­˜åœ¨`%rsp`å¼€å¤´çš„æ•°ç»„ä¸­ã€‚

- +39è¡Œ`%eax-1`ï¼Œæ§åˆ¶æ¯ä¸ªæ•°ä¸å¤§äº6ã€‚

- +60 ~ +95ï¼Œè¿™é‡Œä¸»è¦ç”¨äºåˆ¤æ–­ä¸¤æ•°ä¹‹é—´æ˜¯å¦ç›¸ç­‰ã€‚

- +108 ~ +128ï¼Œå°†å…­ä¸ªæ•°éƒ½è½¬åŒ–ä¸º7-%rax

- +130 ~ +181ï¼Œæˆ‘ä»¬å‘ç°ä¸€ä¸ªåœ°å€ï¼š0x6032d0ï¼Œæ‰“å°å‡ºæ¥

  ```assembly
  (gdb) x/24w 0x6032d0
  0x6032d0 <node1>:       332     1       6304480 0
  0x6032e0 <node2>:       168     2       6304496 0
  0x6032f0 <node3>:       924     3       6304512 0
  0x603300 <node4>:       691     4       6304528 0
  0x603310 <node5>:       477     5       6304544 0
  0x603320 <node6>:       443     6       0       0
  ```

  å‘ç°äº†å…­ä¸ªèŠ‚ç‚¹ï¼Œæ­£è¯´æ˜è¿™ä¸ªåœ°å€å‚¨å­˜çš„æ˜¯ä¸€ä¸ªé“¾è¡¨ã€‚è€Œ`mov    0x8(%rdx),%rdx`ä»£è¡¨ç§»åŠ¨åˆ°ä¸‹ä¸€ä¸ªèŠ‚ç‚¹ã€‚å…¶ä¸­ï¼Œåºå·1~6æ˜¯è¿™äº›èŠ‚ç‚¹çš„ç¼–å·ï¼Œå‰é¢çš„æ•°å­—æ˜¯å‚¨å­˜çš„å€¼ã€‚

  å¾—çŸ¥è¿™ä¸€ç‚¹åï¼Œæˆ‘ä»¬åˆ†æä»£ç ï¼Œå¾—çŸ¥è¿™ä¸€æ®µä»£ç çš„æ ¸å¿ƒæ˜¯åˆ©ç”¨æˆ‘ä»¬è¾“å…¥çš„ç¼–å·åºåˆ—å¯¹å…¶è¿›è¡Œé‡æ–°æ’åºï¼ˆä¹Ÿå°±æ˜¯%rspï¼Œ%rsiå’Œ%rdxä¹‹é—´çš„äº’ç›¸æ“ä½œï¼‰ã€‚

- +183åï¼šåˆ¤æ–­é“¾è¡¨æ˜¯å¦æ»¡è¶³é™åºã€‚å› æ­¤åœ¨å‰é¢æˆ‘ä»¬éœ€è¦æ»¡è¶³é™åºï¼Œè€Œé™åºçš„é“¾è¡¨å­˜æ”¾çš„æ•°æ®æ˜¯ç»è¿‡7-xå¤„ç†çš„ã€‚å› æ­¤æŒ‰æºå€¼é™åºä¸ºï¼š3ï¼Œ4ï¼Œ5ï¼Œ6ï¼Œ1ï¼Œ2ï¼Œç»è¿‡å¤„ç†åçš„é™åºä¸º4ï¼Œ3ï¼Œ2ï¼Œ1ï¼Œ6ï¼Œ5ã€‚è¿™å°±æ˜¯æˆ‘ä»¬çš„ç»“æœã€‚

æœ€åæ£€éªŒç»“æœï¼š

```assembly
(gdb) run ans.txt
Starting program: /home/usr/CMU15-213 labs/bomb/bomb ans.txt
[Thread debugging using libthread_db enabled]
Using host libthread_db library "/lib/x86_64-linux-gnu/libthread_db.so.1".
Welcome to my fiendish little bomb. You have 6 phases with
which to blow yourself up. Have a nice day!
Phase 1 defused. How about the next one?
That's number 2.  Keep going!
Halfway there!
So you got that one.  Try this one.
Good work!  On to the next...
Congratulations! You've defused the bomb!
```

å®Œæˆï¼